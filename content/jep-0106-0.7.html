<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0106: JID Escaping</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="JID Escaping">
<meta name="DC.Creator" content="Joe Hildebrand">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Description" content="This JEP specifies a mechanism that enables the display of Jabber Identifiers (JIDs) with characters disallowed by the Nodeprep profile of stringprep.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2005-05-08">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0106">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2005 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;http://www.opencontent.org/openpub/&gt;).">
</head>
<body bgcolor="#FFFFFF">
<h1>JEP-0106: JID Escaping</h1>
<p>This JEP specifies a mechanism that enables the display of Jabber Identifiers (JIDs) with characters disallowed by the Nodeprep profile of stringprep.</p>
<p><hr></p>
<p style="color:red">NOTICE: This JEP is currently within Last Call or under consideration by the Jabber Council for advancement to the next stage in the JSF standards process. For further details, visit &lt;<a href="http://www.jabber.org/council/queue.shtml">http://www.jabber.org/council/queue.shtml</a>&gt;.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Proposed<br>
            Type: Standards Track<br>
            Number: 0106<br>
            Version: 0.7<br>
            Last Updated: 2005-05-08<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, JEP-0030<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: jid\20escaping<br></p>
<h2>Author Information</h2>
<h3>Joe Hildebrand</h3>
<p class="indent">
        Email: jhildebrand@jabber.com<br>
        JID: hildjj@jabber.org</p>
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email: stpeter@jabber.org<br>
        JID: stpeter@jabber.org</p>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2005 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;<a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocols defined in this JEP have been developed outside the Internet Standards Process and are to be understood as extensions to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#reqs">Requirements</a>
</dt>
<dt>3.  <a href="#discovery">Discovery</a>
</dt>
<dt>4.  <a href="#transforms">Transformations</a>
</dt>
<dl>
<dt>4.1.  <a href="#concepts">Concepts</a>
</dt>
<dt>4.2.  <a href="#encoding">Encoding Transformation</a>
</dt>
<dt>4.3.  <a href="#decoding">Decoding Transformation</a>
</dt>
</dl>
<dt>5.  <a href="#bizrules">Business Rules</a>
</dt>
<dl>
<dt>5.1.  <a href="#bizrules-processing">Native Processing</a>
</dt>
<dt>5.2.  <a href="#bizrules-algorithm">Address Transformation Algorithm</a>
</dt>
<dt>5.3.  <a href="#bizrules-exceptions">Exceptions</a>
</dt>
<dt>5.4.  <a href="#bizrules-othermethods">JID Escaping vs. Older Methods</a>
</dt>
</dl>
<dt>6.  <a href="#impl">Implementation Notes</a>
</dt>
<dl>
<dt>6.1.  <a href="#impl-email">Email Addresses</a>
</dt>
<dt>6.2.  <a href="#impl-sip">SIP Addresses</a>
</dt>
<dt>6.3.  <a href="#impl-im">IM and Presence Addresses</a>
</dt>
<dt>6.4.  <a href="#impl-imps">IMPS Addresses</a>
</dt>
<dt>6.5.  <a href="#impl-ldap">LDAP Distinguished Names</a>
</dt>
</dl>
<dt>7.  <a href="#security">Security Considerations</a>
</dt>
<dt>8.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>9.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl><dt>9.1.  <a href="#registrar-features">Service Discovery Features</a>
</dt></dl>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style=""><span class="ref" style="">XMPP Core</span>  [<a href="#nt-id2251129">1</a>] defines the Nodeprep profile of stringprep (<span class="ref" style="">RFC 3454</span>  [<a href="#nt-id2251154">2</a>]), which specifies that the following nine Unicode code points are disallowed in the node identifier portion of a Jabber Identifier (hereafter we refer to these as "the disallowed characters"):</p>
  <ul>
    <li>All whitespace characters (which reduce to U+0020, also called SP)</li>
    <li>U+0022 (")</li>
    <li>U+0026 (&amp;)</li>
    <li>U+0027 (')</li>
    <li>U+002F (/)</li>
    <li>U+003A (:)</li>
    <li>U+003C (&lt;)</li>
    <li>U+003E (&gt;)</li>
    <li>U+0040 (@)</li>
  </ul>
  <p class="" style="">This restriction is an inconvenience for users who have one or more of the disallowed characters in their desired usernames, particularly in the case of the ' character, which is common in names like O'Hara and D'Artagnan. The restriction is a positive hardship if existing email addresses are mapped to JIDs, since some of the disallowed characters are allowed in the username portion of an email address (specifically, the characters &amp; ' / as described in Sections 3.2.4 and 3.2.5 of <span class="ref" style="">RFC 2822</span>  [<a href="#nt-id2251236">3</a>]).</p>
  <p class="" style="">If the &amp; character had not been in the list of disallowed characters, then normal XML escaping conventions (as specified in <span class="ref" style="">XML 1.0</span>  [<a href="#nt-id2250394">4</a>]) could have been used, with the result that D'Artagnan (for example) could have been rendered as D&amp;apos;artagnan [sic]. Since there are good reasons for each of the disallowed characters, another escaping mechanism is needed.</p>
  <p class="" style="">It might have been desirable to use percent-encoding (e.g., %27 for the ' character) as specified in Section 2.1 of <span class="ref" style="">RFC 3986</span>  [<a href="#nt-id2250436">5</a>]. However, that approach was rejected since the % character is an often-used character in existing JIDs (e.g., to replace the @ character in gateway addresses) and the resulting ambiguity would have caused misdelivered or undeliverable messages. Therefore, a new mechanism is described herein to escape only the disallowed characters and only in the node identifier portion of JIDs.</p>
<h2>2.
       <a name="reqs">Requirements</a>
</h2>
  <p class="" style="">This JEP addresses the following requirements:</p>
  <ol start="" type="">
    <li>The escaping mechanism shall apply to the node identitier portion of a JID only, and MUST NOT be applied to domain identifiers or resource identifiers.</li>
    <li>Escaped JIDs MUST conform to the definition of a Jabber ID as specified in <span style="font-weight: bold">RFC 3920</span>, including the Nodeprep profile of stringprep.  In particular this means that even after passing through Nodeprep, the JID MUST be valid, with the result that Unicode look-alikes like U+02BC (Modifier Letter Apostrophe) MUST NOT be used.</li>
    <li>It MUST NOT be possible for clients to use this escaping mechanism to avoid the goal of stringprep; namely, that JIDs that look alike should have same character representation after being processed by stringprep. Therefore, this mechanism MUST NOT be applied to any characters other than the disallowed characters.</li>
    <li>Existing JIDs that include portions of the escaping mechanism MUST continue to be valid.</li>
    <li>The escaping mechanism MUST NOT break commonly deployed Jabber/XMPP software implementations such as servers, components, gateways, and clients.</li>
    <li>The escaping mechanism SHOULD NOT place undue strain upon server implementations; implementations or deployments that do not need to unescape SHOULD be able to ignore the escaping mechanism.</li>
  </ol>
<h2>3.
       <a name="discovery">Discovery</a>
</h2>
  <p class="" style="">If an entity needs to discover whether another entity supports JID escaping, it MUST send a disco#info request to the other entity as specified in <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2255165">6</a>].</p>
  <p class="caption">Example 1. Client requests features</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='porthos@musketeers.bourbon.gov/gate'
    to='irc.shakespeare.lit'
    id='info1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If the queried entity supports JID escaping, it MUST return a <span style="font-weight: bold">jid\20escaping</span> [sic] feature in its reply.</p>
  <p class="caption">Example 2. Service responds with features</p>
<div class="indent"><pre>
&lt;iq type='get'
    to='porthos@musketeers.bourbon.gov/gate'
    from='irc.shakespeare.lit'
    id='info1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
...
    &lt;feature var='jid\20escaping'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>4.
       <a name="transforms">Transformations</a>
</h2>
  <div class="indent">
<h3>4.1 <a name="concepts">Concepts</a>
</h3>
    <p class="" style="">This JEP specifies encoding each disallowed character as \hexhex -- where "hexhex" is the hexadecimal value of the Unicode code point in question, ignoring the leading "00" in the code point (e.g., 27 for the ' character, resulting in an encoding of \27). (Note: This escaping method is quite similar to that used for disallowed characters in LDAP distinguished names, as specified in <span class="ref" style="">RFC 2253</span>  [<a href="#nt-id2255244">7</a>].) Full encoding and decoding transformations for all nine disallowed characters are provided in the following sections. In addition, encoding and decoding transformations are shown for the \ character in case it needs to be "double-escaped" when it occurs in a non-XMPP address as part of a string that corresponds to one of the other encoded characters.</p>
    <p class="" style="">Note: All transformations are exactly as specified below. CASE IS SIGNIFICANT. Lowercase was selected since Nodeprep will case fold to lowercase for US-ASCII characters such as A, C, E, and F.</p>
  </div>
  <div class="indent">
<h3>4.2 <a name="encoding">Encoding Transformation</a>
</h3>
    <p class="" style="">The encoding transformations are defined in the following table. Typically, encoding is performed only by a client that is processing information provided by a human user in unescaped form, or by a gateway to some external system (e.g., email or LDAP) that needs to generate a JID.</p>
    <p class="caption">Table 1: Mapping from Unescaped to Encoded Characters</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
<th colspan="" rowspan="">Unescaped Character</th>
<th colspan="" rowspan="">Encoded Character</th>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;space&gt;</td>
<td align="" colspan="" rowspan="">\20</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">"</td>
<td align="" colspan="" rowspan="">\22</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&amp;</td>
<td align="" colspan="" rowspan="">\26</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">'</td>
<td align="" colspan="" rowspan="">\27</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">/</td>
<td align="" colspan="" rowspan="">\2f</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">:</td>
<td align="" colspan="" rowspan="">\3a</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;</td>
<td align="" colspan="" rowspan="">\3c</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&gt;</td>
<td align="" colspan="" rowspan="">\3e</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">@</td>
<td align="" colspan="" rowspan="">\40</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\</td>
<td align="" colspan="" rowspan="">\5c</td>
</tr>
    </table>
    <p class="caption">Example 3. JID Encoding: Porthos starts a chat, typing into his client the JID d'artagnan@musketeers.bourbon.gov:</p>
<div class="indent"><pre>
&lt;message 
    from='porthos@musketeers.bourbon.gov/gate'
    to='d\27artagnan@musketeers.bourbon.gov'
    type='chat'&gt;
  &lt;body&gt;And do you always forget your eyes when you run?&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.3 <a name="decoding">Decoding Transformation</a>
</h3>
    <p class="" style="">The decoding transformations are defined in the following table. Typically, decoding is performed only by a client that wants to display JIDs containing encoded characters to a human user, or by a gateway to some external system (e.g., email or LDAP) that needs to generate identifiers for foreign systems.</p>
    <p class="caption">Table 2: Mapping from Encoded to Decoded Characters</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
<th colspan="" rowspan="">Encoded Character</th>
<th colspan="" rowspan="">Decoded Character</th>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\20</td>
<td align="" colspan="" rowspan="">&lt;space&gt;</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\22</td>
<td align="" colspan="" rowspan="">"</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\26</td>
<td align="" colspan="" rowspan="">&amp;</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\27</td>
<td align="" colspan="" rowspan="">'</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\2f</td>
<td align="" colspan="" rowspan="">/</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\3a</td>
<td align="" colspan="" rowspan="">:</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\3c</td>
<td align="" colspan="" rowspan="">&lt;</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\3e</td>
<td align="" colspan="" rowspan="">&gt;</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\40</td>
<td align="" colspan="" rowspan="">@</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">\5c</td>
<td align="" colspan="" rowspan="">\</td>
</tr>
    </table>
    <p class="caption">Example 4. JID Encoding: D'Artagnan the elder sends SMTP mail through a gateway:</p>
<div class="indent"><pre>
&lt;message 
    from='d\27artagnan@gascon.fr/elder'
    to='tréville%musketeers.bourbon.gov@smtp.example.com'&gt;
  &lt;body&gt;I recommend my son to you.&lt;/body&gt;
&lt;/message&gt;
    </pre></div>
  </div>
<h2>5.
       <a name="bizrules">Business Rules</a>
</h2>
  <div class="indent">
<h3>5.1 <a name="bizrules-processing">Native Processing</a>
</h3>
    <p class="" style="">The following processing rules apply to native XMPP implementations:</p>
    <ol start="" type="">
      <li>A client SHOULD render an encoded character as its decoded equivalent when presenting it to a human user.</li>
      <li>A server MAY decode an encoded character for communication with external systems (e.g. LDAP), but only <span style="font-style: italic">after</span> the Nodeprep profile of stringprep has been applied.</li>
      <li>The decoding transformation MUST be NFKC-safe -- i.e., it MUST conform to Unicode normalization form KC (see Appendix B.3 of <span style="font-weight: bold">RFC 3454</span>).</li>
      <li>An entity MUST NOT include the unescaped or decoded version of an encoded character over the wire in any XML stanzas sent to another entity.</li>
      <li>An entity MUST NOT use the unescaped or decoded version of an encoded character when comparing two JIDs.</li>
    </ol>
  </div>
  <div class="indent">
<h3>5.2 <a name="bizrules-algorithm">Address Transformation Algorithm</a>
</h3>
    <p class="" style="">When transforming a non-XMPP address into an XMPP address, an implementation MUST adhere to the following process:</p>
    <ol start="" type="">
      <li>The original address MUST first be properly decoded (e.g., according to the rules in <span style="font-weight: bold">RFC 3986</span>) before it is transformed into a JID.</li>
      <li>Any instances of strings that correspond to encodings of the disallowed characters (e.g., the string "\27") in the original address MUST be "double-escaped" by converting the backslash character to the string "\5c".</li>
      <li>The URI scheme component MUST be removed.</li>
      <li>All disallowed characters in the original address MUST be properly encoded in the resulting JID (as described above).</li>
    </ol>
    <p class="" style="">While the fourth step should be clear from the foregoing text and the third step is necessary since XMPP addresses are not URIs, the meaning of the first and second steps may not be obvious.</p>
    <p class="" style="">Regarding step one, many non-XMPP messaging systems use URIs to identify addresses (examples include the mailto:, sip:, sips:, im:, pres:, and wv: URI schemes) or otherwise encode an identifier (e.g., an LDAP distinguished name). Before transforming an address or identifier into a JID, it MUST first be decoded according the rules specified for that type of address or identifier in order to ensure that the proper characters are transformed.</p>
    <p class="" style="">Regarding step two, it is possible for some non-XMPP addresses to contain strings that correspond to JID-escaped characters (e.g., "\27"). Consider a Wireless Village address of &lt;wv:\3and\2is\5@example.com&gt; -- if that addresses were directly converted into into a JID, the resulting XMPP address would be \3and\2is\5@example.com, which could be construed as :nd\2is\5@example.com if JID escaping logic is applied. Therefore the leading \ character MUST be converted to the string "\5c" during the transformation, leading to a JID of \5c3and\2is\5@example.com (which would be presented to a human user as \3and\2is\5@example.com). Escaping of the backslash character before two hexhex characters MUST NOT be performed if the string is "\5c", only if the string corresponds to the encoded representation of one ofthe disallowed characters.</p>
  </div>
  <div class="indent">
<h3>5.3 <a name="bizrules-exceptions">Exceptions</a>
</h3>
    <p class="" style="">In order to maintain as much backward compatibility as possible, partial escape sequences and escape sequences corresponding to characters not on the list of disallowed characters MUST be ignored.</p>
    <p class="caption">Example 5. Partial escape sequence</p>
<div class="indent"><pre><span style="font-weight: bold">\2plus\2is\4</span> is not modified by encoding or decoding transformations.</pre></div>
    <p class="caption">Example 6. Invalid escape sequence 1</p>
<div class="indent"><pre><span style="font-weight: bold">foo\bar</span> is not modified (to <span style="font-weight: bold">fooºr</span>) by encoding or decoding transformations.</pre></div>
    <p class="caption">Example 7. Invalid escape sequence 2</p>
<div class="indent"><pre><span style="font-weight: bold">foob\41r</span> is not modified (to <span style="font-weight: bold">foobAr</span>) by encoding or decoding transformations.</pre></div>
  </div>
  <div class="indent">
<h3>5.4 <a name="bizrules-othermethods">JID Escaping vs. Older Methods</a>
</h3>
    <p class="" style="">When a client attempts to communicate with another entity through a gateway, it needs to know which encoding mechanism to use. A client MUST assume that the gateway does not support the JID escaping mechanism unless it explicitly discovers support for the <span style="font-weight: bold">jid\20escaping</span> [sic] feature via Service Discovery as shown above. If there any errors in the service discovery exchange or if support for JID escaping is not discovered, the client SHOULD proceed as follows:</p>
    <ol start="" type="">
      <li>If the gateway supports the 'jabber:iq:gateway' protocol (as specified in <span class="ref" style="">Gateway Interaction</span>  [<a href="#nt-id2255986">8</a>]), use that protocol.</li>
      <li>If the gateway does not support the 'jabber:iq:gateway' protocol, use customary escaping mechanisms (such as transformation of the @ character to the % character).</li>
    </ol>
  </div>
<h2>6.
       <a name="impl">Implementation Notes</a>
</h2>
  <p class="" style="">In order to assist implementors, this section describes specific mappings between JIDs and addresses or identifiers used in the following standardized protocols:</p>
  <ul>
    <li>Mailboxes and the mailto: URI scheme as used in email.</li>
    <li>The sip: and sips: URI schemes as used in SIP/SIMPLE.</li>
    <li>The im: and pres: URI schemes.</li>
    <li>The wv: URI scheme as used in Wireless Village (IMPS).</li>
    <li>LDAP distinguished names.</li>
  </ul>
  <div class="indent">
<h3>6.1 <a name="impl-email">Email Addresses</a>
</h3>
    <p class="" style="">The address format for an Internet mailbox is specified in <span style="font-weight: bold">RFC 2822</span>. The identifier of interest in this context is the "addr-spec" address and more particularly the "dot-atom" rule specified in Section 3.2.4, i.e., the email address shorn of angle brackets, display names, comments, quoted strings, and the like. Because some deployments of XMPP messaging systems may want to re-use existing email addresses as JIDs, it is helpful to define how to transform an email address into a JID.</p>
    <p class="" style="">In general, it is straightforward to transform an email address (i.e., a "dot-atom") into a JID, since traditional email addresses allow US-ASCII characters only rather than the nearly full range of Unicode code points allowed in a JID.  [<a href="#nt-id2256076">9</a>] However, there are three characters allowed in the local-part of an email address that are not allowed in the node identifier portion of a JID: namely, the characters &amp; ' / as described in Sections 3.2.4 and 3.2.5 of <span style="font-weight: bold">RFC 2822</span>. In order to transform these characters, a compliant implementation MUST use the methods specified herein.</p>
    <p class="caption">Example 8. An Email Address Containing JID-Disallowed Characters</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 9. The Transformed JID</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 10. The JID as Presented to a User</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="" style="">(Note: Because the backslash character is forbidden in the "dot-atom" construction, an email address should not contain a string that corresponds to one of the encoded characters specified in the <a href="#transforms">Transformations</a> section of this document; therefore, no such examples are shown; see below under <a href="#impl-imps">IMPS Addresses</a>.)</p>
    <p class="" style="">An email address may also exist in the form of a mailto: URI as specified in <span class="ref" style="">RFC 2368</span>  [<a href="#nt-id2256171">10</a>]. Before transforming a mailto: URI into a JID, it MUST be URL-decoded and all headers MUST be removed, leaving a mailbox identifier, as shown in the following example.</p>
    <p class="caption">Example 11. A mailto: URI Containing JID-Disallowed Characters</p>
<div class="indent"><pre>
mailto:here%27s_a_wild_%26_%2Fcr%zy%2F_address@example.com?subject=that%20is%20crazy%21
    </pre></div>
    <p class="caption">Example 12. The Resulting Mailbox</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 13. The Transformed JID</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 14. The JID as Presented to a User</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="" style="">The foregoing examples showed how to transform an email address or mailto: URI into a JID. However, it also may be necessary to convert a JID into an email address or mailto: URI, as shown in the following example.</p>
    <p class="caption">Example 15. User Enters Address, Including Disallowed Characters</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 16. Client Transforms Address Using JID Escaping</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 17. Application Converts Escaped JID to Mailbox</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 18. Application Converts Mailbox to mailto: URI</p>
<div class="indent"><pre>
mailto:here%27s_a_wild_%26_%2Fcr%zy%2F_address@example.com
    </pre></div>
  </div>
  <div class="indent">
<h3>6.2 <a name="impl-sip">SIP Addresses</a>
</h3>
    <p class="" style="">As specified in <span class="ref" style="">RFC 3261</span>  [<a href="#nt-id2256316">11</a>], a SIP address (i.e., a sip: or sips: URI) can be quite complex if URI parameters or headers are included. However, a basic SIP address (the combination of the optional "userinfo" and required "hostport" constructions) is essentially similar to an email address (e.g., the same characters &amp; ' / allowed in an email address but disallowed in an XMPP node identifier are also allowed in a basic SIP address).</p>
    <p class="caption">Example 19. A Basic sip: URI Containing JID-Disallowed Characters</p>
<div class="indent"><pre>
sip:here%27s_a_wild_%26_%2Fcr%zy%2F_address@example.com
    </pre></div>
    <p class="caption">Example 20. The URL-Decoded Address</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 21. The Transformed JID</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 22. The JID as Presented to a User</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="" style="">The foregoing example showed how to transform a sip: or sips: URI into a JID. However, it also may be necessary to convert a JID into a sip: or sips: URI, as shown in the following example.</p>
    <p class="caption">Example 23. User Enters Address, Including Disallowed Characters</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 24. Client Transforms Address Using JID Escaping</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 25. Application Converts Escaped JID to sip: URI</p>
<div class="indent"><pre>
sip:here%27s_a_wild_%26_%2Fcr%zy%2F_address@example.com
    </pre></div>
  </div>
  <div class="indent">
<h3>6.3 <a name="impl-im">IM and Presence Addresses</a>
</h3>
    <p class="" style="">The im: and pres: URI schemes are specified in <span class="ref" style="">RFC 3860</span>  [<a href="#nt-id2256386">12</a>] and <span class="ref" style="">RFC 3859</span>  [<a href="#nt-id2256408">13</a>] respectively. With the exception of headers, an im: or pres: URI is simply a mailbox (as specified in <span style="font-weight: bold">RFC 2822</span>) prepended with the im: or pres: scheme. Thus a basic IM or PRES address (not including optional headers) is essentially similar to an email address (e.g., the same characters &amp; ' / allowed in an email address but disallowed in an XMPP node identifier are also allowed in a basic IM or PRES address).</p>
    <p class="caption">Example 26. A Basic im: URI Containing JID-Disallowed Characters</p>
<div class="indent"><pre>
im:here%27s_a_wild_%26_%2Fcr%zy%2F_address@example.com
    </pre></div>
    <p class="caption">Example 27. The URL-Decoded Address</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 28. The Transformed JID</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 29. The JID as Presented to a User</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="" style="">The foregoing example showed how to transform an im: or pres: URI into a JID. However, it also may be necessary to convert a JID into an im: or pres: URI, as shown in the following example.</p>
    <p class="caption">Example 30. User Enters Address, Including Disallowed Characters</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address@example.com
    </pre></div>
    <p class="caption">Example 31. Client Transforms Address Using JID Escaping</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address@example.com
    </pre></div>
    <p class="caption">Example 32. Application Converts Escaped JID to pres: URI</p>
<div class="indent"><pre>
pres:here%27s_a_wild_%26_%2Fcr%zy%2F_address@example.com
    </pre></div>
  </div>
  <div class="indent">
<h3>6.4 <a name="impl-imps">IMPS Addresses</a>
</h3>
    <p class="" style="">The Instant Messaging and Presence Service (IMPS) protocol was originally defined by the Wireless Village consortium and is now maintained by the <span class="ref" style="">Open Mobile Alliance (OMA)</span>  [<a href="#nt-id2256514">14</a>]. An IMPS address is formatted as a wv: URI, as specified in <span class="ref" style="">WV Client-Server Protocol v1.1</span>  [<a href="#nt-id2256538">15</a>]. A basic address (not including a private resource) is of the form &lt;wv:user-id@domain&gt; and an address with a private resource is of the form &lt;wv:user-id/resource@domain&gt;.</p>
    <p class="" style="">The "User-ID" construction is either a mobile phone number (beginning with "+1" for international numbers and a digit for national numbers) or an "Internet-Identity". An "Internet-Identity" may contain any US-ASCII character other than / @ + SP TAB and thus may include the following characters that are disallowed in the node identifier portion of a JID: " &amp; ' / : &lt; &gt; (which characters MUST be escaped when transforming an IMPS address into a JID). However, some of those characters are also reserved in URI syntax (namely the &amp; ' / characters) so those characters will be found in encoded form within a wv: URI.</p>
    <p class="caption">Example 33. A Basic wv: URI Containing JID-Disallowed Characters</p>
<div class="indent"><pre>
wv:here%27s_a_wild_%26_%2Fcr%zy%2F_address_for%3A%3Cwv%3E%28%22IMPS%22%29@example.com
    </pre></div>
    <p class="caption">Example 34. The URL-Decoded Address</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address_for:&lt;wv&gt;("IMPS")@example.com
    </pre></div>
    <p class="caption">Example 35. The Transformed JID</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address_for\3a\3cwv\3e(\22IMPS\22)@example.com
    </pre></div>
    <p class="caption">Example 36. The JID as Presented to a User</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address_for:&lt;wv&gt;("IMPS")@example.com
    </pre></div>
    <p class="" style="">Unlike the foregoing address types, IMPS addresses are allowed to contain backslashes. This implies that it is possible for an IMPS address to contain a string that corresponds to one of the encoded character representations for code points that are disallowed in XMPP node identifiers. An example would be the IMPS address &lt;wv:\3and\2is\5@example.com&gt;, where the string "\3a" could be interpreted as the : character if that IMPS address is directly converted into a JID. Therefore, the leading \ character MUST be transformed to "\5c" in order to avoid possible ambiguity. Thus the transformed JID would be &lt;\5c3and\2is\5@example.com&gt;, which would be presented to a user as &lt;\3and\2is\5@example.com&gt;.</p>
    <p class="" style="">If an IMPS address contains a private resource, a gateway between XMPP and IMPS should process the resource and append it to the end of the JID; however, such gateway behavior is out of scope for this JEP.</p>
    <p class="" style="">The foregoing example showed how to transform a wv: URI into a JID. However, it also may be necessary to convert a JID into a wv: URI, as shown in the following example.</p>
    <p class="caption">Example 37. User Enters Address, Including Disallowed Characters</p>
<div class="indent"><pre>
here's_a_wild_&amp;_/cr%zy/_address_for:&lt;wv&gt;("IMPS")@example.com
    </pre></div>
    <p class="caption">Example 38. Client Transforms Address Using JID Escaping</p>
<div class="indent"><pre>
here\27s_a_wild_\26_\2fcr%zy\2f_address_for\3a\3cwv\3e(\22IMPS\22)@example.com
    </pre></div>
    <p class="caption">Example 39. Application Converts Escaped JID to wv: URI</p>
<div class="indent"><pre>
wv:here%27s_a_wild_%26_%2Fcr%zy%2F_address_for%3A%3Cwv%3E%28%22IMPS%22%29@example.com
    </pre></div>
  </div>
  <div class="indent">
<h3>6.5 <a name="impl-ldap">LDAP Distinguished Names</a>
</h3>
    <p class="" style="">Within the Lightweight Directory Access Protocol (see <span class="ref" style="">RFC 2251</span>  [<a href="#nt-id2256710">16</a>]), a "distinguished name" (DN) is a hierarchically-organized string representation that uniquely identifies a user, system, or organization. It is possible that some messaging systems use LDAP distinguished names to identify entities that can communicate using the system (e.g., this is reputed to be the case for certain releases of the Lotus Sametime system sold by IBM), and in any case it may be helpful to transform an LDAP distinguished name into an XMPP address for identification or addressing purposes.</p>
    <p class="" style="">As previously mentioned, a UTF-8 string representation of LDAP distinguished names is specified in <span style="font-weight: bold">RFC 2253</span>. This representation specifies that the characters , + " \ &lt; &gt; ; are to be escaped with the backslash character (e.g., the string "\," would be used to escape the , character) and that any other non-US-ASCII characters are to be escaped using a string of the form "\xx".</p>
    <p class="" style="">The following example shows a distinguished name (and transformations thereof) for a person whose common name is "D'Artagnan Saint-André" and who is associated with an organization called "Example &amp; Company, Inc." whose domain name is "example.com":</p>
    <p class="caption">Example 40. A Distinguished Name</p>
<div class="indent"><pre>
CN=D'Artagnan Saint-André,O=Example &amp; Company, Inc.,DC=example,DC=com
    </pre></div>
    <p class="caption">Example 41. UTF-8 Representation of Distinguished Name</p>
<div class="indent"><pre>
CN=D'Artagnan Saint-Andr\E9,O=Example &amp;amp; Company\, Inc.,DC=example,DC=com
    </pre></div>
    <p class="" style="">This example assumes that the specified user is identified with a gateway running at st.example.com (note that the backslash escaping the , character in the organization name is removed during the transformation).</p>
    <p class="caption">Example 42. The Transformed JID</p>
<div class="indent"><pre>
CN=D\27Artagnan\20Saint-Andr\E9,O=Example\20\26\20Company,\20Inc.,DC=example,DC=com@st.example.com
    </pre></div>
    <p class="caption">Example 43. The JID as Presented to a User</p>
<div class="indent"><pre>
CN=D'Artagnan Saint-André,O=Example &amp; Company, Inc.,DC=example,DC=com@st.example.com
    </pre></div>
    <p class="" style="">Naturally, a more intelligent gateway could use the Domain Components to construct a more readable JID, such as &lt;D\27Artagnan\20Saint-André@example.com&gt;; however, such gateway behavior is out of scope for this JEP.</p>
    <p class="" style="">The foregoing example showed how to transform an LDAP distinguished name into a JID. However, it also may be necessary to convert a JID into an LDAP distinguished name, as shown in the following example.</p>
    <p class="caption">Example 44. User Enters Address, Including Disallowed Characters</p>
<div class="indent"><pre>
CN=D'Artagnan Saint-Andr&amp;#xe9;,O=Example &amp;amp; Company, Inc.,DC=example,DC=com@st.example.com
    </pre></div>
    <p class="caption">Example 45. Client Transforms Address Using JID Escaping</p>
<div class="indent"><pre>
CN=D\27Artagnan\20Saint-Andr\E9,O=Example\20\26\20Company,\20Inc.,DC=example,DC=com@st.example.com
    </pre></div>
    <p class="caption">Example 46. Application Converts Escaped JID to UTF-8 Representation of LDAP Distinguished Name</p>
<div class="indent"><pre>
CN=D'Artagnan Saint-Andr\E9,O=Example &amp;amp; Company\, Inc.,DC=example,DC=com
    </pre></div>
    <p class="caption">Example 47. Application Converts UTF-8 Representation to LDAP Distinguished Name</p>
<div class="indent"><pre>
CN=D'Artagnan Saint-André,O=Example &amp; Company, Inc.,DC=example,DC=com
    </pre></div>
  </div>
<h2>7.
       <a name="security">Security Considerations</a>
</h2>
  <p class="" style="">An entity that performs JID escaping MUST NOT compare unescaped/decoded versions, otherwise messages and other information could be directed to an entity other than the intended recipient.</p>
  <p class="" style="">An entity that transforms a non-XMPP address into a JID MUST follow the algorithm specified in the <a href="#bizrules-algorithm">Address Transformation Algorithm</a> section of this document, otherwise messages and other information could be directed to an entity other than the intended recipient.</p>
<h2>8.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This JEP requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2256929">17</a>].</p>
<h2>9.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>9.1 <a name="registrar-features">Service Discovery Features</a>
</h3>
    <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2256977">18</a>] shall include the <span style="font-weight: bold">jid\20escaping</span> [sic] feature in its registry of service discovery features.</p>
  </div>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<p><a name="nt-id2251129">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2251154">2</a>. RFC 3454: Preparation of Internationalized Strings (stringprep) &lt;<a href="http://www.ietf.org/rfc/rfc3454.txt"> http://www.ietf.org/rfc/rfc3454.txt </a>&gt;.</p>
<p><a name="nt-id2251236">3</a>. RFC 2822: Internet Message Format &lt;<a href="http://www.ietf.org/rfc/rfc2822.txt">http://www.ietf.org/rfc/rfc2822.txt</a>&gt;.</p>
<p><a name="nt-id2250394">4</a>. Extensible Markup Language (XML) 1.0 (Third Edition) &lt;<a href="http://www.w3.org/TR/REC-xml/">http://www.w3.org/TR/REC-xml/</a>&gt;.</p>
<p><a name="nt-id2250436">5</a>. RFC 3986: Uniform Resource Identifiers (URI): Generic Syntax &lt;<a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>&gt;.</p>
<p><a name="nt-id2255165">6</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2255244">7</a>. RFC 2253: Lightweight Directory Access Protocol (v3): UTF-8 String Representation of Distinguished Names &lt;<a href="http://www.ietf.org/rfc/rfc2253.txt">http://www.ietf.org/rfc/rfc2253.txt</a>&gt;.</p>
<p><a name="nt-id2255986">8</a>. JEP-0100: Gateway Interaction &lt;<a href="http://www.jabber.org/jeps/jep-0100.html">http://www.jabber.org/jeps/jep-0100.html</a>&gt;.</p>
<p><a name="nt-id2256076">9</a>. This specification does not cover recent efforts to define internationalized email addresses.</p>
<p><a name="nt-id2256171">10</a>. RFC 2368: The mailto URL scheme &lt;<a href="http://www.ietf.org/rfc/rfc2368.txt">http://www.ietf.org/rfc/rfc2368.txt</a>&gt;.</p>
<p><a name="nt-id2256316">11</a>. RFC 3261: Session Initiation Protocol (SIP) &lt;<a href="http://www.ietf.org/rfc/rfc3261.txt">http://www.ietf.org/rfc/rfc3261.txt</a>&gt;.</p>
<p><a name="nt-id2256386">12</a>. RFC 3860: Common Profile for Instant Messaging (CPIM) &lt;<a href="http://www.ietf.org/rfc/rfc3860.txt">http://www.ietf.org/rfc/rfc3860.txt</a>&gt;.</p>
<p><a name="nt-id2256408">13</a>. RFC 3859: Common Profile for Presence (CPP) &lt;<a href="http://www.ietf.org/rfc/rfc3859.txt">http://www.ietf.org/rfc/rfc3859.txt</a>&gt;.</p>
<p><a name="nt-id2256514">14</a>. The Open Mobile Alliance is the focal point for the development of mobile service enabler specifications, which support the creation of interoperable end-to-end mobile services. For further information, see &lt;<a href="http://www.openmobilealliance.org/">http://www.openmobilealliance.org/</a>&gt;.</p>
<p><a name="nt-id2256538">15</a>. Wireless Village Client-Server Protocol v1.1 &lt;<a href="http://www.openmobilealliance.org/tech/affiliates/wv/wvindex.html">http://www.openmobilealliance.org/tech/affiliates/wv/wvindex.html</a>&gt;.</p>
<p><a name="nt-id2256710">16</a>. RFC 2251: Lightweight Directory Access Protocol (v3) &lt;<a href="http://www.ietf.org/rfc/rfc2251.txt">http://www.ietf.org/rfc/rfc2251.txt</a>&gt;.</p>
<p><a name="nt-id2256929">17</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2256977">18</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.7 (2005-05-08)</h4>
<div class="indent">Added examples of transforming JIDs to non-XMPP address formats. (psa)
    </div>
<h4>Version 0.6 (2005-05-06)</h4>
<div class="indent">Changed format from #xx; to \xx per list discussion; added extensive implementation notes. (psa)
    </div>
<h4>Version 0.5 (2005-04-21)</h4>
<div class="indent">Changed to U+00xx format for code points; added references to various RFCs; corrected terminology; cleaned up text and flow. (psa)
    </div>
<h4>Version 0.4 (2005-04-04)</h4>
<div class="indent">Corrected several small textual errors and ambiguities; slightly reorganized textual flow. (psa)
    </div>
<h4>Version 0.3 (2005-03-16)</h4>
<div class="indent">Clarified relationship between JID escaping and traditional client proxy gateway behavior; fixed several small errors. (psa)
    </div>
<h4>Version 0.2 (2003-10-21)</h4>
<div class="indent">Editorial cleanup; added security considerations. (psa)
    </div>
<h4>Version 0.1 (2003-07-21)</h4>
<div class="indent">Initial version. (jjh)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
