<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0369: Mediated Information eXchange (MIX)</title><link rel="stylesheet" type="text/css" href="xmpp.css" /><link href="prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="Mediated Information eXchange (MIX)" /><meta name="DC.Creator" content="Kevin Smith" /><meta name="DC.Creator" content="Steve Kille" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This document defines Mediated Information eXchange (MIX), an XMPP protocol extension for the exchange of information among multiple users through a mediating service. The protocol can be used to provide human group communication and communication between non-human entities using channels, although with greater flexibility and extensibility than existing groupchat technologies such as Multi-User Chat (MUC).   MIX uses Publish-Subscribe to provide flexible access and publication, and uses Message Archive Management (MAM) to provide storage and archiving. " /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2017-02-13" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0369" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 &#x2013; 2017 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0369: Mediated Information eXchange (MIX)</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This document defines Mediated Information eXchange (MIX), an XMPP protocol extension for the exchange of information among multiple users through a mediating service. The protocol can be used to provide human group communication and communication between non-human entities using channels, although with greater flexibility and extensibility than existing groupchat technologies such as Multi-User Chat (MUC).   MIX uses Publish-Subscribe to provide flexible access and publication, and uses Message Archive Management (MAM) to provide storage and archiving. </td></tr><tr valign="top"><td><strong>Authors:</strong></td><td>Kevin Smith, Steve Kille, Peter Saint-Andre</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 – 2017 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Experimental</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>0.8</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2017-02-13</td></tr></table><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems are advised to carefully consider whether it is appropriate to deploy implementations of this protocol before it advances to a status of Draft.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#reqs">Requirements</a><br />3.  <a href="#concepts">Concepts</a><br />   
      3.1.  <a href="#concepts-approach">Specification Appproach</a><br />   
      3.2.  <a href="#concepts-core">Core Concepts</a><br />   
      3.3.  <a href="#concepts-pubsub">MIX and PubSub</a><br />   
      3.4.  <a href="#concepts-mam">MIX and MAM</a><br />   
      3.5.  <a href="#concepts-mix-participant-server">Behaviour of MIX Participant's Server</a><br />   
      3.6.  <a href="#concepts-presence">User Presence in MIX</a><br />   
      3.7.  <a href="#concepts-pm">Private Messages</a><br />   
      3.8.  <a href="#proxy-jid">Proxy JIDs and JID Visibility</a><br />   
      3.9.  <a href="#concepts-nodes">Standard Nodes</a><br />      
      3.9.1.  <a href="#roles">Roles</a><br />      
      3.9.2.  <a href="#node-archiving">Node Archiving</a><br />      
      3.9.3.  <a href="#messages-node">Messages Node</a><br />      
      3.9.4.  <a href="#participants-node">Participants Node</a><br />      
      3.9.5.  <a href="#jid-map-node">JID Map Node</a><br />      
      3.9.6.  <a href="#presence-node">Presence Node</a><br />      
      3.9.7.  <a href="#info-node">Information Node</a><br />      
      3.9.8.  <a href="#allowed-node">Allowed</a><br />      
      3.9.9.  <a href="#banned-node">Banned</a><br />      
      3.9.10.  <a href="#config-node">Configuration Node</a><br />   
      3.10.  <a href="#non-standard-nodes">Non-Standard Nodes</a><br />4.  <a href="#error-handling">Error Handling</a><br />5.  <a href="#discovery">Discovery</a><br />   
      5.1.  <a href="#disco-service">Discovering a MIX service</a><br />   
      5.2.  <a href="#disco-channel-list">Discovering the Channels on a Service</a><br />   
      5.3.  <a href="#disco-channel-info">Discovering Channel Information</a><br />   
      5.4.  <a href="#disco-channel-nodes">Discovering Nodes at a Channel</a><br />   
      5.5.  <a href="#find-channel-info">Determining Information about a Channel</a><br />   
      5.6.  <a href="#find-channel-participants">Determining the Participants in a Channel</a><br />   
      5.7.  <a href="#mix-client-discovery">Discovering Client MIX Capability</a><br />6.  <a href="#usecases">Use Cases</a><br />   
      6.1.  <a href="#usecases-user">Common User Use Cases</a><br />      
      6.1.1.  <a href="#usecase-user-join">Joining a Channel</a><br />      
      6.1.2.  <a href="#usecase-roster-management">Roster Management</a><br />      
      6.1.3.  <a href="#usecase-visibilty-pref">User Preferences and Additional Information</a><br />      
      6.1.4.  <a href="#usecase-user-leaving">Leaving a Channel</a><br />      
      6.1.5.  <a href="#usecase-setting-nick">Setting a Nick</a><br />      
      6.1.6.  <a href="#usecase-user-register">Registering a Nick</a><br />      
      6.1.7.  <a href="#usecase-user-presence">Setting User Presence</a><br />      
      6.1.8.  <a href="#usecase-obtaining-presence">Client Coming Online and Obtaining Presence from the Local Server</a><br />      
      6.1.9.  <a href="#usecase-server-presence-update">Updating Presence on User's Server</a><br />      
      6.1.10.  <a href="#usecase-real-jids">Determining Real JIDs</a><br />      
      6.1.11.  <a href="#usecase-sync-history">Coming Online: Synchronizing Message History</a><br />      
      6.1.12.  <a href="#usecase-user-offline">Going Offline</a><br />      
      6.1.13.  <a href="#usecase-user-message">Sending a Message</a><br />      
      6.1.14.  <a href="#usecase-retract">Retracting a Message</a><br />      
      6.1.15.  <a href="#usecase-user-tell">Telling another User about a Channel</a><br />      
      6.1.16.  <a href="#usecase-user-invite">Inviting another User to join a Channel that the user does not have Permission to Join</a><br />      
      6.1.17.  <a href="#usecase-user-private-messages">Sending Private Messages</a><br />      
      6.1.18.  <a href="#usecase-vcard">Requesting vCard</a><br />   
      6.2.  <a href="#use-presence-initialize">Presence Initializion</a><br />   
      6.3.  <a href="#use-ensure-delivery">Ensuring Message Delivery</a><br />   
      6.4.  <a href="#use-mam">Use of MAM</a><br />      
      6.4.1.  <a href="#use-mam-messages">Archive of Messages</a><br />      
      6.4.2.  <a href="#use-mam-retrieve">Retrieving Messages</a><br />      
      6.4.3.  <a href="#use-mam-other-nodes">MAM Use with other Channel Nodes</a><br />   
      6.5.  <a href="#usecases-admin">Administrative Use Cases</a><br />      
      6.5.1.  <a href="#usecase-admin-check-create">Checking For Permission To Create a Channel</a><br />      
      6.5.2.  <a href="#usecase-admin-create">Creating a Channel</a><br />      
      6.5.3.  <a href="#usecase-admin-create-adhoc">Creating a Channel for Ad Hoc Use</a><br />      
      6.5.4.  <a href="#usecase-admin-converting-chat">Converting a 1:1 Conversation to a Channel</a><br />      
      6.5.5.  <a href="#usecase-admin-destroy">Destroying a Channel</a><br />      
      6.5.6.  <a href="#usecase-server-destroy">Server Destroying a Channel</a><br />      
      6.5.7.  <a href="#usecase-admin-information">Modifying Channel Information</a><br />      
      6.5.8.  <a href="#usecase-admin-information">Modifying Channel Configuration</a><br />      
      6.5.9.  <a href="#usecase-admin-participants">Controlling Channel Partipcipants</a><br />7.  <a href="#mix-requirements-participant-server">MIX Requirements on Participant's Server</a><br />   
      7.1.  <a href="#server-identification-mix-clients">Server Identification of MIX Capabable Clients</a><br />   
      7.2.  <a href="#mix-from">Messages From MIX Channels</a><br />   
      7.3.  <a href="#user-server-to">Messages To MIX Channels</a><br />   
      7.4.  <a href="#user-server-disco">MIX Management and Discovery</a><br />   
      7.5.  <a href="#mix-diso">IQ Support on Local Server</a><br />   
      7.6.  <a href="#proxy-roster">Roster Management</a><br />   
      7.7.  <a href="#mix-roster-capability-sharing">MIX Roster Item Capability Sharing</a><br />   
      7.8.  <a href="#proxy-mam">MAM Archive Support</a><br />8.  <a href="#mix-and-muc-together">Supporting MIX and MUC together</a><br />   
      8.1.  <a href="#mix-muc-invite-choice">Choosing Which Invite to Send</a><br />9.  <a href="#not-included-from45">Capabilities not provided in MIX</a><br />   
      9.1.  <a href="#password-control">Password Controlled Channels</a><br />   
      9.2.  <a href="#voice-control">Voice Control</a><br />   
      9.3.  <a href="#not-subject">Subject</a><br />10.  <a href="#i18n">Internationalization Considerations</a><br />11.  <a href="#security">Security Considerations</a><br />12.  <a href="#iana">IANA Considerations</a><br />13.  <a href="#registrar">XMPP Registrar Considerations</a><br />14.  <a href="#schema">XML Schema</a><br />15.  <a href="#ack">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p>The Mediated Information eXchange (MIX) protocol is intended as a replacement for Multi-User Chat (MUC). MUC is a major application of XMPP that was developed in 2002 and standardized in <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>]. MIX implements the same basic MUC patterns in a more flexible and extensible way in order to address requirements that have emerged since MUC was developed. MIX supports all of the core chatroom features that are familiar from MUC, such as discussion topics and invitations. Like MUC, it also defines a strong access control model, including the ability to ban users, to name administrators, and to provide controls as to which users can participate in channels.</p>
  <p>Several reasons exist for replacing MUC:</p>
  <ul>
    <li>A number of use cases for group communication have emerged since MUC was first published.</li>
    <li>Experience has shown that it is difficult to use MUC to build several kinds of communication applications (such as a multimedia conference) without undesirable adaptations.</li>
    <li>It is impractical to address a number of the requirements listed in the next section with MUC or with extensions to MUC. </li>
    <li>In the years after MUC was designed, both <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>] and <span class="ref"><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idp1495616">3</a>] have been developed and it is desirable to reuse these building blocks (e.g., MAM can be used for message history) rather than using the less robust methods defined in <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>].</li>
  </ul>
  <p>Because it is anticipated that there will significant co-existence between MUC and MIX, this specification is designed so that:</p>
  <ul>
    <li>XMPP clients can implement MUC and this specification in a way that provides a coherent user experience.</li>
    <li>XMPP servers can implement this specification and also provide a MUC interface in order to support clients that only implement MUC.</li>
  </ul>
  <p>If a server wishes to expose both MUC and MIX representations of chatrooms, it is RECOMMENDED to do so by serving MUC and MIX on different domains, but a server MAY serve them on the same domain.</p>
<h2>2.
       <a name="reqs" id="reqs">Requirements</a></h2>

<p>The following requirements have been identified, which MIX aims to address.</p>
  <ol>
    <li>A user's participation in a channel persists and is not modified by the user's client going online and offline.</li>
    <li>Multiple devices associated with the same account can share the same nick in the channel, with well-defined rules making each client individually addressable.</li>
    <li>Channels are NOT REQUIRED to support or reflect presence for participants.</li>
    <li>A reconnecting client can quickly resync with respect to messages and presence.</li>
    <li>A user MAY (subject to configuration) receive messages from a channel as an invisible observer.</li>
    <li>Configuration can be observed externally to the channel (e.g., list of participants, access control rights, etc.).</li>
    <li>MIX services SHOULD provide mechanisms to prevent JIDs from being harvested.</li>
    <li>MIX and Message Archive Management (MAM) MUST work well together.</li>
    <li>A user can determine which channels they participate in.</li>
    <li>Provide extensibility regarding data formats that can be sent within a channel (files, structured data, indications about media sources in multimedia conferences, etc.) as well as flexibility regarding which data formats a user wants to receive.</li>
    <li>Enable federation of a channel across multiple servers, to provide a service equivalent to "federated MUC" <span class="ref"><a href="https://xmpp.org/extensions/xep-0289.html">Federated MUC for Constrained Environments (XEP-0289)</a></span>  [<a href="#nt-idp1512544">4</a>].</li>
    <li>Enable sharing of messages on a channel without requiring sharing of presence.</li>
    <li>Enable sharing of presence without requiring message sending.</li>
    <li>(Desirable) Make it easier to reduce duplicate traffic.</li>
 </ol>
<h2>3.
       <a name="concepts" id="concepts">Concepts</a></h2>
  <div class="indent"><h3>3.1 <a name="concepts-approach" id="concepts-approach">Specification Appproach</a></h3>
    <p>
      MIX will enable a wide range of auxiliary services.  The goal of the MIX specification is to set out the core capabilities needed for MIX.   It is anticipated that additional XEPs will be written to extend the core MIX, and the core MIX specification notes some areas where this may happen.  This approach will avoid the core MIX specification becoming unduly large.   Profiles referencing sets of related MIX XEPs may be developed in the future.   
    </p>
  </div>
  <div class="indent"><h3>3.2 <a name="concepts-core" id="concepts-core">Core Concepts</a></h3>
  <p>The following concepts underlie the design of MIX.</p>
  <ol>
    <li>MIX channels (roughly equivalent to MUC rooms) are hosted on one or more MIX domains, (examples: 'mix.example.com'; 'conference.example.com'; 'talk.example.com'), which are discoverable through <span class="ref"><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idp1520992">5</a>]. Each channel on a MIX service can then be discovered and queried.</li>
    <li> In MIX each channel (e.g., 'channel@mix.example.com') is a specialized pubsub service. This is based on the model from <span class="ref"><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-idp1524624">6</a>] where every user JID (e.g., 'user@example.com') is its own pubsub service. </li>
    <li>A channel's pubsub service contains a number of nodes for different event types or data formats. As described below, this document defines several standard nodes; however, future specifications or proprietary services can define their own nodes for extensibility.</li>
    <li>Affiliations with the nodes are managed by the MIX service by channel level operations, so that the user does not have to separately manage affiliations with the individual PubSub nodes.
     </li>
    <li><span class="ref"><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idp1495616">3</a>] (MAM) is used for all history access, with each node being individually addressable for MAM queries. This simplifies implementation compared to MUC (which had a specialized and rather limited history retrieval mechanism).</li>
    <li>A client can achieve a 'quick resync' of a node by requesting just those changes it has not yet received, using standard MAM protocol. This solves the MUC issue of either receiving duplicate messages when rejoining a room or potentially missing messages.</li>
    <li>Because MAM is used for history, only those nodes that have a 'current value' need to store any items in them — e.g., 'urn:xmpp:mix:nodes:presence' and 'urn:xmpp:mix:nodes:information' would store their current values (with older values being queryable through MAM), while 'urn:xmpp:mix:nodes:messages' would store no items.</li>
    <li>A user's participation in a channel outlives their client sessions. A client which is offline will not share presence within the channel, but the associated user will still be listed as an participant. </li>
    <li>Presence is sent to participants using bare JID, whether or not the user has an online client. </li>
    <li>Online clients MAY register presence, which is then shared with participants who have subscribed to presence.</li>
    <li>MIX decouples addressing of channel participants from their nicknames, so that nickname changes do not affect addressing.</li>
    <li>Each participant is addressable by a single bare JID, which is a proxy JID (not the user's real JID) to make it straightforward to hide the user's real JID from other channel participants. Full JIDs comprised of this bare JID plus a resource (also anonymized) are then constructed, allowing visibility into the number of online resources participating in a channel.</li>
    <li>MIX requires client support and server support from the server providing the MIX service. </li>
    <li> Although some protocol is shared with MUC, MUC clients are not interoperable with a MIX service.  This means that where a user chooses to use MIX, all of the users clients need to support MIX.</li>
    <li>MIX requires the server to which the MIX client connects to provide functionality to support MIX.  This functionality is defined in this specification and referenced as "MIX Participant's Server Behaviour".</li>
    <li>MIX domains MUST NOT be used to host end user JIDs. </li>
  </ol>
  </div>
  <div class="indent"><h3>3.3 <a name="concepts-pubsub" id="concepts-pubsub">MIX and PubSub</a></h3>
    <p>MIX is based upon domains providing a MIX service, such as 'mix.shakespeare.example'. Note that although PubSub communication is used, a domain used for MIX is a MIX domain and not a standard <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>] domain. Like MUC, there is no requirement on the naming of these domains; the label 'mix' used in examples in this specification and the fact that it is a subdomain of a 'shakespeare.example' service are purely for example.</p>
    <p>Every MIX channel is an addressable PubSub service (with additional MIX semantics) that will be addressed using a bare JID by other XMPP entities, for example coven@mix.shakespeare.example. While <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>] is used as the basis for the MIX model, MIX uses standard presence and groupchat messages to provide an interface to the MIX service that does not expose PubSub protocol for many of the more common functions.
</p>
  </div>
  <div class="indent"><h3>3.4 <a name="concepts-mam" id="concepts-mam">MIX and MAM</a></h3>
    <p> Historical data (such as the messages sent to the channel) is stored in an archive supporting  Message Archive Management (MAM) so that clients can subsequently access this data with MAM. Each node can be archived separately (e.g., the presence node or the configuration node). MIX clients can retrieve archived information with MAM in order to quickly resync messages with regard to a channel, and can do so without providing presence information.</p>
  </div>
  <div class="indent"><h3>3.5 <a name="concepts-mix-participant-server" id="concepts-mix-participant-server">Behaviour of MIX Participant's Server</a></h3>
    <p>
      A MIX channel does not send messages and presence directly to an XMPP MIX client of a channel participant, but addresses them to participant using the participant's bare JID. The participant's server MUST then handle these messages and pass them on to zero, one or multiple clients.   To enable MIX to work, this behaviour is necessary and so the server of every MIX client MUST follow the rules set out in this specification.
This approach  enables flexible support of multiple clients for a MIX channel participant.
       The MIX model is that a user will join a channel over an extended period, and that the user (not a specific client used by the user) joins the channel. The primary subscription is with the client's bare JID.
       There are a number of MIX requirements on behaviour of the MIX Participant's server, which are summarized here:
     </p>
    <ol>

   
      <li>Messages from a MIX client to a MIX channel will go direct to the MIX service.  They are relayed, but not modified, by the participant's server.</li>
      <li>Messages from a MIX channel to a MIX client are always sent to the MIX participants server (addressed by bare JID) and MUST be handled by the MIX participant's server.</li>
      <li>All messages received by the MIX participant's server MUST be stored using MAM.</li>
      <li>The MIX participant's server will only send messages to online clients and will discard messages if no clients are online.
        This means that a MIX client needs to resynchronize with the MIX service when it comes online.  This message synchronization will happen between the MIX client and the MAM archive held on the MIX participant's server.</li>
      
      <li>The MIX client will generally send management and other messages directly to the MIX channel and this MUST be done except where specifically noted.  </li>
      <li>The user's roster contains each MIX channel to which the user is subscribed and is sharing presence.   To achieve this the user's server needs to manage the roster on behalf of the user.  For this reason, MIX join and leave commands MUST be sent by a client to the user's server.   This enables the user's server to correctly manage the roster on behalf of the user.</li>
    </ol>
    <p>
   Messages being sent from MIX channel to a MIX participant’s server (which will be of type=groupchat)  and presence information are sent to the bare JID.  This means that the MIX participant's server  MUST support a modification of the standard <span class="ref"><a href="http://tools.ietf.org/html/rfc6121">RFC 6121</a></span>  [<a href="#nt-idp1553136">7</a>] rules.
    </p>
    <p>
      The core MIX specification sets out how the MIX channel interacts directly with XMPP clients and with the MIX participant's server. Behaviour of the MIX participant's server is also specified in this MIX specification.
    </p>
  </div>
  <div class="indent"><h3>3.6 <a name="concepts-presence" id="concepts-presence">User Presence in MIX</a></h3>
    <p>
      MIX channels store presence in the presence node using the proxy JID of each online client for a user.   User presence MAY be included based on client choice to publish presence.    Where a user publishes presence for multiple clients, this information is available to all users subscribing to the channel presence.
    </p>
    <p>
      External XMPP entities can direct stanzas to clients publishing their presence by sending them to the appropriate full proxy JID in the presence node.   These stanzas MAY be routed to the client by the MIX channel.  The choice to do this is dependent on MIX channel policy.   For example, a disco request MAY be routed through the MIX channel to the client.
    </p>
    <p>
      Presence updates are distributed by a channel to the bare JID of subscribers and then the subscriber's server will distribute to each of the subscriber's currently online clients.
    </p>
  </div>
  <div class="indent"><h3>3.7 <a name="concepts-pm" id="concepts-pm">Private Messages</a></h3>
    <p>
      Private messages MAY be sent to channel participants if allowed by channel policy. Private messages are
 addressed to the user's bare proxy JID determined from the participants node, and routed by the MIX to the user's bare real JID, where standard distribution rules will apply.
    </p>
    
  </div>
  <div class="indent"><h3>3.8 <a name="proxy-jid" id="proxy-jid">Proxy JIDs and JID Visibility</a></h3>
    <p>
      MIX channels have two modes controlling JID visibility:
    </p>
    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: JID Visibility Modes</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body"><th>Mode</th><th>Description</th></tr>
      <tr class="body"><td>'JID Visible'</td><td>In these channels, some or all participant JIDs are visible to all channel participants.</td></tr>
      <tr class="body"><td>'JID Hidden'</td><td>In these channels, no participant JIDs are visible to channel participants, but they are visible to channel administrators.</td></tr>
    </table></div>
    <p>
      A channel participant MAY specify their preferences for JID visibility, with one of the following values:
    </p>
    <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: JID Visibility Preference Options</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body"><th>Preference</th><th>Description</th></tr>
      <tr class="body"><td>'No JID Visibility Preference'</td><td>The users JID will be visible in JID Visible channels and hidden in JID Hidden channels.</td></tr>
      <tr class="body"><td>'Prefer Hidden'</td><td>The user's JID will be hidden in JID Visible channels if the channel policy allows this.</td></tr>
      <tr class="body"><td>'Enforce Hidden'</td><td>The user's JID will never be shown and the user will be removed from channel if channel administrator enforces visibility.</td></tr>
      <tr class="body"><td>'Enforce Visible'</td><td>The users JID will always be shown and the user will be removed from channel if mode is changed to 'JID Hidden'.</td></tr>
    </table></div>
    <p>
      The primary representation of a participant in a MIX channel is a proxy JID, which is an anonymized JID using the same domain as the channel and with the name of the channel encoded, using the format "&lt;channel&gt;+&lt;generated identifier&gt;@&lt;mix domain&gt;".  They generated identifier MUST NOT contain the '+' characters.  The Channel name MAY contain the '+' character.   For example in the channel 'coven@mix.shakespeare.example',   the user 'hag66@shakespeare.example' might have a proxy JID of 'coven+123456@mix.shakespeare.example'.   The reason for the proxy JID is to support JID Hidden channels.   Proxy JIDs are also used in JID Visible channels, for consistency and to enable switching of JID visibility.  The "urn:xmpp:mix:nodes:jidmap" node maps from proxy JID to real JID.  While a user is a participant in a Channel, the mapping between real JID and proxy JID MUST NOT be changed.
    </p>
    <p>
      The example real full JIDs in this specification follow the anticipated new format that splits the resource into two parts.  The first part is UUID that is a stable and fixed value for the client.  The second part is server assigned and will vary with each session.   For example:  'hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'.   CITATION TO BE ADDED.  If the final specification differs from this, the examples will be updated.
    </p>
     <p>
       The full JIDs held in the  presence nodes are anonymized using a similar mechanism.  First the bare JID is mapped to a bare proxy JID, using the mapping held in the "urn:xmpp:mix:nodes:jidmap" node for the bare JID.  Then the resource is replaced with a generated value.   For example,   'hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0' in the channel coven might have a proxy JID of 'coven+123456@mix.shakespeare.example/789'.   There is no client visible mapping of proxy full JIDs maintained as this is not needed.   The MIX channel will need to maintain a mapping, to support directly addressing clients, such as for client to client disco#info queries.  While an anonymized JID is held in the presence node, the mapping to real JID MUST NOT be changed.  When an anonoymized full JID is added to the presence node, mapping to a real full JID that was previously in the presence node, the same anonymized JID as the previous time MAY be used or a different anonymized JID MAY be used.
     </p>
  </div>
  <div class="indent"><h3>3.9 <a name="concepts-nodes" id="concepts-nodes">Standard Nodes</a></h3>
    <p>MIX defines a number standard nodes are as follows.   Note that all nodes are OPTIONAL and that not every channel will necessarily use each node:</p>
    <div class="indent"><p class="caption"><a name="table-3" id="table-3"></a>Table 3: Standard MIX Nodes</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body"><th>Name</th><th>Node</th><th>Description</th><th>Update</th><th>Distribution</th></tr>
      <tr class="body"><td>Messages</td><td>'urn:xmpp:mix:nodes:messages'</td><td>For distributing messages to the channel. Each item of this node will contain a message sent to the channel.</td><td>Message</td><td>Message</td></tr>
      <tr class="body"><td>Participants</td><td>'urn:xmpp:mix:nodes:participants'</td><td>For storing the list of participants and the associated nick.  Channel participants are added when they join the channel and removed when they leave </td><td>Join/Leave/Set Nick</td><td>PubSub</td></tr>
      <tr class="body"><td>JID Map</td><td>'urn:xmpp:mix:nodes:jidmap'</td><td>For storing a list of anonymized bare JIDs from the participants node with a 1:1 mapping to the corresponding real JIDs.</td><td>Automatic</td><td>PubSub</td></tr>
      <tr class="body"><td>Presence</td><td>'urn:xmpp:mix:nodes:presence'</td><td>For storing information about the availability status of online participants, which MAY include multiple clients for a single participant.</td><td>Presence</td><td>Presence</td></tr>
      <tr class="body"><td>Information</td><td>'urn:xmpp:mix:nodes:info'</td><td>For storing general channel information, such as description. </td><td>PubSub</td><td>PubSub</td></tr>
      <tr class="body"><td>Allowed</td><td>'urn:xmpp:mix:nodes:allowed'</td><td>For storing JIDs that are allowed to be channel participants.</td><td>PubSub</td><td>PubSub</td></tr>
      <tr class="body"><td>Banned</td><td>'urn:xmpp:mix:nodes:banned'</td><td>For storing JIDs that are not allowed to be channel participants. </td><td>PubSub</td><td>PubSub</td></tr>
      <tr class="body"><td>Configuration</td><td>'urn:xmpp:mix:nodes:config'</td><td>For storing channel configuration. </td><td>PubSub</td><td>PubSub</td></tr>
    </table></div>
    <p>
      All of the standard nodes are OPTIONAL.   A channel providing a service similar to MUC will typically use all of the standard nodes, but other channels MAY use any combination of these nodes.
      MIX provides mechanisms to allow users to conveniently subscribe to a chosen set of nodes and to unsubscribe to all nodes with a single operation.  Some nodes are accessed and managed with PubSub, whereas other nodes define MIX specific mechanisms for their use, shown in the last two columns of the table.
    </p>
    <p>
      MIX also makes use of two nodes for support of Avatars.  These nodes and their use is defined in <span class="ref"><a href="https://xmpp.org/extensions/xep-0084.html">User Avatar (XEP-0084)</a></span>  [<a href="#nt-idp1592784">8</a>].  These nodes MAY be created as part of a MIX channel, where it is desired to publish an avatar associated with the channel.
    </p>
    <div class="indent"><p class="caption"><a name="table-4" id="table-4"></a>Table 4: MIX Nodes for Avatar Support</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body"><th>Name</th><th>Node</th><th>Description</th></tr>
      <tr class="body"><td>Avatar Data</td><td>'urn:xmpp:avatar:data'</td><td>For publishing an Avatar</td></tr>
      <tr class="body"><td>Avatar Metadata</td><td>'urn:xmpp:avatar:metadata'</td><td>For publishing Avatar metadata</td></tr>
    </table></div>
    <p>
      The structure of each of the standard nodes defined by MIX is now considered in more detail in the rest of this section, after explaining roles.
    </p>
    <div class="indent"><h3>3.9.1 <a name="roles" id="roles">Roles</a></h3>
      <p>
        There are a number of MIX roles for each channel, listed in the following table.   Rights will be assigned to the various roles in the channel configuration node.
      </p>
      <div class="indent"><p class="caption"><a name="table-5" id="table-5"></a>Table 5: Channel Roles</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body"><th>Role</th><th>Membership and Rights</th></tr>
        <tr class="body"><td>Owners</td><td>These are owners of the list, as specified in the channel configuration node.  Only owners are allowed to modify the channel configuration node.</td></tr>
        <tr class="body"><td>Administrators</td><td>Administrators are defined in the channel configuration node.  Administrators have update rights to the Allowed Node and Banned Node, so can control which users are allowed to participate in a channel.  </td></tr>
        <tr class="body"><td>Participants</td><td>Participants are users listed by JID in the participants node.</td></tr>
        <tr class="body"><td>Allowed</td><td>Allowed is the set of JIDs that are participants or are allowed to become participants.  A JID is allowed if it does not match entry in the banned node and either it matches an entry in the allowed node or the allowed node is not present. </td></tr>
        <tr class="body"><td>Anyone</td><td>Any user, including users in the banned node.</td></tr>
      </table></div>
      <p>
        There MUST always be at least one owner and "anyone" will always have role occupants.   Other roles  MAY NOT have any role occupants.  Rights are defined in a strictly hierarchical manner, so that for example Owners will always have rights that Administrators have.
      </p>
    </div>
    
    <div class="indent"><h3>3.9.2 <a name="node-archiving" id="node-archiving">Node Archiving</a></h3>
      <p>
        Nodes MAY be archived and where this is done MAM MUST be used.  Archiving of the Messages node MUST be done as part of the MIX specification.  Archiving of other nodes is OPTIONAL.
      </p>
    </div>
    <div class="indent"><h3>3.9.3 <a name="messages-node" id="messages-node">Messages Node</a></h3>
      <p>
        The Message node is used to distribute messages.   The Messages node is a transient node and so no PubSub items are held.  Messages MUST go to the associated MAM archive and history is retrieved by use of  MAM. Users subscribe to this node to indicate that messages from the channel are to be sent to them.   Private Messages are not distributed by the messages node. 
      
      </p>
      
    </div>

    <div class="indent"><h3>3.9.4 <a name="participants-node" id="participants-node">Participants Node</a></h3>
      <p>Each channel participant is represented as an item of the 'urn:xmpp:mix:nodes:participants' channel node.  Each item is named by the bare proxy JID of the participant. For example 'coven+123456@mix.shakespeare.example' might name the node item associated with participant 'hag66@shakespeare.example'. The nick associated with the user is mandatory and is stored in the item.  The nick for each channel participant MUST be different to the nick of other participants.
      </p>
      <p>
        When a user joins a channel, the user's bare JID is added to the participants node by the MIX service.   When a user leaves a channel, they are removed from the participants node.  The participants node MUST NOT be directly modified using pubsub.
      This node MAY be subscribed to for jid-visible channels that permit subscription to this node - this will allow users to see changes to the channel participants.
      </p>
      <p>The participants node is OPTIONAL.  If the Participants Node is not used, information on channel participants is not shared.  If there is no participants node, the access control value 'participants' MUST NOT be used.   The Participants node is a permanent node with one item per participant.</p>
      <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Value of Participants Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:participants'&gt;
  &lt;item id='coven+123456@mix.shakespeare.example'&gt;
    &lt;participant xmlns='urn:xmpp:mix:0'
                 nick='thirdwitch'/&gt;
  &lt;/item&gt;
&lt;/items&gt;
</pre></div>
    </div>
    <div class="indent"><h3>3.9.5 <a name="jid-map-node" id="jid-map-node">JID Map Node</a></h3>

      <p>The JID Map node is used to associate a proxy bare JID to its corresponding real bare JID.  The JID Map node MUST have one entry for each entry in the Participants node.  This value is added when a user joins the channel and is removed when the user leaves the channel.
       Each item is identified by proxy bare JID, mapping to the real bare JID.  This node is used to give administrator access to real JIDs and participant access to real JIDs in jid-visible channels.  This node MUST NOT be modified directly using pubsub.
       In JID visible channels, all participants MAY subscribe to this node.  In JID hidden channels, only administrators can subscribe.   The JID Map node is a permanent node with one item per participant.</p>
      <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Value of JID Map Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:jidmap'&gt;
  &lt;item id='coven+123456@mix.shakespeare.example'&gt;
    &lt;participant xmlns='urn:xmpp:mix:0'
                 jid='hecate@mix.shakespeare.example'/&gt;
  &lt;/item&gt;
&lt;/items&gt;
</pre></div>
    </div>
    <div class="indent"><h3>3.9.6 <a name="presence-node" id="presence-node">Presence Node</a></h3>
      <p>
        The presence node contains the presence value for clients belonging to participants that choose to publish presence to the channel. A MIX channel MAY require that all participants publish presence.  Each item in the presence node is identified by the full proxy JID, and contains the current presence value for that JID.  The presence is encoded in the same way as data that would be sent in a presence stanza. The full proxy JID is always used in this node. In MIX it is possible to have a 'presence-less channel' by not using this node. Access Control MAY be set to enforce that for each of the full JIDs in this list, the bare JID MUST be in the participants list.
      </p>

      <p>
        This node MAY be subscribed to by users and this subscription MUST use the users bare JID.  So presence of online clients is sent to the user's server for each user subscribed to this node. Presence is always sent using standard presence protocol and NOT using pubsub protocol.   Clients MUST NOT directly access the presence node using pubsub.  The Presence node is a permanent PubSub node.
      </p>
      <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Value of Presence Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:presence'&gt;
  &lt;item id='coven+123456@mix.shakespeare.example/8765'&gt;
    &lt;presence xmlns='jabber:client'&gt;
      &lt;show&gt;dnd&lt;/show&gt;
      &lt;status&gt;Making a Brew&lt;/status&gt;
    &lt;/presence&gt;
  &lt;/item&gt;
&lt;/items&gt;
</pre></div>
    </div>
    <div class="indent"><h3>3.9.7 <a name="info-node" id="info-node">Information Node</a></h3>

      <p>The Information node holds information about the channel.  The information node contains a single item with the current information.  
        The information node is named by the date/time at which the item was created.   The information node is accessed and managed using standard pubsub.   The Information node is a permanent node with a maximum of one item.  Users MAY subscribe to this node to receive information updates. The Information node item MAY contain the following attributes, each of which is OPTIONAL:
      </p>
      <div class="indent"><p class="caption"><a name="table-6" id="table-6"></a>Table 6: Information Node Attributes</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body"><th>Name</th><th>Description</th><th>Field Type</th><th>Values</th><th>Default</th></tr>
        <tr class="body"><td>'Name'</td><td>A short string providing a name for the channel.  For example "The Coven".  Typical uses of this value will be to present a user with the name of this channel in a list of channels to select from or as the header of UI display of the channel.  It is intended for use where a short string is needed to represent the channel.</td><td>text-single</td><td>-</td><td>-</td></tr>
        <tr class="body"><td>'Description'</td><td>A longer description of the channel. For example "The Place where the Macbeth Witches Meet up".   A typical use would be to provide a user with more information about the channel, for example in tool tip.</td><td>text-single</td><td>-</td><td>-</td></tr>
        <tr class="body"><td>'Contact'</td><td>The JID or JIDs of the person or role responsible for the channel.</td><td>jid-multi</td><td>-</td><td>-</td></tr>
      </table></div>
      <p>
        Name and Description of the channel apply to the whole channel and are will usually be changed infrequently.   
      </p>
      <p>The name and description values MUST contain a "text" element and MAY contain additional text elements. Where multiple text elements are provided, each MUST posses an xml:lang attribute that describes the natural language of the element.  The format of the Information node follows <span class="ref"><a href="https://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idp1632416">9</a>].  This allows configuration to be updated by MIX defined commands and that the results of update commands are the same as the PubSub node.
      The following example shows the format of a item in the information node for the example coven@mix.shakespeare.example channel.
      </p>
      <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Information Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:info'&gt;
  &lt;item id='2016-05-30T09:00:00' xmlns='urn:xmpp:mix:0'&gt;
      &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Name'&gt;
            &lt;value&gt;Witches Coven&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Description'&gt;
           &lt;value&gt;A location not far from the blasted heath where 
                  the three witches meet&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='Contact'&gt;
           &lt;value&gt;greymalkin@shakespeare.lit&lt;/value&gt;
         &lt;/field&gt;
         &lt;/x&gt;
  &lt;/item&gt;
&lt;/items&gt;
</pre></div>
    </div>
    
      <div class="indent"><h3>3.9.8 <a name="allowed-node" id="allowed-node">Allowed</a></h3>
        <p>
          This node represents a list of JIDs that are allowed to become participants. If the allowed node is not present, all JIDs are allowed. This node is accessed and managed using standard pubsub.  The allowed list is always considered in conjunction with the banned list, stored in the banned node.  Only Administrators and Owners have write permission to the allowed node and are also the only roles that are allows to subscribe to this node.   The Allowed node is a permanent node.  Each item contains a real bare JID.  The following example shows how the allowed list can specify single JIDs and domains.
        </p>
        <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Allowed Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:allowed'&gt;
  &lt;item id='shakespeare.lit'/&gt;
  &lt;item id='alice@wonderland.lit'/&gt;
&lt;/items&gt;
</pre></div>
      </div>
      <div class="indent"><h3>3.9.9 <a name="banned-node" id="banned-node">Banned</a></h3>
        <p>
          This node represents a list of JIDs that are explicitly not allowed to become participants. The values in this list take priority over values in the allowed node. This node is accessed and managed using standard pubsub  Only Administrators and Owners have write permission to the allowed node and are also the only roles that are allows to subscribe to this node. Each item contains a real bare JID.   The Banned node is a permanent node.
        </p>
        <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Banned Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:banned'&gt;
  &lt;item id='lear@shakespeare.lit'/&gt;
  &lt;item id='macbeth@shakespeare.lit'/&gt;
&lt;/items&gt;
</pre></div>
      </div>
    <div class="indent"><h3>3.9.10 <a name="config-node" id="config-node">Configuration Node</a></h3>
      <p>
        The Configuration node holds the configuration of the channel as a single item, named by the date-time of the last update to the configuration.  The Configuration node is a permanent node with a maximum of one item. Previous configuration history MAY be accessed by MAM.  Users with read access to the configuration node MAY subscribe to the configuration node to get notification of configuration change.  This node is accessed and managed using standard pubsub. The configuration node is OPTIONAL for a MIX channel.  For example, configuration choices could be fixed and not exposed.   A subset of the defined configuration options MAY be used and additional non-standard configuration options MAY be added.   JIDs in the configuration MUST be real bare JIDs and not proxy JIDs.  If configuration options to control functionality of the nature described here are provided, the options defined in this standard MUST be used. The following configuration attributes are defined:
</p>
      <div class="indent"><p class="caption"><a name="table-7" id="table-7"></a>Table 7: Configuration Node Attributes</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body"><th>Name</th><th>Description</th><th>Field Type</th><th>Values</th><th>Default</th></tr>
        <tr class="body"><td>'Last Change Made By'</td><td>Bare JID of the user making the last change.</td><td>jid-single</td><td>-</td><td>-</td></tr>
        <tr class="body"><td>'Owner'</td><td>Bare JIDs with Owner rights as defined in ACL node.  When a channel is created, the JID creating the channel is configured as an owner, unless this attribute is explicitly configured to another value.</td><td>jid-multi</td><td>-</td><td>-</td></tr>
        <tr class="body"><td>'Administrator'</td><td>Bare JIDs with Administrator rights.</td><td>jid-multi</td><td>-</td><td>-</td></tr>
        <tr class="body"><td>'End of Life'</td><td>The date and time at which the channel will be automatically removed by the server.   If this is not set, the channel is permanent.</td><td>text-single</td><td>-</td><td>-</td></tr>
        <tr class="body"><td>'Nodes Present'</td><td>Specifies which nodes are present. Presence of  config nodes is implicit.  Jidmap node MUST be present if participants node is present. 'avatar' means that both Avatar Data and Avatar Metadata nodes are present.</td><td>list-multi</td><td>'participants'; 'presence'; 'information'; 'allowed'; 'banned'; 'avatar'</td><td>-</td></tr>
        <tr class="body"><td>'Message Node Subscription'</td><td>Controls who can subscribe to messages node.</td><td>list-single</td><td>'participants'; 'allowed'; 'anyone'</td><td>'participants'</td></tr>
        <tr class="body"><td>'Presence Node Subscription'</td><td>Controls who can subscribe to presence node.</td><td>list-single</td><td>'participants'; 'allowed'; 'anyone'</td><td>'participants'</td></tr>
        <tr class="body"><td>'Participants Node Subscription'</td><td>Controls who can subscribe to participants node.</td><td>list-single</td><td>'participants'; 'allowed'; 'anyone'; 'nobody'; 'admins'; 'owners'</td><td>'participants'</td></tr>
        
        <tr class="body"><td>'Information Node Subscription'</td><td>Controls who can subscribe to the information node.</td><td>list-single</td><td>'participants'; 'allowed'; 'anyone'</td><td>'participants'</td></tr>
        <tr class="body"><td>'Allowed Node Subscription'</td><td>Controls who can subscribe to allowed node.</td><td>list-single</td><td>'participants'; 'allowed';  'nobody'; 'admins'; 'owners' </td><td>'admins'</td></tr>
        <tr class="body"><td>'Banned Node Subscription'</td><td>Controls who can subscribe to banned node.</td><td>list-single</td><td>'participants'; 'allowed';  'nobody'; 'admins'; 'owners' </td><td>'admins'</td></tr>
        <tr class="body"><td>'Configuration Node Access'</td><td>Controls who can subscribe to configuration node and who has read access to it.</td><td>list-single</td><td>'participants'; 'allowed';  'nobody'; 'admins'; 'owners' </td><td>'owners'</td></tr>
        <tr class="body"><td>'Information Node Update Rights'</td><td>Controls who can make changes to the information node</td><td>list-single</td><td>'participants'; 'admins'; 'owners' </td><td>'admins'</td></tr>
        <tr class="body"><td>'Avatar Nodes Update Rights'</td><td>Controls who can make changes to the avatar data and metadata nodes</td><td>list-single</td><td>'participants'; 'admins'; 'owners' </td><td>'admins'</td></tr>
        <tr class="body"><td>'JID Visibility'</td><td>Controls JID visibility in the channel.</td><td>list-single</td><td>'jid-hidden'; 'jid-optionally-visible'; 'jid-mandatory-visible'</td><td>'jid-hidden'</td></tr>
        <tr class="body"><td>'Open Presence'</td><td>If selected, any client MAY register presence.  If not selected, only clients with bare JID in the participants list are allowed to register presence.</td><td>boolean</td><td>-</td><td>false</td></tr>
        <tr class="body"><td>'Participants Must Provide Presence'</td><td>If selected, all channel participants are REQUIRED to share presence information with the channel.</td><td>boolean</td><td>-</td><td>false</td></tr>
        <tr class="body"><td>'Allow User Message Retraction'</td><td>If this option is selected users will be able to retract messages sent to the MIX channel.</td><td>boolean</td><td>-</td><td>false</td></tr>
        <tr class="body"><td>'Administrator Message Retraction Rights'</td><td>This controls which group is able to retract messages sent to the MIX channel.</td><td>list-single</td><td>'nobody'; 'admins'; 'owners'</td><td>'owners'</td></tr>
        <tr class="body"><td>'Participation Addition by Invitation from Participant'</td><td>This option extends a channel  so that  a channel participant has rights to invite and enable other users as participants.</td><td>boolean</td><td>-</td><td>false</td></tr>
        <tr class="body"><td>'No Private Messages'</td><td>If this option is selected, private messages MUST NOT be used with the channel.</td><td>boolean</td><td>-</td><td>false</td></tr>
      </table></div>
      <p>
        The configuration node is in <span class="ref"><a href="https://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idp1632416">9</a>] format and includes all of the options used by the channel, including values for options using default values.  This means that the value in the form can be directly mapped with the form returned by configuration administration commands. Configuration nodes will typically have a large number of elements. The following short example is provided to illustrate the syntax of the configuration node.
      </p>
      <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Configuration Node</p><div class="indent"><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:config'&gt;
  &lt;item id='2016-05-30T09:00:00' xmlns='urn:xmpp:mix:0'&gt;
      &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Owner'&gt;
            &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Owner'&gt;
            &lt;value&gt;greymalkin@shakespeare.lit&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Message Node Subscription'&gt;
           &lt;value&gt;allowed&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
           &lt;value&gt;jid-mandatory-visible&lt;/value&gt;
         &lt;/field&gt;
         &lt;field var='No Private Messages'&gt;
            &lt;value&gt;true&lt;/value&gt;
         &lt;/field&gt;
         &lt;/x&gt;
  &lt;/item&gt;
&lt;/items&gt;
</pre></div>
    </div>
  </div>
  <div class="indent"><h3>3.10 <a name="non-standard-nodes" id="non-standard-nodes">Non-Standard Nodes</a></h3>
    <p>
      The MIX standard allows channels to use non-standard nodes, using names that do no conflict with the standard nodes.     Non-Standard nodes MUST NOT duplicate or otherwise provide capability that can be provided by standard nodes.
    </p>
  </div>
<h2>4.
       <a name="error-handling" id="error-handling">Error Handling</a></h2>
  <p>
    The MIX specification is built on layered services that have defined errors.  This enables the core MIX specification to reflect primarily the successful use case, as in almost all cases the error reporting of the layer service provide what is needed.   A message sender MUST be prepared to handle any valid error from the layer services.   When a message receiver encounters an error situation, it MUST use the most appropriate layer server error to report this issue back to the sender.   For example a message receiver might use the "not authorized" IQ error in response to a MIX disco that is not authorized.   Errors for the following layer services need to be handled for MIX:
  </p>
  <ol>
    <li>IQ.  All of the IQ errors of <span class="ref"><a href="http://tools.ietf.org/html/rfc6120">RFC 6120</a></span>  [<a href="#nt-idp1689216">10</a>] MUST be supported.</li>
    <li>Messages.  If a message is received and an error situation is encountered, an message of type error MUST be sent back to the message sender of type error specified in <span class="ref"><a href="http://tools.ietf.org/html/rfc6121">RFC 6121</a></span>  [<a href="#nt-idp1553136">7</a>] containing an error defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc6120">RFC 6120</a></span>  [<a href="#nt-idp1689216">10</a>], which is the same error set as for IQs.</li>
    <li>Presence.  Any responses to presence messages MUST follow the rules of <span class="ref"><a href="http://tools.ietf.org/html/rfc6121">RFC 6121</a></span>  [<a href="#nt-idp1553136">7</a>].</li>
    <li>PubSub.  Where MIX protocol messages use PubSub protocol, the errors defined in <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>] MUST be used and supported.</li>
  </ol>
<h2>5.
       <a name="discovery" id="discovery">Discovery</a></h2>
  <div class="indent"><h3>5.1 <a name="disco-service" id="disco-service">Discovering a MIX service</a></h3>
    <p>
      An entity MAY discover a MIX service or MIX services by sending a Service Discovery items ("disco#items") request to its own server.  
    </p>
    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Entity queries Server for associated services</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='lx09df27'
    to='shakespeare.example'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;

&lt;iq from='shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='mix.shakespeare.example'
          name='Shakespearean Chat Service'/&gt;
    &lt;item jid='mix2.shakespeare.example'
          name='Another Shakespearean Chat Service'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
    <p>To determine if a domain hosts a MIX service, a <span class="ref"><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idp1520992">5</a>] info query is sent in the usual manner to determine capabilities.</p>
      <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Entity queries a service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></div>
    <p>The MIX service then MUST return its identity and the features it supports, which MUST include the 'urn:xmpp:mix:0' feature, and the identity MUST have a category of 'conference' and a type of 'text', as shown in the following example: </p>
    <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Service responds with Disco Info result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Shakespearean Chat Service'
        type='text'/&gt;
    &lt;feature var='urn:xmpp:mix:0'/&gt;
    &lt;feature var='searchable' xmlns='urn:xmpp:mix:0'&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
    <p>
      A MIX service MUST return the 'urn:xmpp:mix:0' feature  and MAY return the other features listed here:
     </p>
    <ul>
      <li>'urn:xmpp:mix:0': This indicates support of MIX, and is returned by all MIX services.</li>
      <li>'searchable': This is shown in the above example and indicates that a the MIX Service MAY be searched for channels.   This presence of this feature can be used by a client to guide the user to search for channels in a MIX service.</li>
      <li>'create-channel': This is described in <a href="#usecase-admin-check-create"> Checking for Permission to Create a Channel</a> in support of channel administration.   When an end user client  needs to create channels, perhaps for short term usage, this feature helps the client to identify an MIX service to use.  It enables a configuration where permanent (searchable) channels are placed in one MIX service and clients will be able to create channels in another MIX service which is not searchable.</li>
    </ul>
    <p>A MIX service MUST NOT advertise support for <span class="ref"><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idp1495616">3</a>], as MAM is supported by the channels and not by the service.   A  MIX service MUST NOT advertise support for generic <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>], as although MIX makes use of PubSub it is not a generic PubSub service.</p>
  </div>
  <div class="indent"><h3>5.2 <a name="disco-channel-list" id="disco-channel-list">Discovering the Channels on a Service</a></h3>
    <p>The list of channels supported by a MIX service is obtained by a disco#items command.   The MIX service MUST only return channel that exist and that the user making the query has rights to subscribe to.  </p>
    <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Client Queries for Channels on MIX Service</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='kl2fax27'
    to='mix.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
</pre></div>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. MIX Service Returns Disco Items Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='mix.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='coven@mix.shakespeare.example' /&gt;
    &lt;item jid='spells@mix.shakespeare.example' /&gt;
    &lt;item jid='wizards@mix.shakespeare.example' /&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  </div>
  <div class="indent"><h3>5.3 <a name="disco-channel-info" id="disco-channel-info">Discovering Channel Information</a></h3>
    <p>In order to find out more information about a given channel, a user can send a disco#info query to the channel. </p>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Entity Queries for Information about a Specific Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='ik3vs715'
    to='coven@mix.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info' node='mix'/&gt;
&lt;/iq&gt;
</pre></div>
    <p> The channel MUST return its identity and the features it supports.  Note that a MIX channel MUST support MAM and so the response will always include both MIX and MAM support.  All disco queries on a MIX channel and results returned MUST include the attribute node='mix'.   The reason for this is to facilitate MIX channels and <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] MUC rooms sharing the same JID.   This extra parameter will enable a server to return appropriate information.</p>
    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Channel Returns Disco Info Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@mix.shakespeare.lit'
    id='ik3vs715'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info' node='mix'&gt;
    &lt;identity
        category='conference'
        name='A Dark Cave'
        type='mix'/&gt;
    &lt;feature var='urn:xmpp:mix:0'/&gt;
    &lt;feature var='urn:xmpp:mam:1'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  </div>
  <div class="indent"><h3>5.4 <a name="disco-channel-nodes" id="disco-channel-nodes">Discovering Nodes at a Channel</a></h3>
    <p>Use disco#items to find the nodes associated with a channel.   Discovering nodes in MIX MUST user the node='mix; attribute.  The MIX service MUST only return nodes that exist and that the user making the query has rights to subscribe to. </p>
    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Entity Queries for Nodes at a Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='kl2fax27'
    to='coven@mix.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/ node='mix'&gt;
&lt;/iq&gt;
</pre></div>
    <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Channel Returns Disco Items Result</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@mix.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items' node='mix'&gt;
    &lt;item jid='coven@mix.shakespeare.example'
          node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;item jid='coven@mix.shakespeare.example'
          node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;item jid='coven@mix.shakespeare.example'
          node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;item jid='coven@mix.shakespeare.example'
          node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  </div>
  <div class="indent"><h3>5.5 <a name="find-channel-info" id="find-channel-info">Determining Information about a Channel</a></h3>
    <p>The Information Node contains various information about the channel that can be useful to the user, that the client can access using PubSub, as shown below.</p>
    <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Client Requests Channel Information</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='kl2fax27'
    to='coven@mix.shakespeare.lit'
    type='get'&gt;
  &lt;pubsub xlns='http://jabber.org.protocol.pubsub'&gt;
      &lt;items node='urn:xmpp:nodes:info'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
    <p class="caption"><a name="example-18" id="example-18"></a>Example 18. MIX Service Returns Channel Information</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@mix.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;pubsub xlns='http://jabber.org.protocol.pubsub'&gt;
      &lt;items node='urn:xmpp:nodes:info&gt;&gt;
         &lt;item&gt;
           &lt;item id='2016-05-30T09:00:00' xmlns='urn:xmpp:mix:0'&gt;
              &lt;x xmlns='jabber:x:data' type='result'&gt;
                 &lt;field var='FORM_TYPE' type='hidden'&gt;
                     &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
                 &lt;/field&gt;
                 &lt;field var='Name'&gt;
                     &lt;value&gt;Witches Coven&lt;/value&gt;
                 &lt;/field&gt;
                 &lt;field var='Description'&gt;
                    &lt;value&gt;A location not far from the blasted heath where 
                          the three witches meet&lt;/value&gt;
                  &lt;/field&gt;
                  &lt;field var='Contact'&gt;
                       &lt;value&gt;greymalkin@shakespeare.lit&lt;/value&gt;
                  &lt;/field&gt;
               &lt;/x&gt;
         &lt;/item&gt;
      &lt;/items&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
  </div>
  <div class="indent"><h3>5.6 <a name="find-channel-participants" id="find-channel-participants">Determining the Participants in a Channel</a></h3>
    <p>
      Online clients in the channel are determined from the presence node using PubSub.   Participants in the channel are determined from the Participants Node which will give proxy JID and nick. The jidmap node is used to map to real JIDs.    For JID Hidden channels, only the nicks are returned.  For JID Visible channels, nicks and real JIDs are returned. This query MUST be made directly by a client.</p>
    <p class="caption"><a name="example-19" id="example-19"></a>Example 19. User's Server Requests Participant List</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='kl2fax27'
    to='coven@mix.shakespeare.lit'
    type='get'&gt;
     &lt;pubsub xlns='http://jabber.org.protocol.pubsub'&gt;
          &lt;items node='urn:xmpp:nodes:participants'/&gt;
     &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
    <p class="caption"><a name="example-20" id="example-20"></a>Example 20. MIX Service Returns Participant List for JID Visible Room</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven@mix.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
     &lt;pubsub xlns='http://jabber.org.protocol.pubsub'&gt;
          &lt;items node='urn:xmpp:nodes:participants'&gt;
             &lt;item jid='hag66@shakespeare.lit' nick='thirdwitch'&gt;
             &lt;item jid='hag01@shakespeare.lit' nick='top witch'&gt;
           &lt;/items&gt;
     &lt;/pubsub&gt;
  &lt;items&gt;
&lt;/iq&gt;
</pre></div>
  </div>
  <div class="indent"><h3>5.7 <a name="mix-client-discovery" id="mix-client-discovery">Discovering Client MIX Capability</a></h3>
    <p>
      Where a client supports MIX, it MUST advertise this capability in response to a Disco request.    This will enable other entities to determine if a client supports MIX, and in particular it facilitates the client's server to determine client support.  This can be optimized by use of CAPS.    The following example shows a Disco request to and response from a client that supports both MIX and MUC.
    </p>
    <p class="caption"><a name="example-21" id="example-21"></a>Example 21. Disco Query for MIX support</p><div class="indent"><pre class="prettyprint">
 &lt;iq  from='juliet@capulet.lit/46be1261-200b-4eea-8f82-e4fae46eec56/d6a85bb6-669f-471b-b55b-9a3930f5512e'
    id='disco1'
    to='romeo@montague.lit/14e8cb74-9082-4782-9275-8918ee5d8fcd/6983052d-3fdc-4e32-8221-79571a5210fe'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;    
      
      
&lt;iq from='romeo@montague.lit/14e8cb74-9082-4782-9275-8918ee5d8fcd/6983052d-3fdc-4e32-8221-79571a5210fe'
    id='disco1'
    to='juliet@capulet.lit/46be1261-200b-4eea-8f82-e4fae46eec56/d6a85bb6-669f-471b-b55b-9a3930f5512e'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://code.google.com/p/exodus#QgayPKawpkPSDYmwT/WM94uAlu0='&gt;
    &lt;identity category='client' name='Exodus 0.9.1' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/caps'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#items'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='http://jabber.org/protocol/mix'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  </div>
<h2>6.
       <a name="usecases" id="usecases">Use Cases</a></h2>
  <div class="indent"><h3>6.1 <a name="usecases-user" id="usecases-user">Common User Use Cases</a></h3>
    <div class="indent"><h3>6.1.1 <a name="usecase-user-join" id="usecase-user-join">Joining a Channel</a></h3>
      <p>A user joins a channel by sending a MIX "join" command. There is no default set of nodes, so user MUST specify the set of nodes to be subscribed to. To achieve the equivalent service to MUC, a user would subscribe to messages, and presence.
         This will lead to the server subscribing the user to each of the requested nodes associated with the channel. The MIX service will also add the user to the participant list by injecting a new item into the "urn:xmpp:mix:nodes:participants" node automatically.

      </p>
      <p>The default MIX model is that only channel participants are allowed to subscribe to nodes.    A MIX channel MAY allow non-participant subscription.   This will be handled by clients directly subscribing to the desired PubSub nodes.</p>
      
      <p>
        The user's server needs to make roster changes as part of the join functionality.   Because of this, the join and leave operations need to operate indirectly.
        For this reason the initial join request is sent to the local server with the MIX channel specified as an attribute to the join.
      </p>
      
        <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Client sends request to Local Server to Join a Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='hag66@shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0' 
         channel='coven@mix.shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
      
      <p>
        The user’s server will then pass the request to the MIX channel, with the request coming from the user's bare JID.    
      </p>
      
      <p class="caption"><a name="example-23" id="example-23"></a>Example 23. User's Server sends  Join request to MIX Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
      <p>The channel responds to the user's sever with an IQ-result addressed to the user's bare JID. This stanza includes the nodes to which the user has been successfully subscribed, as well as the bare JID that will be used for the user in this channel and added to the participant list.  The JID returned in the join is the user's bare proxy JID.  The following example shows the result of the above request when the request is completed in full. </p>
      <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Channel responds to User's Server</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0' jid='coven+123456@mix.shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
      
      <p>
     The user's server will then send the join response back to the client that made the join request.   The only change is that the incoming message is addressed to bare JID and the outgoing message is addressed to client's full JID.   Prior to sending this response, the user's server will make roster modifications as set out in the next section.
      </p>
      
      <p class="caption"><a name="example-25" id="example-25"></a>Example 25. User's Server sends response to Client</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0' jid='coven+123456@mix.shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        If a user cannot be subscribed to one or more of the requested nodes (e.g., because the node does not exist), but can be subscribed to some the response simply lists the nodes successfully subscribed.    If none of the nodes requested are successfully subscribed to, an error response is sent indicating the reason that the first node requested was not subscribed to.   This error response will also include other nodes requested where subscription failed for the same reason. </p>
      
      <p>
        The following response example shows a successful response to the initial request example where
        the participant is not be subscribed to all nodes associated with the channel (in this case only messages, participants, and information). This example shows the message from the MIX channel to the user's server, which will be modified and sent to the client.
      </p>
      <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Channel Processes Join With Some Nodes Not Subscribed To</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    from='hag66@shakespeare.example'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0' jid='coven+123456@mix.shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:info'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
      <p>The channel also adds the user to the participants node and sends a notification to subscribers of the participants node.  The following example shows such a notification.</p>
      <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Channel Adds User to Participants Node</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@mix.shakespeare.example'
         to='hecate@shakespeare.example'
         id='5A9C7398-DB13-4BFA-A091-2D466C710AAF'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='urn:xmpp:mix:nodes:participants'&gt;
      &lt;item id='coven+123456@mix.shakespeare.example'&gt;
        &lt;participant xmlns='urn:xmpp:mix:0'/&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></div>
      <p>The user that has been added to the channel is identified by the item id of the item added to the pubsub node, which is the proxy JID of the new channel participant. Note that the &lt;participant&gt; element MUST NOT include a nick of the user being added. The nick MAY be set after the join.</p>
      <p>
        A user MAY subsequently modify subscription to nodes in a channel by sending a subscription modification request, as shown in the following example.  This modification goes directly from client to MIX channel, as this change does not impact the roster and so does not need any local action.
      </p>
      <p class="caption"><a name="example-28" id="example-28"></a>Example 28. User Modifies Subscription Request</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;update-subscription xmlns='urn:xmpp:mix:0'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
  &lt;/update-subscription&gt;
&lt;/iq&gt;

&lt;iq type='result'
     from='coven@mix.shakespeare.example'
     to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;update-subscription xmlns='urn:xmpp:mix:0' jid='hag66@shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
  &lt;/update-subscription&gt;
&lt;/iq&gt;
</pre></div>
    </div>
    <div class="indent"><h3>6.1.2 <a name="usecase-roster-management" id="usecase-roster-management">Roster Management</a></h3>
      <p>
        As part of the channel joining process, the user's server MAY add the MIX channel to the user's roster using standard XMPP to update the roster.  This is done to share the user's presence status with the channel and so the MIX channel will get presence information from the user.  This roster entry will lead to the user's server correctly sending user's presence from all clients to the MIX channel. The roster subscription is configured with one way presence, as presence is sent to the MIX channel but no presence information is sent about the MIX channel to the user. The user's server MUST remove this roster entry after the user leaves the channel.
      </p>
      <p>
           If the user does not wish to publish presence information to the channel, the user will not add the roster entry.  A channel MAY require presence to be provided by all channel participants, which is controlled by the 'Participants Must Provide Presence' option.   The channel MAY check that channel participants have done this and MAY remove participants that do not do this.
      </p>
      <p>
       A channel MAY publish an Avatar following <span class="ref"><a href="https://xmpp.org/extensions/xep-0084.html">User Avatar (XEP-0084)</a></span>  [<a href="#nt-idp1592784">8</a>].  A client MAY make use of this information to associate an Avatar with the roster entry for a channel.
      </p>
    </div>

   <div class="indent"><h3>6.1.3 <a name="usecase-visibilty-pref" id="usecase-visibilty-pref">User Preferences and Additional Information</a></h3>
     <p>A channel MAY store user preferences and parameters with each user.    There are several standard preference options.
       </p>
     <p>
       A user  JID visibility preference have the following values:
     </p>
     <ol>
       <li>'Default'.   In this setting, the channel default value will be used.  This value is used if another value is not explicitly set.</li>
       <li>'Never'.  If this is set, JID will never be shared and user will be removed from the channel if its mode changes to JID-visible-mandatory.</li>
       <li>'Prefer Not'.   If this is set, JID will only be shared if mode is JID-visible-mandatory.</li>
     </ol>
     <p>
      The user MAY specify that no Private Messages are to be sent from the channel, and allow vCard retrieval.
     </p>
     <p>
       The user MAY specify that presence is not to be shared, which will prevent the MIX Channel from sending a presence probe for the user on channel start-up.  The user will also choose to not include the MIX channel in the user's roster, so that presence will not be updated.    Where the channel configuration sets 'Participants Must Provide Presence', this variable MUST be set to 'Share'.
     </p>
     <p>
       The following table sets out the standardized user preference values.   A MIX implementation MAY use other values.
     </p>
     <div class="indent"><p class="caption"><a name="table-8" id="table-8"></a>Table 8: Standard User Preference Options</p><table border="1" cellpadding="3" cellspacing="0">
       <tr class="body"><th>Option</th> <th>Values</th><th>Default</th></tr>
       <tr class="body"><td>'JID Visibility'</td> <td>'Default', 'Never',  'Prefer Not'</td>  <td>'Default'</td></tr>
       <tr class="body"><td>'Private Messages'</td><td>'Allow', 'Block'</td> <td>'Allow'</td></tr>
       <tr class="body"><td>'vCard'</td><td>'Allow', 'Block'</td> <td>'Block'</td></tr>
       <tr class="body"><td>'Presence'</td><td>'Share', 'Not Share'</td><td>'Share'</td></tr>
     </table></div>
     <p>When joining a channel, the client MAY specify one or more preference options as a <span class="ref"><a href="https://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idp1632416">9</a>] form.   In the response, the  server MUST specify all of the user preferences supported by the server, with default values if the user has not requested a different value.  The following example shows joining a channel and setting a preference.  The following example shows the message sent from the user's server to the MIX channel.</p>
     <p class="caption"><a name="example-29" id="example-29"></a>Example 29. User Joins a Channel and Specifies a preference</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
    &lt;join xmlns='urn:xmpp:mix:0'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
            &lt;value&gt;Never&lt;/value&gt;
        &lt;/field&gt;
     &lt;/x&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
     <p>The following example shows a successful join, which also reports all the user preferences. This is the message coming from the MIX channel to the user's server.  All join operations are addressed by a client to the user's server.</p>
     <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Channel Successfully Processes Join and returns the preferences set</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0' jid='hag66@shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
            &lt;value&gt;Never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Private Messages'&gt;
           &lt;value&gt;Allow&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='vCard'&gt;
          &lt;value&gt;Block&lt;/value&gt;
         &lt;/field&gt;
     &lt;/x&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
     <p>The client MAY also query the channel in order to find out which user preferences are supported and the options available.  This will allow users to set options not specified in the standard, by providing a form template in the result.   This query is direct from the client to the MIX channel.</p>
     <p class="caption"><a name="example-31" id="example-31"></a>Example 31. User Requests and Recieves Preferences Template Form</p><div class="indent"><pre class="prettyprint">
&lt;iq type='get'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
    &lt;user-preference xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
    &lt;user-preference xmlns='urn:xmpp:mix:0'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field type='list-single' label='Preference for JID Visibility' 
                   var='JID Visibility'&gt;
            &lt;option label='JID Never Shown'&gt;&lt;value&gt;Never&lt;/value&gt;&lt;/option&gt;
            &lt;option label='Default Behaviour'&gt;
                    &lt;value&gt;Default&lt;/value&gt;&lt;/option&gt;
            &lt;option label='Try not to show JID'&gt;
                     &lt;value&gt;Prefer Not&lt;/value&gt;&lt;/option&gt;
         &lt;/field&gt;
         &lt;field type='list-single' label='Example Custom Preference' 
                 var='Custom Preference'&gt;
            &lt;option label='One Option'&gt;&lt;value&gt;A&lt;/value&gt;&lt;/option&gt;
            &lt;option label='Another Option'&gt;&lt;value&gt;B&lt;/value&gt;&lt;/option&gt;
         &lt;/field&gt;
     &lt;/x&gt;
  &lt;/user-preference&gt;
&lt;/iq&gt;
</pre></div>
     <p>
       A user MAY modify preferences using the corresponding set operation.  The set MAY specify values for some or all attributes.  All attributes are returned in the result.
     </p>
     <p class="caption"><a name="example-32" id="example-32"></a>Example 32. User Updates Preferences</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
    &lt;user-preference xmlns='urn:xmpp:mix:0'/&gt;
     &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
            &lt;value&gt;Never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Private Messages'&gt;
           &lt;value&gt;Allow&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='vCard'&gt;
          &lt;value&gt;Block&lt;/value&gt;
         &lt;/field&gt;
     &lt;/x&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
    &lt;user-preference xmlns='urn:xmpp:mix:0'&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
            &lt;value&gt;Never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Private Messages'&gt;
           &lt;value&gt;Allow&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='vCard'&gt;
          &lt;value&gt;Block&lt;/value&gt;
         &lt;/field&gt;
     &lt;/x&gt;
  &lt;/user-preference&gt;
&lt;/iq&gt;
</pre></div>
   </div>

    <div class="indent"><h3>6.1.4 <a name="usecase-user-leaving" id="usecase-user-leaving">Leaving a Channel</a></h3>
      <p>Users generally remain in a channel for an extended period of time.  In particular the user remains as a participant the channel does not change when the user goes offline as happens with <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>]. So, leaving the channel is a permanent action for a user across all clients, not just a matter of telling the channel that the user is not currently available or for a single client.  In order to  leave a channel, a user sends a MIX "leave" command to the channel. When a user leaves the channel, the user's server will remove the channel from the user's roster.   Leave commands are sent indirectly through the user's server, to enable roster removal.   Leaving is initiated by a client request, as</p>
      
      
      <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Client Requests to Leave a Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='hag66@shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;leave xmlns='urn:xmpp:mix:0'
          channel=`coven@mix.shakespeare.example`/&gt;
&lt;/iq&gt;
</pre></div>
      
      <p>
        The user's server will then generate a matching request to the MIX channel.
      </p>
      
      <p class="caption"><a name="example-34" id="example-34"></a>Example 34. User's Server sends  Leave Request to  a Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;leave xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>
      
    <p>
      The MIX channel will then remove the user from the channel, as described below.   A response is sent to the user's server.
    </p>  
      <p class="caption"><a name="example-35" id="example-35"></a>Example 35. Channel Confirms Leave to User's Server</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'  
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;leave xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>
      
      
      <p>
        After receiving the confirmation that the user has left the MIX channel, the user's server will remove the MIX channel entry from the user's roster.   The user's server will then notify the client that requested to leave.
      </p>
      
      <p class="caption"><a name="example-36" id="example-36"></a>Example 36. User's Server Confirms Leave to Client</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'  
    from='coven@mix.shakespeare.example'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;leave xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>
      <p>When the user leaves the channel, the MIX service is responsible for unsubscribing the user from all nodes in the channel and for removing the user from the participants and presence list.  If the user has online presence when the user leaves the channel, the change of presence status caused by removing the user's entry or entries from the presence node will ensure that subscribers to the presence node are correctly updated on presence status.


        Deletion from the participants and presence functions as if the item (channel participant) had been deleted using the PubSub retract mechanism with notification set to true.    Notification of the deletion is sent to clients subscribed to the participants  PubSub nodes, as shown in the example below.
        </p>
      <p class="caption"><a name="example-37" id="example-37"></a>Example 37. Reporting when User Leaves a Channel</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@mix.shakespeare.example' 
                to='hecate@shakespeare.example' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='urn:xmpp:mix:nodes:participants'&gt;
      &lt;retract id='coven+123456@mix.shakespeare.example'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='coven@mix.shakespeare.example' 
                to='other-witch@shakespeare.example' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='urn:xmpp:mix:nodes:presence'&gt;
      &lt;retract id='coven+123456@mix.shakespeare.example/8765'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></div>


    </div>

    <div class="indent"><h3>6.1.5 <a name="usecase-setting-nick" id="usecase-setting-nick">Setting a Nick</a></h3>
    <p>
      Each participant of a channel MAY have a nick, which is how other users in the channel will see the user.  In some cases a nick is not needed, for example where a user reads messages in a channel but does not send messages or share presence information.    A nick MUST be present for a user to send a message to a channel or for a user's presence to be shared on a channel.   There are four ways that a user's nick can be obtained.   The choice of mechanism or mechanisms is dependent on channel policy:
    </p>
    <ol>
      <li>The nick is registered with the user account in some way, for example as part of user provisioning with nick configured as an attribute in a directory service.   For example, this could be chosen by corporate services that wish to ensure consistent nick values for a set of users and channels.</li>
      <li>The nick is registered with the MIX service, as described in  <a href="#usecase-user-register"> Registering a Nick </a>.</li>
      <li>The user explicitly sets the nick, as described in this section.</li>
      <li>The MIX service generates the nick.  In this case it is RECOMMENDED that the assigned nick is a UUID following <span class="ref"><a href="http://tools.ietf.org/html/rfc4122">RFC 4122</a></span>  [<a href="#nt-idp1817584">11</a>].</li>
    </ol>
    <p>
   A user will typically set a nick when joining a channel and MAY update this nick from time to time.   The user does this by sending a command to the channel to set the nick.  If the user wishes the channel to assign a nick (or knows that the channel will assign a nick) the nick field can be left blank, so that the user can see what is assigned in the result.
    </p>
    <p class="caption"><a name="example-38" id="example-38"></a>Example 38. User sets Nick on Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='coven@mix.shakespeare.example'
    id='7nve413p'&gt;
  &lt;query xmlns='urn:xmpp:mix:0'&gt;
    &lt;nick&gt;thirdwitch&lt;/nick&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>

    <p>
      The channel will return the nick that is to be used, noting that this MAY be different to the requested nick. MIX services SHOULD apply the "nickname" profile of the PRECIS OpaqueString class, as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc7700">RFC 7700</a></span>  [<a href="#nt-idp1822784">12</a>].
    </p>

    <p class="caption"><a name="example-39" id="example-39"></a>Example 39. Channel informs user of Nick</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    from='coven@mix.shakespeare.example'
    to'hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='7nve413p'&gt;
  &lt;query xmlns='urn:xmpp:mix:0'&gt;
    &lt;nick&gt;thirdwitch&lt;/nick&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
    </div>
    <div class="indent"><h3>6.1.6 <a name="usecase-user-register" id="usecase-user-register">Registering a Nick</a></h3>
      <p>A nick MAY be associated with the user's bare JID.  A user can register a nick with the MIX service.  Nick registration can be used ensure that a user is able to use the same nick in all channels in the service and to prevent other users from using a registered nick.   This can help achieve a consistent experience across a set of channels and prevent user confusion.  Support for nick registration by a MIX service is OPTIONAL.  Where nick registration is supported, nick registration MAY be OPTIONAL or MANDATORY.
        Where a user has registered a Nick with the MIX service, it MAY be used by each channel according to policy for the channel.  A channel MAY enforce use of a registered nick.  A channel MUST NOT use a registered nick for any other participant. 
      </p>
      <p>
        In order to determine if a Nick is allowed to be registered, the user MAY use disco to determine capabilities of the MIX service.
      </p>
      <p class="caption"><a name="example-40" id="example-40"></a>Example 40. User Determines features of the MIX service</p><div class="indent"><pre class="prettyprint">
&lt;iq type='get'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='mix.shakespeare.example'
    id='7nve413p'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq type='result'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    from='mix.shakespeare.example'
    id='7nve413p'&gt;
    &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
        &lt;feature xmlns='urn:xmpp:mix:0' var='mix_nick_register'/&gt;
    &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        The response will be a list of features of the MIX channel.  If Nick Registration is supported, then the result set will include &lt;feature var="mix_nick_register"/&gt;.
      </p>
      <p>
        To register a nick with the MIX service the user sends
 a &lt;register/&gt; command to the service. </p>
      <p class="caption"><a name="example-41" id="example-41"></a>Example 41. User Registers with Service</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='mix.shakespeare.example'
    id='7nve413p'&gt;
  &lt;register xmlns='urn:xmpp:mix:0'&gt;
    &lt;nick&gt;thirdwitch&lt;/nick&gt;
  &lt;/register&gt;
&lt;/iq&gt;
</pre></div>
      <p>On success, the service informs the user of its nick. MIX  SHOULD apply the "nickname" profile of the PRECIS OpaqueString class, as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc7700">RFC 7700</a></span>  [<a href="#nt-idp1822784">12</a>] to the requested nick.  This means that  nick that is issued might be different from the nick that was requested.</p>
      <p class="caption"><a name="example-42" id="example-42"></a>Example 42. Service Returns User of Nick</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    to='mix.shakespeare.example'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='7nve413p'&gt;
  &lt;register xmlns='urn:xmpp:mix:0'&gt;
    &lt;nick&gt;thirdwitch&lt;/nick&gt;
  &lt;/register&gt;
&lt;/iq&gt;
</pre></div>
      <p>If the requested nick is already taken, the MIX service returns a &lt;conflict/&gt; error:</p>
      <p class="caption"><a name="example-43" id="example-43"></a>Example 43. Nick is Taken</p><div class="indent"><pre class="prettyprint">
&lt;iq type='error'
    to='mix.shakespeare.example'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='7nve413p'&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
      <p>If the register request does not contain a &lt;nick/&gt; element, then the MIX service assigns one.  It is RECOMMENDED that the assigned nick is a UUID following <span class="ref"><a href="http://tools.ietf.org/html/rfc4122">RFC 4122</a></span>  [<a href="#nt-idp1817584">11</a>].
</p>


    </div>
    <div class="indent"><h3>6.1.7 <a name="usecase-user-presence" id="usecase-user-presence">Setting User Presence</a></h3>
      <p>

        A user joins a channel over an extended period, and participation in a channel does not generally change when user goes online or offline.   The user's  participation in a channel is reflected by the user's bare JID in the participant node.   All messages to the channel are sent to this JID.

      </p>
      <p>

        A user MAY share presence information with the channel, for one or more online clients.   Where a user shares presence information with a channel, the channel is entered by the user's server into the user's roster when the user subscribes to the channel.  When an XMPP client comes online or changes presence status, this will be communicated by the user to the user's server using broadcast presence.  The user's XMPP server is then responsible to share this presence information to each entry in the roster and in particular to each MIX channel in the roster.  The MIX channel will update the "urn:xmpp:mix:nodes:presence" node with any change of status and the updated presence information and then share this updated presence with users subscribed to this node, as described below.   When the user sets an explicit status, this is used to modify the presence node in the channel.   When a client being used by the user goes offline, the associated server will send presence status "unavailable" to the MIX channel, which will cause the full JID for that client to be removed from the presence node.
      </p>
      <p>
        A channel MAY require that all channel participants share presence information with the channel, which is represented in the "urn:xmpp:mix:nodes:presence" node.   If sharing presences is needed by the channel, an XMPP client conforming to this specification MUST share presence with the channel by including the channel in the user's roster. Note that the MIX service cannot generally enforce this, but it can require and enforce that when a message is sent to the channel, that the sender of the message is in the presence list.
      </p>
      <p>
      Presence status and availability is set in a MIX channel by standard presence stanzas sent to the MIX channel by the user's server.   Users wishing to receive presence updates will subscribe to the MIX channel presence node.   Presence updates are sent out to subscribing participants using standard presence stanzas.
      </p>
      <p>
        A user setting status is now used as an example.   Unlike in <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] where coming online is a special action, coming online in MIX is implicit when presence status is set.  Going offline is a achieved by setting presence status to unavailable, which removes the client full JID entry from the presence node.  When a user sets a presence status, the user's server sends updated presence to the MIX channel, and the MIX service then publishes the user's  availability to the "urn:xmpp:mix:nodes:presence" node. If there is not an item named by the full JID of the client with updated presence status, this item is created.</p>
      <p class="caption"><a name="example-44" id="example-44"></a>Example 44. User Setting Presence Status</p><div class="indent"><pre class="prettyprint">
&lt;presence xmlns='jabber:client' from=‘hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0’ 
              to='coven@mix.shakespeare.example'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Making a Brew&lt;/status&gt;
&lt;/presence&gt;</pre></div>
      <p>The user's presence information is then published by the service to the "urn:xmpp:mix:nodes:presence" node, with the 'publisher' attribute set to the user's participant identifier (the proxy JID). The MIX channel then broadcasts the presence change to all users who are subscribed to the "urn:xmpp:mix:nodes:presence" node.  The presence stanza is sent from the proxy (anonymized) full JID of the user.
      Note that presence is associated with a client and so will have a full JID as it comes directly from the client and not from the user's server.</p>
      <p class="caption"><a name="example-45" id="example-45"></a>Example 45. Channel Distributes Presence</p><div class="indent"><pre class="prettyprint">
&lt;presence from='coven+123435@mix.shakespeare.example/678'
          to='coven@mix.shakespeare.example'
          id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'&gt;
  &lt;nick xmlns='http://jabber.org/protocol/nick'&gt;thirdwitch&lt;/nick&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Making a Brew&lt;/status&gt;
&lt;/presence&gt;</pre></div>
    <p>
     The presence is distributed to those subscribing to the MIX channel presence node using a standard XMPP presence stanza. The presence change is recorded on the "urn:xmpp:mix:nodes:presence" node. The history of this node will be held as PubSub format in the MAM archive, so that presence history can be viewed.
    </p>
    </div>

    <div class="indent"><h3>6.1.8 <a name="usecase-obtaining-presence" id="usecase-obtaining-presence">Client Coming Online and Obtaining Presence from the Local Server</a></h3>
      <p>
        The presence information for a channel  is stored in the urn:xmpp:mix:nodes:presence node and distributed using standard presence stanzas to the server of each user subscribing to this presence node.  The user's local server will then pass this presence information on to all online clients.   This ensures that an online client is kept updated with presence.
        When a client goes offline, it will cease getting presence updates. Presence updates will continue to flow to the user's local server, and so the local server is able maintain up to date presence state for the channel.
      </p>
       <p>
        When the client comes online, it will activate use of the MIX.    The user's server will then send full presence status to the client using standard presence messages.   This will enable the client to update presence information for the channel.  Note that this does not need any interaction with the channel.
       </p>

    </div>

    <div class="indent"><h3>6.1.9 <a name="usecase-server-presence-update" id="usecase-server-presence-update">Updating Presence on User's Server</a></h3>
      <p>
        In normal operation a MIX participant's server  will hold accurate presence status for the channel which it provides to clients when they are activated.  Incoming presence updates are immediately sent to active MIX clients.
      </p>
      <p>
        There are two situations where a MIX participant's server  will need to get presence status from the channel.   The first time is when a user joins the channel as a participant and subscribes to presence.   Upon this subscription the MIX channel will send to the participant's server (using the user's bare JID) presence for all of the items in the presence node using standard presence stanzas.  This will give the participant's full current presence for the channel.
      </p>
      <p>
        The second scenario is when the MIX participant's server needs to load or refresh presence status for a channel.  This will be needed when the participant's server is started.   This MIX participant's server requests presence update by sending a directed presence stanza to the MIX channel from the user's bare JID. The MIX channel can distinguish this from a presence update, which will always be sent from the clients full JID.   This special presence stanza will send to the participant's server (using the user's bare JID) presence for all of the items in the presence node using standard presence stanzas.
      </p>
    </div>
    <div class="indent"><h3>6.1.10 <a name="usecase-real-jids" id="usecase-real-jids">Determining Real JIDs</a></h3>
      <p>
        Presence information will provide a MIX client with the nicks and anonymized proxy JIDs for participants.   For JID visible rooms, the user MAY look up the real JID using the "urn:xmpp:mix:nodes:jidmap" node.   The items in this node are identified by proxy JID, and so the real JID can be retrieved using a straightforward PubSub query.    While a user MAY subscribe to the jidmap node, it is more likely to be used to directly look up JIDs as and when needed.
      </p>

    </div>

    <div class="indent"><h3>6.1.11 <a name="usecase-sync-history" id="usecase-sync-history">Coming Online: Synchronizing Message History</a></h3>
      <p>
        A MIX client will typically display message history of the channel to the user.   When a client comes online it will need to obtain this message history from the MAM archive associated with the channel.  There are three basic approaches a client will take:
      </p>
      <ol>
        <li>If the client has previously displayed message history and has been offline for a reasonably small time, the client MAY wish to retrieve all messages since the last one displayed to the user.</li>
        <li>The client MAY wish to display a fixed number of messages, perhaps finding more messages if the client subsequently requests.</li>
        <li>The client MAY wish to display messages from a recent time period, perhaps finding more messages if the client subsequently requests.</li>
      </ol>
      <p>To achieve this, the client will query the user's own MAM archive using <span class="ref"><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idp1495616">3</a>], with the query filtered by the channel JID.   This gives the client flexibility to retrieve and display message history in a manner appropriate to the client implementation.</p>
    </div>


    <div class="indent"><h3>6.1.12 <a name="usecase-user-offline" id="usecase-user-offline">Going Offline</a></h3>
      <p>When a client goes offline, this presence update is sent by the client's server to the MIX channel.   From the client perspective, this is the same as any other presence change.   Handling by the MIX channel is slightly different.</p>
      <p class="caption"><a name="example-46" id="example-46"></a>Example 46. Client Goes Offline in the Channel</p><div class="indent"><pre class="prettyprint">
&lt;presence type='unavailable'
          from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
          to='coven@mix.shakespeare.example'/&gt;
</pre></div>
      <p>The MIX channel will retract (remove) the item in the presence node of the MIX channel identified by the client's full JID.  The MIX channel will notify subscribers to the presence node of the user going offline by sending a presence stanza to the full proxy JID of each client.</p>
      <p class="caption"><a name="example-47" id="example-47"></a>Example 47. Channel Distributes Notification of Client going Offline</p><div class="indent"><pre class="prettyprint">
&lt;presence from='coven+12345@mix.shakespeare.example/678'
          to='hecate@shakespeare.example'
          id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
          type='unavailable'/&gt;</pre></div>

      <p>
        There is the possibility that the message associated with the user going offline will be lost.   If this happens, "ghost" entries will appear in the presence node.   A MIX service MAY take steps to address this, for example by probing client with a disco for presence items that remain unchanged for a long period.
      </p>
      <p>
        It is desirable to prevent clients from going offline briefly and then coming back online again, as this will lead to "flapping presence".   The RECOMMENDED approach to achieve this is use of <span class="ref"><a href="https://xmpp.org/extensions/xep-0198.html">Stream Management (XEP-0198)</a></span>  [<a href="#nt-idp1871744">13</a>] to maintain an XMPP client connection in the event of short term TCP failure.
      </p>
    </div>



    <div class="indent"><h3>6.1.13 <a name="usecase-user-message" id="usecase-user-message">Sending a Message</a></h3>
      <p>A client sends a message directly to a MIX channel as a standard groupchat message, in exactly the same way as for <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>]. Messages are sent directly to the MIX channel from the user's client. The message id is selected by the client.</p>
      <p class="caption"><a name="example-48" id="example-48"></a>Example 48. User Sends Message to Channel</p><div class="indent"><pre class="prettyprint">
&lt;message from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
         to='coven@mix.shakespeare.example'
         id='92vax143g'
         type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
&lt;/message&gt;
</pre></div>
      <p>The MIX channel then puts a copy of the message into the MAM archive for the channel and sends a copy of  the message to each participant in
        standard groupchat format.    These messages sent by the channel are addressed to the bare JID of each participant and this will be handled by the participant's local server.  The message from value is the JID of the channel.  To enable sender identification, the Nick and bare proxy JID of the sender are included in the message as MIX parameters.   The id of the message is the ID from the MAM archive and NOT the id used by the sender.</p>

      <p class="caption"><a name="example-49" id="example-49"></a>Example 49. Channel Reflects Message to Participants</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@mix.shakespeare.example'
         to='hecate@shakespeare.example'
         id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
         type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
  &lt;nick xmlns='urn:xmpp:mix:0'&gt;thirdwitch&lt;/nick&gt;
  &lt;jid xmlns='urn:xmpp:mix:0'&gt;coven+123456@mix.shakespeare.example&lt;/jid&gt;
&lt;/message&gt;
</pre></div>
      <p>
        The messages sent to participants have a different message id to the originally submitted message.  This does not impact most recipients, but it does not allow the message originator to correlate the message with the submitted message.   To address this the MIX channel MUST include an additional element of the message copy going back to the originator's bare JID that includes the original id.  This enables the originator to correlate the received message with the message submitted.
      </p>
      <p class="caption"><a name="example-50" id="example-50"></a>Example 50. Channel Reflects Message back to Originator</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@mix.shakespeare.example'
         to='hag66@shakespeare.example'
         id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
         type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
  &lt;nick xmlns='urn:xmpp:mix:0'&gt;thirdwitch&lt;/nick&gt;
  &lt;jid xmlns='urn:xmpp:mix:0'&gt;coven+123456@mix.shakespeare.example&lt;/jid&gt;
  &lt;submission-id xmlns='urn:xmpp:mix:0'&gt;92vax143g&lt;/submission-id&gt;
&lt;/message&gt;
</pre></div>
    </div>

    <div class="indent"><h3>6.1.14 <a name="usecase-retract" id="usecase-retract">Retracting a Message</a></h3>
      <p>
        A MIX channel MAY support message retraction, where the sender of a messages or an authorized administrator deletes a message.   If this is done the original message MAY be replaced by a tombstone.  The protocol to request retraction does this by a message with a &lt;retract&gt; element as shown in the following example.
      </p>
      <p class="caption"><a name="example-51" id="example-51"></a>Example 51. User Retracts a Message</p><div class="indent"><pre class="prettyprint">
&lt;message from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
         to='coven@mix.shakespeare.example'
         id='92vax143g'&gt;
  &lt;retract id='28482-98726-73623' xmlns='urn:xmpp:mix:0'/&gt;
&lt;/message&gt;
</pre></div>
      <p>
        The MIX channel will allow a user to retract a message sent by the user if the 'Allow User Message Retraction' option is configured.    The MIX channel will allow an administrative user to retract any message if the user is in the group specified by the 'Administrator Message Retraction Rights' option.
      </p>
      <p>
        If the retraction message is accepted, it will be distributed to channel participants.  This will allow retraction to happen in the MAM archive of each channel participant and to reflect the retraction in client GUI.   A client receiving a retraction message SHOULD ensure that the retracted message is no longer displayed to the end user.
      </p>
      <p>
        Two approaches to message retraction can be used.  In the first approach, the retracted message is simply removed.   This is appropriate where retraction is provided as a user service and the user has rights to remove messages sent from the record.
      </p>
      <p>
        The second approach is to leave a tombstone, which if taken MUST be done in the following manner.   This is appropriate where it is desired to leave a record of the message that was redacted.
        With this approach, the original message &lt;body&gt; is removed and replaced with a tombstone using the &lt;retracted&gt; element that shows the JID of user performing the retraction and the time of the retraction.
      </p>
      <p class="caption"><a name="example-52" id="example-52"></a>Example 52. Retracted message tombstone in a MAM result</p><div class="indent"><pre class="prettyprint">
&lt;message id='aeb213' to='juliet@capulet.lit/46be1261-200b-4eea-8f82-e4fae46eec56/d6a85bb6-669f-471b-b55b-9a3930f5512e'&gt;
  &lt;result xmlns='urn:xmpp:mam:1' queryid='f27' id='28482-98726-73623'&gt;
    &lt;forwarded xmlns='urn:xmpp:forward:0'&gt;
      &lt;delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:08:25Z'/&gt;
      &lt;message xmlns='jabber:client' from="hag66@shakespeare.example" 
                 to="macbeth@shakespeare.lit"&gt;
        &lt;retracted xmlns='urn:xmpp:mix:0' by='hag66@shakespeare.example' 
                 time='2010-07-10T23:08:25Z'/&gt;
      &lt;/message&gt;
    &lt;/forwarded&gt;
  &lt;/result&gt;
&lt;/message&gt;
</pre></div>
    </div>

    <div class="indent"><h3>6.1.15 <a name="usecase-user-tell" id="usecase-user-tell">Telling another User about a Channel</a></h3>
      <p>
        A convenient way to reference another channel is to use <span class="ref"><a href="https://xmpp.org/extensions/xep-0372.html">References (XEP-0372)</a></span>  [<a href="#nt-idp1891792">14</a>] which enables the JID of a channel to be shared.  This might be used simply to inform the message recipient about the channel or as mechanism to invite the user to join the channel.   This is useful as an invitation mechanism to a channel that any user can join or where the invitee knows that the user is allowed to join (e.g., because the channel is for all users in an organization).
      </p>
    </div>
    <div class="indent"><h3>6.1.16 <a name="usecase-user-invite" id="usecase-user-invite">Inviting another User to join a Channel that the user does not have Permission to Join</a></h3>
      <p> Invitation by reference, as described in the previous section, is a convenient approach to invite a user to join a channel that the user has permission to join.   This section describes the approach used when the inviter has permission to grant rights for the invitee to become a channel participant.   This might be because the inviter is an administrator of the channel or the channel  has a special mode where channel participants are allowed to grant rights for other users to join a channel enabled ('Participation Addition by Invitation from Participant').   This approach is used to avoid cluttering the allowed node with JIDs of users who are invited to join, but do not accept the invitation.
        When a channel participant(the inviter) invites  another user (the invitee) to join a channel, the following sequence of steps is followed:

      </p>
      <ol>
        <li>The channel inviter sends to the channel requesting an invite for the invitee.</li>
        <li>The channel sends an invitation to the inviter.</li>
        <li>The inviter sends the invitation to the invitee.</li>
        <li>The invitee MAY use the invitation to join the channel.</li>
        <li>The invitee MAY send a response to the inviter, indicating if the invitation was accepted or declined.</li>
      </ol>
      <p>
        The first step is for the inviter to request an invitation from the channel.   The invitation contains inviter, invitee and a token.  The channel will evaluate if the inviter has rights to issue the invitation.   This will be because the inviter is a channel administrator or if the inviter is a channel participant and the channel has 'Participation Addition by Invitation from Participant' mode enabled.  If the inviter has rights to make the invitation, the channel will return a token.  The token is a string that the channel can subsequently use to validate an invitation.   The format of the token is not specified in this standard.   The encoded token MAY reflect a validity time.
      </p>
      <p class="caption"><a name="example-53" id="example-53"></a>Example 53. Inviter Requests and Receives Invitation</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.lit/d1781be2-2b2d-4cd8-8886-bdc0e1087873/2183ee64-9c97-4eeb-bdc0-c35138b9c2b1'
    id='kl2fax27'
    to='coven@mix.shakespeare.lit'
    type='get'&gt;
  &lt;invite xmlns='urn:xmpp:mix:0'&gt;
      &lt;invitee&gt;cat@shakespeare.lit&lt;/invitee&gt;
  &lt;/invite&gt;
&lt;/iq&gt;


&lt;iq from='coven@mix.shakespeare.lit'
    id='kl2fax27'
    to='hag66@shakespeare.lit/d1781be2-2b2d-4cd8-8886-bdc0e1087873/2183ee64-9c97-4eeb-bdc0-c35138b9c2b1'
    type='result'&gt;
  &lt;invite xmlns='urn:xmpp:mix:0'&gt;
        &lt;invitation&gt;
           &lt;inviter&gt;hag66@shakespeare.lit&lt;/inviter&gt;
           &lt;invitee&gt;cat@shakespeare.lit&lt;/invitee&gt;
           &lt;channel&gt;coven@mix.shakespeare.lit&lt;/channel&gt;
           &lt;token&gt;ABCDEF&lt;/token&gt;
        &lt;/invitation&gt;
  &lt;invite/&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        The inviter can now send the invitee a message containing the invitation, as shown in the following example.
      </p>
      <p class="caption"><a name="example-54" id="example-54"></a>Example 54. Inviter sends Invitation to Invitee</p><div class="indent"><pre class="prettyprint">
&lt;message from='hag66@shakespeare.lit/d1781be2-2b2d-4cd8-8886-bdc0e1087873/2183ee64-9c97-4eeb-bdc0-c35138b9c2b1'
    id='foo'
    to='cat@shakespeare.lit'&gt;
    &lt;body&gt;Would you like to join the coven?&lt;body&gt;
    &lt;invitation xmlns='urn:xmpp:mix:0'&gt;
        &lt;inviter&gt;hag66@shakespeare.lit&lt;/inviter&gt;
        &lt;invitee&gt;cat@shakespeare.lit&lt;/invitee&gt;
        &lt;channel&gt;coven@mix.shakespeare.lit&lt;/channel&gt;
        &lt;token&gt;ABCDEF&lt;/token&gt;
   &lt;/invitation&gt;
&lt;/iq&gt;
</pre></div>
  <p>The invitation can now be used by the invitee to join a channel. The invitation is simply added to the standard channel join, so that the channel can validate the invitation using the token. If the allowed node is present and the invitee is not matched against any item, the channel MUST add the invitee to the allowed node as part of the join.</p>
      <p class="caption"><a name="example-55" id="example-55"></a>Example 55. User Joins a Channel with an Invitation</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='cat@shakespeare.example'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;invitation&gt;
        &lt;inviter&gt;hag66@shakespeare.lit&lt;/inviter&gt;
        &lt;invitee&gt;cat@shakespeare.lit&lt;/invitee&gt;
        &lt;channel&gt;coven@mix.shakespeare.lit&lt;/channel&gt;
        &lt;token&gt;ABCDEF&lt;/token&gt;
   &lt;/invitation&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>
      <p>The invitee MAY send an acknowledgement back to the inviter, noting the status of the invitation.  Values are:</p>
      <ul>
        <li>'Joined': The invitee has joined the channel.</li>
        <li>'Declined': The invitee is not taking up the invitation.</li>
        <li>'Acknowledged': The invitation is acknowledged, without information on action taken or planned.</li>
      </ul>
      <p class="caption"><a name="example-56" id="example-56"></a>Example 56. Invitee sends Acknowledgement to Inviter</p><div class="indent"><pre class="prettyprint">
&lt;message from='cat@shakespeare.lit/066923ad-9f06-474d-8cc9-085d14af0554/4974bd01-d991-4bf8-ac4e-18b10160ba46'
    id='bar'
    to='hag66@shakespeare.lit/d1781be2-2b2d-4cd8-8886-bdc0e1087873/2183ee64-9c97-4eeb-bdc0-c35138b9c2b1'&gt;
    &lt;body&gt;No Thanks - too busy chasing mice....&lt;body&gt;
    &lt;invitation-ack xmlns='urn:xmpp:mix:0'&gt;
        &lt;value&gt;Declined&lt;/value&gt;
        &lt;invitation&gt;
             &lt;inviter&gt;hag66@shakespeare.lit&lt;/inviter&gt;
             &lt;invitee&gt;cat@shakespeare.lit&lt;/invitee&gt;
              &lt;channel&gt;coven@mix.shakespeare.lit&lt;/channel&gt;
              &lt;token&gt;ABCDEF&lt;/token&gt;
         &lt;/invitation&gt;
     &lt;/invitation-ack&gt;
&lt;/iq&gt;
</pre></div>
    </div>


    <div class="indent"><h3>6.1.17 <a name="usecase-user-private-messages" id="usecase-user-private-messages">Sending Private Messages</a></h3>

      <p>
       Private Messages are used to provide communication with another channel participant through the MIX channel, without the initiating  user knowing the real JID of the channel participant.  A channel MAY support use of Private Messages.  Private messages are standard XMPP messages.   A message goes through a number of stages with different addressing.  This is set out in the following table.
      </p>
      <div class="indent"><p class="caption"><a name="table-9" id="table-9"></a>Table 9: Setting From and To when sending Private Messages</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body"><th>Message</th><th>From</th><th>To</th></tr>
        <tr class="body"><td>First Message from Client to MIX Channel</td><td>Full JID of initiator's client</td><td>Proxy bare JID of responder</td></tr>
        <tr class="body"><td>First Message from MIX Channel to responder's server</td><td>Proxy full JID of initiator's client</td><td>Bare JID of responder</td></tr>
        <tr class="body"><td>First Message from responder's server to one or more of the responder's clients</td><td>Proxy full JID of initiator</td><td>Full JID of responder's client</td></tr>
        <tr class="body"><td>Messages from responder's client to MIX Channel</td><td>Full JID of responder's client</td><td>Proxy full JID of initiator's client</td></tr>
        <tr class="body"><td>Messages from MIX channel to initiator's client</td><td>Proxy full JID of responder's client</td><td>Full JID of initiator's client</td></tr>
        <tr class="body"><td>Messages from initiator's client to MIX Channel</td><td>Full JID of initiator's client</td><td>Proxy full JID of responder's client</td></tr>
        <tr class="body"><td>Message from MIX Channel to responder's client</td><td>Proxy full JID of initiator's client</td><td>Full JID of responder's client</td></tr>
      </table></div>
      <p>Private Messages MAY be archived using MAM by the XMPP servers associated with initiator and responder.   Private Messages MUST NOT be archived by the MIX channel.</p>
    </div>



    <div class="indent"><h3>6.1.18 <a name="usecase-vcard" id="usecase-vcard">Requesting vCard</a></h3>
      <p>A user MAY request the vCard of a channel participant by sending a request through the channel.  The request MAY be sent directly by the client or MAY be sent by the user's server on behalf of the user.  The MIX channel MAY pass this request on or MAY block it.  vCard requests MAY use <span class="ref"><a href="https://xmpp.org/extensions/xep-0054.html">vcard-temp (XEP-0054)</a></span>  [<a href="#nt-idp1922528">15</a>] (vcard-temp) or <span class="ref"><a href="https://xmpp.org/extensions/xep-0292.html">vCard4 over XMPP (XEP-0292)</a></span>  [<a href="#nt-idp1925312">16</a>] (vCard4 over XMPP).  Where a MIX service supports one or both of these protocols, the protocol MUST be advertized as a feature of the MIX service.   In the following example, using vcard-temp, the requesting client sends a message to the anonymized bare JID of the channel participant for which the vCard is desired.</p>
      <p class="caption"><a name="example-57" id="example-57"></a>Example 57. Client directly requests vCard through channel</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='lx09df27'
    to='coven+989898@mix.shakespeare.example'
    type='get'&gt;
  &lt;vCard xmlns='vcard-temp'/&gt;
&lt;/iq&gt;
</pre></div>
      <p>The MIX channel MAY pass on the vCard request or MAY reject with an error, dependent on channel policy.  The MIX service will then address the vCard request to the user's server (using bare JID) using an anonymous full proxy JID to hide the requester.  </p>
      <p class="caption"><a name="example-58" id="example-58"></a>Example 58. Channel passes on vCard request to the User's Server</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven+123456@mix.shakespeare.example/6789'
    id='lx09df27'
    to='peter@shakespeare.lit'
    type='get'&gt;
  &lt;vCard xmlns='vcard-temp'/&gt;
&lt;/iq&gt;
</pre></div>
    <p>
      The user's server, on behalf of the user, MAY send a response or reject with an error.   The user's server will send the vCard back to the channel.
    </p>
      <p class="caption"><a name="example-59" id="example-59"></a>Example 59. User's Server sends vCard Response via MIX channel</p><div class="indent"><pre class="prettyprint">
&lt;iq from='peter@shakespeare.lit'
    id='lx09df27'
    to='coven+123456@mix.shakespeare.example/6789'
    type='result'&gt;
    &lt;vCard xmlns='vcard-temp'&gt;
    &lt;FN&gt;Peter Saint-Andre&lt;/FN&gt;
    &lt;N&gt;
      &lt;FAMILY&gt;Saint-Andre&lt;/FAMILY&gt;
      &lt;GIVEN&gt;Peter&lt;/GIVEN&gt;
      &lt;MIDDLE/&gt;
    &lt;/N&gt;
    &lt;NICKNAME&gt;stpeter&lt;/NICKNAME&gt;
    &lt;URL&gt;http://www.xmpp.org/xsf/people/stpeter.shtml&lt;/URL&gt;
  &lt;/vCard&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        The MIX channel will then send the vCard response to the requesting client on behalf of the client sending the response.
      </p>
      <p class="caption"><a name="example-60" id="example-60"></a>Example 60. MIX Channel sends vCard responst to Client</p><div class="indent"><pre class="prettyprint">
&lt;iq from='coven+989898@mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
 &lt;vCard xmlns='vcard-temp'&gt;
    &lt;FN&gt;Peter Saint-Andre&lt;/FN&gt;
    &lt;N&gt;
      &lt;FAMILY&gt;Saint-Andre&lt;/FAMILY&gt;
      &lt;GIVEN&gt;Peter&lt;/GIVEN&gt;
      &lt;MIDDLE/&gt;
    &lt;/N&gt;
    &lt;NICKNAME&gt;stpeter&lt;/NICKNAME&gt;
    &lt;URL&gt;http://www.xmpp.org/xsf/people/stpeter.shtml&lt;/URL&gt;
  &lt;/vCard&gt;
&lt;/iq&gt;
</pre></div>
    </div>
  </div>

<div class="indent"><h3>6.2 <a name="use-presence-initialize" id="use-presence-initialize">Presence Initializion</a></h3>
  <p>
    For an active MIX Channel, the presence node is updated as channel participants change status and presence information is sent to the channel.  When a MIX channel starts, typically when the associated MIX Service and Server start, there is a need to initialize the presence node.    This is done by the XMPP server associated with the MIX channel sending out a presence probe for each channel participant, following the presence probe process specified in <span class="ref"><a href="http://tools.ietf.org/html/rfc6121">RFC 6121</a></span>  [<a href="#nt-idp1553136">7</a>].   A presence probe MUST NOT be sent for users who have set presence preference to not sharing.
  </p>
</div>
  <div class="indent"><h3>6.3 <a name="use-ensure-delivery" id="use-ensure-delivery">Ensuring Message Delivery</a></h3>
    <p>
      It is important that messages are all transferred from the MIX channel to the server associated with the each channel participant.   Transfer between servers will typically happen quickly and <span class="ref"><a href="https://xmpp.org/extensions/xep-0198.html">Stream Management (XEP-0198)</a></span>  [<a href="#nt-idp1871744">13</a>] will deal with short connection failures between servers.   Longer connection failures could lead to message loss.  This would lead to online users (who remain connected to their servers) missing messages, and to messages being missed out of the user archive.  This section describes how MIX addresses this.
    </p>
    <p>
      When there is a long term connection failure, the MIX channel will receive an error from the XMPP server indicating that a message failed to transfer to a recipient.   When this happens, the MIX channel MUST take responsibility to ensure that the message is retransmitted and delivered.   When the MIX channel detects a failure it will make use of an IQ Marker message to determine when the connection to the peer server is working again.  Once the channel has received a response to the marker IQ it will retransmit the pending messages.
    </p>
    <p class="caption"><a name="example-61" id="example-61"></a>Example 61. Channel Sends Marker Message</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='coven@mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example'
    type='get'&gt;
  &lt;marker xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;


&lt;iq from='hag66@shakespeare.example'
    id='lx09df27'
    to='coven@mix.shakespeare.example'
    type='result'&gt;
 &lt;marker xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>
  </div>

  <div class="indent"><h3>6.4 <a name="use-mam" id="use-mam">Use of MAM</a></h3>
   <p>
     All messages sent to a MIX channel MUST be archived using MAM in association with the MIX channel.   All messages MUST also be archived on the server associated with each channel participant receiving the message, which enables clients to always retrieve messages from the clients MAM archive.  Other channel nodes MAY be archived.
   </p>
    <div class="indent"><h3>6.4.1 <a name="use-mam-messages" id="use-mam-messages">Archive of Messages</a></h3>
      <p>
        Messages sent to participants MUST be archived by both the MIX channel and by the user's server.   This  MAY include presence messages.   Correct MIX operation relies on messages being archived.
      </p>
    </div>
    <div class="indent"><h3>6.4.2 <a name="use-mam-retrieve" id="use-mam-retrieve">Retrieving Messages</a></h3>
      <p>
        Clients will retrieve MIX messages using standard MAM protocol from the user's archive.  The MAM query will filter based on the channel JID to enable access to messages from a given channel. This gives the user a simple mechanism to access all messages sent to the channel.   MAM can be used to retrieve older messages that have not been cached by the client.
      </p>
      <p>
        Messages can also be retrieved from the channel by addressing MAM queries to the channel JID.   This will behave like a standard MAM archive.  This can be useful for administrators to access archived messages.  It can also be useful for new channel participants to access the historical archives.
      </p>
    </div>
    <div class="indent"><h3>6.4.3 <a name="use-mam-other-nodes" id="use-mam-other-nodes">MAM Use with other Channel Nodes</a></h3>
      <p>
        A MIX Channel MAY use MAM to archive nodes other than message nodes.   Clients with rights to access these archives MAY use MAM to do this, specifying the PubSub node in the MAM query addressed to the channel.
      </p>
    </div>

  </div>


  <div class="indent"><h3>6.5 <a name="usecases-admin" id="usecases-admin">Administrative Use Cases</a></h3>
    
 
    <div class="indent"><h3>6.5.1 <a name="usecase-admin-check-create" id="usecase-admin-check-create">Checking For Permission To Create a Channel</a></h3>
      <p>
        MIX does not standardize an access control model for creating and deleting MIX channels.    The choice is left to the MIX implementer, and could be a very simple or complex approach.  A client can determine if it has permission to create a channel on a MIX service, which MAY be used to control options presented to the user.   This is achieved by a disco command on the MIX service.   If the 'create-channel' feature is returned, the user is able to create a channel.
      </p>
        <p class="caption"><a name="example-62" id="example-62"></a>Example 62. Client determines Capability to Create a Channel</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Shakespearean Chat Service'
        type='text'/&gt;
    &lt;feature var='urn:xmpp:mix:0'/&gt;
    &lt;feature var='create-channel' xmlns='urn:xmpp:mix:0'&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
    </div>
    <div class="indent"><h3>6.5.2 <a name="usecase-admin-create" id="usecase-admin-create">Creating a Channel</a></h3>
      <p>
        A client creates a channel by sending a simple request to the MIX service.   A channel MAY be created with default parameters, as shown in the following example.   The result MUST include the name of the channel which MUST match the channel name in the request (if present).  Creating and destroying a channel is done direct from a client.
      </p>
        <p class="caption"><a name="example-63" id="example-63"></a>Example 63. Creating a Channel with Default Parameters</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
  &lt;create channel='coven' xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
  &lt;create channel='coven' xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        The client MAY also include parameters in <span class="ref"><a href="https://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idp1632416">9</a>] format as part of channel creation.    If the client wishes to inspect configuration, channel administration procedures SHOULD be used.
      </p>
      <p class="caption"><a name="example-64" id="example-64"></a>Example 64. Creating a Channel with Client Specified Parameters</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
  &lt;create channel='coven' xmlns='urn:xmpp:mix:0'&gt;
     &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Owner'&gt;
            &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Owner'&gt;
            &lt;value&gt;greymalkin@shakespeare.lit&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Message Node Subscription'&gt;
           &lt;value&gt;allowed&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
           &lt;value&gt;jid-mandatory-visible&lt;/value&gt;
         &lt;/field&gt;
         &lt;field var='No Private Messages'&gt;
            &lt;value&gt;true&lt;/value&gt;
         &lt;/field&gt;
         &lt;/x&gt;
  &lt;/create&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
  &lt;create channel='coven' xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>

    </div>


    <div class="indent"><h3>6.5.3 <a name="usecase-admin-create-adhoc" id="usecase-admin-create-adhoc">Creating a Channel for Ad Hoc Use</a></h3>
      <p>
        Channels MAY be created for ad hoc use between a set of users.  Channels of this nature will have channel name created by the server and will not be addressable or discoverable.  Here a channel is created without specifying the channel name.   Parameters for the channel MAY also be specified.
      </p>
      <p class="caption"><a name="example-65" id="example-65"></a>Example 65. Creating a Channel for Ad Hoc Use</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
  &lt;create xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
  &lt;create channel='A1B2C345' xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;
</pre></div>
   </div>
   <div class="indent"><h3>6.5.4 <a name="usecase-admin-converting-chat" id="usecase-admin-converting-chat">Converting a 1:1 Conversation to a Channel</a></h3>
     <p>
       A common use case for an ad hoc channel is where two users are engaged in a 1:1 chat and wish to broaden the discussion. Prior to bringing more users into a channel, using standard invitation process, there is a need to create and populate a channel.  The first step is for one of the two users to create an ad hoc channel, as described in the previous section.   The other user will then be invited, and can switch to the new channel.
     </p>
     <p>
       It can also be useful to share some or all of the messages from the 1:1 discussion into the new channel.  The mechanism to do this is to forward messages to be shared in the MUC using <span class="ref"><a href="https://xmpp.org/extensions/xep-0297.html">Stanza Forwarding (XEP-0297)</a></span>  [<a href="#nt-idp1968272">17</a>].  A body SHOULD NOT be used in the outer message.
       This will generally be done by the user creating the channel before the other user is invited, but MAY be sent by either the user creating the channel or the 1:1 chat partner at any time subsequently.
     </p>
     <p class="caption"><a name="example-66" id="example-66"></a>Example 66. Forwarding a message to create History</p><div class="indent"><pre class="prettyprint">
&lt;message from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
         to='A1B2C345@mix.shakespeare.example'
         id='92vax143g'
         type='groupchat'&gt;
         &lt;forwarded xmlns='urn:xmpp:forward:0'&gt;
          &lt;delay xmlns='urn:xmpp:delay' stamp='2010-07-10T23:08:25Z'/&gt;
          &lt;message from='hag67@shakespeare.example/pda'
                   id='0202197'
                   to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
                   type='chat'
                   xmlns='jabber:client'&gt;
              &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
          &lt;/message&gt;
        &lt;/forwarded&gt;
&lt;/message&gt;
</pre></div>
   </div>

    <div class="indent"><h3>6.5.5 <a name="usecase-admin-destroy" id="usecase-admin-destroy">Destroying a Channel</a></h3>
      <p>
        MIX channels are always explicitly destroyed by an owner of the channel or by a server operator. There is no concept of temporary channel, equivalent to <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] temporary room which is automatically destroyed by the server when the users leave.   However, channels MAY be configured with an explicit lifetime, after which the channel MUST be removed by the MIX service.   Where a channel is created for ad hoc use, it MAY be desirable to keep the channel for history reference or for re-use by the same set of users.  Note that the owner of the channel does not need to have presence registered in the channel in order to destroy it.
     </p>
      <p>
        A client destroys a channel using a simple set operation, as shown in the following example.
      </p>
      <p class="caption"><a name="example-67" id="example-67"></a>Example 67. Client Destroys a Channel</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
  &lt;destroy channel='coven' xmlns='urn:xmpp:mix:0'/&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
&lt;/iq&gt;
</pre></div>
    </div>
    <div class="indent"><h3>6.5.6 <a name="usecase-server-destroy" id="usecase-server-destroy">Server Destroying a Channel</a></h3>
      <p>
        A server MUST destroy a channel that has exceeded its specified explicit lifetime.
        Servers MAY destroy channels which have no participants and/or presence according to local policy.   There will often be good reasons to not destroy rooms in these scenarios, in particular to facilitate channel re-use and history access.
      </p>
    </div>
    <div class="indent"><h3>6.5.7 <a name="usecase-admin-information" id="usecase-admin-information">Modifying Channel Information</a></h3>
      <p>Authorized users, typically owners and sometimes administrators, MAY modify the channel information.   The client MAY issue a pubsub get command to obtain a form that will facilitate update of the information node.   The values in the form show current values, which be defaults or MAY have been explicitly set.  In the following example, the channel name was previously set, but other values were not. </p>
      <p class="caption"><a name="example-68" id="example-68"></a>Example 68. Getting Information Form</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='get'&gt;
     &lt;pubsub xmlns='http://jabber.org/protocol/'&gt;
         &lt;items node='urn:xmpp:mix:nodes:info'/&gt;
     &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/'&gt;
     &lt;items node='urn:xmpp:mix:nodes:info'&gt;
       &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;title&gt;Information Node Modification&lt;/title&gt;
        &lt;field type='text-multi'
               label='Channel Name'
               var='Name'&gt;
            &lt;value&gt;Witches Coven&lt;/value&gt;
        &lt;/field&gt;
        &lt;field type='text-multi'
               label='Channel Description'
               var='Description'/&gt;
         &lt;field type=jid-single'
                label='Channel Administrative Contact'
                var='Contact'/&gt;
      &lt;/x&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
      <p>  Updating the information node is done using a pubsub set command.  The MIX channel MUST update the fields with values provided, leaving other fields unchanged.  The result returns the id used in the information node item, which is the date/time of the modification. </p>
      <p class="caption"><a name="example-69" id="example-69"></a>Example 69. Modifying Channel Information</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
     &lt;publish node='urn:xmpp:mix:nodes:info'&gt;
       &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Name'&gt;
            &lt;value&gt;Witches Coven&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Description'&gt;
           &lt;value&gt;A location not far from the blasted heath where 
                        the three witches meet&lt;/value&gt;
         &lt;/field&gt;
         &lt;field var='Contact'&gt;
           &lt;value&gt;greymalkin@shakespeare.lit&lt;/value&gt;
         &lt;/field&gt;
      &lt;/x&gt;
     &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;publish node='urn:xmpp:mix:nodes:info'&gt;
        &lt;item id='2016-05-30T09:00:00' xmlns='urn:xmpp:mix:0'/&gt;
       &lt;/publish&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
    </div>
    <div class="indent"><h3>6.5.8 <a name="usecase-admin-information" id="usecase-admin-information">Modifying Channel Configuration</a></h3>
      <p>Channel owners are allowed to modify the channel configuration.    The client MAY issue a pubsub get command to obtain a form that will facilitate update of the configuration node.  Other clients MAY be authorized to use this command to see the channel configuration, but only owners MAY update the configuration.   The values in the form show current values, which MAY be defaults or MAY have been explicitly set.  The following example shows a short form returned to illustrate the syntax.   A typical configuration form will be much larger with many fields.  Modifying channel configuration is done directly by a client.
      </p>
      <p class="caption"><a name="example-70" id="example-70"></a>Example 70. Getting Configuration Form</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='get'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;items node='urn:xmpp:mix:nodes:config'/&gt;
     &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
     &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;items xmlns='urn:xmpp:mix:0'  node='urn:xmpp:mix:nodes:config'&gt;
       &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;title&gt;Configuration Node Modification&lt;/title&gt;
         &lt;field type=jid-multi'
                label='Channel Administrator'
                var='Administrator'/&gt;
      &lt;/x&gt;
     &lt;/items&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
      <p>  Updating the information node is done using a pubsub set command.  The MIX channel MUST update the fields with values provided, leaving other fields unchanged.  The result returns the id used in the configuration node item, which is the date/time of the modification. </p>
      <p class="caption"><a name="example-71" id="example-71"></a>Example 71. Modifying Channel Configuration</p><div class="indent"><pre class="prettyprint">
 &lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;publish node='urn:xmpp:mix:nodes:config'&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
             &lt;value&gt;urn:xmpp:mix:0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Owner'&gt;
            &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Owner'&gt;
            &lt;value&gt;greymalkin@shakespeare.lit&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='Message Node Subscription'&gt;
           &lt;value&gt;allowed&lt;/value&gt;
         &lt;/field&gt;
        &lt;field var='JID Visibility'&gt;
           &lt;value&gt;jid-mandatory-visible&lt;/value&gt;
         &lt;/field&gt;
         &lt;field var='No Private Messages'&gt;
            &lt;value&gt;true&lt;/value&gt;
         &lt;/field&gt;
      &lt;/x&gt;
     &lt;/publish&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;publish node='urn:xmpp:mix:nodes:config'&gt;
        &lt;item id='2016-05-30T09:00:00' xmlns='urn:xmpp:mix:0'/&gt;
       &lt;/publish&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
    </div>
    <div class="indent"><h3>6.5.9 <a name="usecase-admin-participants" id="usecase-admin-participants">Controlling Channel Partipcipants</a></h3>
      <p>
       Owners and Administrators are allowed to  control which users can participate in a channel by use of Allowed and Banned lists using PubSub.  These operations follow <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>] which sets out detailed protocol use and error handling.
       Allowed and Banned lists MAY be read by PubSub get of the Banned and Allowed Nodes.  This operation MAY be used by users as controlled by 'Allowed Node Subscription' and 'Banned Node Subscription' configuration node options (default Administrators).  
      </p>
      <p class="caption"><a name="example-72" id="example-72"></a>Example 72. Client Reads Allowed Node</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='get'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
         &lt;items node='urn:xmpp:mix:nodes:allowed'/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
         &lt;items node='urn:xmpp:mix:nodes:allowed'&gt;
            &lt;item id='shakespeare.lit'/&gt;
            &lt;item id='alice@wonderland.lit'/&gt;
         &lt;/items&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        JIDs can be added to the  Allowed and Banned nodes  by a pubsub set command.  This is used to add one item to a node.
      </p>
 <p class="caption"><a name="example-73" id="example-73"></a>Example 73. Client Adds a JID to the Allowed Node</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
        &lt;publish node='urn:xmpp:mix:nodes:allowed'&gt;
            &lt;item id='marlow.lit'/&gt;
         &lt;/items&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'/&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        JIDs can be removed from the Allowed and Banned nodes by pubsub retract command.
      </p>
    <p class="caption"><a name="example-74" id="example-74"></a>Example 74. Client Removes a JID to the Banned Node</p><div class="indent"><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    id='lx09df27'
    to='mix.shakespeare.example'
    type='set'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
        &lt;retract node='urn:xmpp:mix:nodes:banned'&gt;
            &lt;item id='lear@shakespeare.lit'/&gt;
         &lt;/items&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    type='result'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'/&gt;
&lt;/iq&gt;
</pre></div>
      <p>
        When the MIX channel adds a JID to the banned node, other nodes in the MIX channel will be appropriately updated to reflect this change.  In particular, the participants nodes and presence nodes will be updated to remove matching JIDs.    This will have the effect of immediately removing the user from the channel.  For this reason, there is no requirement to have the "kick" functionality of MUC, as this is achieved by banning the user.
      </p>
    </div>

  </div>

<h2>7.
       <a name="mix-requirements-participant-server" id="mix-requirements-participant-server">MIX Requirements on Participant's Server</a></h2>
  <p>
    This section defines behaviour REQUIRED by MIX for servers supporting MIX participants.  This provides the full MIX specification for clients and servers is set out in a single document.    This functionality MUST be provided by servers used by clients that participate in MIX channels.  In future, the specifications in this section MAY be moved to a separate XEP or it MAY be incorporated into
 <span class="ref"><a href="https://xmpp.org/extensions/xep-0376.html">Pubsub Account Management (XEP-0376)</a></span>  [<a href="#nt-idp2004992">18</a>] (PAM) which follows a similar model.
  </p>

  <div class="indent"><h3>7.1 <a name="server-identification-mix-clients" id="server-identification-mix-clients">Server Identification of MIX Capabable Clients</a></h3>
    <p>
      A MIX User's server MUST determine which online clients support MIX.   This will enable the server to send MIX traffic to all MIX capable clients.   A MIX capable client MAY choose to come online an not advertize MIX capability.   The mechanism for a server to discover client capability is described in <a href="#mix-client-discovery">Discovering Client MIX Capability</a>.
    </p>

  </div>

  <div class="indent"><h3>7.2 <a name="mix-from" id="mix-from">Messages From MIX Channels</a></h3>
    <p>
      Messages from a MIX channel will usually go to the participant's server.   The only exception to this is where the MIX channel is responding directly to messages from the client.   Messages and presence distributed but a MIX channel will always be sent to the participant's server and addressed to the user's bare JID.  The participant's server will simply send on the messages from the channel to each of the user's online clients which advertise MIX capability.   If there are no such clients activated, the message is dropped.   
    </p>
    <p>
      Messages sent to the participant's sever will always be addressed to the user's bare JID.  The participant’s server will modify the recipient to the full JID of each client to which the message is forwarded.    The participant's server MUST NOT make any other modifications to each message.  The following example, repeated from earlier, shows a message distributed by a MIX channel and directed to the participant’s server with the participant's bare JID.
    </p>
    <p class="caption"><a name="example-75" id="example-75"></a>Example 75. Channel Reflects Message to Participants</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@mix.shakespeare.example'
         to='hecate@shakespeare.example'
         id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
         type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
  &lt;nick xmlns='urn:xmpp:mix:0'&gt;thirdwitch&lt;/nick&gt;
  &lt;jid xmlns='urn:xmpp:mix:0'&gt;coven+123456@mix.shakespeare.example&lt;/jid&gt;
&lt;/message&gt;
</pre></div>

  <p>
    The following example shows how the participant's server modifies the inbound message to replace the bare JID in the 'to' with a full JID for each of two active MIX clients.
  </p>

    <p class="caption"><a name="example-76" id="example-76"></a>Example 76. Participant's Server Sends Modified Message to two Clients</p><div class="indent"><pre class="prettyprint">
&lt;message from='coven@mix.shakespeare.example'
         to='hecate@shakespeare.example/473c6613-fc5b-40f1-9984-a27887d406c9/7afcdb49-b08a-4617-a372-f3b4cff75c6a'
         id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
         type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
  &lt;nick xmlns='urn:xmpp:mix:0'&gt;thirdwitch&lt;/nick&gt;
  &lt;jid xmlns='urn:xmpp:mix:0'&gt;coven+123456@mix.shakespeare.example&lt;/jid&gt;
&lt;/message&gt;

&lt;message from='coven@mix.shakespeare.example'
         to='hecate@shakespeare.example/desktop'
         id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
         type='groupchat'&gt;
  &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;
  &lt;nick xmlns='urn:xmpp:mix:0'&gt;thirdwitch&lt;/nick&gt;
  &lt;jid xmlns='urn:xmpp:mix:0'&gt;coven+123456@mix.shakespeare.example&lt;/jid&gt;
&lt;/message&gt;

</pre></div>
  </div>

  <div class="indent"><h3>7.3 <a name="user-server-to" id="user-server-to">Messages To MIX Channels</a></h3>
    <p>
      Messages sent by a MIX channel participant to the MIX channel are always sent from a MIX client directly to the channel. The participant's server relays the message but does not modify the messages.
    </p>
  </div>
  
  
  <div class="indent"><h3>7.4 <a name="user-server-disco" id="user-server-disco">MIX Management and Discovery</a></h3>
    <p>
      Most interaction between  a MIX client and a MIX channel is directly between the client channel. The participant's server relays the message but does not modify the messages.   In particular configuration management and discovery is direct.   Interaction will be direct, unless explicitly stated otherwise.
    </p>
  </div>
  <div class="indent"><h3>7.5 <a name="mix-diso" id="mix-diso">IQ Support on Local Server</a></h3>
  <p>
    Channel Join and Leave functions operate indirectly through the participant's server.  The reason for this is that where a channel shares user presence, the channel is included in the user's roster which is managed in the local server.  The Join and Leave functions lead to roster changes and so they MUST go through the participant's server.   This is included in each of the operations that work in this manner.   The general mechanism to achieve this is illustrated by example in this section.
    The client addresses indirect messages to the user's own bare JID, indicating the channel with the channel attribute.  This is illustrated below. 
    
  </p>

  
    
  <p class="caption"><a name="example-77" id="example-77"></a>Example 77. Client sends request to local server to Join a MIX Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example/d104f6a7-97e9-477f-8947-e4a37691d7ee/7533375f-2cd1-4455-a311-494bab21f9f0'
    to='hag66@shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0' 
         channel='coven@mix.shakespeare.example'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>

   <p>This is then modified by the local server and sent to the MIX channel.  This is shown in the following example, repeated from the earlier specification of channel behaviour. </p>

    <p class="caption"><a name="example-78" id="example-78"></a>Example 78. Participant's Server sends Join to MIX Channel</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='hag66@shakespeare.example'
    to='coven@mix.shakespeare.example'
    id='E6E10350-76CF-40C6-B91B-1EA08C332FC7'&gt;
  &lt;join xmlns='urn:xmpp:mix:0'&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:messages'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:presence'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:participants'/&gt;
    &lt;subscribe node='urn:xmpp:mix:nodes:config'/&gt;
  &lt;/join&gt;
&lt;/iq&gt;
</pre></div>

  <p>
    The MIX service will send the IQ response to indirect messages to the user's server using the user's bare JID.   The user's server will then route the response back to the user's client.
  </p>
  </div>


  <div class="indent"><h3>7.6 <a name="proxy-roster" id="proxy-roster">Roster Management</a></h3>
    <p>
      The participant's server is responsible for ensuring that MIX channels are correctly entered into the user's roster when user's join MIX channels and for removing them when they leave.   
    </p>
    <p>
      The participant's server MUST ensure that only presence information from clients that advertize MIX capability is sent to the MIX channel.  So, if a user has two online clients, but only one is MIX capable, then the channel will only receive presence information relating to the MIX client.
    </p>
    
  </div>
  
  <div class="indent"><h3>7.7 <a name="mix-roster-capability-sharing" id="mix-roster-capability-sharing">MIX Roster Item Capability Sharing</a></h3>
    <p>It will be useful for a MIX client to know which roster members are MIX channels, as this will facilitate convenient presentation of subscribed MIX channels to the user. A standard roster item is encoded as follows.</p>
    <p class="caption"><a name="example-79" id="example-79"></a>Example 79. Standard Roster Item Encoding</p><div class="indent"><pre class="prettyprint">
&lt;item jid='romeo@example.net'/&gt;
</pre></div>
    
    <p>
      MIX channels in the roster have an attribute 'channel' set to true.   
    </p>
    
    <p class="caption"><a name="example-80" id="example-80"></a>Example 80. Roster Item Encoding of a MIX Channel</p><div class="indent"><pre class="prettyprint">
  &lt;item jid='romeo@example.net'&gt;
      &lt;channel xmlns=‘urn:xmpp:mix:0'/&gt;
  &lt;/item&gt;
</pre></div>
    
    <p>
      When sending roster information to a client that advertises MIX capability, the server MUST return all MIX channels and MUST use this encoding.  Presence  of MIX roster items MUST be set to offline (unavailable).
    </p>
    
    <p>
      Where a client does not advertize MIX capability, the server MAY choose to not return MIX channels as roster items.   If this is done care needs to be taken, in particular around support of roster versioning  <span class="ref"><a href="https://xmpp.org/extensions/xep-0237.html">Roster Versioning (XEP-0237)</a></span>  [<a href="#nt-idp1764096">19</a>].
    </p>
    
  </div>

  <div class="indent"><h3>7.8 <a name="proxy-mam" id="proxy-mam">MAM Archive Support</a></h3>
    <p>
      Archive of MIX channel messages is done by the participant's server.   Where a message is sent to the participant's server and discarded because there are no active clients, it will still be archived.   This means that the messages will be available in the local archive and can be picked up by clients when they come online.
    </p>
  </div>
<h2>8.
       <a name="mix-and-muc-together" id="mix-and-muc-together">Supporting MIX and MUC together</a></h2>
  <p>
    MIX is specified as a service that can be used independent of MUC and a MIX service MAY be implemented without MUC.  If both MIX and MUC are implemented, three approaches are noted.
  </p>
  <ol>
    <li>Entirely separate MIX and MUC implementation, with MIX and MUC using separate domains and MIX channels being completely separate from MUC rooms.</li>
    <li>Fully integrated MIX and MUC implementation, with MIX and MUC sharing a single domain and rooms/channels equivalent.</li>
    <li>Partially integrated MIX and MUC implementation, with MIX and MUC using separate domains, but rooms/channel are common.  This means that each MIX channel will have MUC room of the same name and same participants.</li>
  </ol>
  <p>The fully integrated approach would be transparent to clients.      The following example shows how a MIX service that also supported MUC would respond:</p>
  <p class="caption"><a name="example-81" id="example-81"></a>Example 81. Service responds with Disco Info result showing MIX and MUC support</p><div class="indent"><pre class="prettyprint">
&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Shakespearean Chat Service'
        type='text'/&gt;
    &lt;feature var='urn:xmpp:mix:0'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;urn:xmpp:mix:0#serviceinfo&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  <p>In the fully integrated service item discovery on the MIX/MUC service determines a list of channels.   The protocol used for this is the same in MUC and MIX.   Discovery actions on a channel in MIX MUST use 'node=mix' attribute in the discovery which will lead to the return of MIX channel specific information, as mandated for this discovery in MIX.   If is not set, MUC room specific information is returned.
  </p>
  <p>For the partially integrated service, it will be useful for clients that support both MIX and MUC to be able to determine that the server supports both protocols.   For a MIX client, it will be useful to know the MUC service, so that this information can be shared with a MUC client invitation.   This information is provided by the initial service discovery:</p>
    <p class="caption"><a name="example-82" id="example-82"></a>Example 82. MIX Service responds with Disco Info result sharing MUC service location</p><div class="indent"><pre class="prettyprint">
&lt;iq from='mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Shakespearean Chat Service'
        type='text'/&gt;
    &lt;feature var='urn:xmpp:mix:0'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;urn:xmpp:mix:0#serviceinfo&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='muc-mirror'
             type='jid-single'
             label='Location of MUC mirror service'&gt;
        &lt;value&gt;chat.shakespeare.example&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
    <p>The result is returned in an extended disco results in a form whose type value is 'urn:xmpp:mix:0#serviceinfo'.  The  field with var='muc-mirror' is the value of which is the mirrored MUC domain's JID.  </p>
    <p>Where a client supporting both MIX and MUC is given a reference to a MUC room, it is desirable that the client can determine the MIX channel and join using MIX.   This is achieved by an equivalent extension to MUC service discover.</p>
  <p class="caption"><a name="example-83" id="example-83"></a>Example 83. MUC Service responds with Disco Info result sharing MIX service location</p><div class="indent"><pre class="prettyprint">
&lt;iq from='chat.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/e0def5dc-3282-4d00-840a-0292622ba804/ba70bd0f-96fe-442d-872a-96ef3b168613'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity
        category='conference'
        name='Shakespearean Chat Service'
        type='text'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;urn:xmpp:mix:0#serviceinfo&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='mix-mirror'
             type='jid-single'
             label='Location of MUC mirror service'&gt;
        &lt;value&gt;mix.shakespeare.example&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  <p>The result is returned in an extended disco results in a form whose type value is 'urn:xmpp:mix:0#serviceinfo'.  The  field with var='mix-mirror' is the value of which is the mirrored MIX domain's JID.  </p>
  <div class="indent"><h3>8.1 <a name="mix-muc-invite-choice" id="mix-muc-invite-choice">Choosing Which Invite to Send</a></h3>
    <p>
      Where a client supports MUC and MIX and has determined that for a channel that the server also supports a MUC room, the client has a choice as to which type of invite to send.   This SHOULD be done by determining if the client support MIX using the mechanism specified in
       <a href="#mix-client-discovery">Discovering Client MIX Capability</a>.  If the client supports MIX a MIX invite SHOULD be sent.
    </p>
  </div>

<h2>9.
       <a name="not-included-from45" id="not-included-from45">Capabilities not provided in MIX</a></h2>
  <p>This section lists a number of capabilities not specified in the core MIX which are provided in <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>].   These capabilities will not be added to core MIX but they could in the future be specified as independent XEPs.</p>
  <div class="indent"><h3>9.1 <a name="password-control" id="password-control">Password Controlled Channels</a></h3>
    <p>
      <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] provides a mechanism to control access to MUC rooms using passwords.  An equivalent mechanism is not included in core MIX, as it has a number of security issues.  Control of access to channels is better achieved using an explicit list of participants.
    </p>
  </div>
  <div class="indent"><h3>9.2 <a name="voice-control" id="voice-control">Voice Control</a></h3>
    <p>
      <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] defines a mechanism so that MUC moderators can control who is able to send messages to a MUC room using a "voice" mechanism.  MIX does not provide an exact functional equivalent, although access control to channels enables some of the goals of voice control to be achieved in a different manner.
      
    </p>
  </div>

<div class="indent"><h3>9.3 <a name="not-subject" id="not-subject">Subject</a></h3>
  <p><span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] provide a Subject capability to enable setting of the current topic of discussion.   The Name and Description attributes provided by MIX enable descriptive information to be associated with a channel.   These attributes can replace Subject in the way it is used in many MUC rooms, but they do not reflect the more limited topic nature of Subject.</p>
  <p>It is likely that a new XEP to be used with MIX will be written, perhaps using a "Sticky Messages" approach to fulfil the Subject capability using a different approach. </p>
</div>
<h2>10.
       <a name="i18n" id="i18n">Internationalization Considerations</a></h2>
  <p>MIX allows specification of a number of human readable strings associated with a MIX channel, in particular the name and description information of a  MIX channel.   These strings MAY have language set using an xml:lang attribute, and multiple values MAY be set provided that each one is distinguished using xml:lang.
  </p>

  <p>Nicknames SHOULD be normalized using the "nickname" profile of the PRECIS OpaqueString class, as defined in <span class="ref"><a href="http://tools.ietf.org/html/rfc7700">RFC 7700</a></span>  [<a href="#nt-idp1822784">12</a>]. </p>
<h2>11.
       <a name="security" id="security">Security Considerations</a></h2>
  <p>MIX is built over MAM and PubSub and the security considerations of <span class="ref"><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idp1495616">3</a>] and <span class="ref"><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idp1500240">2</a>] MUST be considered. These services protect MIX channel information, which can be sensitive and needs appropriate protection.</p>
  <p>MIX channels MAY be JID Hidden, in order to hide the JIDs of channel participants from those accessing the channel.  Care MUST be taken to ensure that JIDs are fully hidden. In particular when proxy JIDs are prepared, this MUST be done in a manner which ensure that the real JIDs cannot be determined.   Where nicks are assigned by a channel, this MUST be done in a way that does not expose the JID.</p>
  <p>
    There is no MIX equivalent to <span class="ref"><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idp1490320">1</a>] password controlled rooms, which avoids a number of security issues.
  </p>
  <p>
    MIX provides flexible access control options, which MUST be used in a manner appropriate to the security requirements of MIX users and services.
  </p>

<h2>12.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p>None.</p>
<h2>13.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <p>The urn:xmpp:mix namespace needs to be registered.</p>
<h2>14.
       <a name="schema" id="schema">XML Schema</a></h2>
  <p>To be supplied when MIX progresses to proposed standard.</p>
<h2>15.
       <a name="ack" id="ack">Acknowledgements</a></h2>
  <p>Thanks to the following who have made contributions: Dave Cridland, Philipp Hancke, Waqas Hussain, Timothée Jaussoin, Evgeny Khramtsov, Georg Lukas, Tobias Markmann, Ralph Meijer, Edwin Mons, Emmanuel Gil Peyrot, Florian Schmaus, Lance Stout, Sam Whited, Matthew Wild and one anonymous reviewer.</p>
<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0369<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status:
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.8<br />
            Last Updated: 2017-02-13<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XMPP IM, XEP-0004, XEP-0030, XEP-0054, XEP-0060, XEP-0084, XEP-0128, XEP-0198, XEP-0292, XEP-0297, XEP-0313, XEP-0372<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: MIX<br />
              Source Control:
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0369.xml">HTML</a><br />
            This document in other formats:
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0369.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0369.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Kevin Smith</h3><p class="indent">
        Email:
        <a href="mailto:kevin.smith@isode.com">kevin.smith@isode.com</a><br />
        JabberID:
        <a href="xmpp:kevin.smith@isode.com">kevin.smith@isode.com</a><br /></p><h3>Steve Kille</h3><p class="indent">
        Email:
        <a href="mailto:steve.kille@isode.com">steve.kille@isode.com</a><br />
        JabberID:
        <a href="xmpp:steve.kille@isode.com">steve.kille@isode.com</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        Email:
        <a href="mailto:peter@andyet.net">peter@andyet.net</a><br />
        JabberID:
        <a href="xmpp:stpeter@stpeter.im">stpeter@stpeter.im</a><br />
        URI:
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 – 2017 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idp1490320" id="nt-idp1490320">1</a>. XEP-0045: Multi-User Chat &lt;<a href="https://xmpp.org/extensions/xep-0045.html">https://xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-idp1500240" id="nt-idp1500240">2</a>. XEP-0060: Publish-Subscribe &lt;<a href="https://xmpp.org/extensions/xep-0060.html">https://xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-idp1495616" id="nt-idp1495616">3</a>. XEP-0313: Message Archive Management &lt;<a href="https://xmpp.org/extensions/xep-0313.html">https://xmpp.org/extensions/xep-0313.html</a>&gt;.</p><p><a name="nt-idp1512544" id="nt-idp1512544">4</a>. XEP-0289: Federated MUC for Constrained Environments &lt;<a href="https://xmpp.org/extensions/xep-0289.html">https://xmpp.org/extensions/xep-0289.html</a>&gt;.</p><p><a name="nt-idp1520992" id="nt-idp1520992">5</a>. XEP-0030: Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0030.html">https://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idp1524624" id="nt-idp1524624">6</a>. XEP-0163: Personal Eventing Protocol &lt;<a href="https://xmpp.org/extensions/xep-0163.html">https://xmpp.org/extensions/xep-0163.html</a>&gt;.</p><p><a name="nt-idp1553136" id="nt-idp1553136">7</a>. RFC 6121: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc6121">http://tools.ietf.org/html/rfc6121</a>&gt;.</p><p><a name="nt-idp1592784" id="nt-idp1592784">8</a>. XEP-0084: User Avatar &lt;<a href="https://xmpp.org/extensions/xep-0084.html">https://xmpp.org/extensions/xep-0084.html</a>&gt;.</p><p><a name="nt-idp1632416" id="nt-idp1632416">9</a>. XEP-0004: Data Forms &lt;<a href="https://xmpp.org/extensions/xep-0004.html">https://xmpp.org/extensions/xep-0004.html</a>&gt;.</p><p><a name="nt-idp1689216" id="nt-idp1689216">10</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-idp1817584" id="nt-idp1817584">11</a>. RFC 4122: A Universally Unique IDentifier (UUID) URN Namespace &lt;<a href="http://tools.ietf.org/html/rfc4122">http://tools.ietf.org/html/rfc4122</a>&gt;.</p><p><a name="nt-idp1822784" id="nt-idp1822784">12</a>. RFC 7700: Preparation, Enforcement, and Comparison of Internationalized Strings Representing Nicknames&lt;<a href="http://tools.ietf.org/html/rfc7700">http://tools.ietf.org/html/rfc7700</a>&gt;.</p><p><a name="nt-idp1871744" id="nt-idp1871744">13</a>. XEP-0198: Stream Management &lt;<a href="https://xmpp.org/extensions/xep-0198.html">https://xmpp.org/extensions/xep-0198.html</a>&gt;.</p><p><a name="nt-idp1891792" id="nt-idp1891792">14</a>. XEP-0372: References &lt;<a href="https://xmpp.org/extensions/xep-0372.html">https://xmpp.org/extensions/xep-0372.html</a>&gt;.</p><p><a name="nt-idp1922528" id="nt-idp1922528">15</a>. XEP-0054: vcard-temp &lt;<a href="https://xmpp.org/extensions/xep-0054.html">https://xmpp.org/extensions/xep-0054.html</a>&gt;.</p><p><a name="nt-idp1925312" id="nt-idp1925312">16</a>. XEP-0292: vCard4 over XMPP &lt;<a href="https://xmpp.org/extensions/xep-0292.html">https://xmpp.org/extensions/xep-0292.html</a>&gt;.</p><p><a name="nt-idp1968272" id="nt-idp1968272">17</a>. XEP-0297: Stanza Forwarding &lt;<a href="https://xmpp.org/extensions/xep-0297.html">https://xmpp.org/extensions/xep-0297.html</a>&gt;.</p><p><a name="nt-idp2004992" id="nt-idp2004992">18</a>. XEP-0376: Pubsub Account Management &lt;<a href="https://xmpp.org/extensions/xep-0376.html">https://xmpp.org/extensions/xep-0376.html</a>&gt;.</p><p><a name="nt-idp1764096" id="nt-idp1764096">19</a>. XEP-0237: Roster Versioning &lt;<a href="https://xmpp.org/extensions/xep-0237.html">https://xmpp.org/extensions/xep-0237.html</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 0.8 (2017-02-13)</h4><div class="indent"><p>
      Update after Brussels Summit;
      Remove Explicit Client Activation and replace with client capability discovery (summit 3);
      Limit Indirect to Join/Leave;
      Clarify Server use of Disco of Client;
      Add MIX capability information to Roster (summit 10);
      MIX as Core Spec (summit 1);
      Clarifications of password control, voice and name/description (summit 4/5/6)
      Removal of Subject and reference future Sticky Messages XEP (summit 7);
      Use example JIDs aligned to anticipated BIND2 specification;
      Clarify PubSub Node Type;
      Add Error handling section;
      Substantial Editorial Review;
    </p> (sek)
    </div><h4>Version 0.7.1 (2017-01-30)</h4><div class="indent"><p>
      Ensure all RFC 2119 keywords are capitalized and used correctly;
      Use MAM ID to identify message;
      Clarify use of the various channel names;
      Require all client operations to be direct or indirect (choice is just confusing);
      Add description of implicit activation ;
      MIX Domains must not contain users;
      Clarification on identifying channels in rosters;
    </p> (sek)
    </div><h4>Version 0.7 (2017-01-27)</h4><div class="indent"><p>
      Correct multi-language subject setting;
      Remove MIX Proxy terminology and replace with Participant Server Behaviour;
    </p> (sek)
    </div><h4>Version 0.6.5 (2017-01-10)</h4><div class="indent"><p>
      Modify MIX Proxy so that client sends to bare JID
    </p> (sek)
    </div><h4>Version 0.6.4 (2017-01-10)</h4><div class="indent"><p>
      Add node='mix' to channel disco to facilitate MIX and MUC co-existence on same node;
      Return Proxy JID on Join;
      Adjustment to message reflection
    </p> (sek)
    </div><h4>Version 0.6.3 (2016-12-22)</h4><div class="indent"><p>
      Add Update and Distribution to Table 3;
      Correct from in messages from channel;
      Use XEP-0297 in message forwarding;
      Update Dependent XEPs
    </p> (sek)
    </div><h4>Version 0.6.2 (2016-12-21)</h4><div class="indent"><p>
      Editorial Changes (Georg Lukas Review);
      Improve 1:1 Conversion;
      Sort out MIX Proxy and Presence Update
    </p> (sek)
    </div><h4>Version 0.6.1 (2016-12-05)</h4><div class="indent"><p>
      Clarify Direct PubSub access to each node type.
    </p> (sek)
    </div><h4>Version 0.6 (2016-12-02)</h4><div class="indent"><p>
     Added Internationalization Consideration section, and various I18n edits;
     Added Security Considerations section;
     Tombstoning of Redaction changes made optional;
     Added a section specifying MIX Proxy;
     Change configuration and information node management to directly use PubSub;
     Provide for XEP-0202 (vCard4 over XMPP) in addition to vcard-temp support.
    </p> (sek (XEP Editor: ssw))
    </div><h4>Version 0.5 (2016-11-04)</h4><div class="indent"><p>
      Complete and restructure Administration Section: Creating Channels and modifying configuration;
      Add avatar nodes;
      Add section on roster handling;
      Discovering MIX Services;
      Resolve questions on future capabilities;
      Administration of Allowed/Banned; clarify Kick functionality is replaced;
      User Presence Probes on Channel Start-up;
      Add user Presence preference;
      Clarify and Expand MAM Archiving;
      Sort Retraction;
      Add Marker IQ;
      Conversion 1:1
    </p> (sek (XEP Editor: ssw))
    </div><h4>Version 0.4 (2016-09-21)</h4><div class="indent"><p>Clarification of MIX Proxy concept; Clarify node definitions; Make all nodes optional; Merge ACL node into configuration node; Add information node including avatar; Resolve 4.1 question by accepting provisional answer; Add discovery examples; setting and sharing Subject; Protocol to request channel information and participants;  vCard Request;  Private Messages; Set user preferences with XEP-0004; Remove references to member and occupant;  Add Role Definition;  Add Banned and Allowed Nodes;  Update Configuration Definition;Add information on original id to message reflected back to sender  Add XEP-0372 mechanism to reference channel and informal invite;  Channel Invitations </p> (sek)
    </div><h4>Version 0.3.1 (2016-09-07)</h4><div class="indent"><p>Introduce MIX Proxy concept.   Add MIX capability in client discovery.</p> (sek)
    </div><h4>Version 0.3 (2016-09-05)</h4><div class="indent"><p>Addressing comments from review of 0.2 and expansion/clarification of MUC/MIX dual working</p> (sek)
    </div><h4>Version 0.2.3 (2016-09-01)</h4><div class="indent"><p>Cleanup, use precis nickname for nicknames, and allow multiple subject languages.</p> (ssw, ks)
    </div><h4>Version 0.2.2 (2016-08-26)</h4><div class="indent"><p>Phrasing and grammar.</p> (ssw)
    </div><h4>Version 0.2.1 (2016-08-25)</h4><div class="indent"><p>Includes Link Mauve (Emmanuel Gil PEYROT) editorial changes</p> (sek, egp)
    </div><h4>Version 0.2 (2016-08-16)</h4><div class="indent"><p>Significant update based on XMPP Summit discussions</p> (sek, ks)
    </div><h4>Version 0.1.1 (2016-03-17)</h4><div class="indent"><p>Fix XML in join example.</p> (XEP Editor (ssw))
    </div><h4>Version 0.1 (2016-01-07)</h4><div class="indent"><p>Initial published version approved by the XMPP Council.</p> (XEP Editor (asw))
    </div><h4>Version 0.0.1 (2015-10-12)</h4><div class="indent"><p>First draft.</p> (kis/psa)
    </div></div><hr /><p>END</p></body></html>
