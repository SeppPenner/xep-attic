<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>XEP-0176: Jingle ICE Transport</title>
<link rel="stylesheet" type="text/css" href="/xmpp.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="Jingle ICE Transport">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Creator" content="Joe Beda">
<meta name="DC.Creator" content="Scott Ludwig">
<meta name="DC.Creator" content="Joe Hildebrand">
<meta name="DC.Creator" content="Sean Egan">
<meta name="DC.Description" content="This document defines a Jingle transport method that results in sending data between two entities using the Interactive Connectivity Establishment (ICE) methodology.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="XMPP Extensions Editor">
<meta name="DC.Date" content="2006-10-31">
<meta name="DC.Type" content="XMPP Extension Protocol">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="XEP-0176">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This XMPP Extension Protocol is copyright 1999 - 2006 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.xmpp.org/extensions/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>XEP-0176: Jingle ICE Transport</h1>
<p>This document defines a Jingle transport method that results in sending data between two entities using the Interactive Connectivity Establishment (ICE) methodology.</p>
<p><hr></p>
<p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the Jabber Software Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p>
<p><hr></p>
<h2>XEP Information</h2>
<p class="indent">
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br>
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a><br>
            Number: 0176<br>
            Version: 0.5<br>
            Last Updated: 2006-10-31<br>
            Publishing Organization: <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a><br>
                Approving Body: <a href="http://www.jabber.org/council/">XMPP Council</a><br>Dependencies: XMPP Core, XEP-0166<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: ice<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Jingle%20ICE%20Transport%20(XEP-0176)">http://wiki.jabber.org/index.php/Jingle ICE Transport (XEP-0176)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email:
        <a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a><br>
        JID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a></p>
<h3>Joe Beda</h3>
<p class="indent">
        Email:
        <a href="mailto:jbeda@google.com">jbeda@google.com</a><br>
        JID: 
        <a href="xmpp:jbeda@google.com">jbeda@google.com</a></p>
<h3>Scott Ludwig</h3>
<p class="indent">
        Email:
        <a href="mailto:scottlu@google.com">scottlu@google.com</a><br>
        JID: 
        <a href="xmpp:scottlu@google.com">scottlu@google.com</a></p>
<h3>Joe Hildebrand</h3>
<p class="indent">
        Email:
        <a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a><br>
        JID: 
        <a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a></p>
<h3>Sean Egan</h3>
<p class="indent">
        Email:
        <a href="mailto:seanegan@google.com">seanegan@google.com</a><br>
        JID: 
        <a href="xmpp:seanegan@google.com">seanegan@google.com</a></p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This XMPP Extension Protocol is copyright 1999 - 2006 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The following keywords as used in this document are to be interpreted as described in RFC 2119: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#reqs">Requirements</a>
</dt>
<dt>3.  <a href="#terms">Glossary</a>
</dt>
<dt>4.  <a href="#protocol">Protocol Description</a>
</dt>
<dl>
<dt>4.1.  <a href="#protocol-initiate">Transport Initiation</a>
</dt>
<dt>4.2.  <a href="#protocol-response">Receiver Response</a>
</dt>
<dt>4.3.  <a href="#protocol-negotiate">ICE Negotiation</a>
</dt>
<dl>
<dt>4.3.1.  <a href="#protocol-negotiate-candidate">Syntax of Candidate Element</a>
</dt>
<dt>4.3.2.  <a href="#protocol-negotiate-flow">Negotiation Flow</a>
</dt>
</dl>
<dt>4.4.  <a href="#protocol-acceptance">Acceptance of Successful Candidate</a>
</dt>
</dl>
<dt>5.  <a href="#disco">Service Discovery</a>
</dt>
<dt>6.  <a href="#deploy">Deployment Notes</a>
</dt>
<dt>7.  <a href="#security">Security Considerations</a>
</dt>
<dl><dt>7.1.  <a href="#security-e2e">End-to-End Data Encryption</a>
</dt></dl>
<dt>8.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>9.  <a href="#registrar">XMPP Registrar Considerations</a>
</dt>
<dl>
<dt>9.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt>
<dt>9.2.  <a href="#registrar-transports">Jingle Transport Methods</a>
</dt>
<dt>9.3.  <a href="#registrar-disco">Service Discovery Identity</a>
</dt>
</dl>
<dt>10.  <a href="#schema">XML Schemas</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style=""><span class="ref" style="">Jingle</span>  [<a href="#nt-id2260005">1</a>] defines a framework for negotiating and managing out-of-band data sessions over XMPP. In order to provide a flexible framework, the base Jingle specification defines neither data transport methods nor content formats, leaving that up to separate specifications. The current document defines a transport method for establishing and managing data connections between XMPP entities, using the <span class="ref" style="">Interactive Connectivity Establishment (ICE)</span>  [<a href="#nt-id2260036">2</a>] methodology currently being developed within the IETF.</p>
  <p class="" style="">The process for ICE negotiation is largely the same in Jingle as it is in <span style="font-weight: bold">draft-ietf-mmusic-ice</span>. There are several differences:</p>
  <ul>
    <li>Instead of using SIP as the signalling channel, Jingle uses XMPP as the signalling channel.</li>
    <li>In Jingle, each candidate transport is sent in a separate IQ exchange (rather than sending all candidates at once as in <span style="font-weight: bold">draft-ietf-mmusic-ice</span>); this approach takes advantage of the request-response semantics of the XMPP &lt;iq/&gt; stanza type and enables the parties to send higher-priority candidates earlier in the negotiation.</li>
    <li>Syntax from the Session Description Protocol (see <span class="ref" style="">RFC 4566</span>  [<a href="#nt-id2260097">3</a>]) is mapped to an XML syntax suitable for sending over the XMPP signalling channel.</li>
  </ul>
  <p class="" style=""><span style="font-style: italic">Note: This document depends on the IETF's Interactive Connectivity Establishment (ICE) specification, which is a work in progress. Every effort has been made to keep this document synchronized with <span style="font-weight: bold">draft-ietf-mmusic-ice</span>, for which the latest published version is 12 (hereafter referred to as "<span style="font-weight: bold">ICE-12</span>"). The interested reader is referred to the <span style="font-weight: bold">ICE-12</span> for a detailed description of the ICE methodology, which for the most part this document merely maps to XMPP syntax.</span></p>
<h2>2.
       <a name="reqs">Requirements</a>
</h2>
  <p class="" style="">The Jingle transport method defined herein is designed to meet the following requirements:</p>
  <ol start="" type="">
    <li>Make it possible to establish and manage out-of-band connections between two XMPP entities, even if they are behind Network Address Translators (NATs) or firewalls.</li>
    <li>Make it relatively easy to implement support in standard Jabber/XMPP clients.</li>
    <li>Where communication with non-XMPP entities is needed, push as much complexity as possible onto server-side gateways between the XMPP network and the non-XMPP network.</li>
  </ol>
<h2>3.
       <a name="terms">Glossary</a>
</h2>
  <p class="" style="">The reader is referred to <span style="font-weight: bold">ICE-12</span> for a description of various terms used in the context of ICE. Those terms are not reproduced here.</p>
<h2>4.
       <a name="protocol">Protocol Description</a>
</h2>
  <div class="indent">
<h3>4.1 <a name="protocol-initiate">Transport Initiation</a>
</h3>
    <p class="" style="">In order for the initiator in a Jingle exchange to start the negotiation, it MUST send a Jingle "session-initiate" stanza as described in <span style="font-weight: bold">XEP-0166</span>. This stanza MUST include at least one transport method. If the initiator wishes to negotiate the ICE transport, it MUST include an empty &lt;transport/&gt; child element qualified by the 'http://jabber.org/protocol/jingle/transport/ice' namespace.</p>
    <a name="example-1"></a><p class="caption">Example 1. Initiation</p>
<div class="indent"><pre>
&lt;iq to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='jingle1' type='set'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle' 
          action='session-initiate' 
          initiator='romeo@montague.net/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content name='this-is-the-audio-content'&gt;
      &lt;description xmlns='http://jabber.org/protocol/jingle/description/audio'&gt;
        ...
      &lt;/description&gt;
      &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.2 <a name="protocol-response">Receiver Response</a>
</h3>
    <p class="" style="">As described in <span style="font-weight: bold">XEP-0166</span>, to provisionally accept the session initiation request, the responder returns an IQ-result:</p>
    <a name="example-2"></a><p class="caption">Example 2. Receiver Provisionally Accepts the Session Request</p>
<div class="indent"><pre>
&lt;iq type='result' from='juliet@capulet.com/balcony' to='romeo@montague.net/orchard' id='jingle1'/&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.3 <a name="protocol-negotiate">ICE Negotiation</a>
</h3>
    <p class="" style="">If the responder provisionally accepts the session initiation request as shown above, both initiator and responder MUST immediately negotiate connectivity over the ICE transport by exchanging XML-formatted candidate transports for the channel. This negotiation proceeds immediately in order to maximize the possibility that media can be exchanged as quickly as possible.  [<a href="#nt-id2260284">4</a>]</p>
    <p class="" style="">The candidate syntax and negotiation flow are described below.</p>
    <div class="indent">
<h3>4.3.1 <a name="protocol-negotiate-candidate">Syntax of Candidate Element</a>
</h3>
      <p class="" style="">The following is an example of the candidate format:</p>
      <a name="example-3"></a><p class="caption">Example 3. Initiating Entity Sends a Candidate Transport</p>
<div class="indent"><pre>
&lt;iq to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='info1' type='set'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle' 
          action='transport-info'
          initiator='romeo@montague.net/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'&gt;
      &lt;candidate component='1'
                 foundation='1'
                 generation='0' 
                 ip='10.0.1.1' 
                 network='0'
                 port='8998'
                 priority='2114978302'
                 protocol='udp'
                 pwd='asd88fgpdd777uzjYhagZg'
                 type='local'
                 ufrag='8hhy'/&gt;
    &lt;/transport&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">The attributes of the &lt;candidate/&gt; element are described in the following table:</p>
      <p class="caption">Table 1: Candidate Attributes</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Name</th>
          <th colspan="" rowspan="">Description</th>
          <th colspan="" rowspan="">SDP Syntax</th>
          <th colspan="" rowspan="">Example</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">component</td>
          <td align="" colspan="" rowspan="">A Component ID as defined in <span style="font-weight: bold">ICE-12</span>
</td>
          <td align="" colspan="" rowspan="">Component ID value in a=candidate line</td>
          <td align="" colspan="" rowspan="">1</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">foundation</td>
          <td align="" colspan="" rowspan="">A Foundation as defined in <span style="font-weight: bold">ICE-12</span>
</td>
          <td align="" colspan="" rowspan="">Foundation value in a=candidate line</td>
          <td align="" colspan="" rowspan="">1</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">generation</td>
          <td align="" colspan="" rowspan="">An index, starting at 0, that enables the parties to keep track of updates to the candidate throughout the life of the session</td>
          <td align="" colspan="" rowspan="">N/A</td>
          <td align="" colspan="" rowspan="">0</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">ip</td>
          <td align="" colspan="" rowspan="">The Internet Protocol (IP) address for the candidate transport mechanism; this may be either an IPv4 address or an IPv6 address</td>
          <td align="" colspan="" rowspan="">IP Address value in a=candidate line</td>
          <td align="" colspan="" rowspan="">10.0.1.1</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">network</td>
          <td align="" colspan="" rowspan="">An index, starting at 0, referencing which network this candidate is on for a given peer (used for diagnostic purposes if the calling hardware has more than one Network Interface Card or NIC)</td>
          <td align="" colspan="" rowspan="">N/A</td>
          <td align="" colspan="" rowspan="">0</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">port</td>
          <td align="" colspan="" rowspan="">The port at the candidate IP address</td>
          <td align="" colspan="" rowspan="">Port value in a=candidate line</td>
          <td align="" colspan="" rowspan="">8998</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">priority</td>
          <td align="" colspan="" rowspan="">A Priority as defined in <span style="font-weight: bold">ICE-12</span>
             [<a href="#nt-id2260772">5</a>]
          </td>
          <td align="" colspan="" rowspan="">Priority value in a=candidate line</td>
          <td align="" colspan="" rowspan="">9909</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">protocol</td>
          <td align="" colspan="" rowspan="">The protocol to be used; allowable values are: "udp" (when standard <span style="font-weight: bold">ICE-12</span> is used); "tcp", "tcp-act", and "tcp-pass" (when <span class="ref" style="">TCP Candidates with Interactive Connectivity Establishment (ICE)</span>  [<a href="#nt-id2260849">6</a>] is used); and "ssltcp" (definition to follow)</td>
          <td align="" colspan="" rowspan="">Transport protocol field in a=candidate line</td>
          <td align="" colspan="" rowspan="">udp</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">pwd</td>
          <td align="" colspan="" rowspan="">A Password as defined in <span style="font-weight: bold">ICE-12</span>
</td>
          <td align="" colspan="" rowspan="">a=ice-pwd line</td>
          <td align="" colspan="" rowspan="">asd88fgpdd777uzjYhagZg</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">type</td>
          <td align="" colspan="" rowspan="">A Candidate Type as defined in <span style="font-weight: bold">ICE-12</span>; the allowable values are "host" for host candidates, "srflx" for server reflexive candidates, "prflx" for peer reflexive candidates, and "relay" for relayed candidates</td>
          <td align="" colspan="" rowspan="">Typ field in a=candidate line</td>
          <td align="" colspan="" rowspan="">srflx</td>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">ufrag</td>
          <td align="" colspan="" rowspan="">A User Fragment as defined in <span style="font-weight: bold">ICE-12</span>
</td>
          <td align="" colspan="" rowspan="">a=ice-ufrag line</td>
          <td align="" colspan="" rowspan="">8hhy</td>
        </tr>
      </table>
    </div>
    <div class="indent">
<h3>4.3.2 <a name="protocol-negotiate-flow">Negotiation Flow</a>
</h3>
      <p class="" style="">The first step in negotiating connectivity is for each client to immediately begin sending candidate transport methods to the other client. These candidates SHOULD be gathered by following the procedure specified in Section 5.1 of <span style="font-weight: bold">ICE-12</span> and prioritized by following the procedure specified in Section 5.2 of <span style="font-weight: bold">ICE-12</span>. Each candidate MUST be sent in a &lt;jingle/&gt; element with an action of "transport-info".</p>
      <p class="" style="">If the responder receives and can successfully process a given candidate, it returns an IQ-result (if not, for example because the candidate data is improperly formatted, it returns an error).</p>
      <p class="" style="">Note well that the responder is only indicating receipt of the candidate, not telling the initiator that the candidate will be used.</p>
      <p class="" style="">The initiator keeps sending candidates, one after the other (without stopping to receive an acknowledgement of receipt from the responder for each candidate) until it has exhausted its supply of possible or desirable candidate transports. (Because certain candidates may be more "expensive" in terms of bandwidth or processing power, the initiator may not want to advertise their existence unless necessary.) For each candidate, the responder acknowledges receipt.</p>
      <p class="" style="">At the same time (i.e., immediately after provisionally accepting the session, not waiting for the initiator to begin or finish sending candidates), the responder also begins sending candidates that may work for it. As above, the initiator acknowledges receipt of the candidates.</p>
      <p class="" style="">As the initiator and responder receive candidates, they probe the various candidate transports for connectivity. In performing these connectivity checks, client SHOULD follow the procedure specified in Section 7 of <span style="font-weight: bold">ICE-12</span>.</p>
      <a name="example-4"></a><p class="caption">Example 4. Initiating Entity Sends a Candidate</p>
<div class="indent"><pre>
&lt;iq to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='info1' type='set'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle' 
          action='transport-info'
          initiator='romeo@montague.net/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'&gt;
      &lt;candidate component='1'
                 foundation='1'
                 generation='0' 
                 ip='10.0.1.1' 
                 network='0'
                 port='8998'
                 priority='2114978302'
                 protocol='udp'
                 pwd='asd88fgpdd777uzjYhagZg'
                 type='local'
                 ufrag='8hhy'/&gt;
    &lt;/transport&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
      </pre></div>
      <a name="example-5"></a><p class="caption">Example 5. Initiating Entity Sends a Second Candidate</p>
<div class="indent"><pre>
&lt;iq to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='info2' type='set'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle' 
          action='transport-info' 
          initiator='romeo@montague.net/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'&gt;
      &lt;candidate component='2'
                 foundation='1'
                 generation='0' 
                 ip='192.0.2.3' 
                 network='1'
                 port='45664'
                 priority='1107821052'
                 protocol='udp'
                 pwd='asd88fgpdd777uzjYhagZg'
                 type='srflx'
                 ufrag='8hhy'/&gt;
    &lt;/transport&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
      </pre></div>
      <a name="example-6"></a><p class="caption">Example 6. Initiating Entity Sends a Third Candidate</p>
<div class="indent"><pre>
&lt;iq to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='info3' type='set'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle' 
          action='transport-info' 
          initiator='romeo@montague.net/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'&gt;
      &lt;candidate component='2'
                 foundation='1'
                 generation='0' 
                 ip='208.245.212.67' 
                 network='2'
                 port='53267'
                 priority='1107558908'
                 protocol='udp'
                 pwd='asd88fgpdd777uzjYhagZg'
                 type='srflx'
                 ufrag='8hhy'/&gt;
    &lt;/transport&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">For each candidate received, the other party MUST acknowledge receipt or return an error:</p>
      <a name="example-7"></a><p class="caption">Example 7. Receiving Entity Acknowledges Receipt</p>
<div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' to='romeo@montague.net/orchard' id='info1' type='result'/&gt;

&lt;iq from='juliet@capulet.com/balcony' to='romeo@montague.net/orchard' id='info2' type='result'/&gt;

&lt;iq from='juliet@capulet.com/balcony' to='romeo@montague.net/orchard' id='info3' type='result'/&gt;
      </pre></div>
    </div>
  </div>
  <div class="indent">
<h3>4.4 <a name="protocol-acceptance">Acceptance of Successful Candidate</a>
</h3>
    <p class="" style="">If, based on STUN connectivity checks, the responder determines that it will be able to establish a connection using a given candidate, it sends a &lt;jingle/&gt; element with an action of 'transport-accept' to the initiator, specifying the candidate that succeeded:</p>
    <a name="example-8"></a><p class="caption">Example 8. Juliet Definitively Accepts the Successful Candidate</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/balcony' to='romeo@montague.net/orchard' id='accept1'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle'
          action='transport-accept' 
          initiator='romeo@montague.net/orchard'
          responder='juliet@capulet.com/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'&gt;
      &lt;candidate component='2'
                 foundation='1'
                 generation='0' 
                 ip='192.0.2.3' 
                 network='1'
                 port='45664'
                 priority='1107821052'
                 protocol='udp'
                 pwd='asd88fgpdd777uzjYhagZg'
                 type='srflx'
                 ufrag='8hhy'/&gt;
    &lt;/transport&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The &lt;jingle/&gt; element in the transport-accept stanza SHOULD possess a 'responder' attribute that explicitly specifies the full JID of the responding entity. If provided, all future commmunications SHOULD be sent to the JID provided in the 'responder' attribute.</p> 
    <p class="" style="">If the initiator can also send data over that candidate, then it acknowledges the responder's acceptance:</p>
    <a name="example-9"></a><p class="caption">Example 9. Romeo Acknowledges Acceptance of Successful Candidate</p>
<div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='accept1'/&gt;
    </pre></div>
    <p class="" style="">Now the initiator and responder can begin sending data over the negotiated connection.</p>
    <p class="" style="">If a candidate succeeded for the responder but the initiator cannot send data over that candidate, it MUST return a &lt;not-acceptable/&gt; error in response to the responder's acceptance of the successful candidate:</p>
    <a name="example-10"></a><p class="caption">Example 10. Romeo Returns Error in Response to Acceptance of Successful Candidate</p>
<div class="indent"><pre>
&lt;iq type='error' to='juliet@capulet.com/balcony' from='romeo@montague.net/orchard' id='accept1'&gt;
  &lt;jingle xmlns='http://jabber.org/protocol/jingle'
          action='transport-accept' 
          initiator='romeo@montague.net/orchard'
          responder='juliet@capulet.com/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;transport xmlns='http://jabber.org/protocol/jingle/transport/ice'&gt;
      &lt;candidate component='2'
                 foundation='1'
                 generation='0' 
                 ip='192.0.2.3' 
                 network='1'
                 port='45664'
                 priority='1107821052'
                 protocol='udp'
                 pwd='asd88fgpdd777uzjYhagZg'
                 type='srflx'
                 ufrag='8hhy'/&gt;
    &lt;/transport&gt;
  &lt;/jingle&gt;
  &lt;error type='cancel'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the responder cannot find a suitable candidate transport or it receives a &lt;not-acceptable/&gt; error from the initiator in response to its acceptance of a suitable transport, it SHOULD terminate the session as described in Section 5.9 of <span style="font-weight: bold">XEP-0166</span>.</p>
  </div>
<h2>5.
       <a name="disco">Service Discovery</a>
</h2>
  <p class="" style="">If an entity supports this specification, it MUST return a feature of "http://jabber.org/protocol/jingle/transport/ice" in response to <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2261331">7</a>] information requests.</p>
  <p class="" style="">As mentioned in the <a href="#deploy">Deployment Notes</a> of this document, the administrator of an XMPP server may wish to deploy a STUN server in order to ease the process of negotiating use of the Jingle ICE transport. A client can become aware of a STUN server in the following ways:</p>
  <ol start="1" type="">
    <li>Specified in the default settings for the client (while this may seem sub-optimal, it is acceptable at present because there are so few public STUN servers).</li>
    <li>Manually added by a human user into the client's configuration.</li>
    <li>Discovered via DNS SRV records as specified in Section 9.1 of <span class="ref" style="">RFC 3489</span>  [<a href="#nt-id2261431">8</a>].</li>
    <li>Discovered via the XMPP <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2261378">9</a>] extension.</li>
  </ol>
  <p class="" style="">It is OPTIONAL for a STUN server to support XMPP for the purpose of service discovery. Therefore, client developers SHOULD NOT depend on the existence of XMPP-aware STUN servers.</p>
  <p class="" style="">If a STUN server is accessible via XMPP, it SHOULD be advertised by returning an appropriate item in response to service discovery item requests sent to the address of an XMPP server:</p>
  <a name="example-11"></a><p class="caption">Example 11. Service Discovery of STUN Server (1)</p>
<div class="indent"><pre>
&lt;iq from='romeo@montague.net/orchard' to='montague.net' id='disco1' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;

&lt;iq from='montague.net' to='romeo@montague.net/orchard' id='disco1' type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='stun.montague.net'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">A subsequent service discovery information request to the STUN server MUST result in a response indicating that the STUN server has a service discovery category of "proxy" and type of "stun", as well as advertisement of appropriate service discovery features (because the XMPP interaction is necessary only in order to discover the identity of the STUN server, the only feature that an XMPP-aware STUN server SHOULD advertise is "http://jabber.org/protocol/disco#info".)</p>
  <a name="example-12"></a><p class="caption">Example 12. Service Discovery of STUN Server (2)</p>
<div class="indent"><pre>
&lt;iq from='romeo@montague.net/orchard' to='stun.montague.net' id='disco2' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='stun.montague.net' to='romeo@montague.net/orchard' id='disco1' type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='proxy' type='stun'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>6.
       <a name="deploy">Deployment Notes</a>
</h2>
  <p class="" style="">This specification applies exclusively to Jabber/XMPP clients and places no additional requirements on Jabber/XMPP servers. However, service administrators may wish to deploy a STUN server in order to ease the client-to-client negotiation process.</p>
<h2>7.
       <a name="security">Security Considerations</a>
</h2>
  <div class="indent">
<h3>7.1 <a name="security-e2e">End-to-End Data Encryption</a>
</h3>
    <p class="" style="">In order to secure the end-to-end data stream, implementations SHOULD use encryption methods appropriate to the transport method in use.</p>
  </div>
<h2>8.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2261565">10</a>].</p>
<h2>9.
       <a name="registrar">XMPP Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>9.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
    <p class="" style="">The <span class="ref" style="">XMPP Registrar</span>  [<a href="#nt-id2261615">11</a>] shall include 'http://jabber.org/protocol/jingle/transport/ice' in its registry of protocol namespaces.</p>
  </div>
  <div class="indent">
<h3>9.2 <a name="registrar-transports">Jingle Transport Methods</a>
</h3>
    <p class="" style="">The XMPP Registrar shall include "http://jabber.org/protocol/jingle/transport/ice" in its registry of Jingle transport methods. The registry submission is as follows:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;transport&gt;
  &lt;name&gt;ice&lt;/name&gt;
  &lt;desc&gt;
    A method for negotiation of out-of-band connections with built-in NAT and firewall 
    traversal, equivalent to the IETF's Interactive Connectivity Establishment (ICE) 
    methodology.
  &lt;/desc&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/transport&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>9.3 <a name="registrar-disco">Service Discovery Identity</a>
</h3>
    <p class="" style="">The XMPP Registrar shall include a Service Discovery type of "stun" within the "proxy" category.</p>
    <p class="" style="">The registry submission is as follows:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;category&gt;
  &lt;name&gt;proxy&lt;/name&gt;
  &lt;type&gt;
    &lt;name&gt;stun&lt;/name&gt;
    &lt;desc&gt;a STUN (Simple Traversal of UDP through NATs) service per RFC 3489&lt;/desc&gt;
    &lt;doc&gt;XEP-0176&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
    </pre></div>
  </div>
<h2>10.
       <a name="schema">XML Schemas</a>
</h2>
  <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/jingle/transport/ice'
    xmlns='http://jabber.org/protocol/jingle/transport/ice'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='transport'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='candidate' minOccurs='0' maxOccurs='1'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='candidate'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='component' type='xs:unsignedByte' use='required'/&gt;
          &lt;xs:attribute name='foundation' type='xs:unsignedByte' use='required'/&gt;
          &lt;xs:attribute name='generation' type='xs:unsignedByte' use='required'/&gt;
          &lt;xs:attribute name='ip' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='network' type='xs:unsignedByte' use='required'/&gt;
          &lt;xs:attribute name='port' type='xs:unsignedShort' use='required'/&gt;
          &lt;xs:attribute name='priority' type='xs:positiveInteger' use='required'/&gt;
          &lt;xs:attribute name='protocol' use='optional'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='ssltcp'/&gt;
                &lt;xs:enumeration value='tcp-act'/&gt;
                &lt;xs:enumeration value='tcp-pass'/&gt;
                &lt;xs:enumeration value='tcp'/&gt;
                &lt;xs:enumeration value='udp'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
          &lt;xs:attribute name='pwd' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='type' use='optional'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='host'/&gt;
                &lt;xs:enumeration value='prflx'/&gt;
                &lt;xs:enumeration value='relay'/&gt;
                &lt;xs:enumeration value='srflx'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
          &lt;xs:attribute name='ufrag' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
  </pre></div>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2260005">1</a>. XEP-0166: Jingle &lt;<a href="http://www.xmpp.org/extensions/xep-0166.html">http://www.xmpp.org/extensions/xep-0166.html</a>&gt;.</p>
<p><a name="nt-id2260036">2</a>. Interactive Connectivity Establishment (ICE): A Methodology for Network Address Translator (NAT) Traversal for Offer/Answer Protocols &lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-12.txt">http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-12.txt</a>&gt;. Work in progress.</p>
<p><a name="nt-id2260097">3</a>. RFC 4566: SDP: Session Description Protocol &lt;<a href="http://www.ietf.org/rfc/rfc4566.txt">http://www.ietf.org/rfc/rfc4566.txt</a>&gt;.</p>
<p><a name="nt-id2260284">4</a>. Concurrent with negotiation of the ICE candidates, it is possible for the initiator and responder to negotiate which content types the session will include, which transport methods will be tried for each content type, etc. Those negotiation flows are shown in <span style="font-weight: bold">XEP-0166</span>. This document specifies only negotiation of the ICE transport method.</p>
<p><a name="nt-id2260772">5</a>. In accordance with the rules specified in Section 5.2 of <span style="font-weight: bold">ICE-12</span>, the priority values shown in the examples within this document have been calculated as follows. The "type preference" for local candidates is stipulated to be "126" and for server reflexive candidates "66". The "local preference" for network 0 is stipulated to be "4096", for network 1 "2048", and for network 2 "1024".</p>
<p><a name="nt-id2260849">6</a>. TCP Candidates with Interactive Connectivity Establishment (ICE) &lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-tcp-02.txt">http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-tcp-02.txt</a>&gt;. Work in progress.</p>
<p><a name="nt-id2261331">7</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p>
<p><a name="nt-id2261431">8</a>. RFC 3489: STUN - Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs) &lt;<a href="http://www.ietf.org/rfc/rfc3489.txt">http://www.ietf.org/rfc/rfc3489.txt</a>&gt;.</p>
<p><a name="nt-id2261378">9</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p>
<p><a name="nt-id2261565">10</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2261615">11</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.5 (2006-10-31)</h4>
<div class="indent">
<p class="" style="">Updated to track ICE-12; corrected service discovery process; completed editorial review; removed mention of DTMF, which is for audio only.</p> (psa)
    </div>
<h4>Version 0.4 (2006-09-13)</h4>
<div class="indent">
<p class="" style="">Updated to track ICE-10; added section on service discovery.</p> (psa)
    </div>
<h4>Version 0.3 (2006-07-12)</h4>
<div class="indent">
<p class="" style="">Specified that DTMF must use in-band signalling (XEP-0181).</p> (se/psa)
    </div>
<h4>Version 0.2 (2006-03-24)</h4>
<div class="indent">
<p class="" style="">Recommended use of RTP-native methods for DTMF.</p> (psa)
    </div>
<h4>Version 0.1 (2006-03-01)</h4>
<div class="indent">Initial version (split from XEP-0166). (psa/jb)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
