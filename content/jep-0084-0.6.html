<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0084: User Avatar</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="User Avatar">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Creator" content="Peter Millard">
<meta name="DC.Creator" content="Thomas Muldowney">
<meta name="DC.Creator" content="Julian Missig">
<meta name="DC.Description" content="This JEP defines an XMPP protocol extension for exchanging user avatars.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2005-04-13">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0084">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2005 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>JEP-0084: User Avatar</h1>
<p>This JEP defines an XMPP protocol extension for exchanging user avatars.</p>
<p><hr></p>
<p style="color:red">WARNING: This Standards-Track JEP is Experimental. Publication as a Jabber Enhancement Proposal does not imply approval of this proposal by the Jabber Software Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Experimental<br>
            Type: Standards Track<br>
            Number: 0084<br>
            Version: 0.6<br>
            Last Updated: 2005-04-13<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, JEP-0030, JEP-0060<br>Supersedes: JEP-0008<br>
                Superseded By: None<br>
            Short Name: avatar<br>
            Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/User%20Avatar%20(JEP-0084)">http://wiki.jabber.org/index.php/User Avatar (JEP-0084)</a>&gt;
          </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email: stpeter@jabber.org<br>
        JID: stpeter@jabber.org</p>
<h3>Peter Millard</h3>
<p class="indent">
        Email: pgmillard@jabber.org<br>
        JID: pgmillard@jabber.org</p>
<h3>Thomas Muldowney</h3>
<p class="indent">
        Email: temas@jabber.org<br>
        JID: temas@jabber.org</p>
<h3>Julian Missig</h3>
<p class="indent">
        Email: julian@jabber.org<br>
        JID: julian@jabber.org</p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2005 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#reqs">Requirements</a>
</dt>
<dt>3.  <a href="#proto">Protocol</a>
</dt>
<dl>
<dt>3.1.  <a href="#proto-data">Data Element</a>
</dt>
<dt>3.2.  <a href="#proto-info">Info Element</a>
</dt>
<dt>3.3.  <a href="#proto-pointer">Pointer Element</a>
</dt>
<dt>3.4.  <a href="#proto-stop">Stop Element</a>
</dt>
</dl>
<dt>4.  <a href="#publisher">Publisher User Cases</a>
</dt>
<dl>
<dt>4.1.  <a href="#metadatanode-create">Creating a Metadata Node</a>
</dt>
<dt>4.2.  <a href="#datanode-create">Creating a Data Node</a>
</dt>
<dt>4.3.  <a href="#datanode-publish">Publishing Data to the Data Node</a>
</dt>
<dt>4.4.  <a href="#update">Updating Avatar Metadata</a>
</dt>
<dt>4.5.  <a href="#disable">Disabling Avatars</a>
</dt>
</dl>
<dt>5.  <a href="#subscriber">Subscriber User Cases</a>
</dt>
<dl>
<dt>5.1.  <a href="#subscriber-discover">Discovering Avatar Availability</a>
</dt>
<dt>5.2.  <a href="#subscribe">Subscribing to Avatar Metadata Node</a>
</dt>
<dt>5.3.  <a href="#subscriber-pubsub">Retrieving Avatar Data via Pubsub</a>
</dt>
<dt>5.4.  <a href="#subscriber-http">Retrieving Avatar Data via HTTP</a>
</dt>
</dl>
<dt>6.  <a href="#bizrules">Business Rules</a>
</dt>
<dl><dt>6.1.  <a href="#bizrules-images">Image Requirements</a>
</dt></dl>
<dt>7.  <a href="#impl">Implementation Notes</a>
</dt>
<dt>8.  <a href="#security">Security Considerations</a>
</dt>
<dt>9.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>10.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl><dt>10.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt></dl>
<dt>11.  <a href="#schema">XML Schema</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style="">Many communication applications allow for the association of a small image or icon with a user of that application. Usually, such an "avatar" is not intended to be an accurate picture of the user's actual physical appearance, but rather a representation (often fanciful) of the user's desired self-image or a transient state of the user (such as a mood or activity). This proposal outlines a way to incorporate avatars into current Jabber/XMPP systems by layering this functionality on top of <span class="ref" style="">Publish-Subscribe</span>  [<a href="#nt-id2250570">1</a>] (pubsub).</p>
  <p class="" style="">Pubsub was chosen as the base layer for avatars because of the need to publish a large amount of data to any number of users. Pubsub provides a straightforward mechanism for any user to subscribe to the avatar source and receive notifications from the publisher. The protocol defined herein uses two pubsub nodes: one node for "metadata" about the avatar state (called the "metadata node") and one for the avatar data itself (called the "data node"). This separation of metadata from data conserves bandwidth and enables both the publisher and the subscriber to cache the avatar data. (For example, a user might toggle between two or three avatars, in which case the user's contacts can display a locally cached version of the images without having to retrieve the full image each time.)</p>
  <p class="" style="">This JEP also allows storage of avatar data at a URL accessible via HTTP (see <span class="ref" style="">RFC 2616</span>  [<a href="#nt-id2250729">2</a>]). This can be helpful as a fallback mechanism if a pubsub-aware data repository is not available. It also makes it possible for avatar images to be hosted on public websites (e.g., an end-user-oriented community site) and retrieved from that site rather than handled directly by the publishing client in any fashion.</p>
  <p class="" style="">This JEP also enables XMPP applications to optionally integrate with third-party services that host user avatars (e.g., online gaming systems and virtual worlds).</p>
<h2>2.
       <a name="reqs">Requirements</a>
</h2>
  <p class="" style="">This JEP addresses the following use cases for avatar publishers:</p>
  <ol start="" type="">
    <li>Publishing avatar data</li>
    <li>Updating metadata about the current avatar</li>
    <li>Disabling avatars</li>
  </ol>
  <p class="" style="">This JEP addresses the following use cases for avatar subscribers:</p>
  <ol start="" type="">
    <li>Discovering avatar availability</li>
    <li>Receiving notification of avatar changes</li>
    <li>Retrieving avatar data via pubsub</li>
    <li>Retrieving avatar data via HTTP  [<a href="#nt-id2250621">3</a>]</li>
  </ol>
<h2>3.
       <a name="proto">Protocol</a>
</h2>
  <p class="" style="">The root or "wrapper" element for all avatar-related communications is the &lt;avatar/&gt; element qualified by the 'http://jabber.org/protocol/avatar' namespace. There are four allowable child elements of the &lt;avatar/&gt; root element, as described below.</p>
  <div class="indent">
<h3>3.1 <a name="proto-data">Data Element</a>
</h3>
    <p class="" style="">The &lt;data/&gt; child element is used to communicate avatar data:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;data id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
      type='image/png'
      bytes='12345'
      height='64'
      width='64'&gt;
  IMAGE DATA
&lt;/data&gt;
    </pre></div>
    <p class="" style="">The &lt;data/&gt; element MUST possess the following attributes:</p>
    <ul>
      <li>
<span style="font-style: italic">bytes</span> -- The size of the image data in bytes.</li>
      <li>
<span style="font-style: italic">height</span> -- The height of the image in pixels.</li>
      <li>
<span style="font-style: italic">id</span> -- The SHA1 hash of the image data.</li>
      <li>
<span style="font-style: italic">type</span> -- The IANA-registered content type of the image data.</li>
      <li>
<span style="font-style: italic">width</span> -- The width of the image in pixels.</li>
    </ul>
    <p class="" style="">The value of the 'type' attribute MAY be any IANA-registered content type of type "image" or "video".  [<a href="#nt-id2256231">4</a>] Support for the "image/png" content type is REQUIRED. Support for the "image/gif" and "image/jpeg" content types is RECOMMENDED. Support for any other content type is OPTIONAL.</p>
    <p class="" style="">The value of the 'id' attribute MUST be the SHA1 (<span class="ref" style="">RFC 3174</span>  [<a href="#nt-id2256276">5</a>]) hash of the image data, and the same value MUST be used as the ItemID of the pubsub item for the avatar data (see below).</p>
    <p class="" style="">The &lt;data/&gt; element MUST contain content that is appropriate for the specified content type:</p>
    <ul>
      <li>If the content type specifies a binary image format, the content MUST be XML character data that represents the avatar data, Base64-encoded in accordance with Section 3 of <span class="ref" style="">RFC 3548</span>  [<a href="#nt-id2256323">6</a>].</li>
      <li>If the content type specifies a structured data format (e.g., "image/svg+xml"), the content MUST be a properly-namespaced child element of the &lt;data/&gt; element.</li>
    </ul>
    <p class="" style="">Support for the &lt;data/&gt; element is REQUIRED.</p>
  </div>
  <div class="indent">
<h3>3.2 <a name="proto-info">Info Element</a>
</h3>
    <p class="" style="">The &lt;info/&gt; child element is used to communicate avatar metadata:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
      jid='pubsub.shakespeare.lit'
      node='avatar/data/juliet@capulet.com'
      url='http://www.jabbercentral.org/avatars/happy.png'
      type='image/png'
      bytes='12345'
      height='64'
      width='64'/&gt;
    </pre></div>
    <p class="" style="">The &lt;info/&gt; child element MUST be empty.</p>
    <p class="" style="">The &lt;info/&gt; child element MUST possess the following attributes:</p>
    <ul>
      <li>
<span style="font-style: italic">bytes</span> -- The size of the image data in bytes.</li>
      <li>
<span style="font-style: italic">type</span> -- The IANA-registered content type of the image data.</li>
      <li>
<span style="font-style: italic">height</span> -- The height of the image in pixels.</li>
      <li>
<span style="font-style: italic">id</span> -- The SHA1 hash of the image data.</li>
      <li>
<span style="font-style: italic">width</span> -- The width of the image in pixels.</li>
    </ul>
    <p class="" style="">The &lt;info/&gt; element MUST possess at least one of the following attributes, and MAY possess both:</p>
    <ul>
      <li>
<span style="font-style: italic">jid</span> -- The JID of the pubsub data node or of the pubsub service hosting the data node.</li>
      <li>
<span style="font-style: italic">url</span> -- An http: or https: URI at which the image data file may be found.</li>
    </ul>
    <p class="" style="">In addition, the &lt;info/&gt; element MAY possess the following attribute:</p>
    <ul>
      <li>
<span style="font-style: italic">node</span> -- The NodeID of the pubsub data node at the avatar data is to be retrieved (this supplements the 'jid' attribute and MUST be included if the 'jid' attribute specifies a pubsub service rather than a pubsub node).</li>
    </ul>
    <p class="" style="">The &lt;avatar/&gt; root element MAY contain more than one &lt;info/&gt; element. Each element MUST specify metadata for the same avatar but in alternate formats (e.g., "image/png", "image/gif", and "image/jpeg"), and one of the formats MUST be "image/png" in order to help ensure interoperability.</p>
    <p class="" style="">Support for the &lt;info/&gt; element is REQUIRED.</p>
  </div>
  <div class="indent">
<h3>3.3 <a name="proto-pointer">Pointer Element</a>
</h3>
    <p class="" style="">The &lt;pointer/&gt; child element is used to point to an avatar that is not published via pubsub or HTTP, but rather is provided by a third-party service such as an online gaming system or virtual world:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
  &lt;pointer&gt;
    &lt;x xmlns='http://example.com/virtualworlds'&gt;
      &lt;game&gt;Ancapistan&lt;/game&gt;
      &lt;character&gt;Kropotkin&lt;/character&gt;
    &lt;/x&gt;
  &lt;/pointer&gt;
&lt;/avatar&gt;
    </pre></div>
    <p class="" style="">The &lt;pointer/&gt; element MAY possess the following attributes if the publishing application has the relevant information:</p>
    <ul>
      <li>
<span style="font-style: italic">bytes</span> -- The size of the image data in bytes.</li>
      <li>
<span style="font-style: italic">type</span> -- The IANA-registered content type of the image data.</li>
      <li>
<span style="font-style: italic">height</span> -- The height of the image in pixels.</li>
      <li>
<span style="font-style: italic">id</span> -- The SHA1 hash of the image data.</li>
      <li>
<span style="font-style: italic">width</span> -- The width of the image in pixels.</li>
    </ul>
    <p class="" style="">The content of the &lt;pointer/&gt; element MUST be a properly-namespaced child element that specifies information about how to retrieve the avatar from the third-party service. The structure for any such child element is out of scope for this JEP.</p>
    <p class="" style="">Even if the &lt;pointer&gt; element is included, it MUST be preceded by at least one instance of the &lt;info/&gt; element so that implementations that do not support the &lt;pointer/&gt; element can display a "fallback" format of the avatar (at a minimum, "image/png").</p>
    <p class="" style="">Support for the &lt;pointer/&gt; element is OPTIONAL.</p>
  </div>
  <div class="indent">
<h3>3.4 <a name="proto-stop">Stop Element</a>
</h3>
    <p class="" style="">The &lt;stop/&gt; child element is used to signal that avatar publishing has been disabled:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
  &lt;stop/&gt;
&lt;/avatar&gt;
    </pre></div>
    <p class="" style="">The &lt;stop/&gt; element MUST be empty and MUST NOT possess any attributes.</p>
    <p class="" style="">Support for the &lt;stop/&gt; element is REQUIRED.</p>
  </div>
<h2>4.
       <a name="publisher">Publisher User Cases</a>
</h2>
  <div class="indent">
<h3>4.1 <a name="metadatanode-create">Creating a Metadata Node</a>
</h3>
    <p class="" style="">In order to publish notifications related to its avatar, the avatar publisher MUST first create a node for its avatar metadata:</p>
    <p class="caption">Example 1. Pubsub metadata node creation request</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit'
    id='create1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='avatar/info/juliet@capulet.com'/&gt;
    &lt;configure/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 2. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='juliet@capulet.com/chamber'
    id='create1'/&gt;
    </pre></div>
    <p class="" style="">The avatar publisher SHOULD also publish information about its metadata node to its XMPP server via the "disco publish" protocol specified in <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2256737">7</a>], so that subscribers to its avatar data can discover the metadata node even when the publisher is offline.</p>
    <p class="caption">Example 3. Publishing disco items</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    id='dset1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/avatar'&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='avatar/info/juliet@capulet.com'
          action='update'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.2 <a name="datanode-create">Creating a Data Node</a>
</h3>
    <p class="" style="">There are two allowable sources from which subscribers retrieve avatar data:</p>
    <ol start="" type="">
      <li>A data node on a pubsub service (which need not be the same service used for the metadata node)</li>
      <li>A data file accessible via HTTP</li>
    </ol>
    <p class="" style="">If a data node is used, obviously the publisher needs to create a data node in addition to the already-created metadata node:</p>
    <p class="caption">Example 4. Pubsub data node creation request</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit'
    id='create2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='avatar/data/juliet@capulet.com'/&gt;
    &lt;configure/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 5. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='juliet@capulet.com/chamber'
    id='create2'/&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.3 <a name="datanode-publish">Publishing Data to the Data Node</a>
</h3>
    <p class="" style="">Before updating the avatar metadata node, the publisher MUST make sure that the avatar data is available at the data node or URL. When publishing the avatar data to the data node, the publisher MUST ensure that the value of the item 'id' attribute is the SHA1 hash of the image data (this can be used by the subscriber to determine if a cached copy is still valid).</p>
    <p class="" style="">The following example illustrates the XML structure to be sent when publishing avatar data to the data node.</p>
    <p class="caption">Example 6. Publishing avatar data to data node</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit' 
    id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='avatar/data/juliet@capulet.com'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;data id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'&gt;
            qANQR1DBwU4DX7jmYZnncm...
          &lt;/data&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 7. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result' 
    from='pubsub.shakespeare.lit' 
    to='juliet@capulet.com/chamber' 
    id='publish1'/&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.4 <a name="update">Updating Avatar Metadata</a>
</h3>
    <p class="" style="">Whenever the publisher wishes to change its current avatar, it MUST update the metadata node.</p>
    <p class="" style="">The following example shows metadata specifying avatar data that is available in only one format ("image/png") and accessible only at a pubsub data node:</p>
    <p class="caption">Example 8. Publishing avatar metadata (pubsub data node)</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit'
    id='publish2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Subscribers to the avatar would then receive an update from the metadata node:</p>
    <p class="caption">Example 9. Subscribers receive avatar metadata</p>
<div class="indent"><pre>
&lt;message to='romeo@montague.net' from='pubsub.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">The following example shows metadata specifying avatar data that is available in only one format ("image/gif") and accessible only at an HTTP URL:</p>
    <p class="caption">Example 10. Publishing avatar metadata (HTTP URL)</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit'
    id='publish2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='222f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                url='http://www.jabbercentral.org/avatars/happy.gif'
                type='image/gif'
                bytes='23456'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Subscribers to the avatar would then receive an update from the metadata node:</p>
    <p class="caption">Example 11. Subscribers receive avatar metadata</p>
<div class="indent"><pre>
&lt;message to='romeo@montague.net' from='pubsub.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='222f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                url='http://www.jabbercentral.org/avatars/happy.gif'
                type='image/gif'
                bytes='23456'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">The following example shows metadata specifying avatar data that is available in multiple formats, each of which is accessible at both an HTTP URL and a pubsub data node:</p>
    <p class="caption">Example 12. Publishing avatar metadata (multiple formats)</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit'
    id='publish3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                url='http://www.jabbercentral.org/avatars/happy.png'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
          &lt;info id='222f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                url='http://www.jabbercentral.org/avatars/happy.gif'
                type='image/gif'
                bytes='23456'
                height='64'
                width='64'/&gt;
          &lt;info id='333f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                url='http://www.jabbercentral.org/avatars/happy.mng'
                type='image/mng'
                bytes='78912'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Subscribers to the avatar would then receive an update from the metadata node:</p>
    <p class="caption">Example 13. Subscribers receive avatar metadata</p>
<div class="indent"><pre>
&lt;message to='romeo@montague.net' from='pubsub.shakespeare.lit'&gt;
  &lt;x xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                url='http://www.jabbercentral.org/avatars/happy.png'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
          &lt;info id='222f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                url='http://www.jabbercentral.org/avatars/happy.gif'
                type='image/gif'
                bytes='23456'
                height='64'
                width='64'/&gt;
          &lt;info id='333f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                url='http://www.jabbercentral.org/avatars/happy.mng'
                type='image/mng'
                bytes='78912'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>4.5 <a name="disable">Disabling Avatars</a>
</h3>
    <p class="" style="">In order to temporarily disable any avatar images, the publishing entity publishes an empty &lt;stop/&gt; element to the metadata node:</p>
    <p class="caption">Example 14. Temporarily disabling an avatar</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/chamber'
    to='pubsub.shakespeare.lit' 
    id='publish3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='avatar/info/juliet@capulet.com'&gt;
      &lt;item id='current'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;stop/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
<h2>5.
       <a name="subscriber">Subscriber User Cases</a>
</h2>
  <div class="indent">
<h3>5.1 <a name="subscriber-discover">Discovering Avatar Availability</a>
</h3>
    <p class="" style="">Other clients can see if avatar support is available by sending a <span style="font-weight: bold">Service Discovery</span> items request to the other client and looking for the avatar item. The request SHOULD be sent to the bare JID (&lt;user@host&gt;) of the other user (but may be sent to a full JID), further specified by a disco node of "http://jabber.org/protocol/avatar". (Sending the request to the bare JID enables one to discover whether an offline user has published disco information regarding avatars.)</p>
    <p class="caption">Example 15. Disco items request</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='romeo@montague.net/orchard'
    to='juliet@capulet.com'
    id='items1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/avatar'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The result contains an item with the JID of the pubsub service where the publisher's avatar metadata (but not the avatar data itself) is published, along with the specific node for that metadata:</p>
    <p class="caption">Example 16. Disco items result</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='juliet@capulet.com'
    to='romeo@montague.net/orchard'
    id='items1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='http://jabber.org/protocol/avatar'&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='avatar/info/juliet@capulet.com'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The subscriber application SHOULD then send a disco#info request to the node in order to determine its identity.</p>
  </div>
  <div class="indent">
<h3>5.2 <a name="subscribe">Subscribing to Avatar Metadata Node</a>
</h3>
    <p class="" style="">In order to receive notifications of changes to the publisher's avatar, a subscriber MUST subscribe to the metadata node maintained by the publisher.</p>
    <p class="caption">Example 17. Consumer subscribes to metadata node</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='romeo@montague.net/orchard'
    to='pubsub.shakespeare.lit'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe 
        node='avatar/info/juliet@capulet.com'
        jid='romeo@montague.net'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 18. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='romeo@montague.net/orchard'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;entity node='avatar/info/juliet@capulet.com'
            jid='romeo@montague.net'
            affiliation='none'
            subscription='subscribed'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The subscriber will now receive notifications published to the metadata node by the avatar publisher.</p>
    <p class="" style="">Alternatively, the subscriber MAY retrieve the current avatar metadata from the pubsub service:</p>
    <p class="caption">Example 19. Retrieving the avatar metadata</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='romeo@montague.net/orchard'
    to='pubsub.shakespeare.lit'
    id='ps-items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='avatar/info/juliet@capulet.com' 
           max_items='1'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 20. Avatar metadata result</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='romeo@montague.net/orchard''
    id='ps-items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='avatar/info/juliet@capulet.com'&gt;
      &lt;item&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                jid='pubsub.shakespeare.lit'
                node='avatar/data/juliet@capulet.com'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>5.3 <a name="subscriber-pubsub">Retrieving Avatar Data via Pubsub</a>
</h3>
    <p class="" style="">If the &lt;avatar/&gt; element sent to the metadata node possesses a 'jid' attribute (optionally supplemented by a 'node' attribute), the avatar data is hosted at a pubsub service. Therefore, in order to retrieve the avatar image data, the requesting entity can send a request to the specified JID or JID+node, including an 'id' attribute that matches the value provided in the metadata result.</p>
    <p class="caption">Example 21. Data retrieval request</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='romeo@montague.net/orchard'
    to='pubsub.shakespeare.lit' 
    id='ps-items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='avatar/data/juliet@capulet.com'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'/&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The result contains the avatar image data:</p>
    <p class="caption">Example 22. Data retrieval result</p>
<div class="indent"><pre>
&lt;iq type='result' from='pubsub.shakespeare.lit' id='ps-items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='avatar/data/juliet@capulet.com'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
          &lt;data id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
                type='image/png'
                bytes='12345'
                height='64'
                width='64'&gt;
            qANQR1DBwU4DX7jmYZnncm...
          &lt;/data&gt;
        &lt;/avatar&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>5.4 <a name="subscriber-http">Retrieving Avatar Data via HTTP</a>
</h3>
    <p class="" style="">If the &lt;avatar/&gt; element sent to the metadata node possesses a 'url' attribute, the avatar data is hosted at a URL. Therefore, in order to retrieve the avatar image data, the requesting entity can send an HTTP request to the specified URL.</p>
  </div>
<h2>6.
       <a name="bizrules">Business Rules</a>
</h2>
  <div class="indent">
<h3>6.1 <a name="bizrules-images">Image Requirements</a>
</h3>
    <p class="" style="">Certain restrictions are placed upon the image. First, the image height and width SHOULD be between thirty-two (32) and ninety-six (96) pixels. The suggested size is sixty-four (64) pixels high and sixty-four (64) pixels wide. Images SHOULD be square, but this is not required. Finally, images SHOULD use less than eight (8) kilobytes of data.</p>
  </div>
<h2>7.
       <a name="impl">Implementation Notes</a>
</h2>
  <ul>
    <li>It is the responsibility of the receiving application to determine which avatar format to retrieve (e.g., "image/gif" rather than "image/png") and to determine the appropriate method for retrieval (e.g., HTTP rather than pubsub).</li>
    <li>The receiving application SHOULD NOT scale up an image when displaying it.</li>
    <li>If an avatar is not available for a contact, the receiving MAY display the contact's photo, e.g., as provided in the contact's vCard (see <span class="ref" style="">vcard-temp</span>  [<a href="#nt-id2257576">8</a>]) or other profile information.</li>
  </ul>
<h2>8.
       <a name="security">Security Considerations</a>
</h2>
  <p class="" style="">There are no security features or concerns related to this proposal.</p>
<h2>9.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This JEP makes use of IANA-registered content types, but requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2257635">9</a>].</p>
<h2>10.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>10.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
  <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2257721">10</a>] shall include 'http://jabber.org/protocol/avatar' in its registry of protocol namespaces.</p>
  </div>
<h2>11.
       <a name="schema">XML Schema</a>
</h2>
  <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/avatar'
    xmlns='http://jabber.org/protocol/avatar'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='avatar'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:element ref='data'/&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='info' maxOccurs='unbounded'/&gt;
          &lt;xs:element ref='pointer' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:element name='stop' type='empty'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='data'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute name='bytes' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='type' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='height' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='id' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='width' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='info'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='bytes' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='type' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='height' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='id' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='url' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='width' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='pointer'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:any namespace='##other'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='bytes' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='type' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='height' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='id' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='width' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
  </pre></div>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250570">1</a>. JEP-0060: Publish-Subscribe &lt;<a href="http://www.jabber.org/jeps/jep-0060.html">http://www.jabber.org/jeps/jep-0060.html</a>&gt;.</p>
<p><a name="nt-id2250729">2</a>. RFC 2616: Hypertext Transport Protocol -- HTTP/1.1 &lt;<a href="http://www.ietf.org/rfc/rfc2616.txt">http://www.ietf.org/rfc/rfc2616.txt</a>&gt;.</p>
<p><a name="nt-id2250621">3</a>. By "accessible via HTTP" is meant that the data is available at an http: or https: URI.</p>
<p><a name="nt-id2256231">4</a>. The IANA registry of content types is located at &lt;<a href="http://www.iana.org/assignments/media-types/">http://www.iana.org/assignments/media-types/</a>&gt;.</p>
<p><a name="nt-id2256276">5</a>. RFC 3174: US Secure Hash Algorithm 1 (SHA1) &lt;<a href="http://www.ietf.org/rfc/rfc3174.txt">http://www.ietf.org/rfc/rfc3174.txt</a>&gt;.</p>
<p><a name="nt-id2256323">6</a>. RFC 3548: The Base16, Base32, and Base64 Data Encodings &lt;<a href="http://www.ietf.org/rfc/rfc3548.txt">http://www.ietf.org/rfc/rfc3548.txt</a>&gt;.</p>
<p><a name="nt-id2256737">7</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2257576">8</a>. JEP-0054: vcard-temp &lt;<a href="http://www.jabber.org/jeps/jep-0054.html">http://www.jabber.org/jeps/jep-0054.html</a>&gt;.</p>
<p><a name="nt-id2257635">9</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2257721">10</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.6 (2005-04-13)</h4>
<div class="indent">Major modification per list discussion: specified that metadata may include the same avatar in multiple alternate formats; allowed pointers to third-party avatars not available via pubsub or HTTP; changed pixel size restrictions; specified that bytes, content-type, height, id, and width are required metadata; changed type attribute to content-type; made explicit that URLs can be http: or https: URIs; more fully specified protocol, updated the examples, updated the schemas. (psa)
    </div>
<h4>Version 0.5 (2005-03-28)</h4>
<div class="indent">Friendly fork per Council discussion: allowed data to be stored in a pubsub data repository or at a URL accessible via HTTP; also split text into publisher and subscriber use cases, specified requirements, added more examples, etc. (psa/pgm)
    </div>
<h4>Version 0.4 (2003-05-20)</h4>
<div class="indent">Lessen the image requirements. Include the content type in info. (tjm)
    </div>
<h4>Version 0.3 (2003-05-08)</h4>
<div class="indent">Drastic change to use two nodes on pubsub, allowing for hash updates independently of the data. This makes client caching much easier. Allow only PNG and MNG currently. (tjm)
    </div>
<h4>Version 0.2 (2003-05-07)</h4>
<div class="indent">Clarified the use of "current" as the item id. Fixed some example errors. Made the interaction with disco more clear. The reason to use pubsub is made more clear as well. (tjm)
    </div>
<h4>Version 0.1 (2003-05-07)</h4>
<div class="indent">Initial version. (tjm)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
