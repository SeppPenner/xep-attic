<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0115: Entity Capabilities</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Entity Capabilities" /><meta name="DC.Creator" content="Joe Hildebrand" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Creator" content="Remko Tron&#xE7;on" /><meta name="DC.Description" content="This document defines an XMPP protocol extension for broadcasting and discovering client, device, or generic entity capabilities in a way that minimizes network impact." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2007-04-10" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0115" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright 1999 - 2007 by the XMPP Standards Foundation (XSF) and is in full conformance with the XSF's Intellectual Property Rights Policy &lt;http://www.xmpp.org/extensions/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;)." /></head><body><h1>XEP-0115: Entity Capabilities</h1><p>This document defines an XMPP protocol extension for broadcasting and discovering client, device, or generic entity capabilities in a way that minimizes network impact.</p><hr /><p style="color:green">NOTICE: The protocol defined herein is a Draft Standard of the XMPP Standards Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0115<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Draft">Draft</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 1.3<br />
            Last Updated: 2007-04-10<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XMPP IM, XEP-0030<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: caps<br />
        Schema: &lt;<a href="http://www.xmpp.org/schemas/caps.xsd">http://www.xmpp.org/schemas/caps.xsd</a>&gt;<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Entity Capabilities (XEP-0115)">http://wiki.jabber.org/index.php/Entity Capabilities (XEP-0115)</a>&gt;
            </p><h2>Author Information</h2><div class="indent"><h3>Joe Hildebrand</h3><p class="indent">
        Email:
        <a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a><br />
        JabberID: 
        <a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a></p><h3>Peter Saint-Andre</h3><p class="indent">
        Email:
        <a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a><br />
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a></p><h3>Remko Tron&#xE7;on</h3><p class="indent">
        Email:
        <a href="mailto:public@el-tramo.be">public@el-tramo.be</a><br />
        JabberID: 
        <a href="xmpp:public@el-tramo.be">public@el-tramo.be</a></p></div><h2>Legal Notice</h2><p class="indent">This XMPP Extension Protocol is copyright 1999 - 2007 by the <a href="http://www.xmpp.org/xsf/">XMPP Standards Foundation</a> (XSF) and is in full conformance with the XSF's Intellectual Property Rights Policy &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />&#xA0;&#xA0;&#xA0;
      1.1.  <a href="#motivation">Motivation</a><br />&#xA0;&#xA0;&#xA0;
      1.2.  <a href="#howitworks">How It Works</a><br />2.  <a href="#assumptions">Assumptions</a><br />3.  <a href="#reqs">Requirements</a><br />4.  <a href="#usecases">Use Cases</a><br />&#xA0;&#xA0;&#xA0;
      4.1.  <a href="#advertise">Advertising Capabilities</a><br />&#xA0;&#xA0;&#xA0;
      4.2.  <a href="#discover">Discovering Capabilities</a><br />&#xA0;&#xA0;&#xA0;
      4.3.  <a href="#stream">Stream Feature</a><br />5.  <a href="#optimizations">Server Optimizations</a><br />6.  <a href="#impl">Implementation Notes</a><br />7.  <a href="#error">Error Codes</a><br />8.  <a href="#security">Security Considerations</a><br />9.  <a href="#iana">IANA Considerations</a><br />10.  <a href="#registrar">XMPP Registrar Considerations</a><br />11.  <a href="#schema">XML Schema</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
    <div class="indent"><h3>1.1 <a name="motivation" id="motivation">Motivation</a></h3>
      <p class="" style="">It is often desirable for a Jabber/XMPP application (commonly but not necessarily a client) to take different actions depending on the capabilities of another application from which it receives presence information. Examples include:</p>
      <ul class="" style="">
        <li class="" style="">Showing a different set of icons depending on the capabilities of other clients.</li>
        <li class="" style="">Not sending <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0071.html">XHTML-IM</a></span>  [<a href="#nt-id2251220">1</a>] content to plaintext clients such as cell phones.</li> 
        <li class="" style="">Allowing the initiation of Voice over IP (VoIP) sessions only to clients that support VoIP.</li>
        <li class="" style="">Not showing a "Send a File" button if another user's client does not support <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0096.html">File Transfer</a></span>  [<a href="#nt-id2251302">2</a>].</li>
      </ul>
      <p class="" style="">Some older Jabber clients send one <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2251280">3</a>] and one <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0092.html">Software Version</a></span>  [<a href="#nt-id2259665">4</a>] request to each entity from which they received presence after login. That "disco+version flood" results in an excessive use of bandwidth and is impractical on a larger scale, particularly for users or applications with large rosters. Therefore this document proposes a more robust and scalable solution: namely, a presence-based mechanism  [<a href="#nt-id2251264">5</a>] for exchanging information about entity capabilities. Clients SHOULD NOT engage in the older "disco+version flood" behavior and instead SHOULD use Entity Capabilities as specified herein.</p>
    </div>
    <div class="indent"><h3>1.2 <a name="howitworks" id="howitworks">How It Works</a></h3>
      <p class="" style="">This section provides a friendly, non-normative introduction to the workings of entity capabilities.</p>
      <p class="" style="">Imagine that you are a Shakespearean character named Juliet and one of your contacts, a handsome fellow named Romeo, becomes available. His client wants to publish its capabilities, and does this by adding a &lt;c/&gt; element to its presence packets. As a result, your client receives the following presence packet:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;presence from='romeo@montague.net/home'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps' 
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">The 'node' attribute represents the client Romeo is using, and the 'ver' attribute represents the specific version of this client. At this point, your client has no idea what the capabilities are of someone with a client string 'http://exodus.jabberstudio.org/caps' and a version string '0.9'. Your client therefore sends a query to Romeo, asking what his client version can do (using service discovery):</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq type='get' to='romeo@montague.net/home' id='1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#0.9'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">The response is:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq type='result' from='romeo@montague.net/home' id='1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#0.9'&gt;
    &lt;identity category='client' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#items'/&gt;
    &lt;feature var='http://jabber.org/protocol/feature-neg'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">At this point, your client knows that anyone using the client string 'http://exodus.jabberstudio.org/caps' and the version string '0.9' has a client that can do MUC. Your client remembers this information, such that it does not need to explicitly query the capabilities of a contact with the exact same client and version string. For example, Benvolio may send you the following presence:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;presence from='benvolio@capulet.com/230193'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps' 
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">Now your client automatically knows that Benvolio can do MUC, without needing to ask him explicitly via service discovery.</p>
      <p class="" style="">On the other hand, for a person with the following presence ...</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;presence from='bob@initech.com/Home'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps' 
     node='http://exodus.jabberstudio.org/caps'
     ver='0.10'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">... or the following presence ...</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;presence from='bard@shakespeare.lit/globe'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps' 
     node='http://psi-im.org/caps'
     ver='0.9'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">... you have no information about what this contact's client is capable of (as he is using a different client/version), and you therefore need to query his capabilities explicitly again.</p>
      <p class="" style="">So that is how the 'node' and 'ver' attributes work. But most clients also allow certain features to be turned on or off at run time. For example, clients can allow users to turn off the exchange of chat states (for privacy reasons).  For such a client, this means that it cannot just advertise its capabilities as was done before, since this capabilitiy depends on whether or not the user has turned the option on or off (and capabilities for the same client/version are assumed to be identical for all contacts). Such capabilities are advertised using "extensions". For example:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;presence from='benvolio@capulet.com/230193'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps' 
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9' 
     ext='csn'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">In this case, Benvolio is using an extension that his client calls 'csn'.  Again, your client has no clue what 'csn' means, as it is a name arbitrarily chosen by Benvolio's client. It therefore queries Benvolio's client to find out what a client 'http://exodus.jabberstudio.org/caps' means when it says it supports 'csn'.  It does this by sending a disco#info request to the node#ext (not the node#ver as was done to find the base capabilities):</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq type='get' to='romeo@montague.net/home' id='2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#csn'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">The response is:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq type='result' from='romeo@montague.net/home' id='2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#0.9'&gt;
    &lt;feature var='http://jabber.org/protocol/chatstates'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">Now, your client knows that Benvolio's client (and anyone using the same client node as Benvolio and extension 'csn', since the 'ext' values MUST be stable across client versions) supports chat state notifications.  <span class="em">The sum total of what Benvolio's client supports is the set of features advertised in disco#info responses to the node#ver (base features) and the set of features advertised in disco#info responses to each node#ext (extension features).</span></p>
      <p class="" style="">However, suppose Bill logs on:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;presence from='bard@shakespeare.lit/globe'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps' 
     node='http://psi-im.org/caps'
     ver='0.9' 
     ext='csn'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="" style="">Although you know that 'csn' meant "chat state notifications" for Benvolio (and for everyone using the same client as Benvolio), you do not know what this means for Bill, because he is using a different client! So you need to query his client:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq type='get' to='bard@shakespeare.lit/globe' id='3'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://psi-im.org/caps#csn'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">and the response ...</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq type='result' from='bard@shakespeare.lit/globe' id='3'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
          node='http://psi-im.org/caps#0.9'&gt;
    &lt;feature var='urn:xmpp:ssn'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">... reveals that this client uses 'csn' to denote the capability of "stanza session negotiation" (formerly known as "chat session negotiation"). So although the 'ext' values are stable for each client (and for all versions thereof), they are not stable across different clients.</p>
    </div>
  <h2>2.
       <a name="assumptions" id="assumptions">Assumptions</a></h2>
    <p class="" style="">This document makes several assumptions:</p>
    <ul class="" style="">
      <li class="" style="">The type of client I am using is of interest to the people on my roster.</li>
      <li class="" style="">Clients for the people on my roster might want to make user interface decisions based on my capabilities.</li>
      <li class="" style="">Different instances of the same client (including version) have the same base capabilities.</li>
      <li class="" style="">Some clients will have bundles of functionality that can be enabled and disabled.</li>
      <li class="" style="">One instance of a given client may not know about all of the possible bundles of functionality that can be enabled and disabled (for example, plugins written to a client SDK).</li>
      <li class="" style="">Members of a community tend to cluster around a small set of clients.  More specifically, multiple people in my roster use the same client, and they upgrade versions relatively slowly (commonly a few times a year, perhaps once a week at most, certainly not once a minute).</li>
      <li class="" style="">Some clients are running against servers without server-to-server connectivity enabled, and without access to the Internet via HTTP.</li>
      <li class="" style="">Conversations are possible between users who are not on each other's roster.</li>
      <li class="" style="">Client capabilities may change over the course of a session, due to features being enabled and disabled.</li>
    </ul>
  <h2>3.
       <a name="reqs" id="reqs">Requirements</a></h2>
    <p class="" style="">The protocol defined herein addresses the following requirements:</p>
    <ol start="" class="" style="">
      <li class="" style="">Clients MUST be able to participate even if they support only <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">XMPP Core</a></span>  [<a href="#nt-id2260160">6</a>], <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">XMPP IM</a></span>  [<a href="#nt-id2260188">7</a>], and <span class="cite">XEP-0030</span>.</li>
      <li class="" style="">Clients MUST be able to participate even if they are on networks without connectivity to other XMPP servers, services offering specialized XMPP extensions, or HTTP servers. [<a href="#nt-id2260138">8</a>]</li>
      <li class="" style="">Clients MUST be able to retrieve information without querying each user.</li>
      <li class="" style="">Since presence is normally broadcasted to many users, the byte size of the proposed extension MUST be as small as possible.</li>
      <li class="" style="">It MUST be possible to write a <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0045.html">Multi-User Chat</a></span>  [<a href="#nt-id2260266">10</a>] implementation that passes the given information along.</li>
      <li class="" style="">It MUST be possible to publish a change in capabilities within a single session.</li>
      <li class="" style="">Server infrastructure above and beyond that defined in <span class="cite">XMPP Core</span> and <span class="cite">XMPP IM</span> MUST NOT be required for this approach to work, although additional server infrastructure MAY be used for optimization purposes.</li>
    </ol>
  <h2>4.
       <a name="usecases" id="usecases">Use Cases</a></h2>
    <div class="indent"><h3>4.1 <a name="advertise" id="advertise">Advertising Capabilities</a></h3>
      <p class="" style="">Each time a conformant client sends presence, it annotates that presence with an element that specifies the client type, the version of that client, and which feature bundles (if any) are currently enabled. Unless the server optimizations shown later are being used, the client MUST send this with every presence change (except for unavailable presence) to enable existing servers to remember the last presence for use in responding to probes. The client MUST send the <span class="strong">'node'</span> and <span class="strong">'ver'</span> attributes.</p>
      <p class="" style="">In addition, the client MAY send an <span class="strong">'ext'</span> attribute (short for "extensions") if it has one or more feature bundles to advertise. A feature bundle is any non-standard addition or extension to the core application, such as a client plugin. If more than one feature bundle is advertised, the value of the <span class="strong">'ext'</span> attribute MUST be a space-separated list of bundle names. 
          [<a href="#nt-id2260369">11</a>]
       The client MUST NOT send an <span class="strong">'ext'</span> attribute if there are no interesting non-core features enabled. The names of the feature bundles MUST NOT be used for semantic purposes: they are merely opaque identifiers that will be used in other use cases. However, a client MUST ensure that the same 'ext' value refers to the same feature bundle across client versions (i.e., different values of the 'ver' attribute). If bundles are added or substracted during an entity's session (e.g., a user plugs in a video camera), the entity SHOULD update the value of the 'ext' attribute to reflect the changed capabilities and send a new presence broadcast. If a feature bundle itself changes in any way (e.g., a user installs an updated version of a client plugin), the application MUST change the bundle name and SHOULD send a new presence broadcast.</p>
      <p class="" style="">Note: The values of the <span class="strong">'node'</span>, <span class="strong">'ver'</span>, and <span class="strong">'ext'</span> attributes MUST NOT contain the '#' character, since that character is used as a separator in the <a href="#discover">Discovering Capabilities</a> use case.</p>

      <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Annotated presence sent</p><div class="indent"><pre>
&lt;presence&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9'/&gt;
&lt;/presence&gt;
      </pre></div>
      <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Annotated presence sent, with feature extensions</p><div class="indent"><pre>
&lt;presence&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://exodus.jabberstudio.org/caps'
     ver='0.9'
     ext='93j 1g'/&gt;
&lt;/presence&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>4.2 <a name="discover" id="discover">Discovering Capabilities</a></h3>
      <p class="" style="">Once someone on my roster knows what client I am using, they need to be able to figure out what features are supported by that client. In the deprecated "disco flood" approach, this has been done by sending one "disco#info" request to each entity in a user's roster. Entity capabilities makes that unnecessary through the use of annotated presence. In particular, a client that receives the annotated presence sends a <span class="strong">disco#info</span> request (as defined in <span class="strong">XEP-0030: Service Discovery</span>) to <span class="em">exactly</span> one of the users that sent a particular combination of <span class="strong">node</span> and <span class="strong">ver</span>. If the requestor has received the same annotation from multiple JIDs, the requestor SHOULD pick a random JID from that list to which the requestor will send the <span class="strong">disco#info</span> request.</p>

      <p class="" style="">The <span class="strong">disco#info</span> request is sent to a JID + node combination that consists of the chosen <span class="strong">&lt;user@host/resource&gt;</span> JID and a service discovery <span class="strong">node</span> that is constructed as follows: concatenate (1) the value of the caps <span class="strong">'node'</span> attribute, (2) the "#" character, and (3) the version number specified in the caps <span class="strong">'ver'</span> attribute.</p>

      <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Disco#info request for client#version</p><div class="indent"><pre>
&lt;iq type='get' from='bard@shakespeare.lit/globe' to='randomuser1@capulet.com/resource' id='123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#0.9'/&gt;
&lt;/iq&gt;
      </pre></div>

      <p class="" style="">The random user then returns all of the capabilities supported by the base installation of the application without plugins or other add-ons:</p>

      <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Disco#info response for client#version</p><div class="indent"><pre>
&lt;iq type='result' from='randomuser1@capulet.com/resource' to='bard@shakespeare.lit/globe' id='123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#0.9'&gt;
    &lt;identity category='client' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#items'/&gt;
    &lt;feature var='http://jabber.org/protocol/feature-neg'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      
      <p class="" style="">Subsequent requests MAY be made to determine the supported features associated with each extension. These requests MUST be sent to a random <span class="strong">&lt;user@host/resource&gt;</span> JID that sent a caps annotation that included a particular <span class="strong">node</span>/<span class="strong">ext</span> combination. The <span class="strong">disco#info</span> request shall be sent to a JID + node combination that consists of the chosen JID and a service discovery <span class="strong">node</span> that is constructed as follows: concatenate (1) the value of the caps <span class="strong">'node'</span> attribute, (2) the "#" character, and (3) the extension name specified by one of the space-separated names in the caps <span class="strong">'ext'</span> attribute. The requestor SHOULD try to use different JIDs for each of these requests, as well as for the first request.</p>
      
      <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Disco#info request for client#extension</p><div class="indent"><pre>
&lt;iq type='get' from='bard@shakespeare.lit/globe' to='randomuser3@capulet.com/resource' id='234'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#93j'/&gt;
&lt;/iq&gt;
      </pre></div>

      <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Disco#info response for client#extension</p><div class="indent"><pre>
&lt;iq type='result' from='randomuser3@capulet.com/resource' to='bard@shakespeare.lit/globe' id='234'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#93j'&gt;
    &lt;identity category='client' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/bytestreams'/&gt;
    &lt;feature var='http://jabber.org/protocol/si'/&gt;
    &lt;feature var='http://jabber.org/protocol/si/profile/file-transfer'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>

      <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Disco#info request for client#extension</p><div class="indent"><pre>
&lt;iq type='get' from='bard@shakespeare.lit/globe' to='randomuser4@capulet.com/resource' id='345'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#1g'/&gt;
&lt;/iq&gt;
      </pre></div>

      <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Disco#info response for client#extension</p><div class="indent"><pre>
&lt;iq type='result' from='randomuser4@capulet.com/resource' to='bard@shakespeare.lit/globe' id='345'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://exodus.jabberstudio.org/caps#1g'&gt;
    &lt;identity category='client' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/xhtml-im'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>

      <p class="" style="">Note: The set of features that a given entity advertises in response to a "client#version" request and all "client#extension" requests MUST be equivalent to the response it gives to a <span class="strong">disco#info</span> request with no 'node' attribute:</p>

      <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Generic disco#info response</p><div class="indent"><pre>
&lt;iq type='result' from='randomuser2@capulet.com/resource' to='bard@shakespeare.lit/globe' id='456'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='client' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#items'/&gt;
    &lt;feature var='http://jabber.org/protocol/feature-neg'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='http://jabber.org/protocol/bytestreams'/&gt;
    &lt;feature var='http://jabber.org/protocol/si'/&gt;
    &lt;feature var='http://jabber.org/protocol/si/profile/file-transfer'/&gt;
    &lt;feature var='http://jabber.org/protocol/xhtml-im'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>

      <p class="" style="">All of the responses to the <span class="strong">disco#info</span> queries SHOULD be cached. If a particular entity cannot store the responses, it SHOULD NOT make the requests. An entity SHOULD NOT make the service discovery requests unless the information is required for some local functionality. An entity MUST NOT ever make a request to another entity that has the same version of the same application as the requesting entity, except for extensions that are not supported by the requestor's installation (e.g., one "Exodus 0.9" client MUST NOT query another "Exodus 0.9" client unless the second client has advertised an extension or plugin that the first client does not have).</p>
    </div>

    <div class="indent"><h3>4.3 <a name="stream" id="stream">Stream Feature</a></h3>
      <p class="" style="">A server MAY include its own entity capabilities in a stream feature element so that connecting clients and peer servers do not need to send service discovery requests each time they connect:</p>
      <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Stream feature element including capabilities</p><div class="indent"><pre>
&lt;stream:features&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://jabberd.org/entity'
     ver='1.6.1'/&gt;
&lt;/stream:features&gt;
      </pre></div>
    </div>
  <h2>5.
       <a name="optimizations" id="optimizations">Server Optimizations</a></h2>
    <p class="" style="">A server that is managing an entity's session MAY choose to optimize traffic through the server. In this case, the server MAY strip off redundant capabilities annotations. Because of this, receivers of annotations MUST NOT expect an annotation on every presence packet they receive. If the server wants to perform this traffic optimization, it MUST ensure that the first presence each subscriber receives contains the annotation. The server MUST also ensure that any changes in the annotation (typically in the <span class="strong">'ext'</span> attribute) are sent to all subscribers.</p>

      <p class="" style="">A client MAY query the server using <span class="strong">disco#info</span> to determine if the server supports the <span class="strong">'http://jabber.org/protocol/caps'</span> feature. If so, the server MUST perform the optimization delineated above, and the client MAY choose to only send the capabilities annotation on the first presence packet, as well as whenever its capabilities change.</p>

      <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Disco#info request for server optimization</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony'
    to='capulet.com'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='capulet.com'
    to='juliet@capulet.com/balcony'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='http://jabber.org/protocol/caps'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  <h2>6.
       <a name="impl" id="impl">Implementation Notes</a></h2>
    <p class="" style="">If two entities exchanges messages but they do not normally exchange presence (i.e., via presence subscription), the entities MAY choose to send directed presence to each other, where the presence information SHOULD be annotated with the same capabilities information as each entity sends in broadcasted presence.</p>
    <p class="" style="">If capabilities information has not been received from another entity, an application MUST assume that the other entity does not support capabilities.</p>
  <h2>7.
       <a name="error" id="error">Error Codes</a></h2>
    <p class="" style="">No application-specific error codes are defined by this document. See <span class="strong">XEP-0030: Service Discovery</span> for a list of potential service discovery error codes.</p>
  <h2>8.
       <a name="security" id="security">Security Considerations</a></h2>
    <p class="" style="">Use of the protocol specified in this document might make some client-specific forms of attack slightly easier, since the attacker could more easily determine the type of client being used. However, since most clients respond to <span class="strong">jabber:iq:version</span> requests without performing access control checks, there is no new vulnerability. Entities that wish to restrict access to capabilities information SHOULD use the privacy lists protocol defined in <span class="strong">XMPP IM</span> to define appropriate communications blocking (e.g., an entity MAY choose to allow IQ requests only from "trusted" entities, such as those with whom it has a subscription of "both").</p>
    <p class="" style="">It is possible (though unlikely) for a bad actor or rogue application to poison other entities by providing incorrect information in response to disco#info requests. To guard against such poisoning, a requesting entity MAY send disco#info requests to multiple entities that match the same <span class="strong">node</span>/<span class="strong">ver</span> or <span class="strong">node</span>/<span class="strong">ext</span> combination and then compare the results to ensure consistency. The requesting entity SHOULD NOT send the same request to more than five entities and MUST ensure that the entities are truly different by not sending the same request to multiple entities for which the &lt;user@host&gt; portion matches.</p>
  <h2>9.
       <a name="iana" id="iana">IANA Considerations</a></h2>
    <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2260983">13</a>]. </p>
  <h2>10.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
    <p class="" style="">The <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2261033">14</a>] includes 'http://jabber.org/protocol/caps' in its registries of protocol namespaces and service discovery features.</p>
    <p class="" style="">If it is useful or interesting, the Registrar may also provide registration of the URIs to be used in the <span class="strong">'node'</span> attribute, but since these URIs can be scoped according to well-defined existing rules, this is not necessary.</p>
  <h2>11.
       <a name="schema" id="schema">XML Schema</a></h2>
    <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/caps'
    xmlns='http://jabber.org/protocol/caps'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0115: http://www.xmpp.org/extensions/xep-0115.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='c'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='ext' type='xs:NMTOKENS' use='optional'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='ver' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  <hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2251220" id="nt-id2251220">1</a>. XEP-0071: XHTML-IM &lt;<a href="http://www.xmpp.org/extensions/xep-0071.html">http://www.xmpp.org/extensions/xep-0071.html</a>&gt;.</p><p><a name="nt-id2251302" id="nt-id2251302">2</a>. XEP-0096: File Transfer &lt;<a href="http://www.xmpp.org/extensions/xep-0096.html">http://www.xmpp.org/extensions/xep-0096.html</a>&gt;.</p><p><a name="nt-id2251280" id="nt-id2251280">3</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2259665" id="nt-id2259665">4</a>. XEP-0092: Software Version &lt;<a href="http://www.xmpp.org/extensions/xep-0092.html">http://www.xmpp.org/extensions/xep-0092.html</a>&gt;.</p><p><a name="nt-id2251264" id="nt-id2251264">5</a>. This proposal is not limited to clients, and can be used by any entity that exchanges presence with another entity, e.g., a gateway. However, this document uses the example of clients throughout.</p><p><a name="nt-id2260160" id="nt-id2260160">6</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2260188" id="nt-id2260188">7</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-id2260138" id="nt-id2260138">8</a>. These first two requirements effectively eliminated <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0060.html">Publish-Subscribe</a></span>  [<a href="#nt-id2260232">9</a>] as a possible implementation of entity capabilities.</p><p><a name="nt-id2260232" id="nt-id2260232">9</a>. XEP-0060: Publish-Subscribe &lt;<a href="http://www.xmpp.org/extensions/xep-0060.html">http://www.xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-id2260266" id="nt-id2260266">10</a>. XEP-0045: Multi-User Chat &lt;<a href="http://www.xmpp.org/extensions/xep-0045.html">http://www.xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-id2260369" id="nt-id2260369">11</a>. Each extension name MUST be of type NMTOKEN, where multiple extension names are separated by the white space character #x20, resulting in a tokenized attribute type of NMTOKENS (see Section 3.3.1 of <span class="ref" style=""><a href="http://www.w3.org/TR/REC-xml/">XML 1.0</a></span>  [<a href="#nt-id2260400">12</a>]).</p><p><a name="nt-id2260400" id="nt-id2260400">12</a>. Extensible Markup Language (XML) 1.0 (Fourth Edition) &lt;<a href="http://www.w3.org/TR/REC-xml/">http://www.w3.org/TR/REC-xml/</a>&gt;.</p><p><a name="nt-id2260983" id="nt-id2260983">13</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2261033" id="nt-id2261033">14</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 1.3 (2007-04-10)</h4><div class="indent"><p class="" style="">Added developer-friendly introduction; specified that ext names must be stable across application versions; further clarified examples; added stream feature use case; removed message example (send directed presence instead).</p> (psa/rt/jjh)
    </div><h4>Version 1.2 (2007-02-15)</h4><div class="indent"><p class="" style="">Clarified motivation and handling of service discovery requests.</p> (psa)
    </div><h4>Version 1.1 (2004-10-29)</h4><div class="indent"><p class="" style="">Clarified meaning of service discovery results for client#ver and client#ext.</p> (psa)
    </div><h4>Version 1.0 (2004-08-01)</h4><div class="indent"><p class="" style="">Per a vote of the Jabber Council, advanced status to Draft.</p> (psa)
    </div><h4>Version 0.7 (2004-06-29)</h4><div class="indent"><p class="" style="">Added several items to the Security Considerations; clarified naming requirements regarding 'node', 'ver', and 'ext' attributes.</p> (jjh/psa)
    </div><h4>Version 0.6 (2004-04-25)</h4><div class="indent"><p class="" style="">Made a number of editorial adjustments.</p> (psa)
    </div><h4>Version 0.5 (2004-01-05)</h4><div class="indent"><p class="" style="">Specified that the protocol can be used whenever presence is used (e.g., by gateways); improved the XML schema; made several editorial adjustments.</p> (psa)
    </div><h4>Version 0.4 (2003-09-04)</h4><div class="indent"><p class="" style="">IQ eets must be to a resource, since they are intended to go to a particular session.</p> (jjh)
    </div><h4>Version 0.3 (2003-09-02)</h4><div class="indent"><p class="" style="">Servers MUST strip extras changed to MAY, due to implementer feedback.</p> (jjh)
    </div><h4>Version 0.2 (2003-08-28)</h4><div class="indent"><p class="" style="">Add more clarifying assumptions and requirements, make
        it clear that clients don't have to send capabilities every
        time if the server is optimizing.</p> (jjh)
    </div><h4>Version 0.1 (2003-08-27)</h4><div class="indent"><p class="" style="">Initial version.</p> (jjh)
    </div></div><hr /><p>END</p></body></html>
