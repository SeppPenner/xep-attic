<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<title>JEP-0008: User Avatars in Jabber</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="User Avatars in Jabber">
<meta name="DC.Creator" content="Thomas Muldowney">
<meta name="DC.Creator" content="Julian Missig">
<meta name="DC.Creator" content="Jens Alfke">
<meta name="DC.Creator" content="Peter Millard">
<meta name="DC.Description" content="A proposal for avatars in Jabber.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2003-05-06">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0008">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2004 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.php&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;http://www.opencontent.org/openpub/&gt;).">
</head>
<body bgcolor="#FFFFFF">
<h1>JEP-0008: User Avatars in Jabber</h1>
<p>A proposal for avatars in Jabber.</p>
<p><hr></p>
<p style="color:red">WARNING: This JEP has been retracted by the author(s). Implementation of the protocol described herein is not recommended. Developers desiring similar functionality should implement the protocol that supersedes this one (if any).</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Retracted<br>
            Type: Standards Track<br>
            Number: 0008<br>
            Version: 0.2<br>
            Last Updated: 2003-05-06<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>
                Dependencies: None<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: None<br>
</p>
<h2>Author Information</h2>
<h3>Thomas Muldowney</h3>
<p class="indent">
        Email: temas@jabber.org<br>
        JID: temas@jabber.org</p>
<h3>Julian Missig</h3>
<p class="indent">
        Email: julian@jabber.org<br>
        JID: julian@jabber.org</p>
<h3>Jens Alfke</h3>
<p class="indent">
        Email: jens@mac.com<br>
</p>
<h3>Peter Millard</h3>
<p class="indent">
        Email: me@pgmillard.com<br>
        JID: pgmillard@jabber.org</p>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2004 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.php">http://www.jabber.org/jsf/ipr-policy.php</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;<a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core and XMPP IM specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocols defined in this JEP have been developed outside the Internet Standards Process and are to be understood as extensions to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<dl>
<dt>1.  <a href="#sect-id2595994">Introduction</a>
</dt>
<dt>2.  <a href="#sect-id2596017">Image Requirements</a>
</dt>
<dt>3.  <a href="#sect-id2596050">Avatar Availability</a>
</dt>
<dt>4.  <a href="#sect-id2596236">Avatar Retrieval</a>
</dt>
<dt>5.  <a href="#sect-id2601855">Future Considerations</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl>
<p><hr></p>
<h2>1.
       <a name="sect-id2595994">Introduction</a>
</h2>
  <p class="" style="">Many communication applications now allow for the association of a small image or buddy icon (avatar) with a user of that application. The avatar is not intended to be a defining portrait of the user, but rather a simple expression of the user's appearance, mood, status, and the like. This proposal outlines a way to incorporate avatars into the current Jabber platform.</p>
<h2>2.
       <a name="sect-id2596017">Image Requirements</a>
</h2>
  <p class="" style="">Certain restrictions are placed upon the image. First, the image height and width must be between thirty-two (32) and sixty-four (64) pixels. The suggested size is sixty-four (64) pixels high and sixty-four (64) pixels wide  [<a href="#nt-id2596035">1</a>]. Images should be square, but this is not required. Images should be in GIF, JPEG, or PNG format, although it is possible that in future revisions of this spec more formats will be allowed. Finally, images must use less than eight (8) kilobytes of data.</p>
<h2>3.
       <a name="sect-id2596050">Avatar Availability</a>
</h2>
  <p class="" style="">There are two methods of showing that a client has an avatar available:</p>
  <ol start="" type="">
    <li>Embedding the jabber:x:avatar namespace within &lt;presence/&gt; packets using Jabber's &lt;x/&gt; element</li>
    <li>Displaying the jabber:iq:avatar namespace in browse requests</li>
  </ol>
  <p class="" style="">Partly because Jabber browsing is relatively undeveloped, this proposal focuses on the first option.</p>
  <p class="" style="">The &lt;x/&gt; element in the jabber:x:avatar namespace contains a SHA1 hash (hexadecimal, not base64) of the image data in a &lt;hash/&gt; element. (Because the odds of creating an identical hash are small, the hash is considered unique to the image and can be used to cache images between client sessions, resulting in fewer requests for the image.) The initial announcement of the availability of an avatar is done by sending a presence packet with the jabber:x:avatar information, as follows:</p>
  <p class="caption">Example 1. </p>
<div class="indent"><pre>
&lt;presence&gt;
  &lt;x xmlns='jabber:x:avatar'&gt;
    &lt;hash&gt;SHA1 of image data&lt;/hash&gt;
  &lt;/x&gt;
&lt;/presence&gt;
  </pre></div>
  <p class="" style="">If the avatar-generating user changes the avatar, a new presence packet is sent out with the updated information:</p>
  <p class="caption">Example 2. </p>
<div class="indent"><pre>
&lt;presence&gt;
  &lt;x xmlns='jabber:x:avatar'&gt;
    &lt;hash&gt;SHA1 of new image data&lt;/hash&gt;
  &lt;/x&gt;
&lt;/presence&gt;
  </pre></div>
  <p class="" style="">To disable the avatar, the avatar-generating user's client will send a presence packet with the jabber:x:avatar namespace but with no hash information:</p>
  <p class="caption">Example 3. </p>
<div class="indent"><pre>
&lt;presence&gt;
  &lt;x xmlns='jabber:x:avatar'/&gt;
&lt;/presence&gt;
  </pre></div>
  <p class="" style="">Clients should send the current avatar hash in every &lt;presence/&gt; packet even if the avatar has not changed. Remember that other clients logging in will receive a copy of the most recent &lt;presence/&gt; element, which should therefore always contain the most recent avatar hash. However, if the client's connection is lost unexpectedly or the client disconnects without sending an unavailable presence, the server will send other clients a &lt;presence/&gt; element containing no jabber:x:avatar extension. Therefore if, after receiving one or more presence packets containing jabber:x:avatar information, an avatar-receiving client receives a presence packet that does not include the jabber:x:avatar namespace, it is recommended that the client save the avatar image until the next set of information is received. In this case the avatar-generating client might send something as simple as the following:</p>
  <p class="caption">Example 4. </p>
<div class="indent"><pre>
&lt;presence/&gt;
  </pre></div>
<h2>4.
       <a name="sect-id2596236">Avatar Retrieval</a>
</h2>
  <p class="" style="">There are two methods for retrieving the actual avatar data:</p>
  <ol start="" type="">
    <li>An exchange between clients of &lt;iq/&gt; elements in the jabber:iq:avatar namespace</li>
    <li>Public XML storage from the avatar-generating client to the server and public XML retrieval from the server to the avatar-requesting client  [<a href="#nt-id2596274">2</a>]</li>
  </ol>
  <p class="" style="">The first of these methods is preferred. On this model, a query is sent directly to the avatar-generating client using an &lt;iq/&gt; element of type &quot;get&quot; in the jabber:iq:avatar namespace  [<a href="#nt-id2596300">3</a>]  [<a href="#nt-id2596307">4</a>]:</p>
  <p class="caption">Example 5. </p>
<div class="indent"><pre>
&lt;iq id='2' type='get' to='user@server/resource'&gt;
  &lt;query xmlns='jabber:iq:avatar'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">The avatar-generating client will reply with an &lt;iq/&gt; element of type &quot;result&quot; in the jabber:iq:avatar namespace; this reply will contain a query element that in turn contains a &lt;data/&gt; element with the MIME type in the 'mimetype' attribute and the data base64-encoded in the body of the &lt;data/&gt; element:</p>
  <p class="caption">Example 6. </p>
<div class="indent"><pre>
&lt;iq id='2' type='result' to='user@server/resource'&gt;
  &lt;query xmlns='jabber:iq:avatar'&gt;
    &lt;data mimetype='image/jpeg'&gt;
      Base64-Encoded Data
    &lt;/data&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If the first method fails, the second method that should be attempted by sending a request to the server for the avatar-generating user's public XML containing the avatar data. This data is to be stored in the storage:client:avatar namespace. This method presumes that the avatar-generating client has already stored its avatar data on the server:</p>
  <p class="caption">Example 7. </p>
<div class="indent"><pre>
&lt;iq id='0' type='set' to='user@server'&gt;
  &lt;query xmlns='storage:client:avatar'&gt;
    &lt;data mimetype='image/jpeg'&gt;
      Base64 Encoded Data
    &lt;/data&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Once such data has been set, the avatar can be retrieved by any requesting client from the avatar-generating client's public XML storage:</p>
  <p class="caption">Example 8. </p>
<div class="indent"><pre>
&lt;iq id='1' type='get' to='user@server'&gt;
  &lt;query xmlns='storage:client:avatar'/&gt;
&lt;/iq&gt;
  </pre></div>
<h2>5.
       <a name="sect-id2601855">Future Considerations</a>
</h2>
  <p class="" style="">It is acknowledged that sending avatar information within presence packets is less than desirable in many respects (e.g., in network traffic generated); however, there currently exists in Jabber no generic framework for addressing these shortcomings. Possible solutions on the horizon include live browsing and a pub/sub model, but these are still embryonic and experimental. Once something of that nature is accepted by the Council, the avatar spec will be modified to work within that framework rather than by attaching to presence.</p>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<p>
<a name="nt-id2596035">1</a>. It is highly recommended that clients never scale up images when displaying them.</p>
<p>
<a name="nt-id2596274">2</a>. Refer to the <a href="http://docs.jabber.org/draft-proto/html/xml.html">Generic XML Namespace Storage</a> draft protocol.</p>
<p>
<a name="nt-id2596300">3</a>. Whenever possible, the avatar-requesting client should attempt to determine if the avatar-generating client has an avatar available before requesting it.</p>
<p>
<a name="nt-id2596307">4</a>. It is suggested that no request be made if it is known (such as through a browse reply) that a client does not support the jabber:iq:avatar namespace.</p>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.2 (2003-05-06)</h4>
<div class="indent">At the request of the authors, the status of this JEP has been changed to Retracted, to be superseded by a forthcoming JEP. This JEP will not be considered further by the Jabber Software Foundation and should not be used as a basis for implementations. (psa)
    </div>
<h4>Version 0.1 (2001-09-14)</h4>
<div class="indent">Initial release (tm)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
