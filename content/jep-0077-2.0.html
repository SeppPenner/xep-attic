<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0077: In-Band Registration</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="In-Band Registration">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Description" content="This JEP documents a protocol for in-band registration with instant messaging servers and associated services using the jabber:iq:register namespace.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2004-08-30">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0077">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2005 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;http://www.opencontent.org/openpub/&gt;).">
</head>
<body>
<h1>JEP-0077: In-Band Registration</h1>
<p>This JEP documents a protocol for in-band registration with instant messaging servers and associated services using the jabber:iq:register namespace.</p>
<p><hr></p>
<p style="color:green">NOTICE: The protocol defined herein is a Final Standard of the Jabber Software Foundation and may be considered a stable technology for implementation and deployment.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Final<br>
            Type: Standards Track<br>
            Number: 0077<br>
            Version: 2.0<br>
            Last Updated: 2004-08-30<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: iq-register<br>
        Schema: &lt;<a href="http://jabber.org/protocol/iq-register/iq-register.xsd">http://jabber.org/protocol/iq-register/iq-register.xsd</a>&gt;<br></p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email: stpeter@jabber.org<br>
        JID: stpeter@jabber.org</p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2005 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at &lt;<a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#reqs">Requirements</a>
</dt>
<dt>3.  <a href="#usecases">Use Cases</a>
</dt>
<dl>
<dt>3.1.  <a href="#usecases-register">Entity Registers with a Host</a>
</dt>
<dl><dt>3.1.1.  <a href="#usecases-register-server">Registration with a Server</a>
</dt></dl>
<dt>3.2.  <a href="#usecases-cancel">Entity Cancels an Existing Registration</a>
</dt>
<dt>3.3.  <a href="#usecases-changepw">User Changes Password</a>
</dt>
</dl>
<dt>4.  <a href="#extensibility">Extensibility</a>
</dt>
<dt>5.  <a href="#redirect">Redirection</a>
</dt>
<dt>6.  <a href="#precedence">Precedence Order</a>
</dt>
<dt>7.  <a href="#key">Key Element</a>
</dt>
<dt>8.  <a href="#streamfeature">Stream Feature</a>
</dt>
<dt>9.  <a href="#errors">Error Handling</a>
</dt>
<dt>10.  <a href="#security">Security Considerations</a>
</dt>
<dt>11.  <a href="#expiration">Expiration Date</a>
</dt>
<dt>12.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>13.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl>
<dt>13.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt>
<dt>13.2.  <a href="#registrar-stream">Stream Features</a>
</dt>
<dt>13.3.  <a href="#registrar-formtypes">Field Standardization</a>
</dt>
</dl>
<dt>14.  <a href="#schemas">XML Schemas</a>
</dt>
<dl>
<dt>14.1.  <a href="#schemas-register">jabber:iq:register</a>
</dt>
<dt>14.2.  <a href="#schemas-streams">Stream Feature</a>
</dt>
</dl>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style="">The Jabber protocols have long included a method for in-band registration with instant messaging servers and associated services. This method makes use of the 'jabber:iq:register' namespace and has been documented variously in Internet-Drafts and elsewhere. Because in-band registration is not required by <span class="ref" style="">RFC 2779</span>  [<a href="#nt-id2251371">1</a>], documentation of the 'jabber:iq:register' namespace was removed from <span class="ref" style="">XMPP IM</span>  [<a href="#nt-id2251398">2</a>]. This JEP fills the void for canonical documentation.</p>
<h2>2.
       <a name="reqs">Requirements</a>
</h2>
  <p class="" style="">In-band registration must make it possible for an entity to register with a host, or cancel an existing registration with a host. By "host" is meant either of the following:</p>
  <ol start="1" type="1">
    <li>an instant messaging server, such as described in <span style="font-weight: bold">XMPP IM</span> and identified by the "server/im" <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2255217">3</a>] category+type</li>
    <li>an add-on service, such as a gateway (see <span class="ref" style="">Gateway Interaction</span>  [<a href="#nt-id2255241">4</a>]) or a <span class="ref" style="">Multi-User Chat</span>  [<a href="#nt-id2255259">5</a>] service</li>
  </ol>
<h2>3.
       <a name="usecases">Use Cases</a>
</h2>
  <div class="indent">
<h3>3.1 <a name="usecases-register">Entity Registers with a Host</a>
</h3>
    <p class="" style="">In order to determine which fields are required for registration with a host, an entity SHOULD first send an IQ get to the host. The entity SHOULD NOT attempt to guess at the required fields by first sending an IQ set, since the nature of the required data is subject to service provisioning.</p>
    <p class="caption">Example 1. Entity Requests Registration Fields from Host</p>
<div class="indent"><pre>
&lt;iq type='get' id='reg1'&gt;
  &lt;query xmlns='jabber:iq:register'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the entity is not already registered and the host supports In-Band Registration, the host MUST inform the entity of the required registration fields. If the host does not support In-Band Registration, it MUST return a &lt;service-unavailable/&gt; error. If the host is redirecting registration requests to some other medium (e.g., a website), it MAY return an &lt;instructions/&gt; element only, as shown in the <a href="#redirect">Redirection</a> section of this document.</p>
    <p class="caption">Example 2. Host Returns Registration Fields to Entity</p>
<div class="indent"><pre>
&lt;iq type='result' id='reg1'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;instructions&gt;
      Choose a username and password for use with this service.
      Please also provide your email address.
    &lt;/instructions&gt;
    &lt;username/&gt;
    &lt;password/&gt;
    &lt;email/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the host determines (based on the 'from' address) that the entity is already registered, the IQ result that it sends in response to the IQ get MUST contain an empty &lt;registered/&gt; element (indicating that the entity is already registered), SHOULD contain the registration information currently on file for the entity (although the &lt;password/&gt; element MAY be empty), and SHOULD contain an &lt;instructions/&gt; element (whose XML character data MAY be modified to reflect the fact that the entity is currently registered).</p>
    <p class="" style="">If the host is an instant messaging server, it SHOULD assume that the requesting entity is unregistered at this stage unless the entity has already authenticated (for details, see the <a href="#usecases-register-server">Registration with a Server</a> section below).</p>
    <p class="caption">Example 3. Host Informs Entity of Current Registration</p>
<div class="indent"><pre>
&lt;iq type='result' id='reg1'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;registered/&gt;
    &lt;username&gt;juliet&lt;/username&gt;
    &lt;password&gt;R0m30&lt;/password&gt;
    &lt;email&gt;juliet@capulet.com&lt;/email&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the entity is not already registered, the entity SHOULD provide the required information.</p>
    <p class="caption">Example 4. Entity Provides Required Information</p>
<div class="indent"><pre>
&lt;iq type='set' id='reg2'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;username&gt;bill&lt;/username&gt;
    &lt;password&gt;Calliope&lt;/password&gt;
    &lt;email&gt;bill@shakespeare.lit&lt;/email&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Note: The requesting entity MUST provide information for all of the elements (other than &lt;instructions/&gt;) contained in the IQ result.</p>
    <p class="" style="">If the requesting entity provides an empty password element or a password element that contains no XML character data (i.e., either &lt;password/&gt; or &lt;password&gt;&lt;/password&gt;) during initial registration, the server or service MUST return a "Not Acceptable" error to the requesting entity.</p>
    <p class="caption">Example 5. Host Informs Entity of Successful Registration</p>
<div class="indent"><pre>
&lt;iq type='result' id='reg2'/&gt;
    </pre></div>
    <p class="" style="">Alternatively, registration may fail. Possible causes of failure include a username conflict (the desired username is already in use by another entity) and the fact that the requesting entity neglected to provide all of the required information.</p>
    <p class="caption">Example 6. Host Informs Entity of Failed Registration (Username Conflict)</p>
<div class="indent"><pre>
&lt;iq type='error' id='reg2'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;username&gt;bill&lt;/username&gt;
    &lt;password&gt;m1cro$oft&lt;/password&gt;
    &lt;email&gt;billg@bigcompany.com&lt;/email&gt;
  &lt;/query&gt;
  &lt;error code='409' type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 7. Host Informs Entity of Failed Registration (Some Required Information Not Provided)</p>
<div class="indent"><pre>
&lt;iq type='error' id='reg2'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;username&gt;bill&lt;/username&gt;
    &lt;password&gt;Calliope&lt;/password&gt;
  &lt;/query&gt;
  &lt;error code='406' type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <div class="indent">
<h3>3.1.1 <a name="usecases-register-server">Registration with a Server</a>
</h3>
      <p class="" style="">Special care must be taken when an unregistered entity interacts with a server rather than a service. Normally, a server enables in-band registration so that entities can "bootstrap" their participation in the Jabber network; this bootstrapping happens when an unregistered and unauthenticated entity opens a TCP connection to a server and immediately completes the registration use case with the server, then authenticates using the newly-registered identity. As noted, when a server receives an IQ-get for registration information, it SHOULD assume that the requesting entity is unregistered unless the entity has already authenticated.</p>
      <p class="" style="">Depending on local service provisioning, a server MAY return a &lt;not-acceptable/&gt; stanza error if an unregistered entity attempts to register too many times before authenticating or if an entity attempts to register a second identity after successfully completing the registration use case; a server MAY also return a &lt;not-authorized/&gt; stream error if the unregistered entity waits too long before authenticating or attempts to complete a task other than authentication after successfully completing the registration use case.</p>
    </div>
  </div>
  <div class="indent">
<h3>3.2 <a name="usecases-cancel">Entity Cancels an Existing Registration</a>
</h3>
    <p class="" style="">The 'jabber:iq:register' namespace also makes it possible for an entity to cancel a registration with a host by sending a &lt;remove/&gt; element in an IQ set. The host MUST determine the identity of the requesting entity based on the 'from' address of the IQ get.</p>
    <p class="caption">Example 8. Entity Requests Cancellation of Existing Registration</p>
<div class="indent"><pre>
&lt;iq type='set' from='bill@shakespeare.lit/globe' id='unreg1'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;remove/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
    <p class="caption">Example 9. Host Informs Entity of Successful Cancellation</p>
<div class="indent"><pre>
&lt;iq type='result' to='bill@shakespeare.lit/globe' id='unreg_1'/&gt;
    </pre></div>
    <p class="" style="">The host MUST perform the remove based on the 'from' address of the IQ set, usually matching based on bare JID (user@domain).</p>
    <p class="" style="">Several error cases are possible:</p>
    <p class="caption">Table 1: Unregister Error Cases</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
<th colspan="" rowspan="">Condition</th>
<th colspan="" rowspan="">Description</th>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;bad-request/&gt;</td>
<td align="" colspan="" rowspan="">The &lt;remove/&gt; element was not the only child element of the &lt;query/&gt; element.</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;forbidden/&gt;</td>
<td align="" colspan="" rowspan="">The sender does not have sufficient permissions to cancel the registration.</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;registration-required/&gt;</td>
<td align="" colspan="" rowspan="">The entity sending the remove request was not previously registered.</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;unexpected-request/&gt;</td>
<td align="" colspan="" rowspan="">The host is an instant messaging server and the IQ get does not contain a 'from' address because the entity is not registered with the server.</td>
</tr>
    </table>
  </div>
  <div class="indent">
<h3>3.3 <a name="usecases-changepw">User Changes Password</a>
</h3>
    <p class="" style="">The 'jabber:iq:register' namespace enables a user to change his or her password with a server or service. Once registered, the user can change passwords by sending an XML stanza of the following form (where 'somehost' is the domain identifier of the server or service):</p>
    <p class="caption">Example 10. Password Change</p>
<div class="indent"><pre>
&lt;iq type='set' to='somehost' id='change1'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;username&gt;bill&lt;/username&gt;
    &lt;password&gt;newpass&lt;/password&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Because the password change request contains the password in plain text, a client SHOULD NOT send such a request unless the underlying stream is encrypted (using SSL or TLS) and the client has verified that the server certificate is signed by a trusted certificate authority. A given domain MAY choose to disable password changes if the stream is not properly encrypted, or to disable in-band password changes entirely.</p>
    <p class="" style="">If the user provides an empty password element or a password element that contains no XML character data (i.e., either &lt;password/&gt; or &lt;password&gt;&lt;/password&gt;), the server or service MUST NOT change the password to a null value, but instead MUST maintain the existing password.</p>
    <p class="caption">Example 11. Host Informs Client of Successful Password Change</p>
<div class="indent"><pre>
&lt;iq type='result' id='change1'/&gt;
    </pre></div>
    <p class="" style="">Several error conditions are possible:</p>
    <p class="caption">Table 2: Password Change Error Cases</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
<th colspan="" rowspan="">Condition</th>
<th colspan="" rowspan="">Description</th>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;bad-request/&gt;</td>
<td align="" colspan="" rowspan="">The password change request does not contain complete information (both &lt;username/&gt; and &lt;password/&gt; are required).</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;not-authorized/&gt;</td>
<td align="" colspan="" rowspan="">The server or service does not consider the channel safe enough to enable a password change.</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;not-allowed/&gt;</td>
<td align="" colspan="" rowspan="">The server or service does not allow password changes.</td>
</tr>
      <tr class="body">
<td align="" colspan="" rowspan="">&lt;unexpected-request/&gt;</td>
<td align="" colspan="" rowspan="">The host is an instant messaging server and the IQ set does not contain a 'from' address because the entity is not registered with the server.</td>
</tr>
    </table>
    <p class="" style="">The server or service SHOULD NOT return the original XML sent in IQ error stanzas related to password changes.</p>
    <p class="caption">Example 12. Host Informs Client of Failed Password Change (Bad Request)</p>
<div class="indent"><pre>
&lt;iq type='error' from='somehost' to='user@host/resource' id='change1'&gt;
  &lt;error code='400' type='modify'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 13. Host Informs Client of Failed Password Change (Not Authorized)</p>
<div class="indent"><pre>
&lt;iq type='error' from='somehost' to='user@host/resource' id='change1'&gt;
  &lt;error code='401' type='cancel'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 14. Server Informs Client of Failed Password Change (Not Allowed)</p>
<div class="indent"><pre>
&lt;iq type='error' from='somehost' to='user@host/resource' id='change1'&gt;
  &lt;error code='405' type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
<h2>4.
       <a name="extensibility">Extensibility</a>
</h2>
  <p class="" style="">The fields defined in the 'jabber:iq:register' namespace are strictly limited to those specified in the schema. If a host needs to gather additional information, <span class="ref" style="">Data Forms</span>  [<a href="#nt-id2255971">6</a>] SHOULD be used, with the x:data form taking precedence over the iq:register fields (see the <a href="#precedence">Precedence Order</a> section below for further details); a host MUST NOT add new fields to the 'jabber:iq:register' namespace. Support for extensibility via jabber:x:data is RECOMMENDED but is not required for compliance with this JEP.</p>
  <p class="" style="">If the entity supports the <span style="font-weight: bold">Data Forms</span> protocol, it SHOULD submit the data form rather than the predefined 'jabber:iq:register' fields, and MUST NOT submit both the data form and the predefined fields.</p>
  <p class="" style="">The extensibility mechanism for registration makes use of a hidden FORM_TYPE field for the purpose of standardizing field names within the form, as defined in <span class="ref" style="">Field Standardization for Data Forms</span>  [<a href="#nt-id2255993">7</a>]. Implementations supporting this extensibility mechanism SHOULD support the standardized fields as well.</p>
  <p class="caption">Example 15. Entity Requests Registration Fields from Host</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='juliet@capulet.com/balcony'
    to='contests.shakespeare.lit'
    id='reg3'&gt;
  &lt;query xmlns='jabber:iq:register'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption">Example 16. Host Returns Registration Form to Entity</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='contests.shakespeare.lit'
    to='juliet@capulet.com/balcony'
    id='reg3'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;instructions&gt;
      Use the enclosed form to register. If your Jabber client does not
      support Data Forms, visit http://www.shakespeare.lit/contests.php
    &lt;/instructions&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Contest Registration&lt;/title&gt;
      &lt;instructions&gt;
        Please provide the following information
        to sign up for our special contests!
      &lt;/instructions&gt;
      &lt;field
          type='hidden'
          var='FORM_TYPE'&gt;
        &lt;value&gt;jabber:iq:register&lt;/value&gt;
      &lt;/field&gt;
      &lt;field
          type='text-single'
          label='Given Name'
          var='first'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          type='text-single'
          label='Family Name'
          var='last'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          type='text-single'
          label='Email Address'
          var='email'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field
          type='list-single'
          label='Gender'
          var='x-gender'&gt;
        &lt;option label='Male'&gt;&lt;value&gt;M&lt;/value&gt;&lt;/option&gt;
        &lt;option label='Female'&gt;&lt;value&gt;F&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>5.
       <a name="redirect">Redirection</a>
</h2>
  <p class="" style="">A given deployment MAY wish to redirect users to another medium (e.g., a website) for registration, rather than allowing in-band registration. The recommended approach is to include only the &lt;instructions/&gt; element rather than the required fields or a data form in the IQ result, as well as a URL encoded using <span class="ref" style="">Out-of-Band Data</span>  [<a href="#nt-id2256070">8</a>] (see the <a href="#precedence">Precedence Order</a> section below for further details).</p>
  <p class="caption">Example 17. Host Redirects Entity to Web Registration</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='contests.shakespeare.lit'
    to='juliet@capulet.com/balcony'
    id='reg3'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;instructions&gt;
      To register, visit http://www.shakespeare.lit/contests.php
    &lt;/instructions&gt;
  &lt;/query&gt;
  &lt;x xmlns='jabber:x:oob'&gt;
    &lt;url&gt;http://www.shakespeare.lit/contests.php&lt;/url&gt;
  &lt;/x&gt;
&lt;/iq&gt;
  </pre></div>
<h2>6.
       <a name="precedence">Precedence Order</a>
</h2>
  <p class="" style="">Given the foregoing discussion, it is evident that an entity could receive any combination of iq:register, x:data, and x:oob namespaces from a service in response to a request for information. The precedence order is as follows:</p>
  <ol start="1" type="">
    <li>x:data</li>
    <li>iq:register</li>
    <li>x:oob</li>
  </ol>
  <p class="" style="">(Naturally, if the receiving application does not understand any of the foregoing namespaces, it MUST ignore the data qualified by that namespace.)</p>
  <p class="" style="">Thus it is possible that the host may return any of the following combinations, in which case the submitting application MUST proceed as defined in the table below (it is assumed that "iq:register fields" means instructions plus fields, whereas "iq:register instructions" means the &lt;instructions/&gt; element only):</p>
  <p class="caption">Table 3: Recommended Processing of Namespace Combinations</p>
<table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th colspan="" rowspan="">Included Data</th>
      <th colspan="" rowspan="">Recommended Processing</th>
      <th colspan="" rowspan="">Notes</th>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">iq:register fields</td>
      <td align="" colspan="" rowspan="">Submit the completed iq:register fields.</td>
      <td align="" colspan="" rowspan="">This is the normal processing model for "legacy" services and clients.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">x:data form + iq:register fields</td>
      <td align="" colspan="" rowspan="">Submit the completed x:data form if understood, otherwise submit the completed iq:register fields; however, an application MUST NOT submit both.</td>
      <td align="" colspan="" rowspan="">The iq:register fields would be included for "legacy" clients; this combination SHOULD NOT be used if the x:data form includes required fields (e.g., a public key) that are not equivalent to defined iq:register fields (the next combination SHOULD be used instead).</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">x:data form + iq:register instructions</td>
      <td align="" colspan="" rowspan="">Submit the completed x:data form if understood, otherwise present the iq:register instructions to the user.</td>
      <td align="" colspan="" rowspan="">This combination SHOULD be used if the x:data form includes required fields (e.g., a public key) that are not equivalent to defined iq:register fields and an alternate URL is not available.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">x:data form + x:oob URL</td>
      <td align="" colspan="" rowspan="">Submit the completed x:data form if understood, otherwise present the provided URL as an alternative.</td>
      <td align="" colspan="" rowspan="">This combination MAY be returned by a host, but a host SHOULD return the next combination instead in order to support the full range of legacy clients.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">x:data form + iq:register instructions + x:oob URL</td>
      <td align="" colspan="" rowspan="">Submit the completed x:data form if understood, otherwise present the iq:register instructions and provided URL as an alternative.</td>
      <td align="" colspan="" rowspan="">This combination SHOULD be used if the x:data form includes required fields (e.g., a public key) that are not equivalent to defined iq:register fields and an alternate URL is available.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">iq:register instructions + x:oob URL</td>
      <td align="" colspan="" rowspan="">Present the iq:register instructions and provided URL as a redirect.</td>
      <td align="" colspan="" rowspan="">This combination MAY be returned by a host that wishes to redirect registration to a URL.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">iq:register fields + x:oob URL</td>
      <td align="" colspan="" rowspan="">Submit the completed iq:register fields but optionally present the provided URL as an alternative.</td>
      <td align="" colspan="" rowspan="">This combination is NOT RECOMMENDED.</td>
    </tr>
  </table>
<h2>7.
       <a name="key">Key Element</a>
</h2>
  <p class="" style=""><span style="font-style: italic">This element is obsolete, but is documented here for historical completeness.</span></p>
  <p class="" style="">The &lt;key/&gt; element was used as a "transaction key" in certain IQ interactions in order to verify the identity of the sender. In particular, it was used by servers (but generally not services) during in-band registration, since normally a user does not yet have a 'from' address before registering. The flow is as follows:</p>
  <ol start="" type="">
    <li>Client sends IQ-get request to server.</li>
    <li>Server returns required elements to client, including &lt;key/&gt; element containing a random string (often a SHA-1 hash).</li>
    <li>Client sends registration information to server, including &lt;key/&gt; element with the same value provided by the server.</li>
    <li>Server checks key information and processes registration request; if key is missing or the key value does not match the transaction key provided, the server returns an error.</li>
  </ol>
  <p class="" style="">The &lt;key/&gt; element was also used during registration removal.</p>
<h2>8.
       <a name="streamfeature">Stream Feature</a>
</h2>
  <p class="" style=""><span class="ref" style="">XMPP Core</span>  [<a href="#nt-id2256516">9</a>] defines methods for advertising feature support during stream negotiation. For the sake of efficiency, it may be desirable for a server to advertise support for in-band registration as a stream feature. The namespace for reporting support within &lt;stream:features/&gt; is "http://jabber.org/features/iq-register". Upon receiving a stream header qualified by the 'jabber:client' namespace, a server returns a stream header to the client and MAY announce support for in-band registration by including the relevant stream feature:</p>
  <p class="caption">Example 18. Advertising registration as a stream feature</p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;stream:stream xmlns:stream='http://etherx.jabber.org/streams/'
    xmlns='jabber:client'
    from='somedomain'
    version='1.0'&gt;
  &lt;stream:features&gt;
    ...
    &lt;register xmlns='http://jabber.org/features/iq-register'/&gt;
    ...
  &lt;/stream:features&gt;
  </pre></div>
  <p class="" style="">A server SHOULD NOT advertise in-band registration to another server (i.e., if the initial stream header was qualified by the 'jabber:server' namespace).</p>
<h2>9.
       <a name="errors">Error Handling</a>
</h2>
  <p class="" style="">As defined herein, the 'jabber:iq:register' namespace supports both the old (HTTP-style) error codes and the extensible error classes and conditions specified in XMPP Core. A compliant server or service implementation MUST support both old-style and new-style error handling. A compliant client implementation SHOULD support both. For mappings of HTTP-style errors to XMPP-style conditions, refer to <span class="ref" style="">Error Condition Mappings</span>  [<a href="#nt-id2256605">10</a>].</p>
<h2>10.
       <a name="security">Security Considerations</a>
</h2>
  <p class="" style="">In-band registration is usually not included in other messaging protocols (for example, SMTP does not include a method for registering with an email server), often for reasons of security. The registration methods defined herein are known to be insecure and SHOULD NOT be used unless the channel between the registrant and the entity that accepts registration has been secured. For these reasons, the deployment of in-band registration is a policy matter and a given domain MAY choose to disable in-band registration and password changes. Furthermore, this JEP should be deprecated as soon as a successor protocol is defined and implemented.</p>
<h2>11.
       <a name="expiration">Expiration Date</a>
</h2>
  <p class="" style="">In accordance with Section 8 of <span class="ref" style="">Jabber Enhancement Proposals</span>  [<a href="#nt-id2256675">11</a>], this JEP shall expire 6 months from the date of its advancement to a status of Final. The Jabber Council shall review this JEP before its expiration date, and at that time shall determine whether to change its status to Deprecated or to extend the expiration date for an additional six months. That process will continue until the JEP is deprecated or made a permanent standard.</p>
<h2>12.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This JEP requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2256717">12</a>].</p>
<h2>13.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>13.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
    <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2256765">13</a>] includes the 'jabber:iq:register' namespace in its registry of protocol namespaces.</p>
  </div>
  <div class="indent">
<h3>13.2 <a name="registrar-stream">Stream Features</a>
</h3>
    <p class="" style="">The Jabber Registrar includes the 'http://jabber.org/features/iq-register' namespace in its registry of stream feature namespaces.</p>
  </div>
  <div class="indent">
<h3>13.3 <a name="registrar-formtypes">Field Standardization</a>
</h3>
    <p class="" style="">As described in the <a href="#extensibility">Extensibility</a> section above, this proposal includes registration of a FORM_TYPE and associated field types and names for field standardization as defined in JEP-0068. The initial submission is as follows (additional fields may be provided in future submissions):</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;jabber:iq:register&lt;/name&gt;
  &lt;doc&gt;JEP-0077&lt;/doc&gt;
  &lt;desc&gt;
    Standardization of fields related to in-band registration.
  &lt;/desc&gt;
  &lt;field
      var='username'
      type='text-single'
      label='Account name associated with the user'/&gt;
  &lt;field
      var='nick'
      type='text-single'
      label='Familiar name of the user'/&gt;
  &lt;field
      var='password'
      type='text-private'
      label='Password or secret for the user'/&gt;
  &lt;field
      var='name'
      type='text-single'
      label='Full name of the user'/&gt;
  &lt;field
      var='first'
      type='text-single'
      label='First name or given name of the user'/&gt;
  &lt;field
      var='last'
      type='text-single'
      label='Last name, surname, or family name of the user'/&gt;
  &lt;field
      var='email'
      type='text-single'
      label='Email address of the user'/&gt;
  &lt;field
      var='address'
      type='text-single'
      label='Street portion of a physical or mailing address'/&gt;
  &lt;field
      var='city'
      type='text-single'
      label='Locality portion of a physical or mailing address'/&gt;
  &lt;field
      var='state'
      type='text-single'
      label='Region portion of a physical or mailing address'/&gt;
  &lt;field
      var='zip'
      type='text-single'
      label='Postal code portion of a physical or mailing address'/&gt;
  &lt;field
      var='phone'
      type='text-single'
      label='Telephone number of the user'/&gt;
  &lt;field
      var='url'
      type='text-single'
      label='URL to web page describing the user'/&gt;
  &lt;field
      var='date'
      type='text-single'
      label='Some date (e.g., birth date, hire date, sign-up date)'/&gt;
  &lt;field
      var='misc'
      type='text-single'
      label='Free-form text field (obsolete)'/&gt;
  &lt;field
      var='text'
      type='text-single'
      label='Free-form text field (obsolete)'/&gt;
  &lt;field
      var='key'
      type='text-single'
      label='Session key for transaction (obsolete)'/&gt;
&lt;/form_type&gt;
    </pre></div>
  </div>
<h2>14.
       <a name="schemas">XML Schemas</a>
</h2>
  <div class="indent">
<h3>14.1 <a name="schemas-register">jabber:iq:register</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='jabber:iq:register'
    xmlns='jabber:iq:register'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0077: http://www.jabber.org/jeps/jep-0077.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:sequence minOccurs='0'&gt;
          &lt;xs:element name='registered' type='empty' minOccurs='0'/&gt;
          &lt;xs:element name='instructions' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='username' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='nick' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='password' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='name' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='first' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='last' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='email' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='address' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='city' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='state' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='zip' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='phone' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='url' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='date' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='misc' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='text' type='xs:string' minOccurs='0'/&gt;
          &lt;xs:element name='key' type='xs:string' minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:element name='remove' type='empty' minOccurs='0'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>14.2 <a name="schemas-streams">Stream Feature</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/features/iq-register'
    xmlns='http://jabber.org/features/iq-register'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0077: http://www.jabber.org/jeps/jep-0077.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='register' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2251371">1</a>. RFC 2779: A Model for Presence and Instant Messaging &lt;<a href="http://www.ietf.org/rfc/rfc2779.txt">http://www.ietf.org/rfc/rfc2779.txt</a>&gt;.</p>
<p><a name="nt-id2251398">2</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2255217">3</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2255241">4</a>. JEP-0100: Gateway Interaction &lt;<a href="http://www.jabber.org/jeps/jep-0100.html">http://www.jabber.org/jeps/jep-0100.html</a>&gt;.</p>
<p><a name="nt-id2255259">5</a>. JEP-0045: Multi-User Chat &lt;<a href="http://www.jabber.org/jeps/jep-0045.html">http://www.jabber.org/jeps/jep-0045.html</a>&gt;.</p>
<p><a name="nt-id2255971">6</a>. JEP-0004: Data Forms &lt;<a href="http://www.jabber.org/jeps/jep-0004.html">http://www.jabber.org/jeps/jep-0004.html</a>&gt;.</p>
<p><a name="nt-id2255993">7</a>. JEP-0068: Field Data Standardization for Data Forms &lt;<a href="http://www.jabber.org/jeps/jep-0068.html">http://www.jabber.org/jeps/jep-0068.html</a>&gt;.</p>
<p><a name="nt-id2256070">8</a>. JEP-0066: Out of Band Data &lt;<a href="http://www.jabber.org/jeps/jep-0066.html">http://www.jabber.org/jeps/jep-0066.html</a>&gt;.</p>
<p><a name="nt-id2256516">9</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2256605">10</a>. JEP-0086: Error Condition Mappings &lt;<a href="http://www.jabber.org/jeps/jep-0086.html">http://www.jabber.org/jeps/jep-0086.html</a>&gt;.</p>
<p><a name="nt-id2256675">11</a>. JEP-0001: Jabber Enhancement Proposals &lt;<a href="http://www.jabber.org/jeps/jep-0001.html">http://www.jabber.org/jeps/jep-0001.html</a>&gt;.</p>
<p><a name="nt-id2256717">12</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2256765">13</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 2.0 (2004-08-30)</h4>
<div class="indent">Per a vote of the Jabber Council, advanced status to Final; also specified that by server is meant an instant messaging server. (psa)
    </div>
<h4>Version 1.6 (2004-08-23)</h4>
<div class="indent">In order to address Council concerns, clarified precedence order of x:data, iq:register, and x:oob; further specified server handling of initial registration requests from unregistered entities. (psa)
    </div>
<h4>Version 1.5 (2004-07-21)</h4>
<div class="indent">Specified server handling of requests from unregistered entities. (psa)
    </div>
<h4>Version 1.4 (2004-05-10)</h4>
<div class="indent">Removed conformance language regarding servers and services (belongs in a protocol suite specification). (psa)
    </div>
<h4>Version 1.3 (2004-02-24)</h4>
<div class="indent">Added text about redirection to web registration. (psa)
    </div>
<h4>Version 1.2 (2003-11-26)</h4>
<div class="indent">Documented use of &lt;key/&gt; element; added optional stream feature; added XMPP error handling; specified handling of empty passwords. (psa)
    </div>
<h4>Version 1.1 (2003-10-02)</h4>
<div class="indent">Moved change password use case from JEP-0078. (psa)
    </div>
<h4>Version 1.0 (2003-06-18)</h4>
<div class="indent">Per a vote of the Jabber Council, advanced status to Draft. (psa)
    </div>
<h4>Version 0.9 (2003-06-18)</h4>
<div class="indent">Changes to address Council concerns. (psa)
    </div>
<h4>Version 0.8 (2003-06-13)</h4>
<div class="indent">Restored the &lt;misc/&gt; and &lt;text/&gt; elements; added the old &lt;key/&gt; element; specified these three elements as obsolete. (psa)
    </div>
<h4>Version 0.7 (2003-06-12)</h4>
<div class="indent">Added &lt;registered/&gt; element; specified FORM_TYPE for x:data form; clarified that support for the extensibility mechanism is optional; removed the &lt;misc/&gt; and &lt;text/&gt; elements (not necessary given extensibility option); added &lt;nick/&gt;, &lt;first/&gt;, and &lt;last/&gt; elements that were traditionally documented as part of jabber:iq:register. (psa)
    </div>
<h4>Version 0.6 (2003-06-06)</h4>
<div class="indent">Removed XMPP-style error conditions until formats are stable. (psa)
    </div>
<h4>Version 0.5 (2003-05-30)</h4>
<div class="indent">Removed "encrypted secret" content, added information about expiration date. (psa)
    </div>
<h4>Version 0.4 (2003-05-28)</h4>
<div class="indent">Added "encrypted secret" content. (psa)
    </div>
<h4>Version 0.3 (2003-05-20)</h4>
<div class="indent">Slight editorial revisions. (psa)
    </div>
<h4>Version 0.2 (2003-04-29)</h4>
<div class="indent">Fixed schema, made minor editorial changes. (psa)
    </div>
<h4>Version 0.1 (2003-04-06)</h4>
<div class="indent">Initial version. (psa)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
