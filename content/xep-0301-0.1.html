<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0301: In-Band Real Time Text</title><link rel="stylesheet" type="text/css" href="../xmpp.css" /><link href="../prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="../prettify.js"></script><meta name="DC.Title" content="In-Band Real Time Text" /><meta name="DC.Creator" content="Mark Rejhon" /><meta name="DC.Description" content="This is a specification for real-time text transmitted in-band over an XMPP session." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2011-06-29" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0301" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 - 2011 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0301: In-Band Real Time Text</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This is a specification for real-time text transmitted in-band over an XMPP session.</td></tr><tr valign="top"><td><strong>Author:</strong></td><td>Mark Rejhon</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 - 2011 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Experimental</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>0.1</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2011-06-29</td></tr></table><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems are advised to carefully consider whether it is appropriate to deploy implementations of this protocol before it advances to a status of Draft.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#introduction">Introduction</a><br />2.  <a href="#requirements">Requirements</a><br />   
      2.1.  <a href="#fluid_realtime_text">Fluid Real-Time Text</a><br />   
      2.2.  <a href="#interoperable">Interoperable</a><br />   
      2.3.  <a href="#inband_transmission">In-Band Transmission</a><br />   
      2.4.  <a href="#flexible">Flexible</a><br />3.  <a href="#glossary">Glossary</a><br />4.  <a href="#protocol">Protocol</a><br />   
      4.1.  <a href="#rtt_element">RTT Element</a><br />   
      4.2.  <a href="#rtt_attributes">RTT Attributes</a><br />      
      4.2.1.  <a href="#xmlns">xmlns</a><br />      
      4.2.2.  <a href="#seq">seq</a><br />      
      4.2.3.  <a href="#event">event</a><br />   
      4.3.  <a href="#body_element">Body Element</a><br />      
      4.3.1.  <a href="#backwards_compatible">Backwards Compatible</a><br />      
      4.3.2.  <a href="#behavior_in_clients_supporting_this_specification">Behavior in Clients Supporting This Specification</a><br />   
      4.4.  <a href="#transmission_interval">Transmission Interval</a><br />   
      4.5.  <a href="#realtime_actions">Real-Time Actions</a><br />      
      4.5.1.  <a href="#summary_of_action_elements">Summary of Action Elements</a><br />        
      4.5.1.1.  <a href="#edit_actions_tier_1">Edit Actions (Tier 1)</a><br />        
      4.5.1.2.  <a href="#presentation_actions_tier_2">Presentation Actions (Tier 2)</a><br />        
      4.5.1.3.  <a href="#rules_for_attribute_values">Rules for Attribute Values</a><br />      
      4.5.2.  <a href="#action_elements">Action Elements</a><br />        
      4.5.2.1.  <a href="#element_t_insert_text">Element &lt;t&gt; – Insert Text</a><br />        
      4.5.2.2.  <a href="#element_e_backspace">Element &lt;e&gt; – Backspace</a><br />        
      4.5.2.3.  <a href="#element_d_forward_delete">Element &lt;d&gt; – Forward Delete</a><br />        
      4.5.2.4.  <a href="#element_w_interval">Element &lt;w&gt; – Interval</a><br />        
      4.5.2.5.  <a href="#element_c_cursor_position">Element &lt;c&gt; – Cursor Position</a><br />        
      4.5.2.6.  <a href="#element_g_flash">Element &lt;g&gt; – Flash</a><br />      
      4.5.3.  <a href="#processing_rules">Processing Rules</a><br />   
      4.6.  <a href="#error_recovery_of_realtime_text">Error Recovery of Real-Time Text</a><br />      
      4.6.1.  <a href="#staying_in_sync">Staying In Sync</a><br />      
      4.6.2.  <a href="#detecting_loss_of_sync">Detecting Loss of Sync</a><br />      
      4.6.3.  <a href="#recovery_from_loss_of_sync">Recovery From Loss of Sync</a><br />      
      4.6.4.  <a href="#helping_the_recipient_stay_in_sync">Helping The Recipient Stay In Sync</a><br />5.  <a href="#determining_support">Determining Support</a><br />6.  <a href="#implementation_notes">Implementation Notes</a><br />   
      6.1.  <a href="#key_press_intervals">Key Press Intervals</a><br />      
      6.1.1.  <a href="#avoid_bursty_text_presentation">Avoid Bursty Text Presentation</a><br />      
      6.1.2.  <a href="#preserving_key_press_intervals">Preserving Key Press Intervals</a><br />   
      6.2.  <a href="#realtime_transmission">Real-time Transmission</a><br />      
      6.2.1.  <a href="#monitoring_message_edits">Monitoring Message Edits</a><br />      
      6.2.2.  <a href="#guidelines_for_senders">Guidelines for Senders</a><br />      
      6.2.3.  <a href="#guidelines_for_receivers">Guidelines for Receivers</a><br />   
      6.3.  <a href="#remote_cursor">Remote Cursor</a><br />      
      6.3.1.  <a href="#calculating_cursor_position">Calculating Cursor Position</a><br />      
      6.3.2.  <a href="#_guidelines_for_senders">Guidelines for Senders</a><br />      
      6.3.3.  <a href="#_guidelines_for_receivers">Guidelines for Receivers</a><br />   
      6.4.  <a href="#other_guidelines">Other Guidelines</a><br />      
      6.4.1.  <a href="#message_length_limit">Message Length Limit</a><br />      
      6.4.2.  <a href="#performance">Performance</a><br />      
      6.4.3.  <a href="#battery_life">Battery Life</a><br />7.  <a href="#use_cases">Use Cases</a><br />   
      7.1.  <a href="#three_backspaces">Three Backspaces</a><br />   
      7.2.  <a href="#three_backspaces_in_one_action_element">Three Backspaces In One Action Element</a><br />   
      7.3.  <a href="#message_edits_split_into_multiple_transmissions">Message Edits Split Into Multiple Transmissions</a><br />   
      7.4.  <a href="#deleting_text_from_message">Deleting Text From Message</a><br />   
      7.5.  <a href="#inserting_text_into_message">Inserting Text Into Message</a><br />   
      7.6.  <a href="#deleting_and_replacing_text_in_message">Deleting And Replacing Text In Message</a><br />   
      7.7.  <a href="#multiple_message_edits">Multiple Message Edits</a><br />   
      7.8.  <a href="#three_consecutive_messages">Three Consecutive Messages</a><br />   
      7.9.  <a href="#real_world_message_with_key_press_intervals">Real World Message With Key Press Intervals</a><br />8.  <a href="#interoperability_considerations">Interoperability Considerations</a><br />   
      8.1.  <a href="#rfc_4103_and_t140">RFC 4103 and T.140</a><br />   
      8.2.  <a href="#combination_with_other_realtime_media">Combination With Other Real-Time Media</a><br />      
      8.2.1.  <a href="#total_conversation">Total Conversation</a><br />9.  <a href="#internationalization_considerations">Internationalization Considerations</a><br />10.  <a href="#security_considerations">Security Considerations</a><br />   
      10.1.  <a href="#privacy">Privacy</a><br />   
      10.2.  <a href="#congestion_considerations">Congestion Considerations</a><br />11.  <a href="#iana_considerations">IANA Considerations</a><br />12.  <a href="#xmpp_registrar_considerations">XMPP Registrar Considerations</a><br />   
      12.1.  <a href="#protocol_namespaces">Protocol Namespaces</a><br />   
      12.2.  <a href="#namespace_versioning">Namespace Versioning</a><br />13.  <a href="#xml_schema">XML Schema</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="introduction" id="introduction">Introduction</a></h2>
    <p>This document defines a specification for real-time text transmitted in-band over an XMPP session.</p>
    <p>Real-time text is text that is sent as it is created. The recipient can watch the sender type "as written words are typed" – similar to a telephone conversation where one listens to a conversation "as words are spoken". It provides a sense of contact in conversation, eliminates waiting times found in messaging, and is also favored by the deaf who prefer text conversation. For a visual animation of real-time text, see <span class="ref"><span class="strong"><a href="http://www.realjabber.org">RealJabber.org</a></span></span>
   [<a href="#nt-id229679">1</a>].</p>
    <p>Real-time text has been around for decades in various implementations:</p>
    <ul>
      <li>The 'talk' command on UNIX systems since the 1970's.</li>
      <li>ICQ had a split screen mode from 1996-1999 before this feature was removed.</li>
      <li>In 2008, AOL AIM 6.8 gained the <span class="ref"><span class="strong"><a href="http://help.aol.com/help/microsites/microsite.do?cmd=displayKC&amp;externalId=223568">AOL Real-Time IM</a></span></span>  [<a href="#nt-id229716">2</a>] feature.</li>
      <li>Hobby BBS chat programs from the 1990's.</li>
      <li>TDD, TTY and text telephones for the deaf.</li>
      <li>In SIP calls, real-time text is sent using an <span class="ref"><span class="strong"><a href="http://tools.ietf.org/html/rfc4103">IETF RFC 4103</a></span></span>  [<a href="#nt-id229744">3</a>] transport, with <span class="ref"><span class="strong"><a href="http://www.itu.int/rec/T-REC-T.140">ITU-T T.140</a></span></span>  [<a href="#nt-id229763">4</a>] presentation coding.</li>
    </ul>
    <h2>2.
       <a name="requirements" id="requirements">Requirements</a></h2>
        <div class="indent"><h3>2.1 <a name="fluid_realtime_text" id="fluid_realtime_text">Fluid Real-Time Text</a></h3>
    <ol>
      <li>Allow transmission of real-time text with a low latency.</li>
      <li>Support real-time message editing, including text insertions, deletions and cursor movements.</li>
      <li>Support transmission of the original intervals between key presses, to preserve look-and-feel of typing independently of transmission intervals.</li>
    </ol>
    </div>
    <div class="indent"><h3>2.2 <a name="interoperable" id="interoperable">Interoperable</a></h3>
    <ol>
      <li>Balance low latencies versus system, network and server limitations.</li>
      <li>Be backwards compatible with XMPP clients that do not support real-time text.</li>
      <li>Be interoperable with other real-time text protocols via gateways, including RFC 4103 and other standards.</li>
    </ol>
    </div>
    <div class="indent"><h3>2.3 <a name="inband_transmission" id="inband_transmission">In-Band Transmission</a></h3>
    <ol>
      <li>Reliable real-time text delivery.</li>
      <li>Provide a high level XML mechanism of transmitting real-time text.</li>
      <li>Minimize reliance on knowledge of network transversal protocols and/or out-of-band transmission protocols.</li>
    </ol>
    </div>
    <div class="indent"><h3>2.4 <a name="flexible" id="flexible">Flexible</a></h3>
    <ol>
      <li>Allow use within existing instant-messaging user interfaces, with minimal modifications.</li>
      <li>Allow alternate presentations of real-time text, including split screen and/or other layouts.</li>
      <li>Protocol design extensible for new features.</li>
      <li>Protocol recovery from lost/missing messages.</li>
    </ol>
    </div>
<h2>3.
       <a name="glossary" id="glossary">Glossary</a></h2>
    <p><span class="strong">real-time text</span> – Text transmitted and displayed in real-time as it is typed or entered.</p>
    <p><span class="strong">real-time message</span> – A chat message that changes in real-time, via real-time text, and as it is edited by the remote sender.</p>
    <p><span class="strong">real-time action</span> – An action done to a real-time message, such as an edit action or a presentation action.</p>
    <p><span class="strong">real-time chat session</span> – A chat session that supports real-time messages.</p>
    <p><span class="strong">RTT</span> – Acronym for real-time text. This is also the name of the main XML element used by this standard.</p>
    <p><span class="strong">action element</span> – An XML element that indicates a single edit action, or presentation action.</p>
    


    <p><span class="strong">edit action</span> – A text modification of any kind, including text insertion or deletion. This may be as small as a single key press.</p>
    <p><span class="strong">presentation action</span> – A presentation behavior such as the movement of a visible cursor, a pause, or a flash.</p>
    <h2>4.
       <a name="protocol" id="protocol">Protocol</a></h2>
        <div class="indent"><h3>4.1 <a name="rtt_element" id="rtt_element">RTT Element</a></h3>
    <p>Real-time text is transmitted via an &lt;rtt&gt; child element of a &lt;message&gt; stanza. The &lt;rtt&gt; element is transmitted at regular intervals by the sender while a chat message is being composed, to allow the recipient to watch the sender type (and edit) the message before the full message is sent.</p>
    <p>This is a basic example of a <span class="em"><span class="strong">real-time message</span></span> "Hello, my Juliet!", transmitted in three real-time text fragments, followed by a final message delivery:</p>
    <p><span class="strong">Example 1: Introductory Example</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='juliet@capulet.lit' from='romeo@montague.lit/orchard' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello, &lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='juliet@capulet.lit' from='romeo@montague.lit/orchard' type='chat' id='a02'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='1'&gt;
    &lt;t&gt;my &lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='juliet@capulet.lit' from='romeo@montague.lit/orchard' type='chat' id='a03'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='2'&gt;
    &lt;t&gt;Juliet!&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='juliet@capulet.lit' from='romeo@montague.lit/orchard' type='chat' id='a04'&gt;
  &lt;body&gt;Hello, my Juliet!&lt;/body&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>The &lt;rtt&gt; element contains a series of one or more child elements representing <span class="em"><span class="strong">real-time actions</span></span> including <span class="em"><span class="strong">edit actions</span></span> and/or <span class="em"><span class="strong">presentation actions</span></span>. Example 1 illustrates only a single edit action, the &lt;t&gt; <span class="em"><span class="strong">action element</span></span>, which simply adds text to the end of a message. For more information about action elements, see <a href="#realtime_actions">Real-Time Actions</a>.</p>
    <p>If the recipient client does not support this real-time text standard, the sender SHOULD NOT transmit the &lt;rtt&gt; element. For more information, see <a href="#determining_support">Determining Support</a>.</p>
    </div>
    <div class="indent"><h3>4.2 <a name="rtt_attributes" id="rtt_attributes">RTT Attributes</a></h3>
        <div class="indent"><h3>4.2.1 <a name="xmlns" id="xmlns">xmlns</a></h3>
    <p>This REQUIRED attribute MUST be <span class="strong">urn:xmpp:rtt:0</span></p>
    </div>
    <div class="indent"><h3>4.2.2 <a name="seq" id="seq">seq</a></h3>
    <p>This REQUIRED attribute indicates the sequence number, and MUST begin at 0 in the first &lt;rtt&gt; element sent at the start of a <span class="em"><span class="strong">real-time chat session</span></span>. This attribute MUST increment by 1 for every &lt;rtt&gt; element sent until the end of the session. This value may be used by the receiver to detect lost &lt;message&gt; elements, which affects the integrity of real-time text. For more information, see <a href="#error_recovery_of_realtime_text">Error Recovery of Real-Time Text</a>.</p>
    </div>
    <div class="indent"><h3>4.2.3 <a name="event" id="event">event</a></h3>
    <p>This attribute signals session events for real-time messages, such as the start of a new real-time message. The <span class="strong">event</span> attribute is omitted from the &lt;rtt&gt; element, when it is not needed.</p>
    <ol>
      <li><p><span class="strong">event='new'</span><br />
        The sender MUST use this value on the first &lt;rtt&gt; element of a new real-time message. The recipient MUST initialize a blank real-time message for display, before processing the &lt;rtt&gt; payload, if any is provided.</p></li>
      <li><p><span class="strong">event='reset'</span><br />
        The sender MAY use this value to retransmit a real-time message. The recipient MUST clear the existing real-time message, before processing the &lt;rtt&gt; payload. One use case is for error recovery. Another use case is where the recipient logs off and on, all while the sender is still composing a message. This allows the recipient re-display the real-time message.</p></li>
      <li><p><span class="strong">event='start'</span><br />
        The sender MAY use this value to indicate the start of a real-time session. The &lt;rtt&gt; payload MUST be empty, with no real-time actions.</p></li>
      <li><p><span class="strong">event='cancel'</span><br />
        The sender MAY use this value to indicate the end of a real-time session. The recipient SHOULD clear or close the current real-time message, if any is still displayed. An example case is closing a chat window before a message is delivered. The &lt;rtt&gt; payload MUST be empty, with no real-time actions.</p></li>
    </ol>
    <p>Only one &lt;rtt&gt; element is allowed per &lt;message&gt;. Therefore, to transmit multiple events, use multiple consecutive &lt;message&gt;'s.</p>
    </div>
</div>
    <div class="indent"><h3>4.3 <a name="body_element" id="body_element">Body Element</a></h3>
    <p>To turn a real-time message into a permanent delivered message, the sender MUST transmit the whole message as a standard &lt;body&gt; child element within the &lt;message&gt; stanza.</p>
        <div class="indent"><h3>4.3.1 <a name="backwards_compatible" id="backwards_compatible">Backwards Compatible</a></h3>
    <p>The &lt;body&gt; element continues to follow the <span class="ref"><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-id236587">5</a>] standard. This keeps backwards compatibility with XMPP clients that do not support this specification. Such clients will continue to behave normally, displaying complete lines of messages as they are delivered.</p>
    </div>
    <div class="indent"><h3>4.3.2 <a name="behavior_in_clients_supporting_this_specification" id="behavior_in_clients_supporting_this_specification">Behavior in Clients Supporting This Specification</a></h3>
    <p>Upon receipt of &lt;body&gt;, the recipient MUST replace the real-time message with the final delivered message from &lt;body&gt;. The message is thus becomes permanent and can not be edited any further.</p>
    <p>In the ideal case, the message in a &lt;body&gt; is redundant since it simply repeats the entire contents of the real-time message. In the event that there are lost &lt;messages&gt;, the delivery of the &lt;body&gt; permits <a href="#error_recovery_of_realtime_text">Error Recovery of Real-Time Text</a>.</p>
    <p>After sending a completed message as a &lt;body&gt;, the sender may begin a real-time message, using the <span class="strong">event='new'</span> attribute.</p>
    </div>
</div>
    <div class="indent"><h3>4.4 <a name="transmission_interval" id="transmission_interval">Transmission Interval</a></h3>
    <p>For the best balance between interoperability and usability, the interval of transmission of &lt;rtt&gt; for a continuously-changing real-time message SHOULD be once every <span class="strong">1 second</span>. If there has been no changes to the real-time message, no transmission should take place.</p>
    <p>A much shorter interval may more frequently trigger the flooding protection algorithms in XMPP servers, leading to dropped &lt;message&gt; elements and/or <a href="#congestion_considerations">Congestion Considerations</a>. A longer interval will lead to a less optimal user experience. One second is a balance that meets the requirements of real-time text. This interval is mentioned in other real-time text standards, including section 5.4 of IETF RFC 4103 and section 5.2.2 of <span class="ref"><span class="strong"><a href="http://tools.ietf.org/html/rfc5194">IETF RFC 5194</a></span></span>  [<a href="#nt-id236664">6</a>], used for SIP.</p>
    <p>To smooth the output of text, this specification supports transmission of the sender's original <a href="#key_press_intervals">Key Press Intervals</a>. This allows the recipient software to display the sender's typing at the original speed, regardless of the transmission interval.</p>
    </div>
    <div class="indent"><h3>4.5 <a name="realtime_actions" id="realtime_actions">Real-Time Actions</a></h3>
    <p>The &lt;rtt&gt; element is used to transmit a series of one or more real-time actions, including edit actions and presentation actions.</p>
    <p>Most chat clients allow a sender to edit their message before sending (i.e. via a Send button, or hitting Enter). The inclusion of real-time functionality to existing chat client software must not degrade the sender's existing expectation of being able to edit their messages before sending. Thus, in a real-time chat session, the recipient can watch the sender compose and edit their message before it is delivered.</p>
    <p>Edit actions include typing of text, backspacing, and blocks of text being inserted or deleted. In addition, a real-time chat session may also include presentation actions, including:</p>
    <ul>
      <li>Key press intervals, to smooth the flow of real-time text independently of the transmission interval;</li>
      <li>Cursor movements, to make it easier for the recipient to watch edits being made by the sender;</li>
      <li>Visual flash (beep) to allow the sender to catch the attention of the recipient.</li>
    </ul>
    <p>Each real-time action is represented by an <span class="em"><span class="strong">action element</span></span><span class="em">.</span> Examples can be found in <a href="#use_cases">Use Cases</a>.</p>
        <div class="indent"><h3>4.5.1 <a name="summary_of_action_elements" id="summary_of_action_elements">Summary of Action Elements</a></h3>
    <p>The following is a short summary. For more detailed information, see <a href="#action_elements">Action Elements</a>.</p>
        <div class="indent"><h3>4.5.1.1 <a name="edit_actions_tier_1" id="edit_actions_tier_1">Edit Actions (Tier 1)</a></h3>
        <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: </p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th>Action</th>
            <th>Element</th>
            <th>Description</th>
          </tr>
          <tr class="body">
            <td>Insert Text</td>
            <td>&lt;t ='#'&gt;text&lt;/t&gt;</td>
            <td>REQUIRED. Insert specified <span class="em"><span class="strong">text</span></span> at position <span class="em"><span class="strong">p</span></span> in message.</td>
          </tr>
          <tr class="body">
            <td>Backspace</td>
            <td>&lt;e p='#' n='#'/&gt;</td>
            <td>REQUIRED. Remove <span class="em"><span class="strong">n</span></span> characters to the left of position <span class="em"><span class="strong">p</span></span> in message<span class="em">.</span></td>
          </tr>
          <tr class="body">
            <td>Forward Delete</td>
            <td>&lt;d p='#' n='#'/&gt;</td>
            <td>REQUIRED. Remove <span class="em"><span class="strong">n</span></span> characters starting at position <span class="em"><span class="strong">p</span></span> in message<span class="em">.</span></td>
          </tr>
        </table></div>
    </div>
    <div class="indent"><h3>4.5.1.2 <a name="presentation_actions_tier_2" id="presentation_actions_tier_2">Presentation Actions (Tier 2)</a></h3>
        <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: </p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th>Action</th>
            <th>Element</th>
            <th>Description</th>
          </tr>
          <tr class="body">
            <td>Interval</td>
            <td>&lt;w n='#'/&gt;</td>
            <td>RECOMMENDED. Execute a pause of <span class="em"><span class="strong">n</span></span> thousandths of a second.</td>
          </tr>
          <tr class="body">
            <td>Cursor Position</td>
            <td>&lt;c p='#'/&gt;</td>
            <td>OPTIONAL. Move cursor to position <span class="em"><span class="strong">p</span></span> in message.</td>
          </tr>
          <tr class="body">
            <td>Flash</td>
            <td>&lt;g/&gt;</td>
            <td>OPTIONAL. Execute a visual flash, beep, or buzz.</td>
          </tr>
        </table></div>
    </div>
    <div class="indent"><h3>4.5.1.3 <a name="rules_for_attribute_values" id="rules_for_attribute_values">Rules for Attribute Values</a></h3>
    <ul>
      <li>The <span class="em"><span class="strong">n</span></span> and <span class="em"><span class="strong">p</span></span> attributes are unsigned 32-bit integers, represented as a string.</li>
      <li>If the <span class="em"><span class="strong">n</span></span> attribute is omitted, the default value for <span class="em"><span class="strong">n</span></span> is 1.</li>
      <li>If the <span class="em"><span class="strong">p</span></span> attribute is omitted, the default value for <span class="em"><span class="strong">p</span></span> is the length of the current real-time message.</li>
      <li>A <span class="em"><span class="strong">p</span></span> value of 0 represents the start of the message.</li>
      <li><span class="em"><span class="strong">n</span></span> and <span class="em"><span class="strong">p</span></span> values are counts of individual Unicode code points.</li>
    </ul>
    <p>For interoperability of <span class="em"><span class="strong">p</span></span> and <span class="em"><span class="strong">n</span></span> values, processing MUST be done on the original Unicode real-time message. For both senders and receivers, this is the version of the Unicode message text without Unicode normalization, emoticon graphics images, display text formatting, processing of Unicode combining marks, etc. For recipients obtaining text from the &lt;t&gt; element, this is the Unicode text immediately after XML processing, and before any further processing. From the perspective of <span class="em"><span class="strong">p</span></span> and <span class="em"><span class="strong">n</span></span> values, a real-time message is treated as an editable array of Unicode code points.</p>
    <p>Regardless of the original format of line breaks during XMPP transmission, line breaks are treated as a single code unit (LINE FEED U+000A) for the purposes of real-time message processing. Conversion of line breaks into a single U+000A character is REQUIRED for XML processors, according to section 2.11 of <span class="ref"><span class="strong"><a href="http://www.w3.org/TR/xml/">XML</a></span></span>  [<a href="#nt-id229420">7</a>], so a compliant XML processor already do this automatically, and already provide the correct original Unicode text for interoperability.</p>
    <p><span class="strong">NOTE WELL</span>: Extreme care MUST be taken to correctly calculate n and p values based on Unicode code points, to avoid corruption of the real-time message during real-time editing. For more information, see <a href="#internationalization_considerations">Internationalization Considerations</a>.</p>
    </div>
</div>
    <div class="indent"><h3>4.5.2 <a name="action_elements" id="action_elements">Action Elements</a></h3>
        <div class="indent"><h3>4.5.2.1 <a name="element_t_insert_text" id="element_t_insert_text">Element &lt;t&gt; – Insert Text</a></h3>
    <p>(Tier 1) REQUIRED. Supports the transmission of key presses, text block inserts, and text being pasted.<br />
    <span class="em">Note:</span> <span class="em">Any text permitted in the &lt;body&gt; element of a &lt;message&gt; may be used, subject to the rules in XMPP Core. More examples can be found in <a href="#use_cases">Use Cases</a>.</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;t p='#'&gt;text&lt;/t&gt;</pre></div></p>
    <p>Inserts specified <span class="em"><span class="strong">text</span></span> at position <span class="em"><span class="strong">p</span></span> in the message text.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;t&gt;text&lt;/t&gt;</pre></div></p>
    <p>Appends specified <span class="em"><span class="strong">text</span></span> at the end of message. (<span class="em"><span class="strong">p</span></span> defaults to message length)</p>
    </div>
    <div class="indent"><h3>4.5.2.2 <a name="element_e_backspace" id="element_e_backspace">Element &lt;e&gt; – Backspace</a></h3>
    <p>(Tier 1) REQUIRED. Supports the behavior of Backspace key presses.<br />
    <span class="em">Note: Direction 'left' represents the numeric direction. Thus, for right-to-left text (i.e. Arabic), numeric 'left' represents visible 'right'.</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;e n='#' p='#'/&gt;</pre></div></p>
    <p>Remove <span class="em"><span class="strong">n</span></span> characters to the left of position <span class="em"><span class="strong">p</span></span> in message.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;e p='#'/&gt;</pre></div></p>
    <p>Remove 1 character to the left of position <span class="em"><span class="strong">p</span></span> in message. (<span class="em"><span class="strong">n</span></span> defaults to 1)</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;e n='#'/&gt;</pre></div></p>
    <p>Remove <span class="em"><span class="strong">n</span></span> characters from end of message. (<span class="em"><span class="strong">p</span></span> defaults to message length)</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;e/&gt;</pre></div></p>
    <p>Remove 1 character from end of message. (Both <span class="em"><span class="strong">n</span></span> and <span class="em"><span class="strong">p</span></span> at default values)</p>
    </div>
    <div class="indent"><h3>4.5.2.3 <a name="element_d_forward_delete" id="element_d_forward_delete">Element &lt;d&gt; – Forward Delete</a></h3>
    <p>(Tier 1) REQUIRED. Supports the behavior of Delete key presses, text block deletes, and text being cut.<br />
    <span class="em">Note: Direction 'right' represents the numeric direction. Thus, for right-to-left text (i.e. Arabic), numeric 'right' represents visible 'left'.</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;d p='#' n='#'/&gt;</pre></div></p>
    <p>Remove <span class="em"><span class="strong">n</span></span> characters to the right of position <span class="em"><span class="strong">p</span></span> in message.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;d p='#'/&gt;</pre></div></p>
    <p>Remove 1 character to the right of position <span class="em"><span class="strong">p</span></span> in message. (<span class="em"><span class="strong">n</span></span> defaults to 1)</p>
    </div>
    <div class="indent"><h3>4.5.2.4 <a name="element_w_interval" id="element_w_interval">Element &lt;w&gt; – Interval</a></h3>
    <p>(Tier 2) RECOMMENDED. Allows the transmission of the original intervals between real-time actions, including the pauses between key presses. For more information, see <a href="#key_press_intervals">Key Press Intervals</a>.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;w n='#'/&gt;</pre></div></p>
    <p>Executes a pause of <span class="em"><span class="strong">n</span></span> thousandths of a second. The <span class="em"><span class="strong">n</span></span> value SHOULD NOT exceed the <a href="#transmission_interval">Transmission Interval</a>. Also, if a <a href="#body_element">Body Element</a> arrives, pauses SHOULD be interrupted to prevent message delivery delay.</p>
    </div>
    <div class="indent"><h3>4.5.2.5 <a name="element_c_cursor_position" id="element_c_cursor_position">Element &lt;c&gt; – Cursor Position</a></h3>
    <p>(Tier 2) OPTIONAL. Allows the transmission of cursor positions. This allows the recipient to see the sender's cursor in their real-time message, and makes it easier to track the sender's message edits. For more information, see <a href="#remote_cursor">Remote Cursor</a>.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;c p='#'/&gt;</pre></div></p>
    <p>Moves cursor (caret) to the character position <span class="em"><span class="strong">p</span></span> in message.</p>
    </div>
    <div class="indent"><h3>4.5.2.6 <a name="element_g_flash" id="element_g_flash">Element &lt;g&gt; – Flash</a></h3>
    <p>(Tier 2) OPTIONAL. Allows a flash/beep/buzz feature. This feature is the real-time version of <span class="ref"><a href="http://xmpp.org/extensions/xep-0224.html">Attention</a></span>  [<a href="#nt-id237419">8</a>], and MAY execute the same alerting method.<br />
    <span class="em">Note: This supports real-time text interoperability with similar features in text telephones for the deaf (TTY / TDD), ITU-T T.140 implementations, and Control-G beep at consoles.</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;g/&gt;</pre></div></p>
    <p>Executes a brief flash, sound, vibration, etc.</p>
    </div>
</div>
    <div class="indent"><h3>4.5.3 <a name="processing_rules" id="processing_rules">Processing Rules</a></h3>
    <ul>
      <li>There MUST not be more than one &lt;rtt&gt; child element per &lt;message&gt;.</li>
      <li>The &lt;rtt&gt; element MAY be an empty element, or contain one or more action elements.</li>
      <li>Action elements MUST be immediate children of &lt;rtt&gt;. Nesting is not allowed.</li>
      <li>Support of all Tier 1 edit actions is REQUIRED.</li>
      <li>Tier 2 presentation actions MUST NOT affect the contents of the real-time message string.</li>
      <li>Excess Backspaces and Forward Deletes beyond start/end of the message, MUST be ignored.</li>
      <li>Recipients MUST process supported action elements in the same order as received within the &lt;rtt&gt; element. Unrecognized action elements MUST be ignored.</li>
      <li>Real-time actions work only within the boundaries of the current real-time message, and MUST NOT affect previous messages.</li>
      <li>Values for <span class="em"><span class="strong">p</span></span> and <span class="em"><span class="strong">n</span></span> attributes MUST be calculated according to <a href="#rules_for_attribute_values">Rules for Attribute Values</a>.</li>
    </ul>
    </div>
</div>
    <div class="indent"><h3>4.6 <a name="error_recovery_of_realtime_text" id="error_recovery_of_realtime_text">Error Recovery of Real-Time Text</a></h3>
    <p>In a real-time chat session, it is critical that the real-time message is identical on both the sender and recipient ends. The loss of a single &lt;rtt&gt; transmission can represent missing text, or a missing edit. This leads to the real-time message getting out of sync, the message becoming different on the sender versus the recipient ends.</p>
    <p>Transmissions of &lt;message&gt; elements may be lost for several reasons. One reason is that a recipient may disconnect and reconnect while a sender is still typing a message. Another reason is some XMPP servers may drop &lt;message&gt; elements automatically (i.e. flooding protection).</p>
        <div class="indent"><h3>4.6.1 <a name="staying_in_sync" id="staying_in_sync">Staying In Sync</a></h3>
    <p>To stay synchronized:</p>
    <ol>
      <li>The sender MUST increment the <span class="strong">seq</span> attribute for each consecutive &lt;rtt&gt; element sent.</li>
      <li>The recipients MUST monitor the <span class="strong">seq</span> attribute value of received &lt;rtt&gt; elements, to verify that it is incrementing.</li>
      <li>The seq values for the sender, and for the recipient, are independent and kept track of separately.</li>
    </ol>
    </div>
    <div class="indent"><h3>4.6.2 <a name="detecting_loss_of_sync" id="detecting_loss_of_sync">Detecting Loss of Sync</a></h3>
    <p>The sync is considered lost if the <span class="strong">seq</span> attribute of the &lt;rtt&gt; element does not increment as expected. Trying to process certain real-time edit actions after loss of sync, will result in scrambled text. Therefore, to avoid this situation:</p>
    <ol>
      <li>The recipient MUST stop processing all subsequent real-time action elements, and freeze the current real-time message.</li>
      <li>An indicator (i.e. reception bars, color code, missing text indicator) or a chat state message (i.e. “Typing Frozen...”) MAY be used by the recipient to indicate the loss of sync.</li>
    </ol>
    </div>
    <div class="indent"><h3>4.6.3 <a name="recovery_from_loss_of_sync" id="recovery_from_loss_of_sync">Recovery From Loss of Sync</a></h3>
    <p>Recovery occurs when any of the following happens:</p>
    <ol>
      <li>A message &lt;body&gt; is delivered. The frozen real-time message MUST be replaced with this delivered message.</li>
      <li>The <span class="strong">event</span> attribute of &lt;rtt&gt; has a value of <span class="strong">new</span> or <span class="strong">reset</span>. Processing of real-time text MUST resume, with the new correct <span class="strong">seq</span> value obtained from this &lt;rtt&gt; element.</li>
    </ol>
    </div>
    <div class="indent"><h3>4.6.4 <a name="helping_the_recipient_stay_in_sync" id="helping_the_recipient_stay_in_sync">Helping The Recipient Stay In Sync</a></h3>
    <p>The sender MAY help the recipient stay in sync by automatically retransmitting the real-time message whenever the recipient status changes from offline to online. The entire contents of the real-time message, may be retransmitted using the &lt;rtt&gt; attribute <span class="strong">event='reset'</span> with a single Insert Text action.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;rtt event='reset' seq='#'&gt;
  &lt;t&gt;This is a retransmission of the entire real-time message.&lt;/t&gt;
&lt;/rtt&gt;</pre></div></p>
    </div>
</div>
<h2>5.
       <a name="determining_support" id="determining_support">Determining Support</a></h2>
    <p>If a client supports the Real Time Text protocol, it MUST advertise that fact in its responses via <span class="ref"><a href="http://xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id237681">9</a>] information ("disco#info") requests by returning a feature of <span class="strong">urn:xmpp:rtt:0</span></p>
    <p><span class="strong">Example 1. A disco#info query</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;iq from='romeo@montague.lit/orchard'
    id='disco1'
    to='juliet@capulet.lit/balcony'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

</pre></div></p>
    <p><span class="strong">Example 2. A disco#info response</span></p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;iq from='juliet@capulet.lit/balcony'
    id='disco1'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:rtt:0'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;

</pre></div></p>
    <p>If this successful response of <span class="strong">&lt;feature var='urn:xmpp:rtt:0'/&gt;</span> is not received, the client SHOULD NOT transmit any outgoing &lt;rtt&gt; elements in &lt;message&gt; transmissions. This avoids unnecessary consumption of bandwidth to clients that do not support this protocol.</p>
    <h2>6.
       <a name="implementation_notes" id="implementation_notes">Implementation Notes</a></h2>
        <div class="indent"><h3>6.1 <a name="key_press_intervals" id="key_press_intervals">Key Press Intervals</a></h3>
        <div class="indent"><h3>6.1.1 <a name="avoid_bursty_text_presentation" id="avoid_bursty_text_presentation">Avoid Bursty Text Presentation</a></h3>
    <p>To prevent flooding the public XMPP network, transmissions of messages containing real-time text is rate-limited to the recommended &lt;rtt&gt; message transmission interval, usually 1 second according to <a href="#transmission_interval">Transmission Interval</a>. If the display of text is not smoothed, text will appear in intermittent bursts. This hurts usability of real-time text.</p>
    </div>
    <div class="indent"><h3>6.1.2 <a name="preserving_key_press_intervals" id="preserving_key_press_intervals">Preserving Key Press Intervals</a></h3>
    <p>Through the use of the RECOMMENDED <a href="#element_w_interval">Element &lt;w&gt; – Interval</a>, the original look-and-feel of typing can be preserved, despite the long transmission interval. Using the &lt;w&gt; element, the sender can record multiple key presses including key press intervals, and transmit them over the XMPP network in a single &lt;message&gt;. The recipient can then play back the sender's typing in real-time at original typing speed including the intervals between key presses. The text is displayed exactly as it was typed.</p>
    <p>Much like VoIP is a packetization of sound, this spec enables packetization of typing including the original key press intervals. This enables the real-time feel of typing over virtually any Internet connection, and without requiring shorter transmission intervals. Look and feel of typing is also preserved over polled XMPP including <span class="ref"><a href="http://xmpp.org/extensions/xep-0206.html">XMPP Over BOSH</a></span>  [<a href="#nt-id237796">10</a>], as well as over satellite and long international connections with heavy packet-bursting tendencies and variable latencies.</p>
    <p>The recipient can watch the sender fluidly compose/edit their message in real-time without any “bursting” effects. This is “Natural Typing”, and appears indistinguishable from local typing. Since all key press intervals are preserved at a high precision, all subtleties of typing are preserved, including the 'mood' (calm typing versus panicked or emphatic typing, etc).</p>
    <p>For an example transmission of key intervals, see <a href="#real_world_message_with_key_press_intervals">Real World Message With Key Press Intervals</a>.</p>
    </div>
</div>
    <div class="indent"><h3>6.2 <a name="realtime_transmission" id="realtime_transmission">Real-time Transmission</a></h3>
        <div class="indent"><h3>6.2.1 <a name="monitoring_message_edits" id="monitoring_message_edits">Monitoring Message Edits</a></h3>
    <p>For sending clients, there are several methods of capturing typing and message edits, in order to generate action elements for an &lt;rtt&gt; transmission. The most reliable and practical method is to monitor the <span class="strong">text change event</span> of a text box field (rather than monitoring key press events) since:</p>
    <ul>
      <li>it captures all typing, including edits and deletes.</li>
      <li>it captures cut &amp; paste operations, as well as edits made via a pointing device.</li>
      <li>it captures automatic text changes, such as done by spell checker, macros, assistive devices, etc.</li>
      <li>it captures accented characters, Chinese, Arabic and other characters that require multiple key presses to compose.</li>
      <li>it makes no assumptions about different keyboards or input entry methods.</li>
      <li>text change events are more cross-platform portable, including on mobile phones.</li>
    </ul>
    <p>In the text change event, the current message string can be compared to the previous message string in order to calculate what text changes took place. For more information, see <a href="#rules_for_attribute_values">Rules for Attribute Values</a>. The appropriate action elements are then generated, to represent text insertions and deletions. The key press interval can be measured as the time elapsed in milliseconds between text change events.</p>
    </div>
    <div class="indent"><h3>6.2.2 <a name="guidelines_for_senders" id="guidelines_for_senders">Guidelines for Senders</a></h3>
    <ul>
      <li><p>Monitor typing via the technique in <a href="#monitoring_message_edits">Monitoring Message Edits</a> to generate action elements, and add these action elements to a buffer. This is equivalent to recording a small sequence of typing.</p></li>
      <li><p>During every <a href="#transmission_interval">Transmission Interval</a>, all buffered action elements are transmitted in &lt;rtt&gt; element of a &lt;message&gt;. This is equivalent to transmitting a small sequence of typing at a time.</p></li>
      <li><p>If there are no changes to the real-time message, and no cursor movements, no unnecessary &lt;rtt&gt; transmission takes place.</p></li>
    </ul>
    </div>
    <div class="indent"><h3>6.2.3 <a name="guidelines_for_receivers" id="guidelines_for_receivers">Guidelines for Receivers</a></h3>
    <ul>
      <li><p>Upon receipt of a &lt;message&gt; containing an &lt;rtt&gt; element, the action elements in &lt;rtt&gt; should be added to a queue, in the order that they are received. This provides immunity to variable network conditions, since the buffering action smooths out the latency fluctuations of &lt;message&gt; delivery.</p></li>
      <li><p>The recipient software should interpret the action elements in the playback queue in sequential order, including &lt;w&gt; elements (intervals), into a real-time message. This is equivalent to playing back the sender's original typing, including key press intervals.</p></li>
      <li><p>Processing of intervals (&lt;w&gt; elements) SHOULD be done via non-blocking programming techniques.</p></li>
      <li><p>Upon receiving a &lt;message&gt; containing &lt;body&gt; indicating a completed message, the full message SHOULD be displayed immediately in place of the real-time message, and unprocessed action elements cleared from the playback queue. This ensures final message delivery is not delayed by late processing of action elements.</p></li>
      <li><p>If support for the &lt;w&gt; element is not possible, receiving software SHOULD use an alternate text-smoothing method, such as time-smoothed progressive output of received text.</p></li>
    </ul>
    </div>
</div>
    <div class="indent"><h3>6.3 <a name="remote_cursor" id="remote_cursor">Remote Cursor</a></h3>
    <p>Senders MAY choose to transmit changes to cursor positions. Recipient clients MAY choose to display a cursor (or caret) within incoming real-time messages. This enhances usability of real-time text further, since it becomes easier for a recipient to observe the sender's real-time message edits.</p>
        <div class="indent"><h3>6.3.1 <a name="calculating_cursor_position" id="calculating_cursor_position">Calculating Cursor Position</a></h3>
    <p>The &lt;c&gt; element (Cursor Position) MAY be used to specify an exact cursor position, as a zero-based index into the real-time message string. While between &lt;c&gt; elements, the current cursor position MAY be calculated from the last edit action element as follows:</p>
    <ul>
      <li>For &lt;t&gt; element (Insert Text), the cursor position is moved to the end of the inserted text.</li>
      <li>For &lt;e&gt; element (Backspace), the cursor position is moved left as text is deleted.</li>
      <li>For &lt;d&gt; element (Forward Delete) and all other action elements, the cursor position is unaffected.</li>
      <li>The current cursor position does not affect the behavior of subsequent edit elements.</li>
    </ul>
    </div>
    <div class="indent"><h3>6.3.2 <a name="_guidelines_for_senders" id="_guidelines_for_senders">Guidelines for Senders</a></h3>
    <p>The sender MAY choose to transmit cursor positions via &lt;c&gt; elements, only whenever the actual cursor position is different from the calculated position according to <a href="#calculating_cursor_position">Calculating Cursor Position</a> above.</p>
    <p>Monitoring the actual cursor position may need to be done via a “selection changed” event of a text box field in many programming platforms. This event typically monitors the start/end indexes of a text marking operation, and usually doubles as the event for monitoring the cursor position. In this case, the start index should be used, since the transmission of the visual appearance of text marking operations is not supported in this current specification.</p>
    </div>
    <div class="indent"><h3>6.3.3 <a name="_guidelines_for_receivers" id="_guidelines_for_receivers">Guidelines for Receivers</a></h3>
    <p>Recipient software MAY choose to display a remote cursor within received real-time messages. The remote cursor SHOULD be clearly distinguishable from the sender's local cursor. One example is to use a non-blinking cursor, easily emulated with the vertical bar character '|'.</p>
    <p>While waiting for the next &lt;c&gt; element (if any), the cursor position MAY be calculated from the last edit action element according to <a href="#calculating_cursor_position">Calculating Cursor Position</a>.</p>
    </div>
</div>
    <div class="indent"><h3>6.4 <a name="other_guidelines" id="other_guidelines">Other Guidelines</a></h3>
    <p><a href=""></a>There are other special basic considerations for real-time message transmissions that need to be considered by implementors.</p>
        <div class="indent"><h3>6.4.1 <a name="message_length_limit" id="message_length_limit">Message Length Limit</a></h3>
    <p>A large sequence of rapid message changes may generate a large series of action elements in an &lt;rtt&gt; element, resulting in the &lt;message&gt; exceeding the XMPP server's maximum allowed length of a &lt;message&gt; stanza. This may result in dropped messages. It is acceptable to simply retransmit the whole real-time message using &lt;rtt event='reset'&gt; if the length of the &lt;rtt&gt; element would otherwise exceed the application's maximum chat message length. The process of retransmitting the whole real-time message, has the disadvantage of discarding <a href="#key_press_intervals">Key Press Intervals</a> for one &lt;rtt&gt; element.</p>
    <p>For long messages, the final &lt;rtt&gt; transmission may be made in a separate &lt;message&gt; than the &lt;message&gt; containing the &lt;body&gt;. For example:</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='dda'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='95'&gt;
    &lt;t&gt;Hello World...In a Super Long Message! [etc]&lt;/t&gt;
  &lt;/rtt&gt;
  &lt;body&gt;Hello World...In a Super Long Message! [etc]&lt;/body&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>The message MAY be split into two separate message transmissions:</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='dda'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='95'&gt;
    &lt;t&gt;Hello World...In a Super Long Message! [etc]&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='ddb'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='96' /&gt;
  &lt;body&gt;Hello World...In a Super Long Message! [etc]&lt;/body&gt;
&lt;/message&gt;</pre></div></p>
    </div>
    <div class="indent"><h3>6.4.2 <a name="performance" id="performance">Performance</a></h3>
    <p>The user interface display of the real-time text output, is usually the main performance bottleneck. Care should be taken not to do inefficient entire-screen repainting during every single key press, since fast typists may type over 10 key presses per second. This is especially important for slower platforms. To improve performance, the display of real-time messages may need to be implemented as a separate display element, rather than as a string concatenated to the current message history, so that the display can efficiently be refreshed every key press.</p>
    </div>
    <div class="indent"><h3>6.4.3 <a name="battery_life" id="battery_life">Battery Life</a></h3>
    <p>Battery life considerations are closely related to Performance. The addition of real-time text to a mobile device, will typically significantly impact battery life due mostly to more frequent screen refreshes. The specific implementation of interval action elements (play back of key press intervals) may play a factor, and this should be programmed efficiently. Also, in cases where screen updates are the primary inefficient bottleneck on a specific mobile device, and the code cannot be sufficiently optimized, the number of repaints per second may need to be throttled in order to prolong battery life, at the slight expense of the look-and-feel of typing transmissions. Also see <span class="ref"><a href="http://xmpp.org/extensions/xep-0286.html">XMPP on Mobile Devices</a></span>  [<a href="#nt-id238189">11</a>].</p>
    </div>
</div>
<h2>7.
       <a name="use_cases" id="use_cases">Use Cases</a></h2>
    <p>The first examples are deliberately kept simple instead of real-world, and are designed to educate in a progressively more difficult manner. For simplicity, most examples do not include the RECOMMENDED <a href="#key_press_intervals">Key Press Intervals</a> except for the last Use Case example. For real-world communications in software implementations supporting key press intervals, most transmissions will tend to resemble the last Use Case example, <a href="#real_world_message_with_key_press_intervals">Real World Message With Key Press Intervals</a>.</p>
        <div class="indent"><h3>7.1 <a name="three_backspaces" id="three_backspaces">Three Backspaces</a></h3>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' id='a01' type='chat'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello bcak&lt;/t&gt;&lt;e/&gt;&lt;e/&gt;&lt;e/&gt;&lt;t&gt;ack&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello back"<br />
    This code sends the misspelled "Hello bcak", then &lt;e/&gt;&lt;e/&gt;&lt;e/&gt; backspaces 3 times, then sends "ack".</p>
    </div>
    <div class="indent"><h3>7.2 <a name="three_backspaces_in_one_action_element" id="three_backspaces_in_one_action_element">Three Backspaces In One Action Element</a></h3>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello bcak&lt;/t&gt;&lt;e n='3'/&gt;&lt;t&gt;ack&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello back"<br />
    This code is the same as the previous example, demonstrating that &lt;e n='3'/&gt; does the same thing as &lt;e/&gt;&lt;e/&gt;&lt;e/&gt;.</p>
    </div>
    <div class="indent"><h3>7.3 <a name="message_edits_split_into_multiple_transmissions" id="message_edits_split_into_multiple_transmissions">Message Edits Split Into Multiple Transmissions</a></h3>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='b02'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='1'&gt;
    &lt;t&gt; bcak&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='c03'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='2'&gt;
    &lt;e n='3'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='d04'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='3'&gt;
    &lt;t&gt;ack&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello back"<br />
    This code results in the same final text as the previous two examples, segmented into four separate messages.</p>
    </div>
    <div class="indent"><h3>7.4 <a name="deleting_text_from_message" id="deleting_text_from_message">Deleting Text From Message</a></h3>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello Bob, this is Alice!&lt;/t&gt;&lt;d n='4' p='5'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello, this is Alice!"<br />
    This code outputs "Hello Bob, this is Alice!" then &lt;d n='4' p='5'/&gt; deletes 4 characters from position 5.<br />
    (This erases the text " Bob" including the preceding space character).</p>
    </div>
    <div class="indent"><h3>7.5 <a name="inserting_text_into_message" id="inserting_text_into_message">Inserting Text Into Message</a></h3>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello, this is Alice!&lt;/t&gt;&lt;t p='5'&gt; Bob&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello Bob, this is Alice!"<br />
    This is because the code outputs "Hello, this is Alice!" then the &lt;t p='5'&gt; inserts the specified text " Bob" at position 5.</p>
    </div>
    <div class="indent"><h3>7.6 <a name="deleting_and_replacing_text_in_message" id="deleting_and_replacing_text_in_message">Deleting And Replacing Text In Message</a></h3>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello Bob, tihsd is Alice!&lt;/t&gt;
    &lt;d p='11' n='5'/&gt;
    &lt;t p='11'&gt;this&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello Bob, this is Alice!"<br />
    This code outputs "Hello Bob, tihsd is Alice!", then &lt;d p='11' n='5'/&gt; deletes 5 characters at position 11 in the string of text. (erases the mistyped word "tihsd"). Finally, &lt;t p='11'&gt;this&lt;/t&gt; inserts the text "this" place of the original misspelled word.</p>
    </div>
    <div class="indent"><h3>7.7 <a name="multiple_message_edits" id="multiple_message_edits">Multiple Message Edits</a></h3>
    <p>This is an example message containing multiple consecutive edit actions.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Helo&lt;/t&gt;
    &lt;e/&gt;
    &lt;t&gt;lo...planet&lt;/t&gt;
    &lt;e n='6'/&gt;
    &lt;t&gt; World&lt;/t&gt;
    &lt;d n='3' p='5'/&gt;
    &lt;t p='5'&gt; there,&lt;/t&gt;
    &lt;c p='18'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>Resulting real-time message: "Hello there, World", completed in the following series of steps:</p>
        <div class="indent"><p class="caption"><a name="table-3" id="table-3"></a>Table 3: </p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th>Element</th>
            <th>Action</th>
            <th>Real -Time Message</th>
            <th>Cursor Pos</th>
          </tr>
          <tr class="body">
            <td>&lt;t&gt;Helo&lt;/t&gt;</td>
            <td>Output "Helo"</td>
            <td>Helo</td>
            <td>4</td>
          </tr>
          <tr class="body">
            <td>&lt;e/&gt;</td>
            <td>Backspace 1 character from end of line.</td>
            <td>Hel</td>
            <td>3</td>
          </tr>
          <tr class="body">
            <td>&lt;t&gt;lo...planet&lt;/t&gt;</td>
            <td>Output "lo...planet"</td>
            <td>Hello...planet</td>
            <td>14</td>
          </tr>
          <tr class="body">
            <td>&lt;e n='6'/&gt;</td>
            <td>Backspace 6 characters from end of line</td>
            <td>Hello...</td>
            <td>8</td>
          </tr>
          <tr class="body">
            <td>&lt;t&gt; World&lt;/t&gt;</td>
            <td>Output " World"</td>
            <td>Hello... World</td>
            <td>14</td>
          </tr>
          <tr class="body">
            <td>&lt;d n='3' p='5'/&gt;</td>
            <td>Delete 3 characters at position 5</td>
            <td>Hello World</td>
            <td>5</td>
          </tr>
          <tr class="body">
            <td>&lt;t p='5'&gt; there,&lt;/t&gt;</td>
            <td>Output " there," at position 5</td>
            <td>Hello there, World</td>
            <td>12</td>
          </tr>
          <tr class="body">
            <td>&lt;c p='18'/&gt;</td>
            <td>Move cursor to end</td>
            <td>Hello there, World</td>
            <td>18</td>
          </tr>
        </table></div>
    <p>Normally, the action elements are split into multiple separate transmissions, with <a href="#key_press_intervals">Key Press Intervals</a> added.</p>
    </div>
    <div class="indent"><h3>7.8 <a name="three_consecutive_messages" id="three_consecutive_messages">Three Consecutive Messages</a></h3>
    <p>Representing a short chat session of three separate messages:<br />
    Bob says: "Hello Alice"<br />
    Bob says: "This is Bob"<br />
    Bob says: "How are you?"</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;Hello&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='b02'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='1'&gt;
    &lt;t&gt; Alice&lt;/t&gt;
  &lt;/rtt&gt;
  &lt;body&gt;Hello Alice&lt;/body&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='c03'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='2' event='new'&gt;
    &lt;t&gt;This i&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='d04'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='3'&gt;
    &lt;t&gt;s Bob&lt;/t&gt;
  &lt;/rtt&gt;
  &lt;body&gt;This is Bob&lt;/body&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='e05'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='4' event='new'&gt;
    &lt;t&gt;How a&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='f06'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='5'&gt;
    &lt;t&gt;re yo&lt;/t&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='alice@example.com' from='bob@example.com/home' type='chat' id='g07'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='6'&gt;
    &lt;t&gt;u?&lt;/t&gt;
  &lt;/rtt&gt;
  &lt;body&gt;How are you?&lt;/body&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>This example also illustrates the following:</p>
    <ul>
      <li>The <span class="strong">type</span> attribute equals 'new' for the start of every new message.</li>
      <li>The <span class="strong">seq</span> attribute always increments.</li>
    </ul>
    </div>
    <div class="indent"><h3>7.9 <a name="real_world_message_with_key_press_intervals" id="real_world_message_with_key_press_intervals">Real World Message With Key Press Intervals</a></h3>
    <p>This is the most important example. It is a transmission of “Hello there!” with <a href="#key_press_intervals">Key Press Intervals</a>. It illustrates a four-second typing sequence:</p>
    <ul>
      <li>The misspelled phrase “Hello tehre!” is typed;</li>
      <li>Three cursor-left movements back to the mis-typed letters;</li>
      <li>Two backspaces to delete the two mis-typed letters;</li>
      <li>Two correct key presses to correctly spell the word “there”.</li>
    </ul>
    <p>In between each key press, is <a href="#element_w_interval">Element &lt;w&gt; – Interval</a> to allow the receiving client execute a small pause between action elements, which allows the play back of the typing at its original look-and-feel.</p>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='a01'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='0' event='new'&gt;
    &lt;t&gt;H&lt;/t&gt;
    &lt;w n='215'/&gt;&lt;t&gt;e&lt;/t&gt;
    &lt;w n='154'/&gt;&lt;t&gt;l&lt;/t&gt;
    &lt;w n='251'/&gt;&lt;t&gt;l&lt;/t&gt;
    &lt;w n='115'/&gt;&lt;t&gt;o&lt;/t&gt;
    &lt;w n='265'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='b02'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='1'&gt;
    &lt;w n='40'/&gt;&lt;t&gt; &lt;/t&gt;
    &lt;w n='161'/&gt;&lt;t&gt;t&lt;/t&gt;
    &lt;w n='237'/&gt;&lt;t&gt;e&lt;/t&gt;
    &lt;w n='135'/&gt;&lt;t&gt;h&lt;/t&gt;
    &lt;w n='234'/&gt;&lt;t&gt;r&lt;/t&gt;
    &lt;w n='193'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='c03'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='2'&gt;
    &lt;w n='109'/&gt;&lt;t&gt;e&lt;/t&gt;
    &lt;w n='215'/&gt;&lt;t&gt;!&lt;/t&gt;
    &lt;w n='530'/&gt;&lt;c p='11'/&gt;
    &lt;w n='108'/&gt;&lt;c p='10'/&gt;
    &lt;w n='38'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='d04'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='3'&gt;
    &lt;w n='109'/&gt;&lt;c p='9'&gt;
    &lt;w n='161'/&gt;&lt;e p='9'/&gt;
    &lt;w n='150'/&gt;&lt;e p='8'/&gt;
    &lt;w n='144'/&gt;&lt;t&gt;h&lt;/t&gt;
    &lt;w n='209'/&gt;&lt;t&gt;e&lt;/t&gt;
    &lt;w n='227'/&gt;
  &lt;/rtt&gt;
&lt;/message&gt;

&lt;message to='bob@example.com' from='alice@example.com/home' type='chat' id='d04'&gt;
  &lt;rtt xmlns='urn:xmpp:rtt:0' seq='4'&gt;
    &lt;w n='445'/&gt;&lt;c p='12'&gt;
  &lt;/rtt&gt;
  &lt;body&gt;Hello there!&lt;/body&gt;
&lt;/message&gt;</pre></div></p>
    


    <p>This real-world example also illustrate the following:</p>
    <ul>
      <li>Typing is done via <a href="#element_t_insert_text">Element &lt;t&gt; – Insert Text</a>.</li>
      <li>Cursor movements are done via <a href="#element_c_cursor_position">Element &lt;c&gt; – Cursor Position</a>.</li>
      <li>Backspaces are done via <a href="#element_e_backspace">Element &lt;e&gt; – Backspace</a>.</li>
      <li>Intervals between key presses are done via <a href="#element_w_interval">Element &lt;w&gt; – Interval</a>.</li>
      <li>Each &lt;message&gt; is delivered every one second, the default <a href="#transmission_interval">Transmission Interval</a>.</li>
      <li>To achieve the smoothest playback of typing, the total sum of all values in &lt;w&gt; elements in one &lt;message&gt; equal the <a href="#transmission_interval">Transmission Interval</a> during periods of continuous typing.</li>
      <li>Some &lt;w&gt; interval elements are split between consecutive messages, since key presses are not timed with transmission intervals.</li>
      <li>The &lt;w&gt; interval elements also apply to cursor movements of the <a href="#remote_cursor">Remote Cursor</a>.</li>
      <li>There is a final transmission with a <a href="#body_element">Body Element</a>, transmitted immediately when the message is finished.</li>
      <li>These action elements are generated automatically via <a href="#monitoring_message_edits">Monitoring Message Edits</a>.</li>
    </ul>
    </div>
<h2>8.
       <a name="interoperability_considerations" id="interoperability_considerations">Interoperability Considerations</a></h2>
    <p>There are other real-time text formats with interoperability considerations relating to the session setup level, the media transport level, and presentation level. For each environment where interoperability is supported, an interoperability specification should be documented that covers addressing, session control, media negotiation and media transcoding.</p>
        <div class="indent"><h3>8.1 <a name="rfc_4103_and_t140" id="rfc_4103_and_t140">RFC 4103 and T.140</a></h3>
    <p>One environment for such interoperability considerations is SIP with real-time text (also called Text over IP, or ToIP) as specified in ITU-T T.140 and IETF RFC 4103. One reason for its importance is that this protocol combination is specified by IETF and by regional emergency service organizations to be the protocols supported for IP based real-time emergency calls that support real-time text. Another reason is that SIP is the currently dominating peering protocol between services, and many implementations of real-time text in SIP exist.</p>
    <p>Interoperability implies addressing translation, media negotiation and translation, and media transcoding. For media transcoding between this specification and T.140/RFC 4103, the real-time text transcoding is straight forward, except the editing feature of this specification. Backwards positioning and insertion or deletion far back in the message can cause a large number of erase operations in T.140, that takes time and bandwidth to convey.</p>
    <p>It should be noted that T.140 specifies use of ISO 6429 control codes for presentation characteristics such as text color etc, that are not possible to represent in plain text according to this specification. All control codes from both sides that cannot be presented on the other side of the conversion, must be filtered off in order to not disturb the presentation of text.</p>
    <p>Note that a future version of this specification may support real-time transmission of XHTML-IM formatting, in order to support transcoding of ISO 6429 formatting codes.</p>
    </div>
    <div class="indent"><h3>8.2 <a name="combination_with_other_realtime_media" id="combination_with_other_realtime_media">Combination With Other Real-Time Media</a></h3>
    <p>In some cases, it may be beneficial in a real-time conversation situation to have simultaneous availability of multiple real-time media.</p>
    <p>In the XMPP session environment, the Jingle protocol (<span class="ref"><a href="http://xmpp.org/extensions/xep-0166.html">Jingle</a></span>  [<a href="#nt-id238832">12</a>]) is available for negotiation and transport of the more time-critical, real-time audio and video media. For clients that already support audio and/or video, it is RECOMMENDED to continue providing real-time text according to this specification, regardless of whether audio and/or video is negotiated.</p>
    <p>It is noted there is also another real-time text standard (RFC 4103, RFC 5194), used for SIP sessions with real-time text. In the situation where an implementor needs to decide which real-time text standard to use, it is generally recommended to use the real-time text specification of the specific session control standard in use for that particular session. This varies from implementation to implementation. For example, Google Talk network uses XMPP messaging for instant messages sent during audio/video conversations. Therefore, in this situation, it is recommended to use this XMPP extension document to add real-time text functionality. However, there are other situations where it is necessary to support multiple real-time-text standards, and to interoperate between the multiple real-time text standards. For more information, see the next section.</p>
        <div class="indent"><h3>8.2.1 <a name="total_conversation" id="total_conversation">Total Conversation</a></h3>
    <p>According to <span class="ref"><span class="strong"><a href="http://www.itu.int/rec/T-REC-F.703">ITU-T F.703</a></span></span>  [<a href="#nt-id238865">13</a>], "Total Conversation" defines the simultaneous use of audio, video, and real-time text. For convenience, some chat applications may be designed to have automatic negotiation of as many as possible of the three media preferred by the users.</p>
    </div>
</div>
<h2>9.
       <a name="internationalization_considerations" id="internationalization_considerations">Internationalization Considerations</a></h2>
    <p>There are special internationalization considerations involving real-time editing of international text, due to the character positioning and length values used by <a href="#action_elements">Action Elements</a>, in the form of <span class="em"><span class="strong">p</span></span> and <span class="em"><span class="strong">n</span></span> attributes. Different programming platforms use different internal Unicode encodings, which may be different from the transmission encoding (UTF-8) for XMPP. To achieve universally correct calculations for <span class="em"><span class="strong">p</span></span> and <span class="em"><span class="strong">n</span></span> attributes, consider these factors:</p>
    <ul>
      <li><p>Multiple Unicode code points may represent one displayable Unicode character (i.e. combining marks).<br />
        <span class="em">Action elements operate on Unicode code points</span><span class="em">, not on displayable characters.</span></p></li>
      <li><p>Characters U+10000 through U+1FFFF, which are single code points, but are represented as multiple surrogate code units in certain Unicode encodings (i.e. UTF-16).<br />
        <span class="em">Action elements operate on</span> <span class="em">Unicode</span> <span class="em">code points, not on individual surrogate code units.</span></p></li>
      <li><p>Some Unicode encodings use a variable number of bytes per Unicode code point (i.e. UTF-8).<br /><span class="em">Action elements operate on Unicode code points, not on individual bytes.</span></p></li>
    </ul>
    <p>Failure to correctly calculate <span class="em"><span class="strong">p</span></span> and <span class="em"><span class="strong">n</span></span> values by counting individual Unicode code points, will result in interoperability problems in the form of scrambled text during real-time editing. In some cases, this problem do not become visible until a chat session occurs in a different international language for the first time. It is critical to follow <a href="#rules_for_attribute_values">Rules for Attribute Values</a> in order to maintain world-wide interoperability of international text.</p>
    <h2>10.
       <a name="security_considerations" id="security_considerations">Security Considerations</a></h2>
        <div class="indent"><h3>10.1 <a name="privacy" id="privacy">Privacy</a></h3>
    <p>It is important for implementors of real-time text to educate users about real-time text. Users of real-time text should be aware that their typing in the local input buffer is now visible to everyone in the current chat conversation. This may have security implications if users copy &amp; paste private information into their chat entry buffer (i.e. a shopping invoice) before editing out the private parts of the pasted text (i.e. a credit card number) before they send the message. With real-time editing, recipients can watch all text changes that occur in the sender's text, before the sender sends the final message.</p>
    </div>
    <div class="indent"><h3>10.2 <a name="congestion_considerations" id="congestion_considerations">Congestion Considerations</a></h3>
    <p>The nature of real-time text result in more frequent transmission of &lt;message&gt; elements than may otherwise happen in a non-real-time text conversation. This may lead to increased network and server loading of XMPP networks. Care SHOULD to be taken to use a reasonable <a href="#transmission_interval">Transmission Interval</a>, and avoid transmitting messages at an excessive rate, to avoid creating unnecessary congestion on public XMPP networks. Also, see <span class="ref"><a href="http://xmpp.org/extensions/xep-0205.html">Best Practices to Discourage Denial of Service Attacks</a></span>  [<a href="#nt-id239054">14</a>].</p>
    <p>Network monitoring mechanisms (i.e. <span class="ref"><a href="http://xmpp.org/extensions/xep-0184.html">Message Delivery Receipts </a></span>  [<a href="#nt-id239084">15</a>] and/or <span class="ref"><a href="http://xmpp.org/extensions/xep-0199.html">XMPP Ping</a></span>  [<a href="#nt-id239106">16</a>], etc.) MAY be used to monitor reliability and latency, in order to temporarily adjust the interval to prevent failure of real-time text transmissions during extreme network conditions.</p>
    <p>That said, the load between participants using this specification in the recommended way, will cause a load that is only marginally higher than a user communicating without this specification. This is very low compared to many other activities possible on XMPP networks including VoIP and file transfers.</p>
    </div>
<h2>11.
       <a name="iana_considerations" id="iana_considerations">IANA Considerations</a></h2>
    <p>This document requires no interaction with the Internet Assigned Numbers Authority (IANA).</p>
    <h2>12.
       <a name="xmpp_registrar_considerations" id="xmpp_registrar_considerations">XMPP Registrar Considerations</a></h2>
        <div class="indent"><h3>12.1 <a name="protocol_namespaces" id="protocol_namespaces">Protocol Namespaces</a></h3>
    <p>The XMPP Registrar should include "urn:xmpp:rtt:0" in its registry of protocol namespaces (see &lt;<a href="http://xmpp.org/registrar/namespaces.html">http://xmpp.org/registrar/namespaces.html</a>&gt;).</p>
    </div>
    <div class="indent"><h3>12.2 <a name="namespace_versioning" id="namespace_versioning">Namespace Versioning</a></h3>
    <p>If the protocol defined in this specification undergoes a revision that is not fully backwards-compatible with an older version, the XMPP Registrar shall increment the protocol version number found at the end of the XML namespaces defined herein, as described in Section 4 of XEP-0053.</p>
    </div>
<h2>13.
       <a name="xml_schema" id="xml_schema">XML Schema</a></h2>
    <p><p class="caption"></p><div class="indent"><pre class="prettyprint">&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:xmpp:rtt:0'
    xmlns='urn:xmpp:rtt:0'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0xxx: http://www.xmpp.org/extensions/xep-0xxx.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='rtt'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='seq' type='xs:unsignedInteger' use='required'/&gt;
      &lt;xs:attribute name='event' type='xs:string' use='optional'/&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='t' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='e' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='d' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='c' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='w' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='g' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='t' type='xs:string'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='p' type='xs:unsignedInteger' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='e' type='empty'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='p' type='xs:unsignedInteger' use='optional'/&gt;
      &lt;xs:attribute name='n' type='xs:unsignedInteger' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='d' type='empty'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='p' type='xs:unsignedInteger' use='required'/&gt;
      &lt;xs:attribute name='n' type='xs:unsignedInteger' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='c' type='empty'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='p' type='xs:unsignedInteger' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='w' type='empty'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:attribute name='n' type='xs:unsignedInteger' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  
  &lt;xs:element name='g' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;</pre></div></p>
    <hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0301<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.1<br />
            Last Updated: 2011-06-29<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XEP-0020<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: NOT_YET_ASSIGNED<br />
              Source Control: 
                <a class="standardsButton" href="http://gitorious.org/xmpp/xmpp/blobs/master/extensions/xep-0301.xml">HTML</a><br />
            This document in other formats: 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0301.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0301.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Mark Rejhon</h3><p class="indent">
        Organization: RealJabber.org and Rejhon Technologies Inc.<br />
        Email:
        <a href="mailto:mark@realjabber.org">mark@realjabber.org</a><br />
        JabberID: 
        <a href="xmpp:markybox@gmail.com">markybox@gmail.com</a><br />
        URI: 
        <a href="http://www.realjabber.com">http://www.realjabber.com</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 - 2011 by the <a href="http://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/">http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/</a>&gt; or obtained by writing to XMPP Standards Foundation, 1899 Wynkoop Street, Suite 600, Denver, CO 80202 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-id229679" id="nt-id229679">1</a>. RealJabber.org is the author's web site containing work related to this specification, including animation examples of what real time text looks like. &lt;<a href="http://www.realjabber.org">http://www.realjabber.org</a>&gt;.</p><p><a name="nt-id229716" id="nt-id229716">2</a>. AOL AIM Real Time Text: &lt;<a href="http://help.aol.com/help/microsites/microsite.do?cmd=displayKC&amp;externalId=223568">http://help.aol.com/help/microsites/microsite.do?cmd=displayKC&amp;externalId=223568</a>&gt;.</p><p><a name="nt-id229744" id="nt-id229744">3</a>. IETF RFC 4103: RTP Payload for Text Conversation. &lt;<a href="http://tools.ietf.org/html/rfc4103">http://tools.ietf.org/html/rfc4103</a>&gt;.</p><p><a name="nt-id229763" id="nt-id229763">4</a>. ITU-T T.140: Protocol for multimedia application text conversation. &lt;<a href="http://www.itu.int/rec/T-REC-T.140">http://www.itu.int/rec/T-REC-T.140</a>&gt;.</p><p><a name="nt-id236587" id="nt-id236587">5</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-id236664" id="nt-id236664">6</a>. IETF RFC 5194: Framework for Real-Time Text over IP Using the Session Initiation Protocol (SIP). &lt;<a href="http://tools.ietf.org/html/rfc5194">http://tools.ietf.org/html/rfc5194</a>&gt;.</p><p><a name="nt-id229420" id="nt-id229420">7</a>. XML: Extensible Markup Language 1.0 (Fifth Edition). &lt;<a href="http://www.w3.org/TR/xml/">http://www.w3.org/TR/xml/</a>&gt;.</p><p><a name="nt-id237419" id="nt-id237419">8</a>. XEP-0224: Attention &lt;<a href="http://xmpp.org/extensions/xep-0224.html">http://xmpp.org/extensions/xep-0224.html</a>&gt;.</p><p><a name="nt-id237681" id="nt-id237681">9</a>. XEP-0030: Service Discovery &lt;<a href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id237796" id="nt-id237796">10</a>. XEP-0206: XMPP Over BOSH &lt;<a href="http://xmpp.org/extensions/xep-0206.html">http://xmpp.org/extensions/xep-0206.html</a>&gt;.</p><p><a name="nt-id238189" id="nt-id238189">11</a>. XEP-0286: XMPP on Mobile Devices &lt;<a href="http://xmpp.org/extensions/xep-0286.html">http://xmpp.org/extensions/xep-0286.html</a>&gt;.</p><p><a name="nt-id238832" id="nt-id238832">12</a>. XEP-0166: Jingle &lt;<a href="http://xmpp.org/extensions/xep-0166.html">http://xmpp.org/extensions/xep-0166.html</a>&gt;.</p><p><a name="nt-id238865" id="nt-id238865">13</a>. ITU-T F.703: Multimedia conversational services. &lt;<a href="http://www.itu.int/rec/T-REC-F.703">http://www.itu.int/rec/T-REC-F.703</a>&gt;.</p><p><a name="nt-id239054" id="nt-id239054">14</a>. XEP-0205: Best Practices to Discourage Denial of Service Attacks &lt;<a href="http://xmpp.org/extensions/xep-0205.html">http://xmpp.org/extensions/xep-0205.html</a>&gt;.</p><p><a name="nt-id239084" id="nt-id239084">15</a>. XEP-0184: Message Delivery Receipts &lt;<a href="http://xmpp.org/extensions/xep-0184.html">http://xmpp.org/extensions/xep-0184.html</a>&gt;.</p><p><a name="nt-id239106" id="nt-id239106">16</a>. XEP-0199: XMPP Ping &lt;<a href="http://xmpp.org/extensions/xep-0199.html">http://xmpp.org/extensions/xep-0199.html</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 0.1 (2011-06-29)</h4><div class="indent"><p>Initial published version.</p> (psa)
    </div><h4>Version 0.0.3 (2011-06-24)</h4><div class="indent"><p>Third draft, minor edits.</p> (MDR)
    </div><h4>Version 0.0.2 (2011-06-15)</h4><div class="indent"><p>Second draft.</p> (MDR)
    </div><h4>Version 0.0.1 (2011-02-21)</h4><div class="indent"><p>First draft.</p> (MDR)
    </div></div><hr /><p>END</p></body></html>
