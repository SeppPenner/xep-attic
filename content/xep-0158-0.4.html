<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>XEP-0158: Robot Challenges</title>
<link rel="stylesheet" type="text/css" href="/xmpp.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="Robot Challenges">
<meta name="DC.Creator" content="Ian Paterson">
<meta name="DC.Description" content="This document specifies an XMPP protocol extension that entities may use to discover whether the sender of an XML stanza is a human user or a robot.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="XMPP Extensions Editor">
<meta name="DC.Date" content="2005-09-30">
<meta name="DC.Type" content="XMPP Extension Protocol">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="XEP-0158">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This XMPP Extension Protocol is copyright 1999 - 2006 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.xmpp.org/extensions/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>XEP-0158: Robot Challenges</h1>
<p>This document specifies an XMPP protocol extension that entities may use to discover whether the sender of an XML stanza is a human user or a robot.</p>
<p><hr></p>
<p style="color:red">WARNING: Consideration of this document has been Deferred by the Jabber Software Foundation. Implementation of the protocol described herein is not recommended.</p>
<p><hr></p>
<h2>XEP Information</h2>
<p class="indent">
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Deferred">Deferred</a><br>
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a><br>
            Number: 0158<br>
            Version: 0.4<br>
            Last Updated: 2005-09-30<br>
            Publishing Organization: <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a><br>
                Approving Body: <a href="http://www.jabber.org/council/">XMPP Council</a><br>Dependencies: XMPP Core, XMPP IM, XEP-0004, XEP-0066<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: challenge<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Robot%20Challenges%20(XEP-0158)">http://wiki.jabber.org/index.php/Robot Challenges (XEP-0158)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Ian Paterson</h3>
<p class="indent">
        Email:
        <a href="mailto:ian.paterson@clientside.co.uk">ian.paterson@clientside.co.uk</a><br>
        JID: 
        <a href="xmpp:ian@zoofy.com">ian@zoofy.com</a></p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This XMPP Extension Protocol is copyright 1999 - 2006 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The following keywords as used in this document are to be interpreted as described in RFC 2119: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#require">Requirements</a>
</dt>
<dl>
<dt>2.1.  <a href="#require-extend">Extensibility</a>
</dt>
<dt>2.2.  <a href="#require-variety">Variety</a>
</dt>
</dl>
<dt>3.  <a href="#media">Media Element</a>
</dt>
<dt>4.  <a href="#protocol">Protocol Usage</a>
</dt>
<dl>
<dt>4.1.  <a href="#protocol-simple">Simple Challenge</a>
</dt>
<dl>
<dt>4.1.1.  <a href="#protocol-challenge">Challenge Stanza</a>
</dt>
<dt>4.1.2.  <a href="#protocol-response">Response Stanza</a>
</dt>
<dt>4.1.3.  <a href="#protocol-result">Result Stanza</a>
</dt>
</dl>
<dt>4.2.  <a href="#protocol-multiple">Multiple Challenges</a>
</dt>
</dl>
<dt>5.  <a href="#register">Extended In-Band Registration</a>
</dt>
<dt>6.  <a href="#captcha">Challenge Types</a>
</dt>
<dl>
<dt>6.1.  <a href="#captcha-intro">Introduction</a>
</dt>
<dt>6.2.  <a href="#captcha-hashcash">SHA-256 Hashcash</a>
</dt>
<dt>6.3.  <a href="#captcha-captcha">CAPTCHAs</a>
</dt>
</dl>
<dt>7.  <a href="#legacy">Question and Answer for Legacy Clients</a>
</dt>
<dt>8.  <a href="#stop">Discontinuation Policy</a>
</dt>
<dt>9.  <a href="#sec">Security Considerations</a>
</dt>
<dt>10.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>11.  <a href="#registrar">XMPP Registrar Considerations</a>
</dt>
<dl>
<dt>11.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt>
<dt>11.2.  <a href="#registrar-formtypes">Field Standardization</a>
</dt>
<dl>
<dt>11.2.1.  <a href="#registrar-formtypes-challenge">challenge FORM_TYPE</a>
</dt>
<dt>11.2.2.  <a href="#registrar-formtypes-register">jabber:iq:register FORM_TYPE</a>
</dt>
</dl>
</dl>
<dt>12.  <a href="#schemas">XML Schemas</a>
</dt>
<dl>
<dt>12.1.  <a href="#schemas-challenge">http://jabber.org/protocol/challenge</a>
</dt>
<dt>12.2.  <a href="#schemas-media">http://jabber.org/protocol/media</a>
</dt>
</dl>
<dt>13.  <a href="#open">Open Issues</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style="">The appearance of large public IM services based on <span class="ref" style="">RFC 3920</span>  [<a href="#nt-id2251001">1</a>] and <span class="ref" style="">RFC 3921</span>  [<a href="#nt-id2251022">2</a>] makes it desirable to implement protocols that <span style="font-style: italic">discourage</span> the sending of large quantities of IM SPAM (SPIM) from XMPP clients (connected to legitimate servers) and XMPP servers (with virtual clients) -- all hosted on networks of 'zombie' machines. SPIM is defined here as any type of unsolicited XMPP stanza sent by a 'robot' and delivered to a human, including messages and subscription requests. SPIM has the potential to disrupt people even more than SPAM, because each message interrupts the receiver (humans typically filter SPAM in batch mode).</p>
  <p class="" style="">Several of the most effective techniques developed to combat SPAM require humans to be differentiated from bots using a "Completely Automated Public Turing Test to Tell Computers and Humans Apart" or CAPTCHA (see &lt;<a href="http://www.captcha.net/">http://www.captcha.net/</a>&gt;). These challenge techniques are easily adapted to discourage SPIM. The very occasional inconvenience of responding to a CAPTCHA (for example, when creating an IM account or sending a message to a new correspondent) is small and perfectly acceptable -- especially when compared to the countless robot-generated interruptions people might otherwise have to filter every day.</p>
  <p class="" style="">An alternative technique to CAPTCHAs requires Desktop PC clients to undertake a <span class="ref" style="">Hashcash</span>  [<a href="#nt-id2251082">3</a>] challenge. These are completely transparent to PC users. They require clients to perform specified CPU-intensive work, making it difficult to send large amounts of SPIM.</p>
  <p class="" style="">The generic challenge protocol described in this document is designed for incorporation into other protocols like <span class="ref" style="">In-Band Registration</span>  [<a href="#nt-id2251126">4</a>] and <span class="ref" style="">SPIM-Blocking Control</span>  [<a href="#nt-id2251287">5</a>].</p>
<h2>2.
       <a name="require">Requirements</a>
</h2>
  <div class="indent">
<h3>2.1 <a name="require-extend">Extensibility</a>
</h3>
    <p class="" style="">The CAPTCHAs in most common use today are Optical Character Recognition (OCR) challenges where an image containing deformed text is presented and the human enters the characters they can read. However if OCR software advances more rapidly than the techniques used to disguise text from Artificial Intelligence (AI) then very different CAPTCHAs will need to be deployed. This protocol must be extensible enough to allow the incorporation of CAPTCHA techniques that may not have been envisaged.</p>
  </div>
  <div class="indent">
<h3>2.2 <a name="require-variety">Variety</a>
</h3>
    <p class="" style="">Several common CAPTCHA techniques present major problems to users with disabilities (see <span class="ref" style="">Inaccessibility of Visually-Oriented Anti-Robot Tests</span>  [<a href="#nt-id2251164">6</a>]). Clients running in constrained environments may not be able to perform some challenges (for example, due to the absence of audio output or a lack of CPU performance). This protocol must allow clients to be offered a choice from a variety of challenges.</p>
  </div>
<h2>3.
       <a name="media">Media Element</a>
</h2>
  <p class="" style="">This protocol requires multimedia to be included within <span class="ref" style="">Data Forms</span>  [<a href="#nt-id2251208">7</a>]. This section defines a new namespace ('http://jabber.org/protocols/media') for that purpose. The root element for the namespace is &lt;media/&gt;. It MUST be contained within a &lt;field/&gt; element qualified by the 'jabber:x:data' namespace.</p>
  <p class="" style="">If the media is an image or video then the &lt;media/&gt; element SHOULD include 'width' and 'height' attributes specifying the recommended display size of the media in pixels.</p>
  <p class="" style="">The &lt;media/&gt; element SHOULD contain at least one &lt;uri/&gt; element to specify the out-of-band location of the media data.  [<a href="#nt-id2251236">8</a>] The &lt;uri/&gt; element MUST contain a URI that indicates the location.</p>
  <p class="" style="">The &lt;media/&gt; element MAY also contain one or more &lt;data/&gt; elements for distributing the media in-band. The &lt;data/&gt; element MUST contain the Base64 encoded (in accordance with Section 3 of <span class="ref" style="">RFC 3548</span>  [<a href="#nt-id2257701">9</a>]) media data. The <span style="font-style: italic">encoded</span> data SHOULD NOT be larger than 8 KB. Note that if a stanza contains more than one &lt;data/&gt; element then the sending entity MUST take care not to trigger karma limits.</p>
  <p class="" style="">Each &lt;uri/&gt; or &lt;data/&gt; element MUST include a 'type' atribute that specifies the MIME type (see <span class="ref" style="">RFC 2045</span>  [<a href="#nt-id2257737">10</a>]) of the media.</p>
  <p class="caption">Example 1. Audio Media Element</p>
<div class="indent"><pre>
&lt;media xmlns='xmlns='http://jabber.org/protocol/media'&gt;
  &lt;uri type='audio/x-wav'&gt;http://www.victim.com/challenges/speech.wav?F3A6292C&lt;/uri&gt;
  &lt;uri type='audio/ogg-speex'&gt;http://www.victim.com/challenges/speech.ogg?F3A6292C&lt;/uri&gt;
  &lt;uri type='audio/mpeg'&gt;http://www.victim.com/challenges/speech.mp3?F3A6292C&lt;/uri&gt;
  &lt;data type='audio/x-wav'&gt; ** Base64 encoded audio ** &lt;/data&gt;
&lt;/media&gt;
  </pre></div>
<h2>4.
       <a name="protocol">Protocol Usage</a>
</h2>
  <div class="indent">
<h3>4.1 <a name="protocol-simple">Simple Challenge</a>
</h3>
    <p class="" style="">An entity (client or server) MAY send a challenge to a client immediately after receiving a stanza from the client. An entity MUST NOT send challenges under any other circumstances. Hereafter, the entity that sends a challenge is called a "challenger".</p>
    <p class="caption">Example 2. Client Sends Stanza Via Server</p>
<div class="indent"><pre>
&lt;message from='robot@spimmer.com/zombie'
    to='innocent@victim.com'
    xml:lang='en'
    id='spam1'&gt;
  &lt;body&gt;Love pills - 75% OFF&lt;/body&gt;
  &lt;x xmlns='jabber:x:oob'&gt;
    &lt;url&gt;http://www.spimmer.com/lovepills.html&lt;/url&gt;
  &lt;/x&gt;
&lt;/message&gt;
    </pre></div>
    <div class="indent">
<h3>4.1.1 <a name="protocol-challenge">Challenge Stanza</a>
</h3>
    <p class="" style="">Each of the challenge form's &lt;field/&gt; elements (see <span style="font-weight: bold">Data Forms</span>) that are not hidden MAY contain a different challenge and any media required for the challenge. The hidden 'from' field MUST contain the value of the 'to' attribute of the client's stanza that triggered the challenge. If the stanza from the client included an 'id' attribute then the hidden 'sid' field MUST be set to that value. The 'xml:lang' attribute of the challenge stanza SHOULD be the same as the one received from the client. The hidden 'FORM_TYPE' field MUST have a value of "http://jabber.org/protocol/challenge" in accordance with <span class="ref" style="">Field Standardization for Data Forms</span>  [<a href="#nt-id2257837">11</a>].</p>
    <p class="" style="">The challenger SHOULD include an explanation (in the &lt;body/&gt; element) for clients that do not support this protocol. The challenger MAY also include a URL (typically a Web page with instructions) using <span class="ref" style="">Out-of-Band Data</span>  [<a href="#nt-id2257872">12</a>] as an alternative for clients that do not support the challenge form. Note: even if it provides a URL, a challenger MUST always provide a challenge form.  [<a href="#nt-id2257863">13</a>]</p>
    <p class="caption">Example 3. Server Offers a Choice of Challenges to a Client</p>
<div class="indent"><pre>
&lt;message from='victim.com'
    to='robot@spimmer.com/zombie'
    xml:lang='en'
    id='F3A6292C'&gt;
  &lt;body&gt;Your messages to innocent@victim.com are being blocked.
    Visit the Web page to unblock them.&lt;/body&gt;
  &lt;x xmlns='jabber:x:oob'&gt;
    &lt;url&gt;http://www.victim.com/challenge.html?F3A6292C&lt;/url&gt;
  &lt;/x&gt;
  &lt;challenge xmlns='http://jabber.org/protocol/challenge'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;field type='hidden' var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='hidden' var='from'&gt;&lt;value&gt;innocent@victim.com&lt;/value&gt;&lt;/field&gt;
      &lt;field type='hidden' var='sid'&gt;&lt;value&gt;spam1&lt;/value&gt;&lt;/field&gt;
      &lt;field var='ocr'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'
               width='290'
               height='80'&gt;
          &lt;uri type='image/jpeg'&gt;http://www.victim.com/challenges/ocr.jpeg?F3A6292C&lt;/uri&gt;
          &lt;data type='image/jpeg'&gt; ** Base64 encoded image ** &lt;/data&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field var='picture_recog'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'
               width='150'
               height='150'&gt;
          &lt;uri type='image/jpeg'&gt;http://www.victim.com/challenges/picture.jpeg?F3A6292C&lt;/uri&gt;
          &lt;data type='image/jpeg'&gt; ** Base64 encoded image ** &lt;/data&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field var='speech_recog'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'&gt;
          &lt;uri type='audio/x-wav'&gt;http://www.victim.com/challenges/speech.wav?F3A6292C&lt;/uri&gt;
          &lt;uri type='audio/ogg-speex'&gt;http://www.victim.com/challenges/speech.ogg?F3A6292C&lt;/uri&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field var='video_recog'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'
               width='150'
               height='150'&gt;
          &lt;uri type='video/mpeg'&gt;http://www.victim.com/challenges/video.mpeg?F3A6292C&lt;/uri&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field label='Type the color of a stop light' type='text-single' var='qa'/&gt;
      &lt;field label='93C7A' type='text-single' var='SHA-256'/&gt;
    &lt;/x&gt;
  &lt;/challenge&gt;
&lt;/message&gt;
    </pre></div>
    </div>

    <div class="indent">
<h3>4.1.2 <a name="protocol-response">Response Stanza</a>
</h3>
    <p class="" style="">The client SHOULD ignore the challenge stanza in either of the following cases:</p>
    <ul>
      <li>If it has not recently sent (in the last two minutes for example) a stanza to the JID specified in the 'from' field of the form with the 'id' specified in the 'sid' field (or with no 'id' if no 'sid' field is included).  [<a href="#nt-id2257906">14</a>]</li>
      <li>If the 'from' attribute of the challenge stanza does not match the 'from' field of the form. (If the values are different, then they still match if the bare JIDs are the same, or if the 'from' attribute is the domain of the other JID.)</li>
    </ul>
    <p class="" style="">Otherwise, if the challenger provided a URL using <span style="font-weight: bold">Out-of-Band Data</span>, then the client MAY present the URL to its user, instead of responding to the challenge form, in any of the following cases:</p>
    <ul>
      <li>if it does not understand the challenge form</li>
      <li>if it does not support all of the <span style="font-style: italic">required</span> challenges (see <a href="#protocol-multiple">Multiple Challenges</a>)</li>
      <li>if it does not support enough of the challenges (see <a href="#protocol-multiple">Multiple Challenges</a>)</li>
    </ul>
    <p class="" style="">Otherwise, the client MUST respond to the challenger, preserving the 'id' attribute of the challenge stanza.</p>
    <p class="" style="">The client MUST respond with a &lt;not-acceptable/&gt; error in any of the following cases:</p>
    <ul>
      <li>if it does not support all of the required challenges (see <a href="#protocol-multiple">Multiple Challenges</a>)</li>
      <li>if it does not support enough of the challenges (see <a href="#protocol-multiple">Multiple Challenges</a>)</li>
      <li>if its user declines the challenge</li>
    </ul>
    <p class="caption">Example 4. Client Reports Challenge Not Acceptable</p>
<div class="indent"><pre>
&lt;message type='error'
    from='robot@spimmer.com/zombie'
    to='victim.com'
    xml:lang='en'
    id='F3A6292C'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Otherwise, it MUST select one challenge according to the user's preferences and submit the user's response form to the challenger.</p>
    <p class="caption">Example 5. Client Sends one Response to the Server</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='robot@spimmer.com/zombie'
    to='victim.com'
    xml:lang='en'
    id='F3A6292C'&gt;
  &lt;challenge xmlns='http://jabber.org/protocol/challenge'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='from'&gt;&lt;value&gt;innocent@victim.com&lt;/value&gt;&lt;/field&gt;
      &lt;field var='sid'&gt;&lt;value&gt;spam1&lt;/value&gt;&lt;/field&gt;
      &lt;field var='ocr'&gt;&lt;value&gt;7nHL3&lt;/value&gt;&lt;/field&gt;
    &lt;/x&gt;
  &lt;/challenge&gt;
&lt;/iq&gt;
    </pre></div>
    </div>

    <div class="indent">
<h3>4.1.3 <a name="protocol-result">Result Stanza</a>
</h3>
    <p class="" style="">The challenger SHOULD send a &lt;service-unavailable/&gt; error to the client if:</p>
    <ul>
      <li>The challenger did not send the specified challenge.  [<a href="#nt-id2258102">15</a>]</li>
      <li>The client already submitted its response to this challenge.</li>
      <li>The client took too long to submit its response.</li>
    </ul>
    <p class="" style="">Note: This error MAY be sent even in cases where the challenge became unnecessary while the challenger was waiting for the response.</p>
    <p class="caption">Example 6. Server Indicates Challenge Not Found</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='victim.com'
    to='robot@spimmer.com/zombie'
    id='F3A6292C'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">After receiving a correct response to its challenge, the challenger SHOULD inform the client that it was successful.</p>
    <p class="caption">Example 7. Server Tells the Client it Passed</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='victim.com'
    to='robot@spimmer.com/zombie'
    id='F3A6292C'/&gt;
    </pre></div>
    <p class="" style="">However, if the client submits an incorrect response the challenger SHOULD send it a &lt;not-acceptable/&gt; error with type "cancel":  [<a href="#nt-id2258199">16</a>]</p>
    <p class="caption">Example 8. Server Tells the Client it Failed</p>
<div class="indent"><pre>
&lt;iq type='error'
    from='victim.com'
    to='robot@spimmer.com/zombie'
    id='F3A6292C'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    </div>
  </div>
  <div class="indent">
<h3>4.2 <a name="protocol-multiple">Multiple Challenges</a>
</h3>
    <p class="" style="">The enitity may demand responses to more than one of the challenges it is offering by including an 'answers' &lt;field/&gt; element in the form. It may require responses to particular challenges by including &lt;required/&gt; elements in the compulsory fields.</p>
    <p class="caption">Example 9. Server Sets Multiple Challenges</p>
<div class="indent"><pre>
&lt;message from='victim.com'
    to='robot@spimmer.com/zombie'
    xml:lang='en'
    id='73DE28A2'&gt;
  &lt;body&gt;Your messages to innocent@victim.com are being blocked.
    To unblock them, ask innocent@victim.com to send you a message.&lt;/body&gt;
  &lt;challenge xmlns='http://jabber.org/protocol/challenge'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;field type='hidden' var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='hidden' var='from'&gt;&lt;value&gt;innocent@victim.com&lt;/value&gt;&lt;/field&gt;
      &lt;field type='hidden' var='sid'&gt;&lt;value&gt;spam2&lt;/value&gt;&lt;/field&gt;
      &lt;field type='hidden' var='answers'&gt;&lt;value&gt;2&lt;/value&gt;&lt;/field&gt;
      &lt;field var='ocr'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'
               width='290'
               height='80'&gt;
          &lt;uri type='image/jpeg'&gt;http://www.victim.com/challenges/ocr.jpeg?F3A6292C&lt;/uri&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field var='audio_recog'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'&gt;
          &lt;uri type='audio/x-wav'&gt;http://www.victim.com/challenges/audio.wav?F3A6292C&lt;/uri&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field label='Type the color of a stop light' type='text-single' var='qa'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field label='e03d7' type='text-single' var='SHA-256'/&gt;
    &lt;/x&gt;
  &lt;/challenge&gt;
&lt;/message&gt;
    </pre></div>

    <p class="" style="">If the client finds the request acceptable, it MUST answer all challenges that include a &lt;required/&gt; element. If the total number of answers was specified and it is greater than the number of &lt;required/&gt; elements then the client MUST also answer one or more of the challenges without a &lt;required/&gt; element. In the example above, the client should respond to the 'qa' challenge <span style="font-style: italic">and</span> one of the other challenges ('ocr', 'audio_recog' or 'SHA-256').</p>
    <p class="caption">Example 10. Client Sends Multiple Responses to the Server</p>
<div class="indent"><pre>
&lt;iq type='set'
    from='robot@spimmer.com/zombie'
    to='victim.com'
    xml:lang='en'
    id='73DE28A2'&gt;
  &lt;challenge xmlns='http://jabber.org/protocol/challenge'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='from'&gt;&lt;value&gt;innocent@victim.com&lt;/value&gt;&lt;/field&gt;
      &lt;field var='sid'&gt;&lt;value&gt;spam2&lt;/value&gt;&lt;/field&gt;
      &lt;field var='answers'&gt;&lt;value&gt;2&lt;/value&gt;&lt;/field&gt;
      &lt;field var='qa'&gt;&lt;value&gt;divad&lt;/value&gt;&lt;/field&gt;
      &lt;field var='SHA-256'&gt;&lt;value&gt;innocent@victim.com2450F06C173B05E3&lt;/value&gt;&lt;/field&gt;
    &lt;/x&gt;
  &lt;/challenge&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The challenger MAY decide the client has passed a challenge even if the responses are not all perfectly correct.</p>
  </div>
<h2>5.
       <a name="register">Extended In-Band Registration</a>
</h2>
  <p class="" style="">This section shows how challenges SHOULD be combined with the existing registration protocol according to the rules defined in the Extensibility section of <span style="font-weight: bold">In-Band Registration</span>. Note: The &lt;challenge/&gt; wrapper element is not required.</p>
  <p class="caption">Example 11. Entity Requests Registration Fields from Host</p>
<div class="indent"><pre>
&lt;iq type='get' xml:lang='en' id='reg1'&gt;
  &lt;query xmlns='jabber:iq:register'/&gt;
&lt;/iq&gt;
    </pre></div>
  <p class="" style="">Note that the challenge form MUST be inside the &lt;query/&gt; element, and the server's challenge ID is specified within the form:</p>
  <p class="caption">Example 12. Host Returns Registration and Challenge Fields to Entity</p>
<div class="indent"><pre>
&lt;iq type='result' xml:lang='en' id='reg1'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;field type='hidden' var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='hidden' var='cid'&gt;&lt;value&gt;F3A6292C&lt;/value&gt;&lt;/field&gt;
      &lt;field type='hidden' var='answers'&gt;&lt;value&gt;3&lt;/value&gt;&lt;/field&gt;
      &lt;field var='ocr'&gt;
        &lt;media xmlns='xmlns='http://jabber.org/protocol/media'
               width='290'
               height='80'&gt;
          &lt;uri type='image/jpeg'&gt;http://www.victim.com/challenges/ocr.jpeg?F3A6292C&lt;/uri&gt;
        &lt;/media&gt;
      &lt;/field&gt;
      &lt;field label='93C7A' type='text-single' var='SHA-256'/&gt;
      &lt;field type='text-single' var='username'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      &lt;field type='text-single' var='password'&gt;
        &lt;required/&gt;
      &lt;/field&gt;
    &lt;/x&gt;
    &lt;instructions&gt;
      To register, visit http://www.victim.com/register.html
    &lt;/instructions&gt;
    &lt;x xmlns='jabber:x:oob'&gt;
      &lt;url&gt;http://www.victim.com/register.html&lt;/url&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>

    <p class="" style="">The server MAY include an &lt;instructions/&gt; element and a URL using <span style="font-weight: bold">Out-of-Band Data</span> (e.g., a web page) in the &lt;query/&gt; element (see example above). <span style="font-weight: bold">In-Band Registration</span> recommends that the challenger SHOULD submit the completed x:data form, however if it does not understand the form, then it MAY present the instructions and the included URL to the user instead of providing the required information in-band.</p>
    <p class="caption">Example 13. Entity Provides Required Information In-Band</p>
<div class="indent"><pre>
&lt;iq type='set' xml:lang='en' id='reg2'&gt;
  &lt;query xmlns='jabber:iq:register'&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='cid'&gt;&lt;value&gt;F3A6292C&lt;/value&gt;&lt;/field&gt;
      &lt;field var='answers'&gt;&lt;value&gt;3&lt;/value&gt;&lt;/field&gt;
      &lt;field var='ocr'&gt;&lt;value&gt;7nHL3&lt;/value&gt;&lt;/field&gt;
      &lt;field var='username'&gt;&lt;value&gt;bill&lt;/value&gt;&lt;/field&gt;
      &lt;field var='password'&gt;&lt;value&gt;Calliope&lt;/value&gt;&lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
<h2>6.
       <a name="captcha">Challenge Types</a>
</h2>
  <div class="indent">
<h3>6.1 <a name="captcha-intro">Introduction</a>
</h3>
    <p class="" style="">Entities MUST address the needs of disabled people and CPU-constrained clients by offering people a reasonable choice of different types of challenges.</p>
    <p class="" style="">Desktop clients running on modern PCs will typically be configured to automatically perform a specified 'SHA-256' Hashcash challenge (see below) whenever it is below a certain level of difficulty, with the result that many people may not even notice challenges most of the time. However, people using CPU-constrained clients (e.g. Web or mobile clients) would notice the performance hit. They might prefer to take a CAPTCHA challenge instead.  [<a href="#nt-id2258435">17</a>]</p>
    <p class="" style="">Visually disabled people using a CPU-constrained client could configure their client to always present them with an audio CAPTCHA challenge.</p>
    <p class="" style="">Most of the challenges below are language sensitive. However, the evaluation of the OCR and Hashcash responses does not depend on the language the client is using.</p>
    <p class="" style="">Challenge types are distinguished by the 'var' attribute of each &lt;field/&gt; element. Several types of challenges are described below. More challenges MAY be documented elsewhere and registered with the <span class="ref" style="">XMPP Registrar</span>  [<a href="#nt-id2258505">18</a>] (see <a href="#registrar-formtypes">Field Standardization</a>).</p>
  </div>
  <div class="indent">
<h3>6.2 <a name="captcha-hashcash">SHA-256 Hashcash</a>
</h3>
    <p class="" style="">The SHA-256 Hashcash challenge is transparent to average PC users. It is indicated when the value of the 'var' attribute is 'SHA-256'. It forces clients to perform CPU-intensive work, making it difficult to send large amounts of SPIM. This significantly reduces SPIM, but alone it will not completely stop SPIM being sent through large collections of 'zombie' computers.  [<a href="#nt-id2258535">19</a>]</p>
    <p class="" style="">The challenger MUST set the 'label' attribute of the &lt;field/&gt; element to a hexadecimal random number containing a configured number of bits (2<span class="super" style="">20</span> ≤ label &lt; 2<span class="super" style="">21</span>, for example).</p>
    <p class="" style="">To pass the test, the client MUST return a text string that starts with the JID the client sent the first stanza to (i.e., the stanza that triggered the challenge). The least significant bits of the SHA-256 hash (see <span class="ref" style="">Secure Hash Standard</span>  [<a href="#nt-id2258867">20</a>]) of the string MUST equal the hexadecimal value specified by the challenger (in the 'label' attribute of the &lt;field/&gt; element). For example, if the 'label' attribute is the 20-bit value 'e03d7' then the following string would be correct:</p>
    <p class="caption"></p>
<div class="indent"><pre>innocent@victim.com2450F06C173B05E3</pre></div>
    <p class="" style="">Note: When configuring the number of bits to be specified by a challenger in the 'label' attribute values, administrators MUST balance the need to make mass SPIM as difficult as possible, with the inconvenience that may be caused to the users of less powerful computers. (Most clients will be challenged only very occasionally, so the consumption of 70% of a typical desktop CPU for 4 seconds might be considered appropriate.) Administrators SHOULD increment the configured number of bits from time to time to match increases in the performance of typical desktop PCs. If an administrator notices that SPIM robots never attempt the Hashcash challenge, then he SHOULD consider reducing the number of bits, to avoid inconveniencing people unnecessarily.</p>
  </div>
  <div class="indent">
<h3>6.3 <a name="captcha-captcha">CAPTCHAs</a>
</h3>
    <p class="" style="">For those CAPTCHA types where generic instructions are possible (see table below) then the &lt;field/&gt; element SHOULD NOT include a 'label' attribute (the client MUST present generic instructions to its user in the language of its user interface). Otherwise the 'label' attribute SHOULD ask a specific question in the language indicated by the 'xml:lang' attribute of the challenge stanza.</p>
    <p class="" style="">If a media type is specified (see table below) then the &lt;field/&gt; element MUST contain a &lt;media/&gt; element that includes a &lt;uri/&gt; element of that type. Clients that support the CAPTCHA type MUST be able to play or render the specified MIME-types (see table below). They MAY also support other formats.  [<a href="#nt-id2258960">21</a>]</p>
    <p class="" style="">The 'type' attribute of the &lt;field/&gt; element SHOULD be 'text-single', 'text-private', or 'text-multi' (if no 'type' is specified, the default is 'text-single').  [<a href="#nt-id2258981">22</a>] The response MUST be provided in the language specified by the 'xml:lang' attribute of the challenge stanza.</p>
    <p class="caption">Table 1: CAPTCHAs</p>
<table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">'var'</th>
        <th colspan="" rowspan="">Name</th>
        <th colspan="" rowspan="">Media type</th>
        <th colspan="" rowspan="">MIME-type</th>
        <th colspan="" rowspan="">'label'</th>
        <th colspan="" rowspan="">Example generic instructions</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">ocr*</td>
        <td align="" colspan="" rowspan="">Optical Character Recognition</td>
        <td align="" colspan="" rowspan="">image</td>
        <td align="" colspan="" rowspan="">image/jpeg</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Enter the code you see</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">picture_recog</td>
        <td align="" colspan="" rowspan="">Picture Recognition</td>
        <td align="" colspan="" rowspan="">image</td>
        <td align="" colspan="" rowspan="">image/jpeg</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Describe the picture</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">video_recog</td>
        <td align="" colspan="" rowspan="">Video Recognition</td>
        <td align="" colspan="" rowspan="">video</td>
        <td align="" colspan="" rowspan="">video/mpeg</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Describe the video</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">speech_recog</td>
        <td align="" colspan="" rowspan="">Speech Recognition</td>
        <td align="" colspan="" rowspan="">audio</td>
        <td align="" colspan="" rowspan="">audio/x-wav</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Enter the words you hear</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">audio_recog</td>
        <td align="" colspan="" rowspan="">Audio Recognition</td>
        <td align="" colspan="" rowspan="">audio</td>
        <td align="" colspan="" rowspan="">audio/x-wav</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Describe the sound you hear</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">picture_q</td>
        <td align="" colspan="" rowspan="">Picture Question</td>
        <td align="" colspan="" rowspan="">image</td>
        <td align="" colspan="" rowspan="">image/jpeg</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Answer the question you see</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">video_q</td>
        <td align="" colspan="" rowspan="">Video Question</td>
        <td align="" colspan="" rowspan="">video</td>
        <td align="" colspan="" rowspan="">video/mpeg</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Answer the question in the video</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">speech_q</td>
        <td align="" colspan="" rowspan="">Speech Question</td>
        <td align="" colspan="" rowspan="">audio</td>
        <td align="" colspan="" rowspan="">audio/x-wav</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Answer the question you hear</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">qa</td>
        <td align="" colspan="" rowspan="">Text Question and Answer</td>
        <td align="" colspan="" rowspan="">-</td>
        <td align="" colspan="" rowspan="">-</td>
        <td align="" colspan="" rowspan="">Yes**</td>
        <td align="" colspan="" rowspan="">-</td>
      </tr>
    </table>
    <p class="" style="">* The image portrays random characters that humans can read but OCR software cannot.  [<a href="#nt-id2259518">23</a>] To pass the challenge, the user must simply type the characters. The correct answer SHOULD NOT depend on the language specified by the 'xml:lang' attribute of the challenge stanza.</p>
    <p class="" style="">** To pass the challenge, the user must type the answer to the question in the 'label' attribute.</p>
    <p class="" style="">Note: It may be profitable to send SPIM even if less than one percent of CAPTCHA responses are successful. The effectiveness of a CAPTCHA challenge needs to be close to perfect, unless it is used in combination with other anti-SPIM techniques.</p>
  </div>
<h2>7.
       <a name="legacy">Question and Answer for Legacy Clients</a>
</h2>
  <p class="" style="">An challenger MAY provide a text question in the &lt;body/&gt; element of a challenge stanza for clients that do not support challenge forms. Entities that cannot serve <span style="font-weight: bold">Out-of-Band Data</span> URLs MAY use this option to challenge legacy clients.</p>
  
  <p class="" style="">Note: Robots always attempt the easiest challenge they are offered. So the question MUST be at least as difficult for a robot as the challenge form.</p>
  <p class="" style="">Note: Even if it provides a text question in the &lt;body/&gt; element, a challenger MUST always provide a challenge form.</p>
  <p class="caption">Example 14. Client Includes a Legacy Challenge</p>
<div class="indent"><pre>
&lt;message from='innocent@victim.com/pda'
    to='robot@spimmer.com/zombie'
    xml:lang='en'
    id='F3A6292C'&gt;
  &lt;body&gt;Your messages to me are being blocked. To unblock them,
    reply with the color of a stop light followed by 'F3A6292C'.&lt;/body&gt;
  &lt;challenge xmlns='http://jabber.org/protocol/challenge'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;field type='hidden' var='FORM_TYPE'&gt;
        &lt;value&gt;http://jabber.org/protocol/challenge&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='hidden' var='from'&gt;&lt;value&gt;innocent@victim.com&lt;/value&gt;&lt;/field&gt;
      &lt;field type='hidden' var='sid'&gt;&lt;value&gt;spam1&lt;/value&gt;&lt;/field&gt;
      &lt;field label='Type the color of a stop light' type='text-single' var='qa'/&gt;
      &lt;field label='93C7A' type='text-single' var='SHA-256'/&gt;
    &lt;/x&gt;
  &lt;/challenge&gt;
&lt;/message&gt;
  </pre></div>
  <p class="" style="">Legacy clients respond to the challenger using a &lt;message/&gt; stanza (not an &lt;iq/&gt;).</p>
  <p class="caption">Example 15. Legacy Client Responds</p>
<div class="indent"><pre>
&lt;message from='robot@spimmer.com/zombie' to='innocent@victim.com/pda'&gt;
  &lt;body&gt;red F3A6292C&lt;/body&gt;
&lt;/message&gt;
  </pre></div>
  <p class="" style="">The challenger SHOULD treat the stanza as a normal message (instead of as a response to its challenge) if the legacy client either takes too long to submit it or has already responded to the challenge. The challenger MAY treat the response as a normal message even in cases where the challenge became unnecessary while the challenger was waiting for the response.</p>
  <p class="" style="">Otherwise the challenger MUST report the result of the challenge to the legacy client using a &lt;message/&gt; stanza (not an &lt;iq/&gt;).</p>
  <p class="caption">Example 16. Client Tells the Legacy Client it Passed</p>
<div class="indent"><pre>
&lt;message from='innocent@victim.com/pda' to='robot@spimmer.com/zombie'&gt;
  &lt;body&gt;Your message was delivered. Your messages
        to me are no longer being blocked.&lt;/body&gt;
&lt;/message&gt;
  </pre></div>
  <p class="caption">Example 17. Client Tells the Legacy Client it Failed</p>
<div class="indent"><pre>
&lt;message type='error'
         from='innocent@victim.com/pda'
         to='robot@spimmer.com/zombie'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
      Your message to me was not delivered.
    &lt;/text&gt;
  &lt;/error&gt;
&lt;/message&gt;
  </pre></div>
<h2>8.
       <a name="stop">Discontinuation Policy</a>
</h2>
  <p class="" style="">It is RECOMMENDED that entities employ other techniques to combat SPIM in addition to those described in this document. The expectation is that this protocol will be an important and successful tool for discouraging SPIM. However, much of its success is dependent on the quality of the CAPTCHAs employed by a particular implementation.</p>
  <p class="" style="">The administrator of a challenger MUST discontinue the use of Robot Challenges under the following circumstances:</p>
  <ul>
    <li>If he realises that the challenger's challenges are largely ineffective in combating SPIM, and that the reduction in SPIM does not compensate for the inconvenience to humans of responding to the challenger's challenges.</li>
    <li>If other, <span style="font-style: italic">more transparent</span>, techniques being employed by the challenger are so successful that challenges are offering only negligible additional protection against SPIM.</li>
    <li>If the challenger needs no protection at all because it receives only a negligible amount of SPIM.</li>
  </ul>
<h2>9.
       <a name="sec">Security Considerations</a>
</h2>
  <p class="" style="">This document introduces no security considerations above and beyond those described in <span style="font-weight: bold">RFC 3920</span> and <span style="font-weight: bold">RFC 3921</span>.</p>
<h2>10.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2259808">24</a>]. </p>
<h2>11.
       <a name="registrar">XMPP Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>11.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
    <p class="" style="">Upon approval of this document, the <span class="ref" style="">XMPP Registrar</span>  [<a href="#nt-id2259846">25</a>] shall register the following protocol namespaces:</p>
    <ul>
      <li>http://jabber.org/protocol/challenge</li>
      <li>http://jabber.org/protocol/media</li>
    </ul>
  </div>
  <div class="indent">
<h3>11.2 <a name="registrar-formtypes">Field Standardization</a>
</h3>
    <div class="indent">
<h3>11.2.1 <a name="registrar-formtypes-challenge">challenge FORM_TYPE</a>
</h3>
      <p class="" style="">Upon approval of this document, the <span style="font-weight: bold">XMPP Registrar</span> shall register the following new FORM_TYPE. Additional fields will be defined in future submissions.</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/challenge&lt;/name&gt;
  &lt;doc&gt;XEP-0158&lt;/doc&gt;
  &lt;desc&gt;forms enabling robot challenges&lt;/desc&gt;
  &lt;field
      var='answers'
      type='hidden'
      label='number of answers required'/&gt;
  &lt;field
      var='audio_recog'
      type='text-single'
      label='text associated with a sound'/&gt;
  &lt;field
      var='cid'
      type='hidden'
      label='challenge ID'/&gt;
  &lt;field
      var='from'
      type='hidden'
      label='to attribute of stanza that triggered challenge'/&gt;
  &lt;field
      var='ocr'
      type='text-single'
      label='code appearing in an image'/&gt;
  &lt;field
      var='picture_q'
      type='text-single'
      label='answer associated with a picture'/&gt;
  &lt;field
      var='picture_recog'
      type='text-single'
      label='text associated with a picture'/&gt;
  &lt;field
      var='qa'
      type='text-single'
      label='answer to a question'/&gt;
  &lt;field
      var='SHA-256'
      type='text-single'
      label='least significant bits of SHA-256 hash of text should equal hexadecimal label'/&gt;
  &lt;field
      var='sid'
      type='hidden'
      label='stanza ID'/&gt;
  &lt;field
      var='speech_q'
      type='text-single'
      label='answer associated with speech'/&gt;
  &lt;field
      var='speech_recog'
      type='text-single'
      label='text associated with speech'/&gt;
  &lt;field
      var='video_q'
      type='text-single'
      label='answer associated with a video'/&gt;
  &lt;field
      var='video_recog'
      type='text-single'
      label='text associated with a video'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>11.2.2 <a name="registrar-formtypes-register">jabber:iq:register FORM_TYPE</a>
</h3>
      <p class="" style="">Upon approval of this document, the <span style="font-weight: bold">XMPP Registrar</span> shall register the following new fields for the existing jabber:iq:register FORM_TYPE. Additional fields will be defined in future submissions.</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;jabber:iq:register&lt;/name&gt;
  &lt;doc&gt;XEP-0077&lt;/doc&gt;
  &lt;field
      var='answers'
      type='hidden'
      label='number of answers required'/&gt;
  &lt;field
      var='audio_recog'
      type='text-single'
      label='text associated with a sound'/&gt;
  &lt;field
      var='cid'
      type='hidden'
      label='challenge ID'/&gt;
  &lt;field
      var='ocr'
      type='text-single'
      label='code appearing in an image'/&gt;
  &lt;field
      var='picture_q'
      type='text-single'
      label='answer associated with a picture'/&gt;
  &lt;field
      var='picture_recog'
      type='text-single'
      label='text associated with a picture'/&gt;
  &lt;field
      var='qa'
      type='text-single'
      label='answer to a question'/&gt;
  &lt;field
      var='SHA-256'
      type='text-single'
      label='least significant bits of SHA-256 hash of text should equal hexadecimal label'/&gt;
  &lt;field
      var='speech_q'
      type='text-single'
      label='answer associated with speech'/&gt;
  &lt;field
      var='speech_recog'
      type='text-single'
      label='text associated with speech'/&gt;
  &lt;field
      var='video_q'
      type='text-single'
      label='answer associated with a video'/&gt;
  &lt;field
      var='video_recog'
      type='text-single'
      label='text associated with a video'/&gt;
&lt;/form_type&gt;
      </pre></div>
    </div>
  </div>
<h2>12.
       <a name="schemas">XML Schemas</a>
</h2>
  <div class="indent">
<h3>12.1 <a name="schemas-challenge">http://jabber.org/protocol/challenge</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/challenge'
    xmlns='http://jabber.org/protocol/challenge'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='challenge'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x' minOccurs='1' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>

  <div class="indent">
<h3>12.2 <a name="schemas-media">http://jabber.org/protocol/media</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/media'
    xmlns='http://jabber.org/protocol/media'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='media'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='uri' minOccurs='1' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='data' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='height' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='width' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='uri'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute name='type' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='data'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute name='type' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
<h2>13.
       <a name="open">Open Issues</a>
</h2>
  <p class="" style="">Another protocol could allow users to edit the challenges their server will make on their behalf. For example, the number of SHA-256 bits, a personal or original question and answer, a picture, a video, or a sound recording... Of course Aunt Tillie would typically only use this feature if she was plagued by SPIM.</p>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2251001">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2251022">2</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2251082">3</a>. Hashcash &lt;<a href="http://hashcash.org/">http://hashcash.org/</a>&gt;.</p>
<p><a name="nt-id2251126">4</a>. XEP-0077: In-Band Registration &lt;<a href="http://www.xmpp.org/extensions/xep-0077.html">http://www.xmpp.org/extensions/xep-0077.html</a>&gt;.</p>
<p><a name="nt-id2251287">5</a>. XEP-0159: SPIM-Blocking Control &lt;<a href="http://www.xmpp.org/extensions/xep-0159.html">http://www.xmpp.org/extensions/xep-0159.html</a>&gt;.</p>
<p><a name="nt-id2251164">6</a>. Inaccessibility of Visually-Oriented Anti-Robot Tests &lt;<a href="http://www.w3.org/TR/turingtest/">http://www.w3.org/TR/turingtest/</a>&gt;.</p>
<p><a name="nt-id2251208">7</a>. XEP-0004: Data Forms &lt;<a href="http://www.xmpp.org/extensions/xep-0004.html">http://www.xmpp.org/extensions/xep-0004.html</a>&gt;.</p>
<p><a name="nt-id2251236">8</a>. Constrained execution environments prevent some clients rendering media unless it has been received out-of-band (e.g., Web clients).</p>
<p><a name="nt-id2257701">9</a>. RFC 3548: The Base16, Base32, and Base64 Data Encodings &lt;<a href="http://www.ietf.org/rfc/rfc3548.txt">http://www.ietf.org/rfc/rfc3548.txt</a>&gt;.</p>
<p><a name="nt-id2257737">10</a>. RFC 2045: Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies &lt;<a href="http://www.ietf.org/rfc/rfc2045.txt">http://www.ietf.org/rfc/rfc2045.txt</a>&gt;.</p>
<p><a name="nt-id2257837">11</a>. XEP-0068: Field Data Standardization for Data Forms &lt;<a href="http://www.xmpp.org/extensions/xep-0068.html">http://www.xmpp.org/extensions/xep-0068.html</a>&gt;.</p>
<p><a name="nt-id2257872">12</a>. XEP-0066: Out of Band Data &lt;<a href="http://www.xmpp.org/extensions/xep-0066.html">http://www.xmpp.org/extensions/xep-0066.html</a>&gt;.</p>
<p><a name="nt-id2257863">13</a>. A constrained client, like a mobile phone, cannot present a Web page to its user.</p>
<p><a name="nt-id2257906">14</a>. Otherwise the user's presence would be disclosed, or a SPIM robot might dupe the user into providing answers to other people's challenges!</p>
<p><a name="nt-id2258102">15</a>. If the challenger is a client then it SHOULD be careful not to leak information about the presence of its user and reply to potentially bogus challenge responses with exactly the same XML that its server would send if its user were offline.</p>
<p><a name="nt-id2258199">16</a>. If a large proportion of the responses a server is receiving from another IP are incorrect then it SHOULD inform the administrator of the other server (using the protocol to be defined in a forthcoming proposal on SPIM reporting). It SHOULD also automatically block all stanzas from the abusive user, users, server or IP.</p>
<p><a name="nt-id2258435">17</a>. A CPU-constrained client could ask a faster computer (its server, for example) to perform a Hashcash challenge for it.</p>
<p><a name="nt-id2258505">18</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p>
<p><a name="nt-id2258535">19</a>. The hope is that the extra CPU usage will often be noticed by the owners of the zombie machines, who will be more likely to fix them.</p>
<p><a name="nt-id2258867">20</a>. Secure Hash Standard: Federal Information Processing Standards Publication 180-2  &lt;<a href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf">http://csrc.nist.gov/publications/fips/fips180-2/fips186-2withchangenotice.pdf</a>&gt;.</p>
<p><a name="nt-id2258960">21</a>. Audio CAPTCHAs typically require challengers to provide at least the 'audio/x-wav' MIME-type (with the PCM codec) because more efficient patent-free formats are often not supported by constrained clients. It is RECOMMENDED that challengers provide more compact formats (like Ogg Speex or MP3) too.</p>
<p><a name="nt-id2258981">22</a>. The 'boolean' and 'list-single' field types would make it trivial for a robot to provide a correct response at least some of the time.</p>
<p><a name="nt-id2259518">23</a>. See PWNtcha &lt;<a href="http://sam.zoy.org/pwntcha/">http://sam.zoy.org/pwntcha/</a>&gt; for some example OCR CAPTCHA images.</p>
<p><a name="nt-id2259808">24</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2259846">25</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.4 (2005-09-30)</h4>
<div class="indent">Required WAV instead of MP3 for audio CAPTCHAs; minor corrections (ip)
    </div>
<h4>Version 0.3 (2005-09-28)</h4>
<div class="indent">Added more CAPTCHA types and the legacy question and answer section (ip)
    </div>
<h4>Version 0.2 (2005-09-14)</h4>
<div class="indent">Minor fixes (ip)
    </div>
<h4>Version 0.1 (2005-09-14)</h4>
<div class="indent">Initial version. (ip)
    </div>
<h4>Version 0.0.1 (2005-09-07)</h4>
<div class="indent">First draft. (ip)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
