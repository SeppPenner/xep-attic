<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0072: SOAP Over XMPP</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="SOAP Over XMPP">
<meta name="DC.Creator" content="Fabio Forno">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Description" content="This JEP defines methods for transporting SOAP messages over Jabber/XMPP.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2005-11-01">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0072">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2005 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>JEP-0072: SOAP Over XMPP</h1>
<p>This JEP defines methods for transporting SOAP messages over Jabber/XMPP.</p>
<p><hr></p>
<p style="color:red">NOTICE: This JEP is currently within Last Call or under consideration by the Jabber Council for advancement to the next stage in the JSF standards process. For further details, visit &lt;<a href="http://www.jabber.org/council/queue.shtml">http://www.jabber.org/council/queue.shtml</a>&gt;.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Proposed<br>
            Type: Standards Track<br>
            Number: 0072<br>
            Version: 0.13<br>
            Last Updated: 2005-11-01<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, SOAP 1.2, JEP-0030<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: soap<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/SOAP%20Over%20XMPP%20(JEP-0072)">http://wiki.jabber.org/index.php/SOAP Over XMPP (JEP-0072)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Fabio Forno</h3>
<p class="indent">
        Email: fabio.forno@polito.it<br>
        JID: sciasbat@jabber.linux.it</p>
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email: stpeter@jabber.org<br>
        JID: stpeter@jabber.org</p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2005 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#arch">Architectural Assumptions</a>
</dt>
<dt>3.  <a href="#uc">Use Cases</a>
</dt>
<dl>
<dt>3.1.  <a href="#disco">Discovering Support</a>
</dt>
<dt>3.2.  <a href="#exchange">Exchanging SOAP Messages</a>
</dt>
<dl>
<dt>3.2.1.  <a href="#exchange-iq">Exchanging SOAP Messages Using XMPP IQ Stanzas</a>
</dt>
<dt>3.2.2.  <a href="#exchange-message">Exchanging SOAP Messages Using XMPP Message Stanzas</a>
</dt>
</dl>
<dt>3.3.  <a href="#data">Sending Associated Data</a>
</dt>
<dl>
<dt>3.3.1.  <a href="#data-link">Links</a>
</dt>
<dt>3.3.2.  <a href="#data-mime">MIME</a>
</dt>
<dt>3.3.3.  <a href="#data-transport">Other Transports</a>
</dt>
<dt>3.3.4.  <a href="#data-ft">File Transfer</a>
</dt>
</dl>
<dt>3.4.  <a href="#wsdl">Specifying a WSDL Definition</a>
</dt>
</dl>
<dt>4.  <a href="#binding">SOAP XMPP Binding</a>
</dt>
<dl>
<dt>4.1.  <a href="#binding-name">Binding Name</a>
</dt>
<dt>4.2.  <a href="#binding-features">Supported Features</a>
</dt>
<dt>4.3.  <a href="#binding-patterns">Supported Message Exchange Patterns</a>
</dt>
<dt>4.4.  <a href="#binding-operation">Operation of Request-Response Message Exchange Pattern</a>
</dt>
<dl>
<dt>4.4.1.  <a href="#binding-operation-request">Behavior of Requesting SOAP Node</a>
</dt>
<dl>
<dt>4.4.1.1.  <a href="#binding-operation-request-init">Init</a>
</dt>
<dt>4.4.1.2.  <a href="#binding-operation-request-requesting">Requesting</a>
</dt>
<dt>4.4.1.3.  <a href="#binding-operation-request-sendingreceiving">Sending+Receiving</a>
</dt>
<dt>4.4.1.4.  <a href="#binding-operation-request-successfail">Success and Fail</a>
</dt>
</dl>
<dt>4.4.2.  <a href="#binding-operation-response">Behavior of Responding SOAP Node</a>
</dt>
<dl>
<dt>4.4.2.1.  <a href="#binding-operation-response-init">Init</a>
</dt>
<dt>4.4.2.2.  <a href="#binding-operation-response-receiving">Receiving</a>
</dt>
<dt>4.4.2.3.  <a href="#binding-operation-response-receivingsending">Receiving+Sending</a>
</dt>
<dt>4.4.2.4.  <a href="#binding-operation-response-successfail">Success and Fail</a>
</dt>
</dl>
</dl>
</dl>
<dt>5.  <a href="#w3c">W3C Considerations</a>
</dt>
<dl>
<dt>5.1.  <a href="#w3c-review">W3C Review</a>
</dt>
<dt>5.2.  <a href="#w3c-soapversions">SOAP Versioning</a>
</dt>
<dt>5.3.  <a href="#w3c-xmlversions">XML Versioning</a>
</dt>
</dl>
<dt>6.  <a href="#errors">Error Handling</a>
</dt>
<dt>7.  <a href="#bizrules">Business Rules</a>
</dt>
<dl><dt>7.1.  <a href="#bizrules-encoding">Encoding</a>
</dt></dl>
<dt>8.  <a href="#security">Security Considerations</a>
</dt>
<dt>9.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>10.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl>
<dt>10.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt>
<dt>10.2.  <a href="#registrar-disco">Service Discovery Identity</a>
</dt>
</dl>
<dt>11.  <a href="#schema">XML Schema</a>
</dt>
<dl>
<dt>11.1.  <a href="#schema-soap">SOAP Envelope</a>
</dt>
<dt>11.2.  <a href="#schema-error">Application-Specific XMPP Errors</a>
</dt>
</dl>
<dt>12.  <a href="#impl">Implementation Notes</a>
</dt>
<dt>13.  <a href="#acknowledgements">Acknowledgements</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style=""><span class="ref" style="">Simple Object Access Protocol (SOAP)</span>  [<a href="#nt-id2250646">1</a>] is a lightweight protocol that defines a method for the exchange of messages independently from the programming language and platform. For interoperability, the SOAP specification is also agnostic about possible transport protocols, though almost all existing implementations use mainly HTTP.</p>
  <p class="" style="">The primary limitation of HTTP consists in the fact that HTTP-based message exchanges allow only synchronous request-response semantics. To overcome this limitation, SMTP is often used to carry asynchronous messages, but it is a complex protocol and inefficient for passing short and frequent messages that should be delivered in close to real time.</p>
  <p class="" style="">Thus XMPP (see <span class="ref" style="">RFC 3920</span>  [<a href="#nt-id2250694">2</a>]) can be the ideal transport protocol for many of the application fields of web services, since it can carry efficiently and reliably both types of messages, synchronous and asynchronous. Moreover, XMPP-based web services will not need complex support protocols, such as <span style="font-weight: bold">WS-Routing</span>  [<a href="#nt-id2250674">3</a>] and <span style="font-weight: bold">WS-Referral</span>  [<a href="#nt-id2250718">4</a>], in order to deliver messages to entities that cannot be identified by static public IP addresses. Therefore, this JEP defines a binding of SOAP to XMPP as an alternative to the existing HTTP and SMTP bindings.</p>
  <p class="" style="">(Note: The main body of this JEP provides descriptive text suitable for use by XMPP developers. A formal description of the SOAP XMPP Binding itself is provided in the section of this document entitled <a href="#binding">SOAP XMPP Binding</a>.)</p>
<h2>2.
       <a name="arch">Architectural Assumptions</a>
</h2>
  <p class="" style="">The usual architecture of XMPP is described in Section 2 of <span style="font-weight: bold">RFC 3920</span>. In essence, XMPP is most commonly deployed using a client-server (or logical peer-to-peer) architecture quite similar to that of the email system, except that XMPP does not have multiple hops between servers, enforces domain names to prevent address spoofing, and enables channel encryption (via TLS) and authentication (via SASL) between client and server as well as among servers.</p>
  <p class="" style="">The binding of SOAP to XMPP assumes that most SOAP-enabled XMPP entities will be implemented as XMPP clients that communicate with other entities as logical peers. However, in order to deploy more scalable services, such entities could also be implemented as server-side components (see <span class="ref" style="">Jabber Component Protocol</span>  [<a href="#nt-id2250813">5</a>]) or even as special-purpose XMPP servers.</p>
  <p class="" style="">The SOAP specification defines the concepts of "SOAP intermediary" and "ultimate SOAP receiver" (see Section 1.5.3 of <span style="font-weight: bold">SOAP Version 1.2 Part 1</span>). In general, this specification assumes that XMPP entities that support the SOAP XMPP Binding will be ultimate SOAP receivers, since SOAP intermediaries tend to be artifacts of the existing SOAP bindings (HTTP and SMTP) rather than applicable to all possible bindings. SOAP intermediaries are usually deployed in order to (1) cross trust boundaries in protocols that do not enforce domain names or authenticate end-points, (2) ensure scalability, (3) secure messages sent over unencrypted channels, and (4) provide message tracing. However, these issues are addressed natively in XMPP (e.g., channel encryption is defined in <span style="font-weight: bold">RFC 3920</span>), in XMPP extensions (e.g., message tracing is defined in <span class="ref" style="">Advanced Message Processing</span>  [<a href="#nt-id2250305">6</a>]), or in deployment decisions such as business level agreements between XMPP domains. One final justification for SOAP intermediaries is to act as gateways between different transport mechanisms (e.g., between HTTP and SMTP), and XMPP entities may well be SOAP intermediaries for that reason. For further details about gateways between XMPP and other SOAP bindings, refer to the <a href="#impl">Implementation Notes</a> section of this document.</p>
<h2>3.
       <a name="uc">Use Cases</a>
</h2>
  <div class="indent">
<h3>3.1 <a name="disco">Discovering Support</a>
</h3>
    <p class="" style="">In order to determine whether a potential responding entity supports the SOAP XMPP Binding, a requesting entity SHOULD send a <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2250402">7</a>] information request to the potential responding entity:</p>
    <p class="caption">Example 1. Requester queries responder regarding protocol support</p>
<div class="indent"><pre>
&lt;iq from='requester@example.com/soap-client'
    to='responder@example.com/soap-server' 
    id='disco1'
    type='get'&gt; 
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the responding entity supports the SOAP XMPP Binding and the requesting entity is not blocked from communicating with the responding entity, the responding entity MUST include a feature of "http://jabber.org/protocol/soap" in its reply and SHOULD specify a service discovery identity of "automation/soap".</p>
    <p class="caption">Example 2. Responder replies regarding protocol support</p>
<div class="indent"><pre>
&lt;iq from='responder@example.com/soap-server' 
    to='requester@example.com/soap-client'
    id='disco1'
    type='result'&gt; 
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='automation' type='soap'/&gt;
    &lt;feature var='http://jabber.org/protocol/soap'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>3.2 <a name="exchange">Exchanging SOAP Messages</a>
</h3>
    <p class="" style="">When a requesting entity wants to interact with a responding entity via the SOAP XMPP Binding, it faces a fundamental choice: to use &lt;iq/&gt; stanzas or to use &lt;message/&gt; stanzas. The following guidelines may prove useful:</p>
    <ol start="" type="">
      <li>&lt;iq/&gt; stanzas SHOULD be used when more formal request-response semantics are needed or when an immediate answer is required.</li>
      <li>&lt;message/&gt; stanzas SHOULD be used when less formal request-response semantics are acceptable or when store-and-forward ("offline message") delivery is needed (e.g., because the intended recipient may be temporarily unavailable).</li>
    </ol>
    <p class="" style="">Examples of both approaches are provided below, encapsulating the SOAP message examples (a travel reservation flow) to be found in <span class="ref" style="">SOAP Version 1.2 Part 0</span>  [<a href="#nt-id2256581">8</a>].</p>
    <div class="indent">
<h3>3.2.1 <a name="exchange-iq">Exchanging SOAP Messages Using XMPP IQ Stanzas</a>
</h3>
      <p class="" style="">The transport with &lt;iq/&gt; stanzas is performed in a way similar to that described for XML-RPC in <span class="ref" style="">Jabber-RPC</span>  [<a href="#nt-id2256624">9</a>]. Request envelopes are carried by &lt;iq/&gt; stanzas of type "set", and answer envelopes by &lt;iq/&gt; stanzas of type "result". SOAP errors are encoded with standard SOAP envelopes, and returned in stanzas of type "error" with appropriate codes in order to distinguish them from errors specific to the XMPP transport layer (see <a href="#errors">Error Handling</a> for details).</p>
      <p class="" style="">Each &lt;iq/&gt; stanza of type "set" MUST contain a SOAP envelope as the first-level child element, since it already represents a properly namespaced XML subtree qualified by the 'http://www.w3.org/2003/05/soap-envelope' namespace.</p>
      <p class="caption">Example 3. Requesting entity sends IQ-set</p>
<div class="indent"><pre>
&lt;iq from='requester@example.com/soap-client'
    id='soap1'
    to='responder@example.com/soap-server' 
    type='set'&gt; 
  &lt;env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope"&gt; 
   &lt;env:Header&gt;
    &lt;m:reservation xmlns:m="http://travelcompany.example.org/reservation" 
            env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
             env:mustUnderstand="true"&gt;
     &lt;m:reference&gt;uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d&lt;/m:reference&gt;
     &lt;m:dateAndTime&gt;2001-11-29T13:20:00.000-05:00&lt;/m:dateAndTime&gt;
    &lt;/m:reservation&gt;
    &lt;n:passenger xmlns:n="http://mycompany.example.com/employees"
            env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
             env:mustUnderstand="true"&gt;
     &lt;n:name&gt;Ake Jogvan Ovind&lt;/n:name&gt;
    &lt;/n:passenger&gt;
   &lt;/env:Header&gt;
   &lt;env:Body&gt;
    &lt;p:itinerary
      xmlns:p="http://travelcompany.example.org/reservation/travel"&gt;
     &lt;p:departure&gt;
       &lt;p:departing&gt;New York&lt;/p:departing&gt;
       &lt;p:arriving&gt;Los Angeles&lt;/p:arriving&gt;
       &lt;p:departureDate&gt;2001-12-14&lt;/p:departureDate&gt;
       &lt;p:departureTime&gt;late afternoon&lt;/p:departureTime&gt;
       &lt;p:seatPreference&gt;aisle&lt;/p:seatPreference&gt;
     &lt;/p:departure&gt;
     &lt;p:return&gt;
       &lt;p:departing&gt;Los Angeles&lt;/p:departing&gt;
       &lt;p:arriving&gt;New York&lt;/p:arriving&gt;
       &lt;p:departureDate&gt;2001-12-20&lt;/p:departureDate&gt;
       &lt;p:departureTime&gt;mid-morning&lt;/p:departureTime&gt;
       &lt;p:seatPreference/&gt;
     &lt;/p:return&gt;
    &lt;/p:itinerary&gt;
    &lt;q:lodging
     xmlns:q="http://travelcompany.example.org/reservation/hotels"&gt;
     &lt;q:preference&gt;none&lt;/q:preference&gt;
    &lt;/q:lodging&gt;
   &lt;/env:Body&gt;
  &lt;/env:Envelope&gt;  
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If the responding entity does not support the SOAP XMPP Binding, it SHOULD return a &lt;service-unavailable/&gt; error:</p>
      <p class="caption">Example 4. Responding entity reports that it cannot handle SOAP messages</p>
<div class="indent"><pre>
&lt;iq type='result' to='requester@example.com/soap-client' id='soap1'&gt;
  &lt;error code='503' type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If a SOAP-related fault occurs, the mappings in <a href="#errors">Error Handling</a> SHOULD be used.</p>
      <p class="caption">Example 5. Responding entity indicates SOAP fault</p>
<div class="indent"><pre>
&lt;iq type='error' to='requester@example.com/soap-client' id='soap1'&gt;
  &lt;env:Envelope
      xmlns:env='http://www.w3.org/2003/05/soap-envelope'
      xmlns:rpc='http://www.w3.org/2003/05/soap-rpc'&gt;
    &lt;env:Body&gt;
      &lt;env:Fault&gt;
        &lt;env:Code&gt;
          &lt;env:Value&gt;env:Sender&lt;/env:Value&gt;
          &lt;env:Subcode&gt;
            &lt;env:Value&gt;rpc:BadArguments&lt;/env:Value&gt;
          &lt;/env:Subcode&gt;
        &lt;/env:Code&gt;
        &lt;env:Reason&gt;
          &lt;env:Text xml:lang='en-US'&gt;Processing error&lt;/env:Text&gt;
        &lt;/env:Reason&gt;
      &lt;/env:Fault&gt;
    &lt;/env:Body&gt;
  &lt;/env:Envelope&gt;
  &lt;error code='500' type='modify'&gt;
    &lt;undefined-condition xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;Sender xmlns='http://jabber.org/protocol/soap#fault'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If the responding entity does not return an error, it MUST respond with an IQ of type "result":</p>
      <p class="caption">Example 6. Responding entity returns IQ-result</p>
<div class="indent"><pre>
&lt;iq from='responder@example.com/soap-server' 
    id='soap1'
    to='requester@example.com/soap-client' 
    type='result'&gt;
  &lt;env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope"&gt; 
   &lt;env:Header&gt;
    &lt;m:reservation xmlns:m="http://travelcompany.example.org/reservation" 
        env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
             env:mustUnderstand="true"&gt;
     &lt;m:reference&gt;uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d&lt;/m:reference&gt;
     &lt;m:dateAndTime&gt;2001-11-29T13:35:00.000-05:00&lt;/m:dateAndTime&gt;
    &lt;/m:reservation&gt;
    &lt;n:passenger xmlns:n="http://mycompany.example.com/employees"
        env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
             env:mustUnderstand="true"&gt;
     &lt;n:name&gt;Ake Jogvan Ovind&lt;/n:name&gt;
    &lt;/n:passenger&gt;
   &lt;/env:Header&gt;
   &lt;env:Body&gt;
    &lt;p:itineraryClarification 
      xmlns:p="http://travelcompany.example.org/reservation/travel"&gt;
     &lt;p:departure&gt;
       &lt;p:departing&gt;
         &lt;p:airportChoices&gt;
            JFK LGA EWR 
         &lt;/p:airportChoices&gt;
       &lt;/p:departing&gt;
     &lt;/p:departure&gt;
     &lt;p:return&gt;
       &lt;p:arriving&gt;
         &lt;p:airportChoices&gt;
           JFK LGA EWR 
         &lt;/p:airportChoices&gt;
       &lt;/p:arriving&gt;
     &lt;/p:return&gt;  
    &lt;/p:itineraryClarification&gt;
   &lt;/env:Body&gt;
  &lt;/env:Envelope&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">At this point the requesting entity could send another IQ-set:</p>
      <p class="caption">Example 7. Requesting entity sends another IQ-set</p>
<div class="indent"><pre>
&lt;iq from='requester@example.com/soap-client'
    id='soap2'
    to='responder@example.com/soap-server' 
    type='set'&gt; 
  &lt;env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope"&gt; 
   &lt;env:Header&gt;
    &lt;m:reservation 
       xmlns:m="http://travelcompany.example.org/reservation" 
        env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
             env:mustUnderstand="true"&gt;
      &lt;m:reference&gt;uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d&lt;/m:reference&gt;
      &lt;m:dateAndTime&gt;2001-11-29T13:36:50.000-05:00&lt;/m:dateAndTime&gt;
    &lt;/m:reservation&gt;
    &lt;n:passenger xmlns:n="http://mycompany.example.com/employees"
        env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
             env:mustUnderstand="true"&gt;
     &lt;n:name&gt;Ake Jogvan Ovind&lt;/n:name&gt;
    &lt;/n:passenger&gt;
   &lt;/env:Header&gt;
   &lt;env:Body&gt;
    &lt;p:itinerary 
     xmlns:p="http://travelcompany.example.org/reservation/travel"&gt;
     &lt;p:departure&gt;
       &lt;p:departing&gt;LGA&lt;/p:departing&gt;
     &lt;/p:departure&gt;
     &lt;p:return&gt;
       &lt;p:arriving&gt;EWR&lt;/p:arriving&gt;
     &lt;/p:return&gt;
    &lt;/p:itinerary&gt;
   &lt;/env:Body&gt;
  &lt;/env:Envelope&gt;
&lt;/iq&gt;
      </pre></div>
    </div>
    <div class="indent">
<h3>3.2.2 <a name="exchange-message">Exchanging SOAP Messages Using XMPP Message Stanzas</a>
</h3>
      <p class="" style="">The process for exchanging SOAP messages using the XMPP &lt;message/&gt; stanza type is effectively no different from the use with &lt;iq/&gt; stanzas, except that message stanzas may be sent to bare JIDs (user@host) rather than full JIDs (user@host/resource), message stanzas may be stored for later delivery, etc. The following business rules apply:</p>
      <ol start="" type="">
        <li>The message stanza containing a request MUST carry one SOAP envelope as a first-level child element.</li>
        <li>The 'id' attribute MUST be used to track the XMPP messages and eventually associate errors or answers with the related requests (this is for tracking at the XMPP level, not the SOAP level).</li>
      </ol>
    </div>
  </div>
  <div class="indent">
<h3>3.3 <a name="data">Sending Associated Data</a>
</h3>
    <p class="" style="">SOAP messages may contain associated (usually binary) data, and XMPP stanzas that encapsulate such SOAP messages could invoke bandwidth restriction settings (commonly called "karma" in XMPP) tuned for normal text chats. The problem could be bypassed by servers having special karma settings for larger messages, or by SOAP-enabled entities being implemented as components rather than XMPP nodes; however, server-to-server communications risk becoming a serious bottleneck, especially in terms of latency and responsiveness when too many large messages are sent. Therefore, it is desirable to support the sending of attachments or files in order to exchange large amounts of binary data associated with SOAP requests and responses. The possible approaches are described below.</p>
    <div class="indent">
<h3>3.3.1 <a name="data-link">Links</a>
</h3>
      <p class="" style="">The first possible approach is to represent the binary data as a file, put it to an accessible location (e.g., HTTP or FTP URI), and insert a link to the file directly either into the SOAP envelope (e.g., via <span class="ref" style="">Resource Representation SOAP Header Block</span>  [<a href="#nt-id2256387">10</a>]) or into the XMPP message or IQ stanza (e.g, via <span class="ref" style="">Out-of-Band Data</span>  [<a href="#nt-id2256414">11</a>]).</p>
      <p class="caption">Example 8. SOAP representation header</p>
<div class="indent"><pre>
&lt;iq from='requester@example.com/soap-client'
    id='soaplink1'
    to='responder@example.com/soap-server' 
    type='set'&gt; 
  &lt;env:Envelope xmlns:env='http://www.w3.org/2003/05/soap-envelope' 
                xmlns:rep='http://www.w3.org/2004/08/representation' 
                xmlns:xmlmime='http://www.w3.org/2004/11/xmlmime'&gt;
    &lt;env:Header&gt;
      &lt;rep:Representation resource='http://example.org/me.png'&gt;
        &lt;rep:Data xmlmime:contentType='image/png'&gt;/aWKKapGGyQ=&lt;/rep:Data&gt;
      &lt;/rep:Representation&gt;
    &lt;/env:Header&gt;
    &lt;env:Body&gt;
      &lt;x:MyData xmlns:x='http://example.org/mystuff'&gt;
        &lt;x:name&gt;John Q. Public&lt;/x:name&gt;
        &lt;x:img src='http://example.org/me.png'/&gt;
      &lt;/x:MyData&gt;
    &lt;/env:Body&gt;
  &lt;/env:Envelope&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="caption">Example 9. XMPP IQ with out-of-band data</p>
<div class="indent"><pre>
&lt;iq from='requester@example.com/soap-client'
    id='soaplink2'
    to='responder@example.com/soap-server' 
    type='set'&gt; 
  &lt;query xmlns='jabber:iq:oob'&gt;
    &lt;url&gt;http://example.org/me.png&lt;/url&gt;
  &lt;/query&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">Although this is a general method that can be used by XMPP clients if they are able to put and retrieve files via HTTP or FTP, not all clients have access to HTTP/FTP servers. Therefore this approach SHOULD NOT be used except as a fallback.</p>
    </div>
    <div class="indent">
<h3>3.3.2 <a name="data-mime">MIME</a>
</h3>
      <p class="" style="">The second possible approach is to encode SOAP envelopes and attachments as MIME multipart messages using <span class="ref" style="">SOAP 1.2 Attachment Feature</span>  [<a href="#nt-id2256524">12</a>] (or, more recently, <span class="ref" style="">SOAP Message Transmission Optimization Mechanism</span>  [<a href="#nt-id2256492">13</a>] and <span class="ref" style="">XML-binary Optimized Packaging</span>  [<a href="#nt-id2257326">14</a>]).</p>
      <p class="caption">Example 10. SOAP attachment using MIME</p>
<div class="indent"><pre>
MIME-Version: 1.0
Content-Type: Multipart/Related; boundary=MIME_boundary; type=text/xml;
        start="&lt;claim061400a.xml@claiming-it.com&gt;"
Content-Description: This is the optional message description.

--MIME_boundary
Content-Type: text/xml; charset=UTF-8
Content-Transfer-Encoding: 8bit
Content-ID: &lt;claim061400a.xml@claiming-it.com&gt;

&lt;?xml version='1.0' ?&gt;
&lt;env:Envelope
xmlns:env='http://www.w3.org/2003/05/soap-envelope'&gt;
&lt;env:Body&gt;
..
&lt;theSignedForm href='cid:claim061400a.tiff@claiming-it.com'/&gt;
..
&lt;/env:Body&gt;
&lt;/env:Envelope&gt;

--MIME_boundary
Content-Type: image/tiff
Content-Transfer-Encoding: binary
Content-ID: &lt;claim061400a.tiff@claiming-it.com&gt;
...
      </pre></div>
      <p class="" style="">Although this approach can work well for the HTTP and email bindings of SOAP, it cannot be used directly by native XMPP entities since XML streams transport pure XML only and not MIME messages. Therefore this approach MUST NOT be used within the XMPP binding.</p>
    </div>
    <div class="indent">
<h3>3.3.3 <a name="data-transport">Other Transports</a>
</h3>
      <p class="" style="">A third possible approach is to use other protocols designed to transport SOAP and binary data together, such as <span style="font-weight: bold">WS-Attachments</span>  [<a href="#nt-id2257368">15</a>] and SOAP-over-BEEP as defined in <span class="ref" style="">RFC 3288</span>  [<a href="#nt-id2257399">16</a>].</p>
      <p class="" style="">However, these methods are just other transport protocols and most likely would needlessly complicate implementations of SOAP over XMPP. Therefore, implementations SHOULD NOT use these approaches.</p>
    </div>
    <div class="indent">
<h3>3.3.4 <a name="data-ft">File Transfer</a>
</h3>
      <p class="" style="">A fourth possible approach is to use the file transfer method described in <span class="ref" style="">File Transfer</span>  [<a href="#nt-id2257453">17</a>]. Because this is the common and standardized method for XMPP entities to transfer large or binary files outside the XMPP band, it SHOULD be used.</p>
      <p class="" style="">In particular, the entity that has the file SHOULD advertise the availability of the associated stream using <span class="ref" style="">Publishing SI Requests</span>  [<a href="#nt-id2257486">18</a>], at which point the entity that is to receive the file SHOULD initiate the file transfer process.</p>
      <p class="caption">Example 11. Requester advertises file</p>
<div class="indent"><pre>
&lt;message from='requester@example.com/soap-client'
         id='soapft1'
         to='responder@example.com/soap-server'&gt;
  &lt;sipub xmlns='http://jabber.org/protocol/si-pub'
      id='publish-2345'
      mime-type='image/png'
      profile='http://jabber.org/protocol/si/profile/file-transfer'&gt;
    &lt;file xmlns='http://jabber.org/protocol/si/profile/file-transfer'
          name='me.png'
          size='4238'
          date='2005-11-01T23:11Z'/&gt;
  &lt;/sipub&gt;
&lt;/message&gt;
      </pre></div>
      <p class="" style="">A potential receiver starts the stream initiation session by sending an IQ-get to the sender, using the &lt;start xmlns='http://jabber.org/protocol/sipub'/&gt; element. This element contains the 'id' attribute to specify which published stream to retrieve:</p>
      <p class="caption">Example 12. Receiver requests start of stream</p>
<div class="indent"><pre>
&lt;iq type='get'
    id='sipub-request-0'
    from='responder@example.com/soap-server'
    to='requester@example.com/soap-client'&gt;
  &lt;start xmlns='http://jabber.org/protocol/sipub'
         id='publish-2345'/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">If the sender accepts the request, it responds with an IQ-result containing a &lt;starting/&gt; element. This element indicates the stream initiation identifier to be used:</p>
      <p class="caption">Example 13. Sender accepts request to start stream</p>
<div class="indent"><pre>
&lt;iq type='result'
    id='sipub-request-0'
    from='requester@example.com/soap-client'
    to='responder@example.com/soap-server'&gt;
  &lt;starting xmlns='http://jabber.org/protocol/sipub'
            sid='session-87651234'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Then the sender begins the stream initiation negotiation:</p>
    <p class="caption">Example 14. Sender starts negotiation</p>
<div class="indent"><pre>
&lt;iq type='set'
    id='sipub-set-1'
    from='requester@example.com/soap-client'
    to='responder@example.com/soap-server'&gt;
  &lt;si xmlns='http://jabber.org/protocol/si'
      id='session-87651234'
        mime-type='image/png'
      profile='http://jabber.org/protocol/si/profile/file-transfer'&gt;
    &lt;file xmlns='http://jabber.org/protocol/si/profile/file-transfer'
          name='me.png'
          size='4238'
          date='2005-11-01T23:11Z'/&gt;
  &lt;/si&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">For details regarding file transfer and advertising of file transfer stream initiation requests, refer to <span style="font-weight: bold">JEP-0096</span> and <span style="font-weight: bold">JEP-0137</span>.</p>
    </div>
  </div>
  <div class="indent">
<h3>3.4 <a name="wsdl">Specifying a WSDL Definition</a>
</h3>
    <p class="" style=""><span class="ref" style="">WSDL</span>  [<a href="#nt-id2257624">19</a>] provides a machine-readable, formal description of web services operations, protocol bindings, and end points (i.e., network addresses). WSDL definitions attempt to specify a loose coupling of SOAP envelopes and their transports in order to maintain their independence and flexibility.</p>
    <p class="" style="">The definition of an XMPP SOAP transport in WSDL is straightforward. The following rules apply:</p>
    <ol start="" type="">
      <li>The 'transport' attribute of the &lt;soap:binding&gt; element MUST be set to "http://jabber.org/protocol/soap".</li>
      <li>The 'style' attribute of the &lt;soap:binding&gt; element SHOULD be set to "document".</li>
      <li>The 'soapAction' attribute of the &lt;soap:operation&gt; element MAY be used; if so, it SHOULD be transported in an appropriate env:Header element for compatibility with the HTTP transport.</li>
      <li>A valid <span class="ref" style="">XMPP IRI/URI</span>  [<a href="#nt-id2257696">20</a>] MUST be used for the 'location' attribute in the &lt;soap:address&gt; element.</li>
    </ol>
    <p class="" style="">The following is an example of a WSDL definition for an endpoint that supports the SOAP XMPP binding: a mythical service that translates Shakespearean English into selected modern languages and dialects.</p>
    <p class="caption">Example 15. Example of WSDL definition for a translation service that supports SOAP over XMPP</p>
<div class="indent"><pre>
&lt;definitions 
    name='ShakespeareTranslation' 
    targetNamespace='http://www.example.org/services/BabelFishService.wsdl'&gt;
    xmlns='http://schemas.xmlsoap.org/wsdl/'
    xmlns:soap='http://schemas.xmlsoap.org/wsdl/soap/'
    xmlns:tns='http://shakespeare.lit/translation.wsdl'&gt;
  
  &lt;binding name='ShakespeareTranslationSoap' type='tns:TranslationPortType'&gt;
    &lt;soap:binding style='document' transport='http://jabber.org/protocol/soap'/&gt;
    &lt;operation name='Translate'&gt;
      &lt;input&gt;...&lt;/input&gt;
      &lt;output&gt;...&lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;

  &lt;service name='ShakespeareTranslationService'&gt;
    &lt;documentation&gt;Translates Shakespearean text.&lt;/documentation&gt;
    &lt;port name='TranslationPort' binding='tns:ShakespeareTranslationSoap'&gt;
      &lt;soap:address location='xmpp:translation@shakespeare.lit'/&gt;
    &lt;/port&gt;
  &lt;/service&gt;

&lt;/definitions&gt;
    </pre></div>
    <p class="" style="">Although there is no standard procedure for publishing WSDL documents, usually they are made available through HTTP at some URL discoverable with public registries such as UDDI servers. WSDL descriptions for XMPP bindings MAY follow the same publishing process, or MAY be discoverable through Jabber/XMPP specific mechanisms such as <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2257780">21</a>] or <span class="ref" style="">Publish-Subscribe</span>  [<a href="#nt-id2257793">22</a>].</p>
  </div>
<h2>4.
       <a name="binding">SOAP XMPP Binding</a>
</h2>
  <p class="" style="">Section 4 of <span class="ref" style="">SOAP Version 1.2 Part 1</span>  [<a href="#nt-id2257826">23</a>] defines a SOAP Protocol Binding Framework; two instantiations of that framework are the SOAP HTTP Binding (specified in Section 7 of <span class="ref" style="">SOAP Version 1.2 Part 2</span>  [<a href="#nt-id2257849">24</a>]) and the <span class="ref" style="">SOAP Email Binding</span>  [<a href="#nt-id2257840">25</a>]. (Additionaly, a binding to BEEP is described in <span style="font-weight: bold">RFC 3288</span>.) As an alternative to the HTTP and Email bindings, this section formally defines the SOAP XMPP Binding in accordance with the SOAP Protocol Binding Framework.</p>
  <p class="" style="">Note: The SOAP XMPP Binding is optional, and SOAP nodes are not required to implement it. A SOAP node that correctly and completely implements the SOAP XMPP Binding as described herein may be said to "conform to the SOAP 1.2 XMPP Binding".</p>
  <div class="indent">
<h3>4.1 <a name="binding-name">Binding Name</a>
</h3>
    <p class="" style="">The SOAP XMPP Binding is identified by the following URI:</p>
    <ul>
      <li>http://jabber.org/protocol/soap</li> 
    </ul>
  </div>
  <div class="indent">
<h3>4.2 <a name="binding-features">Supported Features</a>
</h3>
    <p class="" style="">XMPP is a pure XML streaming protocol used to exchange snippets of structured data called "XML stanzas" (see Section 4.1 of <span style="font-weight: bold">RFC 3920</span>) between any two network endpoints.</p>
    <p class="" style="">Because XMPP is a direct messaging protocol, it does not possess the equivalent of web methods such as the HTTP GET, PUT, POST, and DELETE methods. Therefore, it is NOT RECOMMENDED for a SOAP node that supports only the SOAP XMPP Binding to provide the "SOAP Web Method Feature" described in Section 6.4 of <span style="font-weight: bold">SOAP Version 1.2 Part 2</span>. (A SOAP gateway between XMPP and HTTP should support the SOAP Web Method Feature in order to ensure interoperability; however, description of such gateways is outside the scope of this document.)</p>
    <p class="" style="">Because XMPP is a pure XML protocol, it does not use MIME types (<span class="ref" style="">RFC 2045</span>  [<a href="#nt-id2257982">26</a>]) or XML media types (<span class="ref" style="">RFC 3023</span>  [<a href="#nt-id2258008">27</a>]), but rather sends XML directly over the wire. Therefore, it is NOT RECOMMENDED for a SOAP node that supports only the SOAP XMPP Binding to provide the "SOAP Action Feature" described in Section 6.5 of <span style="font-weight: bold">SOAP Version 1.2 Part 2</span>. (A SOAP gateway between XMPP and HTTP should support the SOAP Action Feature in order to ensure interoperability; however, description of such gateways is outside the scope of this document.)</p>
  </div>
  <div class="indent">
<h3>4.3 <a name="binding-patterns">Supported Message Exchange Patterns</a>
</h3>
    <p class="" style="">XMPP inherently provides request-response semantics via the &lt;iq/&gt; stanza type and &lt;message/&gt; stanza type, where the &lt;iq/&gt; stanza type requires more formality regarding preservation of request-response semantics in the context of synchronous communications, whereas the &lt;message/&gt; stanza provides a looser mapping to request-response semantics as well as the ability to ensure store-and-forward capabilities similar to those provided by email (see the <a href="#impl">Implementation Notes</a> section of this document). Because both stanza types support request-response semantics, an implementation of the SOAP XMPP Binding MUST support only the following message exchange pattern (MEP) defined in the core SOAP 1.2 specification:</p>
    <ul>
      <li>http://www.w3.org/2003/05/soap/mep/request-response/</li>
    </ul>
  </div>
  <div class="indent">
<h3>4.4 <a name="binding-operation">Operation of Request-Response Message Exchange Pattern</a>
</h3>
    <p class="" style="">The request-response message exchange pattern is described in Section 6.2 of <span style="font-weight: bold">SOAP Version 1.1 Part 2</span>. For binding instances conforming to the specification of the SOAP XMPP Binding:</p>
    <ul>
      <li>A SOAP node instantiated at an XMPP entity may assume the role (i.e., the <tt>http://www.w3.org/2003/05/soap/bindingFramework/ExchangeContext/Role</tt> property) of "RequestingSOAPNode".</li>
      <li>A SOAP node instantiated at an XMPP entity may assume the role (i.e., the <tt>http://www.w3.org/2003/05/soap/bindingFramework/ExchangeContext/Role</tt> property) of "RespondingSOAPNode".</li>
    </ul>
    <p class="" style="">The remainder of this section describes the message exchange pattern (MEP) state machine and its relation to XMPP as described in <span style="font-weight: bold">RFC 3920</span>. For the sake of brevity, relative URIs are used (the base URI being <tt>http://www.w3.org/2003/05/soap/bindingFramework/ExchangeContext/Role</tt>), the string "fail:" is used as a conventional prefix for the namespace <tt>http://www.example.org/2001/12/soap/mep/FailureReasons/</tt>, and the string "reqresp:" is used as a conventional prefix for the namespace <tt>http://www.example.org/2001/12/soap/mep/request-response/</tt>. In the state tables below, the states are defined as values of the <tt>http://www.w3.org/2003/05/soap/bindingFramework/ExchangeContext/State</tt> property (see Section 6.2 of <span style="font-weight: bold">SOAP Version 1.2 Part 2</span>) and are of type xs:anyURI.</p>
    <div class="indent">
<h3>4.4.1 <a name="binding-operation-request">Behavior of Requesting SOAP Node</a>
</h3>
      <p class="" style="">The overall flow of the behavior of a Requesting SOAP Node follows the outline state machine description contained in Section 6.2 of <span style="font-weight: bold">SOAP Version 1.2 Part 2</span>. The following subsections describe each state in more detail, where "Requesting SOAP Node" is to be understood as a logical entity made up of the binding and the local SOAP node associated with the XMPP entity that generates a SOAP request.</p>
      <div class="indent">
<h3>4.4.1.1 <a name="binding-operation-request-init">Init</a>
</h3>
        <p class="" style="">The following table formally describes the "Init" state of the Requesting SOAP Node in the SOAP XMPP Binding:</p>
	<p class="caption">Table 1: Init: State Description (Requesting)</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Feature</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">State Name</td>
	    <td align="" colspan="" rowspan="">Init</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Description</td>
	    <td align="" colspan="" rowspan="">Formulate and send request message</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Pre-Conditions</td>
	    <td align="" colspan="" rowspan="">Control of the outbound transport message exchange context is transferred from the local SOAP node to the binding</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Actions</td>
	    <td align="" colspan="" rowspan="">Formulate and send XMPP &lt;iq/&gt; or &lt;message/&gt; request stanza (see table "Init: XMPP Fields (Requesting)") that encappsulates SOAP envelope transferred from local SOAP node to binding</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Post-Conditions</td>
	    <td align="" colspan="" rowspan="">None</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Transitions</td>
	    <td align="" colspan="" rowspan="">See table "Init: Transitions (Requesting)"</td>
	  </tr>
	</table>
        <p class="" style="">In the "Init" state, an XMPP stanza (either &lt;iq/&gt; or &lt;message/&gt;) is formulated by the Requesting SOAP Node according to the following table:</p>
	<p class="caption">Table 2: Init: XMPP Fields (Requesting)</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Field</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">XMPP Method</td>
	    <td align="" colspan="" rowspan="">For XMPP &lt;iq/&gt; stanzas, the value of the XMPP 'type' attribute MUST be "set"; does not apply to XMPP &lt;message/&gt; stanzas</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Originator</td>
	    <td align="" colspan="" rowspan="">The XMPP address (JID) carried in the <tt>reqresp:ImmediateSender</tt> property of the message exchange context is encapsulated as the value of the XMPP 'from' attribute; normally this is set by the XMPP server to which the originator connects</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Destination</td>
	    <td align="" colspan="" rowspan="">The XMPP address (JID) carried in the <tt>reqresp:ImmediateDestination</tt> property of the message exchange context is encapsulated as the value of the XMPP 'to' attribute</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Correlation Request Message ID</td>
	    <td align="" colspan="" rowspan="">As required for XMPP &lt;iq/&gt; stanzas in general and required for XMPP &lt;message/&gt; stanzas sent in the context of the SOAP XMPP Binding, a correlation request message ID is generated by the sender and encapsulated as the value of the XMPP 'id' attribute</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">XMPP Stanza Contents</td>
	    <td align="" colspan="" rowspan="">The XML of the SOAP envelope carried in the <tt>reqresp:OutboundMessage</tt> property of the transport message exchange context is encapsulated as a direct child element of the XMPP &lt;iq/&gt; or &lt;message/&gt; stanza</td>
	  </tr>
	</table>
        <p class="" style="">The following table summarizes the transitions from the "Init" state of the Requesting SOAP Node:</p>
	<p class="caption">Table 3: Init: Transitions (Requesting)</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Event / Condition</th>
	    <th colspan="" rowspan="">Next State</th>
	    <th colspan="" rowspan="">Failure Reason</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Request Successfully Sent</td>
	    <td align="" colspan="" rowspan="">Requesting</td>
	    <td align="" colspan="" rowspan="">N/A</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Failure to Send Request</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:TransmissionFailure</td>
	  </tr>
	</table>
      </div>
      <div class="indent">
<h3>4.4.1.2 <a name="binding-operation-request-requesting">Requesting</a>
</h3>
        <p class="" style="">The following table formally describes the "Requesting" state of the Requesting SOAP Node in the SOAP XMPP Binding:</p>
	<p class="caption">Table 4: Requesting: State Description</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Feature</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">State Name</td>
	    <td align="" colspan="" rowspan="">Requesting</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Description</td>
	    <td align="" colspan="" rowspan="">Waiting for correlated XMPP response (Request Message completely sent on exit from Init state)</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Pre-Conditions</td>
	    <td align="" colspan="" rowspan="">Completion of Init state</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Actions</td>
	    <td align="" colspan="" rowspan="">Wait for a receive XMPP response stanza</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Post-Conditions</td>
	    <td align="" colspan="" rowspan="">Instantiate or replace the <tt>reqresp:ImmediateSender</tt> property with an XMPP address (JID) that denotes the sender of the XMPP response stanza</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Transitions</td>
	    <td align="" colspan="" rowspan="">See table "Requesting: Transitions"</td>
	  </tr>
	</table>
        <p class="" style="">The following table summarizes the transitions from the "Requesting" state of the Requesting SOAP Node:</p>
	<p class="caption">Table 5: Requesting: Transitions</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Event / Condition</th>
	    <th colspan="" rowspan="">Next State</th>
	    <th colspan="" rowspan="">Failure Reason</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Received Correlated XMPP Response</td>
	    <td align="" colspan="" rowspan="">Sending+Receiving</td>
	    <td align="" colspan="" rowspan="">N/A</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Reception Failure (various XMPP errors)</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:ReceptionFailure</td>
	  </tr>
	</table>
	<p class="" style="">For a listing of relevant XMPP error conditions, refer to Sections 9.3.3 and 4.7.3 of <span style="font-weight: bold">RFC 3920</span>.</p>
      </div>
      <div class="indent">
<h3>4.4.1.3 <a name="binding-operation-request-sendingreceiving">Sending+Receiving</a>
</h3>
        <p class="" style="">The following table formally describes the "Sending+Receiving" state of the Requesting SOAP Node in the SOAP XMPP Binding:</p>
	<p class="caption">Table 6: Sending+Receiving: State Description</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Feature</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">State Name</td>
	    <td align="" colspan="" rowspan="">Sending+Receiving</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Description</td>
	    <td align="" colspan="" rowspan="">Receive correlated XMPP response including SOAP envelope</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Pre-Conditions</td>
	    <td align="" colspan="" rowspan="">Completion of Receiving state</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Actions</td>
	    <td align="" colspan="" rowspan="">Process XMPP &lt;iq/&gt; or &lt;message/&gt; response stanza and included SOAP envelope, instantiating or replacing the <tt>reqresp:InboundMessage</tt> property with an infoset representation of the SOAP envelope contained in the XMPP response stanza</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Post-Conditions</td>
	    <td align="" colspan="" rowspan="">Control of the inbound transport message exchange context is transferred from the binding to the local SOAP node</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Transitions</td>
	    <td align="" colspan="" rowspan="">See table "Sending+Receiving: Transitions"</td>
	  </tr>
	</table>
        <p class="" style="">The following table summarizes the transitions from the "Sending+Receiving" state of the Requesting SOAP Node:</p>
	<p class="caption">Table 7: Sending+Receiving: Transitions</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Event / Condition</th>
	    <th colspan="" rowspan="">Next State</th>
	    <th colspan="" rowspan="">Failure Reason</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Received Well-Formed Response Message</td>
	    <td align="" colspan="" rowspan="">Success</td>
	    <td align="" colspan="" rowspan="">N/A</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Reception Failure (various XMPP errors)</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:ReceptionFailure</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Malformed Response Message (invalid SOAP envelope)</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:BadRequestMessage</td>
	  </tr>
	</table>
	<p class="" style="">For a listing of relevant XMPP error conditions, refer to Sections 9.3.3 and 4.7.3 of <span style="font-weight: bold">RFC 3920</span>.</p>
      </div>
      <div class="indent">
<h3>4.4.1.4 <a name="binding-operation-request-successfail">Success and Fail</a>
</h3>
        <p class="" style="">A given instance of a request-response transport message exchange terminates when the state "Success" or "Fail" is reached; control over the transport message exchange context returns to the Requesting SOAP Node.</p>
      </div>
    </div>
    <div class="indent">
<h3>4.4.2 <a name="binding-operation-response">Behavior of Responding SOAP Node</a>
</h3>
      <p class="" style="">The overall flow of the behavior of a Responding SOAP Node follows the outline state machine description contained in Section 6.2 of <span style="font-weight: bold">SOAP Version 1.2 Part 2</span>. The following subsections describe each state in more detail, where "Responding SOAP Node" is to be understood as a logical entity made up of the binding and the local SOAP node associated with the XMPP entity that responds to a SOAP request.</p>
      <div class="indent">
<h3>4.4.2.1 <a name="binding-operation-response-init">Init</a>
</h3>
        <p class="" style="">The following table formally describes the "Init" state of the Responding SOAP Node in the SOAP XMPP Binding:</p>
	<p class="caption">Table 8: Init: State Description (Responding)</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Feature</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">State Name</td>
	    <td align="" colspan="" rowspan="">Init</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Description</td>
	    <td align="" colspan="" rowspan="">Receive request message</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Pre-Conditions</td>
	    <td align="" colspan="" rowspan="">None</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Actions</td>
	    <td align="" colspan="" rowspan="">Receive and validate inbound XMPP &lt;iq/&gt; or &lt;message/&gt; request stanza; instantiate or replace the <tt>reqresp:ImmediateSender</tt> property with an XMPP address (JID) that denotes the sender of the XMPP request; instantiate or replace the <tt>reqresp:InboundMessage</tt> property with an infoset representation of the included SOAP envelope</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Post-Conditions</td>
	    <td align="" colspan="" rowspan="">Control of the inbound transport message exchange context is transferred from the binding to the local SOAP node</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Transitions</td>
	    <td align="" colspan="" rowspan="">See table "Init: Transitions (Responding)"</td>
	  </tr>
	</table>
        <p class="" style="">The following table summarizes the transitions from the "Init" state of the Responding SOAP Node:</p>
	<p class="caption">Table 9: Init: Transitions (Responding)</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Event / Condition</th>
	    <th colspan="" rowspan="">Next State</th>
	    <th colspan="" rowspan="">Failure Reason</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Received Well-Formed Request Message</td>
	    <td align="" colspan="" rowspan="">Receiving</td>
	    <td align="" colspan="" rowspan="">N/A</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Reception Failure (various XMPP errors)</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:ReceptionFailure</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Malformed Response Message (invalid SOAP envelope)</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:BadRequestMessage</td>
	  </tr>
	</table>
	<p class="" style="">For a listing of relevant XMPP error conditions, refer to Section 9.3.3 of <span style="font-weight: bold">RFC 3920</span>.</p>
      </div>
      <div class="indent">
<h3>4.4.2.2 <a name="binding-operation-response-receiving">Receiving</a>
</h3>
        <p class="" style="">The following table formally describes the "Receiving" state of the Responding SOAP Node in the SOAP XMPP Binding:</p>
	<p class="caption">Table 10: Receiving: State Description</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Feature</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">State Name</td>
	    <td align="" colspan="" rowspan="">Receiving</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Description</td>
	    <td align="" colspan="" rowspan="">Waiting for local SOAP node to return response message</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Pre-Conditions</td>
	    <td align="" colspan="" rowspan="">Completion of Init state</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Actions</td>
	    <td align="" colspan="" rowspan="">None</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Post-Conditions</td>
	    <td align="" colspan="" rowspan="">Control of the outbound transport message exchange context is transferred from the local SOAP node to the binding</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Transitions</td>
	    <td align="" colspan="" rowspan="">See table "Receiving: Transitions"</td>
	  </tr>
	</table>
        <p class="" style="">The following table summarizes the transitions from the "Receiving" state of the Responding SOAP Node:</p>
	<p class="caption">Table 11: Receiving: Transitions</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Event / Condition</th>
	    <th colspan="" rowspan="">Next State</th>
	    <th colspan="" rowspan="">Failure Reason</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Response Message Becomes Available</td>
	    <td align="" colspan="" rowspan="">Receiving+Sending</td>
	    <td align="" colspan="" rowspan="">N/A</td>
	  </tr>
	</table>
      </div>
      <div class="indent">
<h3>4.4.2.3 <a name="binding-operation-response-receivingsending">Receiving+Sending</a>
</h3>
        <p class="" style="">The following table formally describes the "Receiving+Sending" state of the Responding SOAP Node in the SOAP XMPP Binding:</p>
	<p class="caption">Table 12: Receiving+Sending: State Description</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Feature</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">State Name</td>
	    <td align="" colspan="" rowspan="">Receiving+Sending</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Description</td>
	    <td align="" colspan="" rowspan="">Waiting for local SOAP node to return response message</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Pre-Conditions</td>
	    <td align="" colspan="" rowspan="">Completion of Receiving state</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Actions</td>
	    <td align="" colspan="" rowspan="">Formulate and send XMPP &lt;iq/&gt; or &lt;message/&gt; response stanza (see table "Receiving+Sending: XMPP Fields")</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Post-Conditions</td>
	    <td align="" colspan="" rowspan="">None</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Transitions</td>
	    <td align="" colspan="" rowspan="">See table "Receiving+Sending: Transitions"</td>
	  </tr>
	</table>
        <p class="" style="">In the "Receiving+Sending" state, an XMPP stanza (either &lt;iq/&gt; or &lt;message/&gt;) is formulated by the Responding SOAP Node according to the following table:</p>
	<p class="caption">Table 13: Receiving+Sending: XMPP Fields</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Field</th>
	    <th colspan="" rowspan="">Value / Description</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">XMPP Method</td>
	    <td align="" colspan="" rowspan="">For XMPP &lt;iq/&gt; stanzas, the value of the XMPP 'type' attribute MUST be "result"; does not apply to XMPP &lt;message/&gt; stanzas</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Originator</td>
	    <td align="" colspan="" rowspan="">The XMPP address (JID) carried in the <tt>reqresp:ImmediateSender</tt> property of the message exchange context is encapsulated as the value of the XMPP 'from' attribute; normally set by the XMPP server to which the originator connects</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Destination</td>
	    <td align="" colspan="" rowspan="">The XMPP address (JID) carried in the <tt>reqresp:ImmediateDestination</tt> property of the message exchange context is encapsulated as the value of the XMPP 'to' attribute</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Correlation Request Message ID</td>
	    <td align="" colspan="" rowspan="">As required for XMPP &lt;iq/&gt; stanzas in general and required for XMPP &lt;message/&gt; stanzas sent in the context of the SOAP XMPP Binding, the correlation request message ID is copied from the ID of the request and encapsulated as the value of the XMPP 'id' attribute</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">XMPP Stanza Contents</td>
	    <td align="" colspan="" rowspan="">The XML of the SOAP envelope carried in the <tt>reqresp:OutboundMessage</tt> property of the transport message exchange context is encapsulated as a direct child element of the XMPP &lt;iq/&gt; or &lt;message/&gt; stanza</td>
	  </tr>
	</table>
        <p class="" style="">The following table summarizes the transitions from the "Receiving+Sending" state of the Responding SOAP Node:</p>
	<p class="caption">Table 14: Receiving: Transitions</p>
<table border="1" cellpadding="3" cellspacing="0">
	  <tr class="body">
	    <th colspan="" rowspan="">Event / Condition</th>
	    <th colspan="" rowspan="">Next State</th>
	    <th colspan="" rowspan="">Failure Reason</th>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Response Message Successfully Sent</td>
	    <td align="" colspan="" rowspan="">Success</td>
	    <td align="" colspan="" rowspan="">N/A</td>
	  </tr>
	  <tr class="body">
	    <td align="" colspan="" rowspan="">Failure to Send Response Message</td>
	    <td align="" colspan="" rowspan="">Fail</td>
	    <td align="" colspan="" rowspan="">fail:TransmissionFailure</td>
	  </tr>
	</table>
      </div>
      <div class="indent">
<h3>4.4.2.4 <a name="binding-operation-response-successfail">Success and Fail</a>
</h3>
        <p class="" style="">A given instance of a request-response transport message exchange terminates when the state "Success" or "Fail" is reached; from the perspective of the Responding SOAP Node, the transport message exchange has completed.</p>
      </div>
    </div>
  </div>
<h2>5.
       <a name="w3c">W3C Considerations</a>
</h2>
  <p class="" style="">The main body of text that addresses the requirements of the W3C with regard to SOAP bindings is provided in the <a href="#binding">SOAP XMPP Binding</a> section of this document. The current section addresses only the topic of organizational interaction between the W3C and the <span class="ref" style="">Jabber Software Foundation (JSF)</span>  [<a href="#nt-id2260246">28</a>] regarding the SOAP XMPP Binding.</p>
  <div class="indent">
<h3>5.1 <a name="w3c-review">W3C Review</a>
</h3>
    <p class="" style="">As was done with <span class="ref" style="">XHTML-IM</span>  [<a href="#nt-id2260294">29</a>], the SOAP XMPP Binding defined herein has been reviewed informally by one or more appropriate experts from the W3C before the <span class="ref" style="">Jabber Council</span>  [<a href="#nt-id2260316">30</a>] advanced it to a status of Draft within the JSF's standards process. Before this specification proceeds to a status of Final within the JSF's standards process, it should undergo a formal review through communication with the W3C's <a href="http://www.w3.org/2000/xp/Group/">XML Protocol Working Group</a>. To that end, revised versions of this specification will be announced on the W3C's public xml-dist-app@w3.org mailing list.</p>
  </div>
  <div class="indent">
<h3>5.2 <a name="w3c-soapversions">SOAP Versioning</a>
</h3>
    <p class="" style="">This specification addresses SOAP 1.2 only. This specification may be superseded or supplemented in the future by a Jabber Enhancement Proposal that defines methods for encapsulating content defined by future versions of SOAP as published by the W3C.</p>
  </div>
  <div class="indent">
<h3>5.3 <a name="w3c-xmlversions">XML Versioning</a>
</h3>
    <p class="" style="">Per <span style="font-weight: bold">RFC 3920</span>, XMPP supports XML 1.0 only. If future versions of XMPP support XML 1.1 or subsequent versions, this specification may be modified to address handling of SOAP messages that are encoded in versions other than XML 1.0.</p>
  </div>
<h2>6.
       <a name="errors">Error Handling</a>
</h2>
  <p class="" style="">SOAP provides its own encoding scheme for errors due to message processing or application execution, and it uses SOAP envelopes for reporting. In the SOAP HTTP Binding, these errors are mapped to corresponding HTTP status codes. In the SOAP XMPP Binding, they are mapped to the catch-all XMPP error of &lt;undefined-condition/&gt; along with application-specific error condition elements qualified by the 'http://jabber.org/protocol/soap#fault' namespace (this is consistent with Section 9.3.3 of <span style="font-weight: bold">RFC 3920</span>, see also <span class="ref" style="">Error Condition Mappings</span>  [<a href="#nt-id2260429">31</a>]). The element names of these application-specific error conditions map directly to the SOAP fault codes specified in Section 5.4.6 of <span style="font-weight: bold">SOAP Version 1.2 Part 1</span>.</p>
  <p class="" style="">The following table provides a mapping between SOAP, HTTP, and application-specific XMPP errors.</p>
  <p class="caption">Table 15: Mapping of SOAP Faults to HTTP Status Codes and XMPP Error Conditions</p>
<table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th colspan="" rowspan="">SOAP Fault</th>
      <th colspan="" rowspan="">HTTP Status Code</th>
      <th colspan="" rowspan="">XMPP Application Error</th>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">env:DataEncodingUnknown</td>
      <td align="" colspan="" rowspan="">500</td>
      <td align="" colspan="" rowspan="">&lt;DataEncodingUnknown/&gt;</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">env:MustUnderstand</td>
      <td align="" colspan="" rowspan="">500</td>
      <td align="" colspan="" rowspan="">&lt;MustUnderstand/&gt;</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">env:Receiver</td>
      <td align="" colspan="" rowspan="">500</td>
      <td align="" colspan="" rowspan="">&lt;Receiver/&gt;</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">env:Sender</td>
      <td align="" colspan="" rowspan="">400</td>
      <td align="" colspan="" rowspan="">&lt;Sender/&gt;</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">env:VersionMismatch</td>
      <td align="" colspan="" rowspan="">500</td>
      <td align="" colspan="" rowspan="">&lt;VersionMismatch/&gt;</td>
      </tr>
  </table>
  <p class="" style="">Note: When errors are due to the XMPP transport protocol alone and not to the application layer defined by SOAP, errors MUST be reported with standard XMPP error codes only instead of the XMPP &lt;undefined-condition/&gt; condition plus application-specific condition.</p> 
<h2>7.
       <a name="bizrules">Business Rules</a>
</h2>
  <div class="indent">
<h3>7.1 <a name="bizrules-encoding">Encoding</a>
</h3>
    <p class="" style="">Because XMPP does not require the parsing of arbitrary and complete XML documents and does not require implementations to support the full XML specification, transported SOAP envelopes MUST comply with the XML restrictions specified in Section 11 ("XML Usage Within XMPP") of <span style="font-weight: bold">RFC 3920</span>. In particular, all envelope elements MUST be properly namespaced (SOAP allows elements within the default namespace, but they are deprecated since SOAP 1.2).</p>
    <p class="" style="">SOAP envelopes may contain arbitrary data encoded in valid XML as well as byte arrays encoded with SOAP-specific elements. The SOAP specification recommends to encode byte arrays in Base 64 (see <span class="ref" style="">RFC 3548</span>  [<a href="#nt-id2260687">32</a>]), with the result that envelopes with binary data can be transported within regular XMPP stanzas. All the remaining PCDATA MUST be encoded as UTF-8 in order to match the XML stream encoding.</p>
  </div>
<h2>8.
       <a name="security">Security Considerations</a>
</h2>
    <p class="" style="">SOAP has been supplemented by several support protocols that help ensure message integrity and confidentiality (<span style="font-weight: bold">WS-Security</span>  [<a href="#nt-id2260712">33</a>]) as well as transaction management for failing message exchanges (<span style="font-weight: bold">WS-Transaction</span>
     [<a href="#nt-id2260727">34</a>]). These protocols are all based on SOAP messages and take into account that the underlying protocols can be unreliable and not trusted, thus there are no arguments against their application with XMPP. Alternatively, implementations MAY use native XMPP security such as <span class="ref" style="">XMPP E2E</span>  [<a href="#nt-id2260765">35</a>].</p>
<h2>9.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">No interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2260809">36</a>] is required as a result of this JEP.</p>
<h2>10.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>10.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
    <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2260860">37</a>] includes 'http://jabber.org/protocol/soap' in its registry of protocol namespaces.</p>
  </div>
  <div class="indent">
<h3>10.2 <a name="registrar-disco">Service Discovery Identity</a>
</h3>
    <p class="" style="">The Jabber Registrar includes a Service Discovery type of "soap" within the "automation" category.</p>
    <p class="" style="">The registry submission is as follows:</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;category&gt;
  &lt;name&gt;automation&lt;/name&gt;
  &lt;type&gt;
    &lt;name&gt;soap&lt;/name&gt;
    &lt;desc&gt;A SOAP receiver (either intermediate or ultimate).&lt;/desc&gt;
    &lt;doc&gt;JEP-0072&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
    </pre></div>
  </div>
<h2>11.
       <a name="schema">XML Schema</a>
</h2>
  <div class="indent">
<h3>11.1 <a name="schema-soap">SOAP Envelope</a>
</h3>
    <p class="" style="">Because the SOAP envelope is included as a first-level child element of an &lt;iq/&gt; or &lt;message/&gt; stanza via standard XMPP extension mechanisms, an XML schema is not required for this JEP. An XML schema for the SOAP envelope element is provided at &lt;<a href="http://www.w3.org/2003/05/soap-envelope/">http://www.w3.org/2003/05/soap-envelope/</a>&gt;.</p>
  </div>
  <div class="indent">
<h3>11.2 <a name="schema-error">Application-Specific XMPP Errors</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/soap#fault'
    xmlns='http://jabber.org/protocol/soap#fault'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='DataEncodingUnknown' type='empty'/&gt;
  &lt;xs:element name='MustUnderstand' type='empty'/&gt;
  &lt;xs:element name='Receiver' type='empty'/&gt;
  &lt;xs:element name='Sender' type='empty'/&gt;
  &lt;xs:element name='VersionMismatch' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
<h2>12.
       <a name="impl">Implementation Notes</a>
</h2>
  <p class="" style=""><span style="font-style: italic">This section is non-normative.</span></p> 
  <p class="" style="">An XMPP entity that supports the SOAP XMPP binding could function as a "SOAP intermediary" that hands a SOAP message off to some other deployment for subsequent processing (HTTP, email, a specialized enterprise messaging platform, etc.) rather than functioning as the "ultimate SOAP receiver" for the message (as these terms are defined in Section 1.5.3 of <span style="font-weight: bold">SOAP Version 1.2 Part 1</span>). If the intended recipient functions as a SOAP intermediary, implementations should be aware that subsequent processing may alter the representation of SOAP messages.</p>
  <p class="" style="">As an example, consider a component that functions as a gateway between XMPP-based and HTTP-based web services. Its purpose might be to mix HTTP and XMPP for web services and to invoke any web services already accessible through HTTP from XMPP clients.</p>
  <p class="" style=""><span style="font-weight: bold">WS-Routing</span>, whose aim is to dynamically compose SOAP message paths and processing sequences, can be used in order to reference web services outside of an XMPP network from within it. WS-Routing extends SOAP Envelope Headers with the &lt;path/&gt; element, which specifies the following for the message: the sender's URL (&lt;from/&gt;), the final destination's URL (&lt;to/&gt;), a forward (&lt;forward/&gt;) path with an arbitrary number of intermediaries (&lt;via/&gt;), and an optional return path (&lt;reverse/&gt;). Each intermediary MUST process the &lt;path/&gt; header and update it accordingly to the already performed path; moreover it MAY process the Body of the message.</p>
  <p class="" style="">A SOAP message originated by an XMPP entity ('xmpp:orig@A.example.com/soap'), and directed to an end point accessible through HTTP ('http://C.example.net/some/endpoint'), could be built using a &lt;path/&gt; header having:</p>
  <ol start="" type="">
    <li>the &lt;to/&gt; element set to 'http://C.example.net/some/endpoint'</li>
    <li>one &lt;via/&gt; element set to an HTTP&lt;-&gt;XMPP gateway, such as 'xmpp:soapgw@B.example.org/soap', in the forward path</li>
    <li>an appropriate SOAP action in the  &lt;action&gt; element of the &lt;path/&gt; header (this may be required by the HTTP end point)</li>
    <li>a blank return path</li>
  </ol>
  <p class="" style="">Then the SOAP message can be sent within an &lt;iq/&gt; stanza to the gateway's JID. The gateway processes the SOAP headers, and looking through the headers it discovers that it must act only as intermediary. From the &lt;to/&gt; element it reads the URL of the final end point, extracts the SOAP action, changes the path removing the step already performed, and issues an HTTP request with the modified envelope and appropriate HTTP headers. Once it has received a response, it prepares a new &lt;iq/&gt; stanza of type "result" or "error" and sends its reply to the original requester. The following example shows the possible SOAP headers of the described process.</p>
  <p class="caption">Example 16. Gateway-generated SOAP headers</p>
<div class="indent"><pre>
&lt;S:Envelope xmlns:S='http://www.w3.org/2003/05/soap-envelope'&gt;
   &lt;S:Header&gt;
      &lt;m:path xmlns:m='http://www.soap.org/path'&gt;
         &lt;m:action&gt;http://im.example.org/chat&lt;/m:action&gt;
         &lt;m:to&gt;http://C.example.net/some/endpoint&lt;/m:to&gt;
         &lt;m:forward&gt;
            &lt;m:via&gt;xmpp:soapgw@B.example.org/soap&lt;/m:via&gt;
         &lt;/m:forward&gt;
         &lt;m:reverse&gt;
            &lt;m:via/&gt;
         &lt;/m:reverse&gt;
         &lt;m:from&gt;xmpp:orig@A.example.com/soap&lt;/m:from&gt;
         &lt;m:id&gt;uuid:84b9f5d0-33fb-4a81-b02b-5b760641c1d6&lt;/m:id&gt;
      &lt;/m:path&gt;
   &lt;/S:Header&gt;
   &lt;S:Body&gt;
      ...
   &lt;/S:Body&gt;
&lt;/S:Envelope&gt;
  </pre></div>
  <p class="" style="">Generic XMPP routers that conform to <span style="font-weight: bold">RFC 3920</span> may also "store and forward" Jabber messages. This feature is usually called "offline message handling": the router makes a decision as to whether to deliver the message to the local intended recipient based on the recipient's presence, and if the recipient is offline when the router processes the message then it may store the message for delivery when the recipient next comes online (rather than returning an error to the sender). Although it is possible to write an XMPP router that directly supports the SOAP XMPP binding and implements the SOAP processing model, generic XMPP routers do not contain such support. Accordingly, generic XMPP routers will not forward an XMPP message to an alternate SOAP transport such as HTTP or SMTP, or provide other functions of a SOAP intermediary or ultimate receiver. When a generic XMPP router delivers a message to the intended recipient (whether immediately or as delayed in "offline storage") and the intended recipient supports the SOAP XMPP binding, SOAP processing is performed; such an intended recipient MAY act either as a SOAP intermediary or as an ultimate SOAP receiver.</p>
  <p class="" style="">With regarding to exchange of associated data, an XMPP entity that functions as a gateway to other SOAP bindings it SHOULD use W3C-recommended protocols for transporting SOAP attachments over non-XMPP SOAP bindings (e.g., HTTP and SMTP) when communicating with non-XMPP entities.</p>
<h2>13.
       <a name="acknowledgements">Acknowledgements</a>
</h2>
  <p class="" style="">Many thanks to Noah Mendelsohn for his assistance regarding SOAP binding definitions and conformance issues. Thanks also to Michael Mahan and Rich Salz for their comments.</p>
  <p class="" style="">Some text in the <a href="#binding">SOAP XMPP Binding</a> section of this document is closely modelled on Section 7 of <span style="font-weight: bold">SOAP Version 1.2 Part 2</span> and on <span style="font-weight: bold">SOAP Version 1.2 Email Binding</span>.</p>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250646">1</a>. Simple Object Access Protocol (SOAP) &lt;<a href="http://www.w3.org/TR/SOAP/">http://www.w3.org/TR/SOAP/</a>&gt;.</p>
<p><a name="nt-id2250694">2</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2250674">3</a>. WS-Routing Specification &lt;<a href="http://msdn.microsoft.com/library/en-us/dnglobspec/html/ws-routing.asp">http://msdn.microsoft.com/library/en-us/dnglobspec/html/ws-routing.asp</a>&gt;.</p>
<p><a name="nt-id2250718">4</a>. WS-Referral Specification &lt;<a href="http://msdn.microsoft.com/library/en-us/dnglobspec/html/ws-referral.asp">http://msdn.microsoft.com/library/en-us/dnglobspec/html/ws-referral.asp</a>&gt;.</p>
<p><a name="nt-id2250813">5</a>. JEP-0114: Jabber Component Protocol &lt;<a href="http://www.jabber.org/jeps/jep-0114.html">http://www.jabber.org/jeps/jep-0114.html</a>&gt;.</p>
<p><a name="nt-id2250305">6</a>. JEP-0079: Advanced Message Processing &lt;<a href="http://www.jabber.org/jeps/jep-0079.html">http://www.jabber.org/jeps/jep-0079.html</a>&gt;.</p>
<p><a name="nt-id2250402">7</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2256581">8</a>. SOAP Version 1.2 Part 0: Primer &lt;<a href="http://www.w3.org/TR/soap12-part0">http://www.w3.org/TR/soap12-part0</a>&gt;.</p>
<p><a name="nt-id2256624">9</a>. JEP-0009: Jabber-RPC &lt;<a href="http://www.jabber.org/jeps/jep-0009.html">http://www.jabber.org/jeps/jep-0009.html</a>&gt;.</p>
<p><a name="nt-id2256387">10</a>. Resource Representation SOAP Header Block &lt;<a href="http://www.w3.org/TR/soap12-rep">http://www.w3.org/TR/soap12-rep</a>&gt;.</p>
<p><a name="nt-id2256414">11</a>. JEP-0066: Out of Band Data &lt;<a href="http://www.jabber.org/jeps/jep-0066.html">http://www.jabber.org/jeps/jep-0066.html</a>&gt;.</p>
<p><a name="nt-id2256524">12</a>. SOAP 1.2 Attachment Feature &lt;<a href="http://www.w3.org/TR/soap12-af/">http://www.w3.org/TR/soap12-af/</a>&gt;.</p>
<p><a name="nt-id2256492">13</a>. SOAP Message Transmission Optimization Mechanism &lt;<a href="http://www.w3.org/TR/soap12-mtom">http://www.w3.org/TR/soap12-mtom</a>&gt;.</p>
<p><a name="nt-id2257326">14</a>. XML-binary Optimized Packaging &lt;<a href="http://www.w3.org/TR/xop10/">http://www.w3.org/TR/xop10/</a>&gt;.</p>
<p><a name="nt-id2257368">15</a>. WS-Attachments &lt;<a href="http://www.watersprings.org/pub/id/draft-nielsen-dime-soap-01.txt">http://www.watersprings.org/pub/id/draft-nielsen-dime-soap-01.txt</a>&gt; (work in progress).</p>
<p><a name="nt-id2257399">16</a>. RFC 3288: Using the Simple Object Access Protocol (SOAP) in Blocks Extensible Exchange Protocol (BEEP) &lt;<a href="http://www.ietf.org/rfc/rfc3288.txt">http://www.ietf.org/rfc/rfc3288.txt</a>&gt;.</p>
<p><a name="nt-id2257453">17</a>. JEP-0096: File Transfer &lt;<a href="http://www.jabber.org/jeps/jep-0096.html">http://www.jabber.org/jeps/jep-0096.html</a>&gt;.</p>
<p><a name="nt-id2257486">18</a>. JEP-0137: Publishing SI Requests &lt;<a href="http://www.jabber.org/jeps/jep-0137.html">http://www.jabber.org/jeps/jep-0137.html</a>&gt;.</p>
<p><a name="nt-id2257624">19</a>. WSDL 1.1 Specification &lt;<a href="http://www.w3.org/TR/wsdl">http://www.w3.org/TR/wsdl</a>&gt;.</p>
<p><a name="nt-id2257696">20</a>. Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP) &lt;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-xmpp-iri-02.txt">http://www.ietf.org/internet-drafts/draft-saintandre-xmpp-iri-02.txt</a>&gt; (work in progress).</p>
<p><a name="nt-id2257780">21</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2257793">22</a>. JEP-0060: Publish-Subscribe &lt;<a href="http://www.jabber.org/jeps/jep-0060.html">http://www.jabber.org/jeps/jep-0060.html</a>&gt;.</p>
<p><a name="nt-id2257826">23</a>. SOAP Version 1.2 Part 1: Messaging &lt;<a href="http://www.w3.org/TR/soap12-part1">http://www.w3.org/TR/soap12-part1</a>&gt;.</p>
<p><a name="nt-id2257849">24</a>. SOAP Version 1.2 Part 2: Adjuncts &lt;<a href="http://www.w3.org/TR/soap12-part2">http://www.w3.org/TR/soap12-part2</a>&gt;.</p>
<p><a name="nt-id2257840">25</a>. SOAP Version 1.2 Email Binding &lt;<a href="http://www.w3.org/TR/soap12-email">http://www.w3.org/TR/soap12-email</a>&gt;.</p>
<p><a name="nt-id2257982">26</a>. RFC 2045: Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies &lt;<a href="http://www.ietf.org/rfc/rfc2045.txt">http://www.ietf.org/rfc/rfc2045.txt</a>&gt;.</p>
<p><a name="nt-id2258008">27</a>. RFC 3023: XML Media Types &lt;<a href="http://www.ietf.org/rfc/rfc3023.txt">http://www.ietf.org/rfc/rfc3023.txt</a>&gt;.</p>
<p><a name="nt-id2260246">28</a>. The Jabber Software Foundation (JSF) is an independent, non-profit organization that develops open application protocols on top of the IETF's Extensible Messaging and Presence Protocol (XMPP). For further information, see &lt;<a href="http://www.jabber.org/jsf/">http://www.jabber.org/jsf/</a>&gt;.</p>
<p><a name="nt-id2260294">29</a>. JEP-0071: XHTML-IM &lt;<a href="http://www.jabber.org/jeps/jep-0071.html">http://www.jabber.org/jeps/jep-0071.html</a>&gt;.</p>
<p><a name="nt-id2260316">30</a>. The Jabber Council is a technical steering committee, authorized by the JSF Board of Directors and elected by JSF members, that approves of new Jabber protocols and oversees the JSF's standards process. For further information, see &lt;<a href="http://www.jabber.org/council/">http://www.jabber.org/council/</a>&gt;.</p>
<p><a name="nt-id2260429">31</a>. JEP-0086: Error Condition Mappings &lt;<a href="http://www.jabber.org/jeps/jep-0086.html">http://www.jabber.org/jeps/jep-0086.html</a>&gt;.</p>
<p><a name="nt-id2260687">32</a>. RFC 3548: The Base16, Base32, and Base64 Data Encodings &lt;<a href="http://www.ietf.org/rfc/rfc3548.txt">http://www.ietf.org/rfc/rfc3548.txt</a>&gt;.</p>
<p><a name="nt-id2260712">33</a>. WS-Security &lt;<a href="http://msdn.microsoft.com/ws/2002/04/Security/">http://msdn.microsoft.com/ws/2002/04/Security/</a>&gt;.</p>
<p><a name="nt-id2260727">34</a>. WS-Transaction &lt;<a href="http://msdn.microsoft.com/library/en-us/dnglobspec/html/ws-transaction.asp">http://msdn.microsoft.com/library/en-us/dnglobspec/html/ws-transaction.asp</a>&gt;.</p>
<p><a name="nt-id2260765">35</a>. RFC 3923: End-to-End Signing and Object Encryption for the Extensible Messaging and Presence Protocol (XMPP) &lt;<a href="http://www.ietf.org/rfc/rfc3923.txt">http://www.ietf.org/rfc/rfc3923.txt</a>&gt;.</p>
<p><a name="nt-id2260809">36</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2260860">37</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.13 (2005-11-01)</h4>
<div class="indent">In accordance with Council feedback: divided Sending Attachments text into multiple subsections and added XMPP examples to each subsection; specified use of JEP-0137 to publish SI requests related to file transfer; specified use of application-specific stanza errors; fixed typographical error in WSDL example. (psa)
    </div>
<h4>Version 0.12 (2005-10-18)</h4>
<div class="indent">In accordance with Council feedback, re-organized descriptive text around use cases. (psa)
    </div>
<h4>Version 0.11 (2005-09-07)</h4>
<div class="indent">Modified service discovery category and type; made several other small text changes based on W3C feedback. (psa)
    </div>
<h4>Version 0.10 (2005-09-01)</h4>
<div class="indent">Added information about service discovery. (psa)
    </div>
<h4>Version 0.9 (2005-08-17)</h4>
<div class="indent">Added implementation note about XMPP routers based on W3C feedback. (psa)
    </div>
<h4>Version 0.8 (2005-07-21)</h4>
<div class="indent">Cleaned up WSDL definition. (psa)
    </div>
<h4>Version 0.7 (2005-06-30)</h4>
<div class="indent">Clarified implementation notes and text on attachments. (psa/ff)
    </div>
<h4>Version 0.6 (2005-06-29)</h4>
<div class="indent">Addressed W3C feedback by (1) adding section on architectural assumptions, (2) adding references to recent W3C attachments work, and (3) discussing XML 1.1 support. (psa)
    </div>
<h4>Version 0.5 (2005-04-01)</h4>
<div class="indent">Corrected several small errors throughout. (psa)
    </div>
<h4>Version 0.4 (2005-01-06)</h4>
<div class="indent">Added W3C Considerations and formal description of SOAP XMPP Binding. (psa)
    </div>
<h4>Version 0.3 (2004-05-10)</h4>
<div class="indent">Changed namespaces to keep in sync with latest SOAP specs. Removed the encodingStyle attribute, since in SOAP 1.2 it is allowed only in child elements of the Body. Removed the &lt;soap&gt; element from the error message example. Fixed the Fault encoding. Explicitly prohibited SOAP elements within the default namespace. (ff)
    </div>
<h4>Version 0.2 (2003-11-11)</h4>
<div class="indent">Deleted the superfluous &lt;soap&gt; element for envelope encapsulation; Changed error reporting semantics; Added a WSDL Binding example; Added a routing example for HTTP&lt;-&gt;XMPP gateways; Added XML Schema; References to Jabber changed in references to XMPP; Other minor changes. (ff)
    </div>
<h4>Version 0.1 (2003-02-17)</h4>
<div class="indent">Initial version. (ff)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
