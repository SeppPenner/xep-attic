<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0084: User Avatar</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="User Avatar">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Creator" content="Peter Millard">
<meta name="DC.Creator" content="Thomas Muldowney">
<meta name="DC.Creator" content="Julian Missig">
<meta name="DC.Description" content="This document defines an XMPP protocol extension for exchanging user avatars.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2006-01-17">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0084">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2006 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>JEP-0084: User Avatar</h1>
<p>This document defines an XMPP protocol extension for exchanging user avatars.</p>
<p><hr></p>
<p style="color:red">WARNING: This Standards-Track JEP is Experimental. Publication as a Jabber Enhancement Proposal does not imply approval of this proposal by the Jabber Software Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Experimental<br>
            Type: Standards Track<br>
            Number: 0084<br>
            Version: 0.7<br>
            Last Updated: 2006-01-17<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, JEP-0030, JEP-0060, JEP-0163<br>Supersedes: JEP-0008<br>
                Superseded By: None<br>
            Short Name: avatar<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/User%20Avatar%20(JEP-0084)">http://wiki.jabber.org/index.php/User Avatar (JEP-0084)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email:
        <a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a><br>
        JID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a></p>
<h3>Peter Millard</h3>
<p class="indent">
        See <a href="#authornote">Author Note</a><br></p>
<h3>Thomas Muldowney</h3>
<p class="indent">
        Email:
        <a href="mailto:temas@jabber.org">temas@jabber.org</a><br>
        JID: 
        <a href="xmpp:temas@jabber.org">temas@jabber.org</a></p>
<h3>Julian Missig</h3>
<p class="indent">
        Email:
        <a href="mailto:julian@jabber.org">julian@jabber.org</a><br>
        JID: 
        <a href="xmpp:julian@jabber.org">julian@jabber.org</a></p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2006 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#reqs">Requirements</a>
</dt>
<dt>3.  <a href="#process">Basic Process Flow</a>
</dt>
<dl>
<dt>3.1.  <a href="#process-createmeta">User Creates Metadata Node</a>
</dt>
<dt>3.2.  <a href="#process-createdata">User Creates Data Node</a>
</dt>
<dt>3.3.  <a href="#process-pubdata">User Publishes Data</a>
</dt>
<dt>3.4.  <a href="#process-pubmeta">User Publishes Metadata Notification</a>
</dt>
<dt>3.5.  <a href="#process-subnotify">Subscribers Receive Metadata Notification</a>
</dt>
<dt>3.6.  <a href="#process-subretrieve">Subscribers Retrieve Data</a>
</dt>
<dt>3.7.  <a href="#pub-stop">Publisher Disables Avatars</a>
</dt>
</dl>
<dt>4.  <a href="#proto">Protocol Syntax</a>
</dt>
<dl>
<dt>4.1.  <a href="#proto-data">Data Element</a>
</dt>
<dt>4.2.  <a href="#proto-meta">Metadata Element</a>
</dt>
<dl>
<dt>4.2.1.  <a href="#proto-info">Info Element</a>
</dt>
<dt>4.2.2.  <a href="#proto-pointer">Pointer Element</a>
</dt>
<dt>4.2.3.  <a href="#proto-stop">Stop Element</a>
</dt>
</dl>
</dl>
<dt>5.  <a href="#examples">Additional Examples</a>
</dt>
<dl>
<dt>5.1.  <a href="#examples-multiple">Metadata With Multiple Content-Types</a>
</dt>
<dt>5.2.  <a href="#examples-pointer">Metadata With Pointer</a>
</dt>
</dl>
<dt>6.  <a href="#disco">Service Discovery</a>
</dt>
<dl><dt>6.1.  <a href="#disco-sub">Discovering Avatar Availability</a>
</dt></dl>
<dt>7.  <a href="#bizrules">Business Rules</a>
</dt>
<dl><dt>7.1.  <a href="#bizrules-images">Image Requirements</a>
</dt></dl>
<dt>8.  <a href="#impl">Implementation Notes</a>
</dt>
<dt>9.  <a href="#security">Security Considerations</a>
</dt>
<dt>10.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>11.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl><dt>11.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt></dl>
<dt>12.  <a href="#schema">XML Schema</a>
</dt>
<dl>
<dt>12.1.  <a href="#schema-data">Data Namespace</a>
</dt>
<dt>12.2.  <a href="#schema-metadata">Metadata Namespace</a>
</dt>
</dl>
<dt>13.  <a href="#authornote">Author Note</a>
</dt>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
  <p class="" style="">Many communication applications allow for the association of a small image or icon with a user of that application. Usually, such an "avatar" is not intended to be an accurate picture of the user's actual physical appearance, but rather a representation (often fanciful) of the user's desired self-image or a transient state of the user (such as a mood or activity). This document outlines a way to incorporate avatars into current Jabber/XMPP systems by layering this functionality on top of the XMPP <span class="ref" style="">Publish-Subscribe</span>  [<a href="#nt-id2250741">1</a>] extension ("pubsub"), specifically the <span class="ref" style="">Personal Eventing via Pubsub</span>  [<a href="#nt-id2250902">2</a>] subset ("SPPS"), which is designed for use in the context of XMPP instant messaging and presence systems that conform to <span class="ref" style="">RFC 3921</span>  [<a href="#nt-id2250925">3</a>].</p>
  <p class="" style="">The protocol defined herein uses two pubsub nodes: one node for "metadata" about the avatar state (called the "metadata node") and one for the avatar data itself (called the "data node"). This separation of metadata from data conserves bandwidth and enables both the publisher and the subscriber to cache the avatar data. (For example, a user might toggle between two or three avatars, in which case the user's contacts can display a locally cached version of the images without having to retrieve the full image each time.)</p>
  <p class="" style="">This protocol also allows storage of avatar data at a URL accessible via HTTP (see <span class="ref" style="">RFC 2616</span>  [<a href="#nt-id2250763">4</a>]).  [<a href="#nt-id2250966">5</a>] This can be helpful as a fallback mechanism if a pubsub-aware data repository is not available. It also makes it possible for avatar images to be hosted on public websites (e.g., an end-user-oriented community site) and retrieved from that site rather than handled directly by the publishing client in any fashion.</p>
  <p class="" style="">Finally, this protocol also enables XMPP applications to optionally integrate with third-party services that host user avatars (e.g., online gaming systems and virtual worlds).</p>
<h2>2.
       <a name="reqs">Requirements</a>
</h2>
  <p class="" style="">This document addresses the following use cases for avatar publishers:</p>
  <ol start="" type="">
    <li>Publishing avatar data</li>
    <li>Updating metadata about the current avatar</li>
    <li>Disabling avatars</li>
  </ol>
  <p class="" style="">This document addresses the following use cases for avatar subscribers:</p>
  <ol start="" type="">
    <li>Discovering avatar availability</li>
    <li>Receiving notification of avatar changes</li>
    <li>Retrieving avatar data via pubsub</li>
    <li>Retrieving avatar data via HTTP</li>
  </ol>
<h2>3.
       <a name="process">Basic Process Flow</a>
</h2>
  <p class="" style="">The process for publishing and updating user avatars is as follows:</p>
  <ol start="" type="">
    <li>User creates metadata node</li>
    <li>User creates data node for "image/png" content-type</li>
    <li>User publishes avatar data for "image/png" content-type to data node and optionally publishes other content-types to HTTP URLs</li>
    <li>User publishes notification of updated avatar to metadata node, with ItemID that matches SHA1 hash of image data for "image/png" content-type (note: this is a hash of the image data itself, not the base64-encoded version)</li>
    <li>Subscribers receive notification</li>
    <li>Optionally (and if necessary), subscribers retrieve avatar data identified by ItemID from data node using pubsub get-items feature (or via HTTP)</li>
    <li>Optionally, user disables avatar display.</li>
  </ol>
  <p class="" style="">This process flow is described more fully in the following sections.</p>
  <p class="" style="">Note: Before publishing avatar data and metadata, the user MUST determine if his or her server supports the SPPS subset of pubsub by following the procedures specified in <span style="font-weight: bold">JEP-0163</span>.</p>
  <div class="indent">
<h3>3.1 <a name="process-createmeta">User Creates Metadata Node</a>
</h3>
    <p class="" style="">In order to publish notifications related to its avatar, the user MUST first create a node for his or her avatar metadata:</p>
    <p class="caption">Example 1. Pubsub metadata node creation request</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='create1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='http://jabber.org/protocol/avatar#metadata' access='presence'/&gt;
    &lt;configure/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The NodeID MUST be "http://jabber.org/protocol/avatar#metadata" and the access model SHOULD be "presence".</p>
    <p class="caption">Example 2. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.com/chamber' id='create1'/&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>3.2 <a name="process-createdata">User Creates Data Node</a>
</h3>
    <p class="" style="">Next, the user MUST create a node for his or her avatar data:</p>
    <p class="caption">Example 3. Pubsub data node creation request</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='create2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='http://jabber.org/protocol/avatar#data' access='presence'/&gt;
    &lt;configure/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The NodeID MUST be "http://jabber.org/protocol/avatar#data" and the access model SHOULD be "presence".</p>
    <p class="caption">Example 4. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.com/chamber' id='create2'/&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>3.3 <a name="process-pubdata">User Publishes Data</a>
</h3>
    <p class="" style="">Before updating the avatar metadata node, the publisher MUST make sure that the avatar data is available at the data node or URL. When publishing the avatar data to the data node, the publisher MUST ensure that the value of the pubsub ItemID is the SHA1 hash of the data for the "image/png" content-type (this is used by the subscriber to determine if a locally cached copy can be displayed).</p>
    <p class="" style="">The following example illustrates the XML structure to be sent when publishing avatar data to the data node.</p>
    <p class="caption">Example 5. Publishing avatar data to data node</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/avatar#data'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;data xmlns='http://jabber.org/protocol/avatar#data'&gt;
          qANQR1DBwU4DX7jmYZnncm...
        &lt;/data&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 6. Pubsub service replies with success</p>
<div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.com/chamber' id='publish1'/&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>3.4 <a name="process-pubmeta">User Publishes Metadata Notification</a>
</h3>
    <p class="" style="">Whenever the publisher wishes to change its current avatar, it MUST update the metadata node.</p>
    <p class="" style="">The following example shows metadata specifying avatar data that is available in only one format ("image/png") and accessible only at the data node:</p>
    <p class="caption">Example 7. Publishing avatar metadata</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='publish2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/avatar#metadata'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
        &lt;/metadata&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>3.5 <a name="process-subnotify">Subscribers Receive Metadata Notification</a>
</h3>
    <p class="" style="">Subscribers to the metadata node would then receive the notification:</p>
    <p class="caption">Example 8. Subscribers receive avatar metadata notification</p>
<div class="indent"><pre>
&lt;message to='romeo@montague.net' from='juliet@capulet.com/chamber'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/avatar#metadata'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
        &lt;/metadata&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>3.6 <a name="process-subretrieve">Subscribers Retrieve Data</a>
</h3>
    <p class="" style="">Upon receiving the notification, each subscriber SHOULD determine if it has a locally cached copy of that avatar (which it can determine by searching for an image identified by the ItemID). If the subscriber already has a locally cached copy of the avatar image, it MUST NOT retrieve the image data.</p>
    <p class="" style="">If the subscriber does not have a locally cached copy of the avatar image, it SHOULD retrieve the data. It can do this by sending a pubsub get-items request to the data node, specifying the appropriate ItemID:</p>
    <p class="caption">Example 9. Subscriber requests last item by ItemID</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='romeo@montague.net/home'
    to='juliet@capulet.com'
    id='retrieve1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='http://jabber.org/protocol/avatar#metadata'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The SPPS service running at the user's server then SHOULD return the avatar data:</p>
    <p class="caption">Example 10. Publishing avatar data to data node</p>
<div class="indent"><pre>
&lt;iq type='result' from='juliet@capulet.com' to='romeo@montague.net/home' id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/avatar#data'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;data xmlns='http://jabber.org/protocol/avatar#data'&gt;
          qANQR1DBwU4DX7jmYZnncm...
        &lt;/data&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the &lt;info/&gt; element sent to the metadata node possesses a 'url' attribute, the avatar data is hosted at a URL. Therefore, in order to retrieve the avatar image data for that content-type, the requesting entity MUST send an HTTP request to the specified URL. Methods for doing so are out of scope for this document.</p>
  </div>
  <div class="indent">
<h3>3.7 <a name="pub-stop">Publisher Disables Avatars</a>
</h3>
    <p class="" style="">In order to temporarily disable any avatar, the user publishes an empty &lt;stop/&gt; element to the metadata node (this item SHOULD NOT possess an ItemID):</p>
    <p class="caption">Example 11. Temporarily disabling an avatar</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='publish3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='avatar/info/juliet@capulet.com'&gt;
      &lt;item&gt;
        &lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
          &lt;stop/&gt;
        &lt;/metadata&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">As before, subscribers to the metadata node would then receive the notification:</p>
    <p class="caption">Example 12. Subscribers receive avatar metadata notification</p>
<div class="indent"><pre>
&lt;message to='romeo@montague.net' from='juliet@capulet.com/chamber'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/avatar#metadata'&gt;
      &lt;item&gt;
        &lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
          &lt;stop/&gt;
        &lt;/metadata&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
    </pre></div>
  </div>
<h2>4.
       <a name="proto">Protocol Syntax</a>
</h2>
  <p class="" style="">The SPPS subset of pubsub requires that there shall exist a one-to-one relationship between namespaces and nodes. Because the protocol defined herein stipulates the use of two nodes (one for avatar data and one for avatar metadata), we define two namespaces, each with a corresponding root element:</p>
  <ul>
    <li>&lt;data xmlns='http://jabber.org/protocol/avatar#data'/&gt;</li>
    <li>&lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'/&gt;</li>
  </ul>
  <p class="" style="">These are further specified below.</p>
  <div class="indent">
<h3>4.1 <a name="proto-data">Data Element</a>
</h3>
    <p class="" style="">The &lt;data/&gt; element is used to communicate the avatar data itself, and only for the "image/png" content-type (support for which is REQUIRED):</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;data xmlns='http://jabber.org/protocol/avatar#data'&gt;
  IMAGE DATA
&lt;/data&gt;
    </pre></div>
    <p class="" style="">The XML character data MUST represent the image data for the avatar with a content-type of "image/png", Base64-encoded in accordance with Section 3 of <span class="ref" style="">RFC 3548</span>  [<a href="#nt-id2257623">6</a>]. (Note: Line feeds SHOULD NOT be added but MUST be accepted.)</p>
    <p class="" style="">Support for the &lt;data/&gt; element is REQUIRED.</p>
  </div>
  <div class="indent">
<h3>4.2 <a name="proto-meta">Metadata Element</a>
</h3>
    <p class="" style="">The &lt;metadata/&gt; element is used to communicate information about the avatar. There are three allowable children of the &lt;metadata/&gt; element:</p>
    <ul>
      <li>&lt;info/&gt;</li>
      <li>&lt;pointer/&gt;</li>
      <li>&lt;stop/&gt;</li>
    </ul>
    <p class="" style="">These are further specified below.</p>
    <div class="indent">
<h3>4.2.1 <a name="proto-info">Info Element</a>
</h3>
      <p class="" style="">The &lt;info/&gt; child element is used to communicate avatar metadata:</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'
  &lt;info id='SHA1-hash-of-image-data'
        url='HTTP-URL-for-image-data'
        id='SHA1-hash-of-image-data'
        type='content-type-of-image-data'
        bytes='size-of-image-data-in-bytes'
        height='image-height-in-pixels'
        width='image-width-in-pixels'/&gt;
&lt;/metadata&gt;
      </pre></div>
      <p class="" style="">The &lt;info/&gt; child element MUST be empty.</p>
      <p class="" style="">The &lt;info/&gt; child element MUST possess the following attributes:</p>
      <ul>
        <li>
<span style="font-style: italic">bytes</span> -- The size of the image data in bytes.</li>
        <li>
<span style="font-style: italic">height</span> -- The height of the image in pixels.</li>
        <li>
<span style="font-style: italic">id</span> -- The SHA1 hash of the image data for the specified content-type.</li>
        <li>
<span style="font-style: italic">type</span> -- The IANA-registered content type of the image data.</li>
        <li>
<span style="font-style: italic">width</span> -- The width of the image in pixels.</li>
      </ul>
      <p class="" style="">The &lt;info/&gt; element MAY possess the following attribute:</p>
      <ul>
        <li>
<span style="font-style: italic">url</span> -- An http: or https: URI at which the image data file may be found.</li>
      </ul>
      <p class="" style="">The &lt;metadata/&gt; root element MAY contain more than one &lt;info/&gt; element. Each &lt;info/&gt; element MUST specify metadata for the same avatar image but in alternate content-types (e.g., "image/png", "image/gif", and "image/jpeg"), and one of the formats MUST be "image/png" to ensure interoperability. The value of the 'type' attribute MUST be an IANA-registered content type of type "image" or "video".  [<a href="#nt-id2257804">7</a>] Support for the "image/png" content type is REQUIRED. Support for the "image/gif" and "image/jpeg" content types is RECOMMENDED. Support for any other content type is OPTIONAL.</p>
      <p class="" style="">The value of the 'id' attribute MUST be the SHA1 (<span class="ref" style="">RFC 3174</span>  [<a href="#nt-id2257848">8</a>]) hash of the image data for the specified content-type.</p>
      <p class="" style="">Support for the &lt;info/&gt; element is REQUIRED.</p>
    </div>
    <div class="indent">
<h3>4.2.2 <a name="proto-pointer">Pointer Element</a>
</h3>
      <p class="" style="">The &lt;pointer/&gt; child element is used to point to an avatar that is not published via pubsub or HTTP, but rather is provided by a third-party service such as an online gaming system or virtual world:</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;avatar xmlns='http://jabber.org/protocol/avatar'&gt;
  &lt;pointer&gt;
    ... APPLICATION-SPECIFIC DATA ...
  &lt;/pointer&gt;
&lt;/avatar&gt;
      </pre></div>
      <p class="" style="">The &lt;pointer/&gt; element MAY possess the following attributes if the publishing application has the relevant information:</p>
      <ul>
        <li>
<span style="font-style: italic">bytes</span> -- The size of the image data in bytes.</li>
        <li>
<span style="font-style: italic">height</span> -- The height of the image in pixels.</li>
        <li>
<span style="font-style: italic">id</span> -- The SHA1 hash of the image data for the specified content-type.</li>
        <li>
<span style="font-style: italic">type</span> -- The IANA-registered content type of the image data.</li>
        <li>
<span style="font-style: italic">width</span> -- The width of the image in pixels.</li>
      </ul>
      <p class="" style="">The content of the &lt;pointer/&gt; element MUST be a properly-namespaced child element that specifies information about how to retrieve the avatar from the third-party service. The structure for any such child element is out of scope for this document.</p>
      <p class="" style="">Even if the &lt;pointer&gt; element is included, it MUST be preceded by at least one instance of the &lt;info/&gt; element so that implementations that do not support the &lt;pointer/&gt; element can display a "fallback" format of the avatar (at a minimum, "image/png").</p>
      <p class="" style="">Support for the &lt;pointer/&gt; element is OPTIONAL.</p>
    </div>
    <div class="indent">
<h3>4.2.3 <a name="proto-stop">Stop Element</a>
</h3>
      <p class="" style="">The &lt;stop/&gt; child element is used to signal that avatar publishing has been disabled:</p>
      <p class="caption"></p>
<div class="indent"><pre>
&lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
  &lt;stop/&gt;
&lt;/metadata&gt;
      </pre></div>
      <p class="" style="">The &lt;stop/&gt; element MUST be empty and MUST NOT possess any attributes.</p>
      <p class="" style="">Support for the &lt;stop/&gt; element is REQUIRED.</p>
    </div>
  </div>
<h2>5.
       <a name="examples">Additional Examples</a>
</h2>
  <div class="indent">
<h3>5.1 <a name="examples-multiple">Metadata With Multiple Content-Types</a>
</h3>
    <p class="" style="">The following example shows metadata specifying avatar data that is available in multiple formats ("image/png", "image/gif", and "image/mng"), where the "image/png" content-type is available only at the data node and the other content-types are available HTTP URLs:</p>
    <p class="caption">Example 13. Publishing avatar metadata (multiple formats)</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='publish3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/avatar#metadata'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
          &lt;info id='222f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                url='http://avatars.jabberstudio.org/happy.gif'
                type='image/gif'
                bytes='23456'
                height='64'
                width='64'/&gt;
          &lt;info id='333f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                url='http://avatars.jabberstudio.org/happy.mng'
                type='image/mng'
                bytes='78912'
                height='64'
                width='64'/&gt;
        &lt;/metadata&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>5.2 <a name="examples-pointer">Metadata With Pointer</a>
</h3>
    <p class="" style="">The following example shows metadata specifying avatar data that is available in "image/png" and also with a pointer to an external service.</p>
    <p class="caption">Example 14. Publishing avatar metadata (with pointer)</p>
<div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.com/chamber' id='publish4'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/avatar#metadata'&gt;
      &lt;item id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'&gt;
        &lt;metadata xmlns='http://jabber.org/protocol/avatar#metadata'&gt;
          &lt;info id='111f4b3c50d7b0df729d299bc6f8e9ef9066971f'
                type='image/png'
                bytes='12345'
                height='64'
                width='64'/&gt;
          &lt;pointer&gt;
            &lt;x xmlns='http://example.com/virtualworlds'&gt;
              &lt;game&gt;Ancapistan&lt;/game&gt;
              &lt;character&gt;Kropotkin&lt;/character&gt;
            &lt;/x&gt;
          &lt;/pointer&gt;
        &lt;/metadata&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
<h2>6.
       <a name="disco">Service Discovery</a>
</h2>
  <div class="indent">
<h3>6.1 <a name="disco-sub">Discovering Avatar Availability</a>
</h3>
    <p class="" style="">A contact can determine if another user publishes avatars using this protocol by sending a <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2258157">9</a>] items ("disco#items") request to the user's bare JID (&lt;node@domain.tld&gt;):</p>
    <p class="caption">Example 15. Disco items request</p>
<div class="indent"><pre>
&lt;iq type='get'
    from='romeo@montague.net/orchard'
    to='juliet@capulet.com'
    id='items1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the user publishes avatar data to an SPPS node, the result MUST contain the appropriate items:</p>
    <p class="caption">Example 16. Disco items result</p>
<div class="indent"><pre>
&lt;iq type='result'
    from='juliet@capulet.com'
    to='romeo@montague.net/orchard'
    id='items1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/avatar#data'/&gt;
    &lt;item jid='juliet@capulet.com' node='http://jabber.org/protocol/avatar#metadata'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The contact then may subscribe to the metadata node following the protocol specified in <span style="font-weight: bold">JEP-0060</span>. However, the contact SHOULD NOT subscribe to the data node (instead, it SHOULD simply retrieve items from that node when needed, as described above).</p>
  </div>
<h2>7.
       <a name="bizrules">Business Rules</a>
</h2>
  <div class="indent">
<h3>7.1 <a name="bizrules-images">Image Requirements</a>
</h3>
    <p class="" style="">Certain restrictions are placed upon the image. First, the image height and width SHOULD be between thirty-two (32) and ninety-six (96) pixels. The suggested size is sixty-four (64) pixels high and sixty-four (64) pixels wide. Images SHOULD be square, but this is not required. Finally, images SHOULD use less than eight (8) kilobytes of data.</p>
  </div>
<h2>8.
       <a name="impl">Implementation Notes</a>
</h2>
  <ul>
    <li>It is the responsibility of the receiving application to determine which avatar format to retrieve (e.g., "image/gif" rather than "image/png") and to determine the appropriate method for retrieval (e.g., HTTP rather than pubsub).</li>
    <li>The receiving application SHOULD NOT scale up an image when displaying it.</li>
    <li>If an avatar is not available for a contact, the receiving MAY display the contact's photo, e.g., as provided in the contact's vCard (see <span class="ref" style="">vcard-temp</span>  [<a href="#nt-id2258273">10</a>]) or other profile information.</li>
  </ul>
<h2>9.
       <a name="security">Security Considerations</a>
</h2>
  <p class="" style="">There are no security features or concerns related to this proposal.</p>
<h2>10.
       <a name="iana">IANA Considerations</a>
</h2>
  <p class="" style="">This document makes use of IANA-registered content types, but requires no interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2258344">11</a>].</p>
<h2>11.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
  <div class="indent">
<h3>11.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
  <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2258389">12</a>] shall include 'http://jabber.org/protocol/avatar#data' and 'http://jabber.org/protocol/avatar#metadata' in its registry of protocol namespaces.</p>
  </div>
<h2>12.
       <a name="schema">XML Schema</a>
</h2>
  <div class="indent">
<h3>12.1 <a name="schema-data">Data Namespace</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/avatar#metadata'
    xmlns='http://jabber.org/protocol/avatar#metadata'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='data' type='xs:base64Binary'&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
  <div class="indent">
<h3>12.2 <a name="schema-metadata">Metadata Namespace</a>
</h3>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/avatar#metadata'
    xmlns='http://jabber.org/protocol/avatar#metadata'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='metadata'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='info' maxOccurs='unbounded'/&gt;
          &lt;xs:element ref='pointer' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:element name='stop' type='empty'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='info'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='bytes' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='type' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='height' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='id' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='url' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='width' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='pointer'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:any namespace='##other'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
<h2>13.
       <a name="authornote">Author Note</a>
</h2>
  <p class="" style="">Peter Millard, a co-author of this specification from version 0.1 through version 0.7, died on April 26, 2006.</p>
<p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250741">1</a>. JEP-0060: Publish-Subscribe &lt;<a href="http://www.jabber.org/jeps/jep-0060.html">http://www.jabber.org/jeps/jep-0060.html</a>&gt;.</p>
<p><a name="nt-id2250902">2</a>. JEP-0163: Personal Eventing via Pubsub &lt;<a href="http://www.jabber.org/jeps/jep-0163.html">http://www.jabber.org/jeps/jep-0163.html</a>&gt;.</p>
<p><a name="nt-id2250925">3</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2250763">4</a>. RFC 2616: Hypertext Transport Protocol -- HTTP/1.1 &lt;<a href="http://www.ietf.org/rfc/rfc2616.txt">http://www.ietf.org/rfc/rfc2616.txt</a>&gt;.</p>
<p><a name="nt-id2250966">5</a>. By "accessible via HTTP" is meant that the data is available at an http: or https: URI.</p>
<p><a name="nt-id2257623">6</a>. RFC 3548: The Base16, Base32, and Base64 Data Encodings &lt;<a href="http://www.ietf.org/rfc/rfc3548.txt">http://www.ietf.org/rfc/rfc3548.txt</a>&gt;.</p>
<p><a name="nt-id2257804">7</a>. The IANA registry of content types is located at &lt;<a href="http://www.iana.org/assignments/media-types/">http://www.iana.org/assignments/media-types/</a>&gt;.</p>
<p><a name="nt-id2257848">8</a>. RFC 3174: US Secure Hash Algorithm 1 (SHA1) &lt;<a href="http://www.ietf.org/rfc/rfc3174.txt">http://www.ietf.org/rfc/rfc3174.txt</a>&gt;.</p>
<p><a name="nt-id2258157">9</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2258273">10</a>. JEP-0054: vcard-temp &lt;<a href="http://www.jabber.org/jeps/jep-0054.html">http://www.jabber.org/jeps/jep-0054.html</a>&gt;.</p>
<p><a name="nt-id2258344">11</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2258389">12</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 0.7 (2006-01-17)</h4>
<div class="indent">Updated to use Simplified Personal Publish-Subscribe. (psa)
    </div>
<h4>Version 0.6 (2005-04-13)</h4>
<div class="indent">Major modification per list discussion: specified that metadata may include the same avatar in multiple alternate formats; allowed pointers to third-party avatars not available via pubsub or HTTP; changed pixel size restrictions; specified that bytes, content-type, height, id, and width are required metadata; changed type attribute to content-type; made explicit that URLs can be http: or https: URIs; more fully specified protocol, updated the examples, updated the schemas. (psa)
    </div>
<h4>Version 0.5 (2005-03-28)</h4>
<div class="indent">Friendly fork per Council discussion: allowed data to be stored in a pubsub data repository or at a URL accessible via HTTP; also split text into publisher and subscriber use cases, specified requirements, added more examples, etc. (psa/pgm)
    </div>
<h4>Version 0.4 (2003-05-20)</h4>
<div class="indent">Lessen the image requirements. Include the content type in info. (tjm)
    </div>
<h4>Version 0.3 (2003-05-08)</h4>
<div class="indent">Drastic change to use two nodes on pubsub, allowing for hash updates independently of the data. This makes client caching much easier. Allow only PNG and MNG currently. (tjm)
    </div>
<h4>Version 0.2 (2003-05-07)</h4>
<div class="indent">Clarified the use of "current" as the item id. Fixed some example errors. Made the interaction with disco more clear. The reason to use pubsub is made more clear as well. (tjm)
    </div>
<h4>Version 0.1 (2003-05-07)</h4>
<div class="indent">Initial version. (tjm)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
