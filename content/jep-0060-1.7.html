<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JEP-0060: Publish-Subscribe</title>
<link rel="stylesheet" type="text/css" href="jep.css">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<meta name="DC.Title" content="Publish-Subscribe">
<meta name="DC.Creator" content="Peter Millard">
<meta name="DC.Creator" content="Peter Saint-Andre">
<meta name="DC.Creator" content="Ralph Meijer">
<meta name="DC.Description" content="This JEP defines a generic publish/subscribe framework for use by Jabber entities.">
<meta name="DC.Publisher" content="Jabber Software Foundation">
<meta name="DC.Contributor" content="JEP Editor">
<meta name="DC.Date" content="2005-03-03">
<meta name="DC.Type" content="Jabber Enhancement Proposal">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="JEP-0060">
<meta name="DC.Language" content="en">
<meta name="DC.Rights" content="This Jabber Enhancement Proposal is copyright 1999 - 2006 by the Jabber Software Foundation (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;http://www.jabber.org/jsf/ipr-policy.shtml&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;http://creativecommons.org/licenses/by/2.5/&gt;).">
</head>
<body>
<h1>JEP-0060: Publish-Subscribe</h1>
<p>This JEP defines a generic publish/subscribe framework for use by Jabber entities.</p>
<p><hr></p>
<p style="color:green">NOTICE: The protocol defined herein is a Draft Standard of the Jabber Software Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</p>
<p><hr></p>
<h2>JEP Information</h2>
<p class="indent">
            Status: Draft<br>
            Type: Standards Track<br>
            Number: 0060<br>
            Version: 1.7<br>
            Last Updated: 2005-03-03<br>
            JIG: Standards JIG<br>
                Approving Body: Jabber Council<br>Dependencies: XMPP Core, JEP-0004, JEP-0030, JEP-0068, JEP-0082<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: pubsub<br>
        XML Schema for pubsub: &lt;<a href="http://jabber.org/protocol/pubsub/pubsub.xsd">http://jabber.org/protocol/pubsub/pubsub.xsd</a>&gt;<br>
        XML Schema for pubsub#event: &lt;<a href="http://jabber.org/protocol/pubsub/event.xsd">http://jabber.org/protocol/pubsub/event.xsd</a>&gt;<br>
        XML Schema for pubsub#owner: &lt;<a href="http://jabber.org/protocol/pubsub/owner.xsd">http://jabber.org/protocol/pubsub/owner.xsd</a>&gt;<br>
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Publish-Subscribe%20(JEP-0060)">http://wiki.jabber.org/index.php/Publish-Subscribe (JEP-0060)</a>&gt;
            </p>
<h2>Author Information</h2>
<div class="indent">
<h3>Peter Millard</h3>
<p class="indent">
        See <a href="#authornote">Author Note</a><br></p>
<h3>Peter Saint-Andre</h3>
<p class="indent">
        Email:
        <a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a><br>
        JID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a></p>
<h3>Ralph Meijer</h3>
<p class="indent">
        Email:
        <a href="mailto:ralphm@ik.nu">ralphm@ik.nu</a><br>
        JID: 
        <a href="xmpp:ralphm@ik.nu">ralphm@ik.nu</a></p>
</div>
<h2>Legal Notice</h2>
<p class="indent">This Jabber Enhancement Proposal is copyright 1999 - 2006 by the <a href="http://www.jabber.org/jsf/">Jabber Software Foundation</a> (JSF) and is in full conformance with the JSF's Intellectual Property Rights Policy &lt;<a href="http://www.jabber.org/jsf/ipr-policy.shtml">http://www.jabber.org/jsf/ipr-policy.shtml</a>&gt;. This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</p>
<h2>Discussion Venue</h2>
<p class="indent">The preferred venue for discussion of this document is the Standards-JIG discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards-jig">http://mail.jabber.org/mailman/listinfo/standards-jig</a>&gt;.</p>
<h2>Relation to XMPP</h2>
<p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the Jabber Software Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this JEP has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
<h2>Conformance Terms</h2>
<p class="indent">The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</p>
<p><hr></p>
<h2>Table of Contents</h2>
<div class="indent"><dl>
<dt>1.  <a href="#intro">Introduction</a>
</dt>
<dt>2.  <a href="#terms">Terminology</a>
</dt>
<dl><dt>2.1.  <a href="#terms-pubsub">Publish-Subscribe Terms</a>
</dt></dl>
<dt>3.  <a href="#reqs">Requirements</a>
</dt>
<dt>4.  <a href="#addressing">Addressing</a>
</dt>
<dt>5.  <a href="#events">Event Types</a>
</dt>
<dt>6.  <a href="#affiliations">Affiliations</a>
</dt>
<dt>7.  <a href="#substates">Subscription States</a>
</dt>
<dt>8.  <a href="#usecases">Use Cases</a>
</dt>
<dl>
<dt>8.1.  <a href="#entity">Entity Use Cases</a>
</dt>
<dl>
<dt>8.1.1.  <a href="#disco-service">Discover Service Features</a>
</dt>
<dt>8.1.2.  <a href="#entity-create">Create a New Node</a>
</dt>
<dt>8.1.3.  <a href="#entity-publish">Publish an Item to a Node</a>
</dt>
<dt>8.1.4.  <a href="#entity-delete">Delete an Item from a Node</a>
</dt>
<dt>8.1.5.  <a href="#entity-subscribe">Subscribe to a Node</a>
</dt>
<dt>8.1.6.  <a href="#entity-approve">Approving and Denying Subscription Requests</a>
</dt>
<dt>8.1.7.  <a href="#entity-retrieve">Retrieve Current Affiliations</a>
</dt>
<dt>8.1.8.  <a href="#entity-unsub">Unsubscribe from a Node</a>
</dt>
<dt>8.1.9.  <a href="#entity-configure">Configure Subscription Options</a>
</dt>
<dt>8.1.10.  <a href="#entity-getitems">Get Items for a Node</a>
</dt>
<dt>8.1.11.  <a href="#entity-discovernodes">Discover Nodes</a>
</dt>
<dt>8.1.12.  <a href="#entity-info-metadata">Discover Node Information and Meta-Data</a>
</dt>
<dt>8.1.13.  <a href="#entity-discoveritems">Discover Items for a Node</a>
</dt>
</dl>
<dt>8.2.  <a href="#owner">Owner Use Cases</a>
</dt>
<dl>
<dt>8.2.1.  <a href="#owner-configure">Configure a Node</a>
</dt>
<dt>8.2.2.  <a href="#owner-default">Request Default Configuration Options</a>
</dt>
<dt>8.2.3.  <a href="#owner-delete">Delete a Node</a>
</dt>
<dt>8.2.4.  <a href="#owner-purge">Purge All Node Items</a>
</dt>
<dt>8.2.5.  <a href="#owner-modify">Modifying Entity Affiliations</a>
</dt>
</dl>
</dl>
<dt>9.  <a href="#collections">Collection Nodes</a>
</dt>
<dl>
<dt>9.1.  <a href="#collections-subscribe">Subscribing to a Collection Node</a>
</dt>
<dt>9.2.  <a href="#collections-root">Root Collection Node</a>
</dt>
<dt>9.3.  <a href="#collections-createnodes">Creating New Collection Nodes</a>
</dt>
<dt>9.4.  <a href="#collections-createaffil">Creating Nodes Affiliated with a Collection</a>
</dt>
<dt>9.5.  <a href="#collections-notify">Generating Publish Notifications for Collections</a>
</dt>
</dl>
<dt>10.  <a href="#errors">Error Conditions</a>
</dt>
<dt>11.  <a href="#impl">Implementation Notes</a>
</dt>
<dl>
<dt>11.1.  <a href="#impl-presence">Presence-Based Delivery of Events</a>
</dt>
<dt>11.2.  <a href="#impl-offline">Not Sending Events to Offline Storage</a>
</dt>
<dt>11.3.  <a href="#impl-uniqueness">Node and Item ID Uniqueness</a>
</dt>
<dt>11.4.  <a href="#impl-authorize">Authorizing Subscription Requests (Pending Subscribers)</a>
</dt>
<dt>11.5.  <a href="#impl-hierarchies">Handling Node Hierarchies</a>
</dt>
<dt>11.6.  <a href="#impl-message">Message Bodies</a>
</dt>
<dt>11.7.  <a href="#impl-multiple">Multiple Node Discovery</a>
</dt>
<dt>11.8.  <a href="#impl-association">Associating Events and Payloads with the Generating Entity</a>
</dt>
<dt>11.9.  <a href="#impl-leases">Implementing Time-Based Subscriptions (Leases)</a>
</dt>
<dt>11.10.  <a href="#impl-content">Implementing Content-Based Pubsub Systems</a>
</dt>
</dl>
<dt>12.  <a href="#security">Security Considerations</a>
</dt>
<dt>13.  <a href="#iana">IANA Considerations</a>
</dt>
<dt>14.  <a href="#registrar">Jabber Registrar Considerations</a>
</dt>
<dl>
<dt>14.1.  <a href="#registrar-ns">Protocol Namespaces</a>
</dt>
<dt>14.2.  <a href="#registrar-disco">Service Discovery Category/Type</a>
</dt>
<dt>14.3.  <a href="#registrar-features">Service Discovery Features</a>
</dt>
<dt>14.4.  <a href="#registrar-formtypes">Field Standardization</a>
</dt>
<dl>
<dt>14.4.1.  <a href="#registrar-formtypes-auth">pubsub#subscribe_authorization FORM_TYPE</a>
</dt>
<dt>14.4.2.  <a href="#registrar-formtypes-options">pubsub#subscribe_options FORM_TYPE</a>
</dt>
<dt>14.4.3.  <a href="#registrar-formtypes-config">pubsub#node_config FORM_TYPE</a>
</dt>
<dt>14.4.4.  <a href="#registrar-formtypes-metadata">pubsub#meta-data FORM_TYPE</a>
</dt>
</dl>
<dt>14.5.  <a href="#registrar-shim">SHIM Headers</a>
</dt>
<dt>14.6.  <a href="#registrar-querytypes">URI Query Types</a>
</dt>
</dl>
<dt>15.  <a href="#schemas">XML Schemas</a>
</dt>
<dl>
<dt>15.1.  <a href="#schemas-pubsub">http://jabber.org/protocol/pubsub</a>
</dt>
<dt>15.2.  <a href="#schemas-event">http://jabber.org/protocol/pubsub#event</a>
</dt>
<dt>15.3.  <a href="#schemas-owner">http://jabber.org/protocol/pubsub#owner</a>
</dt>
<dt>15.4.  <a href="#schemas-error">http://jabber.org/protocol/pubsub#errors</a>
</dt>
</dl>
<dt><a href="#notes">Notes</a></dt>
<dt><a href="#revs">Revision History</a></dt>
</dl></div>
<p><hr></p>
<h2>1.
       <a name="intro">Introduction</a>
</h2>
        <p class="" style="">As Jabber technologies have matured, the need for a generic publish-subscribe ("pubsub") mechanism has arisen in a number of problem spaces. These include (but are not limited to): news feeds and content syndacation, avatar management, shared bookmarks, auction and trading systems, online catalogs, workflow systems, network management systems, NNTP gateways, vCard/profile management, and weblogs.</p>
        <p class="" style="">In all of these domains, it is desirable for data communication to follow the classic "publish-subscribe" or "observer" design pattern: a person or application publishes information, and an event notification or the data itself is broadcasted to all authorized subscribers. In general, the relationship between the publisher and subscriber is mediated by a service that receives publication requests, broadcasts event notifications and/or the data itself to subscribers, and enables privileged entities to manage lists of people or applications that are authorized to publish or subscribe. In most pubsub services, the focal point for publication and subscription is a "topic" or "node" to which publishers send data and from which subscribers receive notifications and/or data. Additionally, some nodes may also maintain a history of events and provide other services that supplement the pure pubsub model.</p>
        <p class="" style="">This Jabber Enhancement Proposal defines a single, cohesive, generic protocol which all forms of pubsub can utilize. While compliant implementations are not required to implement all of the features defined herein, this JEP documents most usages that may be requested of a pubsub service.</p>
    <h2>2.
       <a name="terms">Terminology</a>
</h2>
      <div class="indent">
<h3>2.1 <a name="terms-pubsub">Publish-Subscribe Terms</a>
</h3>
        <p class="" style="">The following terms are used throughout this document to refer to elements, objects, or actions that occur in the context of a pubsub service.</p>
        <p class="caption">Table 1: Glossary</p>
<table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
<td align="" colspan="" rowspan="">Address</td>
<td align="" colspan="" rowspan="">(1) A JID as defined in <span class="ref" style="">XMPP Core</span>  [<a href="#nt-id2250282">1</a>], or (2) the combination of a JID and a <span class="ref" style="">Service Discovery</span>  [<a href="#nt-id2250306">2</a>] node.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Entity</td>
<td align="" colspan="" rowspan="">A JID-addressable Jabber entity (client, service, application, etc.).</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Event</td>
<td align="" colspan="" rowspan="">A change in the state of a node.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Instant Node</td>
<td align="" colspan="" rowspan="">A node whose NodeID is automatically generated by a pubsub service.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Item</td>
<td align="" colspan="" rowspan="">An XML fragment which is published to a node, thereby generating an event.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">ItemID</td>
<td align="" colspan="" rowspan="">A unique identifier for an item in the contect of a specific node.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Node</td>
<td align="" colspan="" rowspan="">A virtual location to which information can be published and from which event notifications and/or payloads can be received (in other pubsub systems, this may be labelled a "topic").</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Leaf</td>
<td align="" colspan="" rowspan="">A type of node that contains published items only. It is NOT a container for other nodes.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Collection</td>
<td align="" colspan="" rowspan="">A type of node that contains nodes and/or other collections but no published items. Collections provide the foundation entity to provide a means of representing hierarchial node structures.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">NodeID</td>
<td align="" colspan="" rowspan="">The unique identifier for a node within the context of a pubsub service.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Notification</td>
<td align="" colspan="" rowspan="">A message sent to a subscriber informing them of an event.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Outcast</td>
<td align="" colspan="" rowspan="">An entity that is disallowed from subscribing or publishing to a node.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Owner</td>
<td align="" colspan="" rowspan="">The creator and manager of a node.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Payload</td>
<td align="" colspan="" rowspan="">The full data associated with an event (e.g., an RSS feed) rather than just the event itself.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Private</td>
<td align="" colspan="" rowspan="">A node to which subscriptions are limited by means of a whitelist.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Public</td>
<td align="" colspan="" rowspan="">A node to which any entity may subscribe.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Publisher</td>
<td align="" colspan="" rowspan="">An entity that is allowed to publish items to a node.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Pubsub Service</td>
<td align="" colspan="" rowspan="">An XMPP server or component that adheres to the protocol defined herein.</td>
</tr>
          <tr class="body">
<td align="" colspan="" rowspan="">Subscriber</td>
<td align="" colspan="" rowspan="">An entity that is subscribed to a node.</td>
</tr>
        </table>
      </div>
    <h2>3.
       <a name="reqs">Requirements</a>
</h2>
        <p class="" style="">Requirements for a pubsub service can be driven by end-user needs as well as the needs of other components and services which can use the service. First, a pubsub service implemented using Jabber MUST provide the basic features which implement a pure publish-subscribe pattern:</p>
        
        <ul>
            <li>A Jabber entity MUST be able to publish events to a service such that all subscribers to a node receive notification of the event.</li>
            <li>A Jabber entity MUST be allowed to be affiliated with a node. Allowable affiliations are owner, publisher, none, and outcast. Implementations MUST support affiliations of owner and none, and MAY support affiliations of outcast and publisher.</li>
            <li>A Jabber entity MUST be allowed to query the pubsub service (or a specific node) to determine what optional features of this specification the service (or node) implements. This query MUST use the Service Discovery (disco#info) protocol.</li>
            <li>A Jabber entity MUST be allowed to query a node to determine non-feature-related information about that node (e.g., the service discovery category+type). This query MUST use the Service Discovery (disco#info) protocol.</li>
        </ul>

        
        <p class="" style="">Some of the possible uses of a Jabber-based pubsub service will require other features, but these features are not mandatory for compliance with this specification. However, if these features are implemented, they MUST follow the protocol described herein to be compliant. These features include:</p>
        <ul>
            <li>If configuration of nodes is allowed, a node owner SHOULD be able to configure a node.</li>
            <li>If configuration of subscription options is allowed, a subscriber SHOULD be able to configure the subscription options.</li>
            <li>A node owner SHOULD be able to specify who may subscribe to a node.</li>
            <li>A node owner SHOULD be able to specify who may publish to a node.</li>
            <li>A node MAY be configured to deliver the published payload inside the event notification.</li>
            <li>A node MAY be configured to persist published items to some persistent storage mechanism.</li>
            <li>A node MAY be configured to persist only a limited number of items.</li>
            <li>A node MAY be configured to deliver the last published item after a subscription is granted.</li>
            <li>A service MAY support collections.</li>
            <li>A service or node MAY support extended service discovery information (meta-data).</li>
        </ul>

    <h2>4.
       <a name="addressing">Addressing</a>
</h2>
      <p class="" style="">If a pubsub node is addressable, it MUST be addressable either as (1) a JID or as (1) the combination of a JID and a Service Discovery node.</p>
      <p class="" style="">If a pubsub node is addressable as a JID, the NodeID MUST be the resource identifier, and MUST NOT be specified by the "user" portion (node identifier) of the JID (e.g. "domain/NodeID" and "user@domain/NodeID" are allowed; "NodeID@domain" is not allowed). JID addressing SHOULD be used when interacting with a pubsub node using a protocol that does not support the node attribute. For example, when a service makes it possible for entities to subscribe nodes via presence, it would address nodes as JIDs.</p>
      <p class="" style="">If a pubsub node is addressable as a Service Discovery node, the NodeID MUST be the value of both the Service Discovery 'node' attribute and the pubsub 'node' attribute (i.e., for discovery purposes, a pubsub node is equivalent to a Service Discovery node). Note: A pubsub service MAY enable entities to discover pubsub nodes (and items associated with such nodes) via Service Discovery, but this is OPTIONAL.</p>
    <h2>5.
       <a name="events">Event Types</a>
</h2>
        <p class="" style="">The requirements listed above imply that there are two major dimensions along which we can measure events: persistent vs. transient, and pure notification vs. inclusion of payload. An implementation SHOULD enable an owner to configure a node along both of these dimensions.</p>
        <p class="" style="">A pubsub service MUST validate publish requests against the configuration of the node along both of these dimensions. See the <a href="#entity-publish">publish use-case</a> for specific error conditions based on a publish versus event-type mismatch. In addition, whether an item must be provided by the publisher, and whether an item ID is provided by the publisher or generated by the pubsub service, depends on the type of event being published. We can summarize the relevant rules as follows:</p>
        <p class="caption">Table 2: Event Types, Items, and Item IDs</p>
<table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
<th colspan="" rowspan="">--&gt;</th>
<th colspan="" rowspan="">Notification</th>
<th colspan="" rowspan="">Payload</th>
</tr>
          <tr class="body">
            <td align="" colspan="" rowspan=""><span style="font-weight: bold">Persistent</span></td>
            <td align="" colspan="" rowspan="">Publisher MUST include an item element, which MAY be empty or contain a payload; if item ID is not provided by publisher, it MUST be generated by pubsub service</td>
            <td align="" colspan="" rowspan="">Publisher MUST include an item element that contains the payload; if item ID is not provided by publisher, it MUST be generated by pubsub service</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan=""><span style="font-weight: bold">Transient</span></td>
            <td align="" colspan="" rowspan="">Publisher MUST NOT include an item element (therefore item ID is neither provided nor generated)</td>
            <td align="" colspan="" rowspan="">Publisher MUST include an item element that contains the payload, but the item ID is OPTIONAL</td>
          </tr>
        </table>
    <h2>6.
       <a name="affiliations">Affiliations</a>
</h2>
        <p class="" style="">To manage permissions, the protocol defined herein uses a hierarchy of affiliations, similiar to those introduced in <span class="ref" style="">Multi-User Chat</span>  [<a href="#nt-id2250969">3</a>].</p>
        <p class="caption">Table 3: Affiliations and their Privileges</p>
<table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Affiliation</th>
            <th colspan="" rowspan="">Subscribe</th>
            <th colspan="" rowspan="">Publish Items</th>
            <th colspan="" rowspan="">Purge Items</th>
            <th colspan="" rowspan="">Configure Node</th>
            <th colspan="" rowspan="">Delete Node</th>
            <th colspan="" rowspan="">Delete Item</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">Owner</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">Yes</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">Publisher</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">Yes/No</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">None</td>
            <td align="" colspan="" rowspan="">Yes</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">Outcast</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
            <td align="" colspan="" rowspan="">No</td>
                    <td align="" colspan="" rowspan="">No</td>
          </tr>
        </table>
        <p class="" style="">Pubsub services MAY allow any publisher to delete any item once it has been published to that node instead of allowing only the original publisher to remove it (this is disoverable via the "pubsub#delete-any" feature. If a publisher is not allowed to delete an item, the service MUST bounce the request using a &lt;not-authorized/&gt; error.</p>
        <p class="" style="">Any Jabber entity which is currently subscribed to a node may unsubscribe from a node. All other entities which attempt to unsubscribe from a node MUST receive a &lt;item-not-found/&gt; error in response.</p>
        <p class="" style="">The ways in which an entity changes its affiliation with a node are well-defined. Typically, an owner action is required to make an affiliation state transition. Affiliation changes and their triggering actions are specified in the following table.</p>
        <p class="caption">Table 4: Affiliation State Chart</p>
<table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">--&gt;</th>
            <th colspan="" rowspan="">Outcast</th>
            <th colspan="" rowspan="">None</th>
            <th colspan="" rowspan="">Publisher</th>
            <th colspan="" rowspan="">Owner</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">Outcast</td>
            <td align="" colspan="" rowspan="">--</td>
            <td align="" colspan="" rowspan="">Owner removes ban</td>
            <td align="" colspan="" rowspan="">Owner adds entity to publisher list</td>
            <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">None</td>
            <td align="" colspan="" rowspan="">Owner bans entity</td>
            <td align="" colspan="" rowspan="">--</td>
            <td align="" colspan="" rowspan="">Owner adds entity to publisher list</td>
            <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">Publisher</td>
            <td align="" colspan="" rowspan="">Owner bans entity</td>
            <td align="" colspan="" rowspan="">Owner removes entity from publisher list</td>
            <td align="" colspan="" rowspan="">--</td>
            <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">Owner</td>
            <td align="" colspan="" rowspan="">n/a</td>
            <td align="" colspan="" rowspan="">Owner resigns</td>
            <td align="" colspan="" rowspan="">n/a</td>
            <td align="" colspan="" rowspan="">--</td>
          </tr>
        </table>
    <h2>7.
       <a name="substates">Subscription States</a>
</h2>
        
        <p class="" style="">
        Subscriptions to a node may exist in several states.
        </p>

        <p class="caption">Table 5: Subscription States</p>
<table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
            <th colspan="" rowspan="">Subscription State</th>
            <th colspan="" rowspan="">Description</th>
        </tr>
        <tr class="body">
            <td align="" colspan="" rowspan="">None</td>
            <td align="" colspan="" rowspan="">The node MUST NOT send event notifications or payloads to the Entity.</td>
        </tr>
        <tr class="body">
            <td align="" colspan="" rowspan="">Pending</td>
            <td align="" colspan="" rowspan="">An entity has requested to subscribe to a node and the request has not yet been approved by a node owner. The node MUST NOT send event notifications or payloads to the entity while it is in this state.</td>
        </tr>
        <tr class="body">
            <td align="" colspan="" rowspan="">Unconfigured</td>
            <td align="" colspan="" rowspan="">An entity has subscribed but its subscription options have not yet been configured. The node MAY send event notifications or payloads to the entity while it is in this state. The service MAY timeout unconfigured subscriptions.</td>
        </tr>
        <tr class="body">
            <td align="" colspan="" rowspan="">Subscribed</td>
            <td align="" colspan="" rowspan="">An entity is subscribed to a node. The node MUST send all event notifications (and, if configured, payloads) to the entity while it is in this state.</td>
        </tr>
        </table>

    <h2>8.
       <a name="usecases">Use Cases</a>
</h2>
        <p class="" style="">The following sections define the use cases and the protocol to be used by various actors in those use cases. The <a href="#impl">Implementation Notes</a> section below describes many important factors and business rules which all pubsub services MUST observe. (Note: the examples throughout assume the existence of a separate pubsub component and include any relevant 'from' addresses as stamped by a server or network edge.)</p>

        
        <div class="indent">
<h3>8.1 <a name="entity">Entity Use Cases</a>
</h3>

            
            <div class="indent">
<h3>8.1.1 <a name="disco-service">Discover Service Features</a>
</h3>
                <p class="" style="">Pubub services MUST respond to feature queries using the Service Discovery protocol and scoped by the http://jabber.org/protocol/disco#info namespace. The disco#info result MUST indicate support for the features by using a feature element with the appropriate 'var' attribute. Throughout this document these features are noted, and have been registered with the Jabber Registrar as described in the <a href="registrar">Jabber Registrar Considerations</a> section of this document.</p>
            </div>

            
            <div class="indent">
<h3>8.1.2 <a name="entity-create">Create a New Node</a>
</h3>
                <p class="" style="">Implementations of pubsub SHOULD allow users and services to create new nodes, which other Jabber entities may then publish to or subscribe to (depending on permissions). However, implementations MAY disallow creation of nodes based on the identity of the entity trying to create the new node, or MAY disallow node creation altogether.</p>

                <p class="" style="">Nodes are created based on a NodeID supplied by the node creator. The NodeID MAY have semantic meaning, but such meaning is not required. If the requested NodeID already exists, the pubsub service MUST respond with a &lt;conflict/&gt; error. If the pubsub service does not support node creation, or the requesting JID does not have authorization to create nodes, the pubsub service MUST respond with a &lt;feature-not-implemented/&gt; error.</p>
                
                <p class="" style="">Implementations SHOULD allow node creation requests to contain a node configuration request in the same IQ element. (See the <a href="#owner-configure">Configure a Node</a> section below for more details.) If an entity wishes to accept the default configuration, it SHOULD include an empty &lt;configure/&gt; element in its node creation request.</p>

                <p class="" style="">The NodeID requested in the create node request MAY be modified by the service depending on the node-configuration specified. For example, if the node configuration requests that the new node become associated with a <a href="#collection_create">collection node</a>, the service MAY create a node identifier which is not the same as the original ID requested. In this case, the service MUST return the modified NodeID in the IQ result, contained in a &lt;create/&gt; element whose 'node' attribute specifies the modified NodeID.</p>

                <p class="" style="">Some implementations MAY choose to force entities to register with the pubsub service before allowing nodes to be created. In these cases, the service MUST respond to the create request with a &lt;registration-required/&gt; error if the entity is not registered.</p>

                <p class="" style="">When a service successfully creates a node on behalf of the requesting entity, it MUST return an IQ result. If the node creation request did not specify a NodeID (i.e., the sender requested an "instant node" as described below), the service MUST specify the created NodeID in the IQ result. If the node creation request specified a NodeID but the service modified the NodeID before creating the node as described under the <a href="#collections">Collection Nodes</a> section of this document, the service MUST also specify the modified node in the IQ result. In all other cases, the service MUST NOT specify the NodeID in the IQ result (since the sender can determine which node was created by tracking the 'id' attribute that it provided in the IQ set).</p>

                <p class="caption">Example 1. Entity requests a new node with default configuration.</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="create1"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="generic/pgm-mp3-player"/&gt;
        &lt;configure/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 2. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="create1"/&gt;</pre></div>

                <p class="caption">Example 3. Server replies with Conflict</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="create1"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="generic/pgm-mp3-player"/&gt;
    &lt;/pubsub&gt;
    &lt;error code="409" type="cancel"&gt;
      &lt;conflict xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 4. Server replies with Not Implemented</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="create1"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="generic/pgm-mp3-player"/&gt;
    &lt;/pubsub&gt;
    &lt;error code="501" type="cancel"&gt;
      &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 5. Server replies with Registration Required</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="create1"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="generic/pgm-mp3-player"/&gt;
    &lt;/pubsub&gt;
    &lt;error code="407" type="auth"&gt;
      &lt;registration-required xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;/error&gt;
&lt;/iq&gt;</pre></div>

            <p class="" style="">In some cases, the requesting entity may want the service to automatically generate a unique NodeID for the newly-created node, to which it may immediately publish; we can think of this as an "instant node". To do this, the requesting entity MUST NOT include a NodeID in the request. If the user has permissions to create nodes, the pubsub service MUST create the node, generate a NodeID that is unique within the context of that pubsub service, and inform the user of success (including the NodeID). A service SHOULD support instant nodes; if it does not, it MUST return a &lt;not-acceptable/&gt; error.</p>
                <p class="caption">Example 6. Client requests an instant node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="create2"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 7. Server replies with success and generated NodeID</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="create2"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
       &lt;create
         node="generic/25e3d37dabbab9541f7523321421edc5bfeb2dae"/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>
                <p class="caption">Example 8. Server does not support instant nodes</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="create2"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
       &lt;create/&gt;
    &lt;/pubsub&gt;
    &lt;error code="406" type="modify"&gt;
      &lt;not-acceptable xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;/error&gt;
&lt;/iq&gt;</pre></div>

            </div>

            
            <div class="indent">
<h3>8.1.3 <a name="entity-publish">Publish an Item to a Node</a>
</h3>
                <p class="" style="">Any entity which is allowed to publish to a node (i.e., a publisher or an owner) may do so at any time. When the pubsub service receives the request, all (approved and active) subscribers are notified of the event. The node configuration MUST specify whether or not the payload is to be delivered to the subscribers. If payloads are not delivered with the event notification, subscribers MAY request the published item via the protocol defined in the <a href="#entity-getitems">Get Items for a Node</a> section of this document.</p>
                <p class="" style="">An item MUST NOT contain data defined by more than one namespace, with the exception of item meta-data as described below.</p>
                <p class="" style="">When a publisher publishes a new item to a node, the service MUST validate that the publish request matches the <a href="#events">event type</a> node configuration. Specifically, if items are persistent, or payloads are delivered with event notifications, then the publish request MUST contain an item. If the node is configured for pure event notification, then the publish request MUST NOT contain an item. If a mismatch is detected, the service MUST bounce the packet with a &lt;bad-request/&gt; error.</p>
                <p class="" style="">In order to facilitate authorization for item removal as shown in the <a href="#entity-delete">Delete an Item from a Node</a> section below, implementations which support persistent items SHOULD store the item (if the node is so configured) and maintain a record of the publisher.</p>
                <p class="" style="">(Note: the following examples adhere to the payload format defined in <span class="ref" style="">User Tune</span>  [<a href="#nt-id2252087">4</a>]).</p>
                <p class="caption">Example 9. Entity publishes an item with an ItemID</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="publish1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;publish node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 10. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="publish1"/&gt;</pre></div>

                <p class="caption">Example 11. Entity is not authorized to publish to node</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="publish1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;publish node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 12. Entity attempts to publish to a non-existent node</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="publish1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;publish node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
  &lt;error code="404" type="cancel"&gt;
    &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="" style="">If the node is so configured, the subscribers will receive event notifications only.</p>
                <p class="caption">Example 13. Subscribers receive event notifications only</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message to="subscriber2" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

                <p class="" style="">If the node is so configured, the subscribers will receive both event notifications and payloads.</p>
                <p class="caption">Example 14. Subscribers receive event notifications with payloads</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message to="subscriber2" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

            <p class="" style="">Item identifiers are not mandatory and may not be necessary for many types of nodes. In these cases, when an item is published, it is put into the stack of items.</p>

                <p class="caption">Example 15. Entity publishes an item without an ItemID</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="publish1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;publish node="generic/pgm-mp3-catalog"&gt;
      &lt;item&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 16. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="publish1"/&gt;</pre></div>

                <p class="" style="">If a publisher publishes an item and the ItemID matches that of an existing item, the pubsub service MUST overwrite the existing item and generate a new event notification.</p>

                <p class="" style="">If a single entity is subscribed to a node multiple times, then the service SHOULD notate the event notification so that the entity can determine what subscription identifiers generated this event. If these notations are included, they MUST use the <span class="ref" style="">Stanza Headers and Internet Metadata (SHIM)</span>  [<a href="#nt-id2252264">5</a>] protocol and SHOULD be included after the event notification information (i.e., as the last child of the &lt;message/&gt; stanza).</p>

                <p class="caption">Example 17. Subscriber receives notated event notification</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
    &lt;header name="pubsub#subid"&gt;123-abc&lt;/header&gt;
    &lt;header name="pubsub#subid"&gt;004-yyy&lt;/header&gt;
  &lt;/headers&gt;
&lt;/message&gt;</pre></div>


            </div>

            
            <div class="indent">
<h3>8.1.4 <a name="entity-delete">Delete an Item from a Node</a>
</h3>
            <p class="" style="">A service SHOULD allow publishers to delete items once they have been published to a node that supports persistent items. To delete an item, the publisher sends a retract request as shown in the follow examples. This request may fail because:</p>
           <ul>
           <li>The publisher is not authorized to delete the requested item (&lt;not-authorized/&gt; error).</li>
           <li>The node does not exist (&lt;item-not-found/&gt; error).</li>
           <li>The node does not support persistent items (&lt;not-allowed/&gt; error).</li>
           <li>The service does not support the deletion of items (&lt;feature-not-implemented/&gt; error).</li>
           </ul>

                <p class="caption">Example 18. Entity deletes an item from a node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="deleteitem1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;retract node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/retract&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 19. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="deleteitem1"/&gt;</pre></div>

                <p class="caption">Example 20. Publisher is not authorized to delete this item</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="deleteitem1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;retract node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/retract&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 21. Publisher is trying to delete an item from a non-existent node</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="deleteitem1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;retract node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/retract&gt;
  &lt;/pubsub&gt;
  &lt;error code="404" type="cancel"&gt;
    &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 22. Publisher is trying to delete an item from a node which does not support persistent items</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="deleteitem1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;retract node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/retract&gt;
  &lt;/pubsub&gt;
  &lt;error code="405" type="cancel"&gt;
    &lt;not-allowed xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 23. Service does not support deleting items</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="deleteitem1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;retract node="generic/pgm-mp3-player"&gt;
      &lt;item id="current"/&gt;
    &lt;/retract&gt;
  &lt;/pubsub&gt;
  &lt;error code="501" type="cancel"&gt;
    &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>


            <p class="" style="">If an implementation supports allowing subscribers to be notified of deleted items (and the node is configured for it), the service MUST use message notifications as shown below. The syntax is identical to publish notifications except that instead of &lt;item/&gt; elements, we have &lt;retract/&gt; elements.</p>

                <p class="caption">Example 24. Subscribers are notified of deletion</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;retract id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message to="subscriber2" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;retract id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

            </div>


            
            <div class="indent">
<h3>8.1.5 <a name="entity-subscribe">Subscribe to a Node</a>
</h3>
            <p class="" style="">When a Jabber entity wishes to subscribe to a node, it sends an IQ request to the pubsub service. Depending on the configuration of the node, several things may happen. If the node has "open" subscriptions, the potential subscriber receives either a result or an error. If the node has been configured so that subscription requests must be approved by the node owner (or a designated approver), the pubsub service sends a message to the node owner requesting authorization, where the message contains a form that is structured in accordance with the <span class="ref" style="">Data Forms</span>  [<a href="#nt-id2252741">6</a>] protocol. To approve the subscription request, the node owner MUST submit the form. To deny the request, the owner MUST cancel the form.</p>

            <p class="" style="">Subscription requests to a node MUST contain a 'jid' attribute, which enables the subscriber to specify either a bare JID or a specific resource which should be used as the subscribed Jabber ID. Implementations MUST at a minimum check the bare JID requested against the 'from' attribute on the received packet to make sure that the requesting entity has the same identity as the JID which is being requested to be added to the subscriber list. (Naturally, JIDs of the form &lt;domain&gt; and &lt;domain/resource&gt; may subscribe as well.)</p>

            <p class="" style="">Some implementations MAY allow a service-configured list of entities (Jabber IDs) which are excluded from this check. Those entities may be treated as trusted proxies which are allowed to subscribe on behalf of other users. In the same way, implementations may enable blacklisting of entities based on Jabber ID which are not allowed to perform specific operations.</p>

            <p class="" style="">Services MAY allow entities to subscribe multiple times to the same node. This enables an entity to subscribe using different subscription options. If multiple subscriptions for the same JID is allowed, the service MUST use the 'subid' attribute to differentiate between subscriptions for the same entity. The SubID MUST be present on the entity element any time it is sent to the entity. If the service does not allow multiple subscriptions for the same entity and it receives an additional subscription request, the service MUST return the current subscription state (as if the subscription was just approved).</p>

            <p class="" style="">If an entity attempts to subscribe with a JID that is not allowed (bare JIDs do not match, or the user does not have some kind of admin or proxy privilege as defined by the implementation), then the pubsub service MUST respond with a &lt;not-authorized/&gt; error.</p>

            <p class="" style="">Commercial deployments may wish to allow subscribers to be linked to some kind of paying customer database. If the subscriber needs to provide payment in order to subscribe to the node (e.g., if the subscriber is not in the customer database or the customer's account is not paid up), the service SHOULD return a &lt;payment-required/&gt; error to the subscriber.</p>

                <p class="caption">Example 25. Entity subscribes to a node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="sub1@foo.com/home"
    to="pubsub.jabber.org"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe
        node="generic/pgm-mp3-player"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 26. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entity node="generic/pgm-mp3-player"
            jid="sub1@foo.com"
            affiliation="none"
            subid="123-abc"
            subscription="subscribed"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>


                <p class="caption">Example 27. Entity is not authorized to create a subscription</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe
        node="generic/pgm-mp3-player"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 28. Payment is required for a subscription</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe
        node="generic/pgm-mp3-player"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="402" type="auth"&gt;
    &lt;payment-required xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 29. Server replies with node not found</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe
        node="generic/pgm-mp3-player"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="404" type="cancel"&gt;
    &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 30. Server replies with pending (owner must approve subscription request)</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entity node="generic/pgm-mp3-player"
            jid="sub1@foo.com"
            affiliation="none"
            subid="123-abc"
            subscription="pending"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            </div>

            <div class="indent">
<h3>8.1.6 <a name="entity-approve">Approving and Denying Subscription Requests</a>
</h3>
            <p class="" style="">Pubsub services MAY send approval requests to the current approver (typically the node owner) at any time. As such, these are simple message stanzas which contain a Data Form. The node owner MAY also request the current pending subscriptions at any time. Implementations MUST use the <span class="ref" style="">Ad-Hoc Commands</span>  [<a href="#nt-id2252941">7</a>] protocol to request the pending list. The command name (node attribute of the command element) MUST have a value of "http://jabber.org/protocol/pubsub#get-pending". The command MUST take a single field argument with a 'var' attribute value of "node". This field MUST contain the desired NodeID. The node field SHOULD be a list-single field which contains all of the NodeIDs for which the requestor has approval privileges.
            </p>

            <p class="" style="">If an entity which does not have sufficient permissions to approve subscription requests attempts to get the current pending list, the service MUST respond with a &lt;forbidden/&gt; error message. If the node requested in the node field does not exist, the service MUST respond with a &lt;item-not-found/&gt; error message.
            </p>

            <p class="" style="">When subscription approval messages are sent to the current approver (typically, the node owner), the form MUST contain a hidden field element which uses a 'var' attribute of FORM_TYPE, and a value of "http://jabber.org/protocol/pubsub" as specified in <span class="ref" style="">Field Standardization for Data Forms</span>  [<a href="#nt-id2252996">8</a>]. This enables client applications to detect that this is a pubsub subscriber request, and, if desired, to use some non-standard jabber:x:data dialog. The form MUST contain a boolean field that has a 'var' attribute of "pubsub#allow" which is the field that designates whether or not to allow the subscription request. This field MUST be checked when the form is processed after submission to see if the subscription should be allowed or denied. If the approver cancels the Data Form, then the subscription request MUST remain in the pending list. The Data Form sent to the approver SHOULD include fields to show the node identifier, the subscription id (if applicable), and the JID of the pending subscriber.</p>

            <p class="caption">Example 31. Owner requests pending subscription requests</p>
<div class="indent"><pre>
&lt;iq type="set" to="pubsub.jabber.org" id="pending1"&gt;
    &lt;command xmlns="http://jabber.org/protocol/commands"
             node="http://jabber.org/protocol/pubsub#get-pending"
             action="execute"/&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 32. Server responds with data form to be populated</p>
<div class="indent"><pre>
&lt;iq type="result" to="pubsub.jabber.org" id="pending1"&gt;
    &lt;command xmlns="http://jabber.org/protocol/commands"
             sessionid="pubsub-get-pending:20031021T150901Z-600"
             node="http://jabber.org/protocol/pubsub#get-pending"
             status="executing"
             action="execute"&gt;
        &lt;x xmlns="jabber:x:data" type="form"&gt;
            &lt;field type="list-single"
                   var="pubsub#node"&gt;
                &lt;option&gt;&lt;value&gt;generic/pgm-mp3-player&lt;/value&gt;&lt;/option&gt;
                &lt;option&gt;&lt;value&gt;generic/pgm-geoloc&lt;/value&gt;&lt;/option&gt;
                &lt;option&gt;&lt;value&gt;generic/pgm-avatar&lt;/value&gt;&lt;/option&gt;
            &lt;/field&gt;
        &lt;/x&gt;
    &lt;/command&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 33. Server responds with forbidden</p>
<div class="indent"><pre>
&lt;iq type="error" from="pubsub.jabber.org" id="pending2"&gt;
    &lt;error code="403" type="cancel"&gt;
      &lt;forbidden xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;/error&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 34. Server responds with node not found</p>
<div class="indent"><pre>
&lt;iq type="error" from="pubsub.jabber.org" id="pending2"&gt;
    &lt;error code="404"&gt;
      &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;/error&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 35. Owner requests all pending subscription requests for a node</p>
<div class="indent"><pre>
&lt;iq type="set" to="pubsub.jabber.org" id="pending2"&gt;
    &lt;command xmlns="http://jabber.org/protocol/commands"
             sessionid="pubsub-get-pending:20031021T150901Z-600"
             node="http://jabber.org/protocol/pubsub#get-pending"
             action="execute"&gt;
        &lt;x xmlns="jabber:x:data" type="submit"&gt;
            &lt;field var="pubsub#node"&gt;
                &lt;value&gt;generic/pgm-mp3-player&lt;/value&gt;
            &lt;/field&gt;
        &lt;/x&gt;
    &lt;/command&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 36. Server responds with success</p>
<div class="indent"><pre>
&lt;iq type="result" from="pubsub.jabber.org" id="pending2"/&gt;</pre></div>

                <p class="caption">Example 37. Server sends authorization request to node owner</p>
<div class="indent"><pre>
&lt;message to="node-owner" from="pubsub.jabber.org"&gt;
    &lt;x xmlns="jabber:x:data" type="form"&gt;
        &lt;title&gt;PubSub subscriber request&lt;/title&gt;
        &lt;instructions&gt;
          To approve this entity&amp;apos;s subscription request,
          click the OK button. To deny the request, click the
          cancel button.
        &lt;/instructions&gt;
        &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subid"
               type="hidden"&gt;
            &lt;value&gt;123-abc&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#node"
               type="text-single"
               label="Node ID"&gt;
            &lt;value&gt;generic/pgm-mp3-player&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pusub#subscriber_jid"
               type="jid-single"
               label="Subscriber Address"&gt;
            &lt;value&gt;sub1@foo.com&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#allow"
               type="boolean"
               label="Allow this JID to subscribe to this pubsub node?"&gt;
            &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
    &lt;/x&gt;
&lt;/message&gt;</pre></div>

            <p class="caption">Example 38. Owner approves subscription request</p>
<div class="indent"><pre>
&lt;message from="node-owner" to="pubsub.jabber.org"&gt;
    &lt;x xmlns="jabber:x:data" type="submit"&gt;
        &lt;field var="FORM_TYPE" type="hidden"&gt;
           &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subid"&gt;
           &lt;value&gt;123-abc&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#node"&gt;
           &lt;value&gt;generic/pgm-mp3-player&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subscriber_jid"&gt;
           &lt;value&gt;sub1@foo.com&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#allow"&gt;
            &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
    &lt;/x&gt;
&lt;/message&gt;</pre></div>

            <p class="caption">Example 39. Owner denies subscription request</p>
<div class="indent"><pre>
&lt;message from="node-owner" to="pubsub.jabber.org"&gt;
    &lt;x xmlns="jabber:x:data" type="submit"&gt;
        &lt;field var="FORM_TYPE" type="hidden"&gt;
           &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subid"&gt;
           &lt;value&gt;123-abc&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#node"&gt;
           &lt;value&gt;generic/pgm-mp3-player&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subscriber_jid"&gt;
           &lt;value&gt;sub1@foo.com&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#allow"&gt;
            &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
    &lt;/x&gt;
&lt;/message&gt;</pre></div>


            <p class="" style="">The service would then send a message with extended information in the 'jabber:x:data' namespace for all pending subscription requests, as shown above for a single pending subscription request.</p>

            </div>

            
            <div class="indent">
<h3>8.1.7 <a name="entity-retrieve">Retrieve Current Affiliations</a>
</h3>
                <p class="" style="">Entities SHOULD be allowed to query the service to provide all of the current affiliations for all nodes within that service for that entity. The affiliations element is used to make the request. For each affiliation, an entity element is returned containing the NodeID, the JID which is affiliated (MAY include a resource, depending on how the JID subscribed), the affiliation, and the current subscription state. If subscription identifiers are supported by the service and the entity's subscription is not NONE or OUTCAST, the 'subid' attribute MUST be present as well as the 'jid' attribute.</p>

                <p class="caption">Example 40. Entity requests all current affiliations</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="sub1@foo.com"
    to="pubsub.jabber.org"
    id="allsubs"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;affiliations/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 41. Service replies with all current affiliations</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com"
    id="allsubs"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;affiliations&gt;
      &lt;entity node="node1"
              jid="sub1@foo.com"
              affiliation="owner"
              subid="sub1"
              subscription="subscribed"/&gt;
      &lt;entity node="node2"
              jid="sub1@foo.com"
              affiliation="publisher"
              subid="sub2"
              subscription="subscribed"/&gt;
      &lt;entity node="node3"
              jid="sub1@foo.com/pda"
              affiliation="none"
              subid="sub3"
              subscription="unconfigured"/&gt;
      &lt;entity node="node4"
              jid="sub1@foo.com/work"
              affiliation="none"
              subid="sub4"
              subscription="pending"/&gt;
      &lt;entity node="node5"
              jid="sub1@foo.com"
              affiliation="outcast"
              subscription="none"/&gt;
      &lt;entity node="node6"
              jid="sub1@foo.com"
              affiliation="owner"
              subscription="none"/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            </div>

            
            <div class="indent">
<h3>8.1.8 <a name="entity-unsub">Unsubscribe from a Node</a>
</h3>
            <p class="" style="">To unsubscribe from a node, the subscriber sends an appropriately-formatted IQ request to the node in question. If the unsubscribe is successful, an IQ result is sent back. If the value of the 'jid' attribute does not specify an existing subscriber, the pubsub service MUST return an error stanza, which SHOULD be &lt;unexpected-request/&gt; and which SHOULD also include a &lt;not-subscribed/&gt; child qualified by the 'http://jabber.org/protocol/pubsub#errors' namespace. If the requestor is not authorized to unsubscribe the specified JID, the service MUST return a &lt;not-authorized/&gt; error. If the node does not exist, the pubsub service MUST return a &lt;item-not-found/&gt; error. If a subscription identifier is associated with the subscription (ie, the service supports them), the unsubscribe request MUST include the appropriate 'subid' attribute. If the unsubscribe request includes a SubID but SubIDs are not supported for the node (or the subscriber did not subscribe using a SubID in the first place), then the service SHOULD ignore the SubID and simply unsubscribe the entity. If subscriber originally subscribed with a SubID but the unsubscribe request includes a SubID other that is not valid or current for the subscriber, the service MUST return a &lt;not-acceptable/&gt; error.</p>

                <p class="caption">Example 42. Entity unsubscribes from a node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="sub1@foo.com"
    to="pubsub.jabber.org"
    id="unsub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
     &lt;unsubscribe
         node="generic/pgm-mp3-player"
         subid="123-abc"
         jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 43. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com"
    id="unsub1"/&gt;
</pre></div>

                <p class="caption">Example 44. Requestor is not a subscriber</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com"
    id="unsub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
     &lt;unsubscribe
         node="generic/pgm-mp3-player"
         subid="123-abc"
         jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;not-subscribed xmlns="http://jabber.org/protocol/pubsub#errors"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 45. Node does not exist</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com"
    id="unsub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
     &lt;unsubscribe
         node="generic/pgm-mp3-player"
         subid="123-abc"
         jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="404" type="cancel"&gt;
    &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>


                <p class="caption">Example 46. Invalid subscription identifier</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com"
    id="unsub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
     &lt;unsubscribe
         node="generic/pgm-mp3-player"
         subid="123-abc"
         jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="406" type="modify"&gt;
    &lt;not-acceptable xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>
            </div>

            
            <div class="indent">
<h3>8.1.9 <a name="entity-configure">Configure Subscription Options</a>
</h3>
            <p class="" style="">Implementations MAY allow subscribers to configure options for their own subscription. Implementations SHOULD use the <span style="font-weight: bold">Data Forms</span> protocol to accomplish this configuration. A subscriber requests the subscription options by using the &lt;options/&gt; element inside of an IQ stanza, to which the service MUST respond with either an error (detailed below) or a result element containing the options.</p>

            <p class="" style="">If a service supports subscription options it MUST advertise that fact in the result to a disco#info query by including a feature whose 'var' attribute is "pubsub#subscription-options". If a service supports subscription options, an entity MAY subscribe and provide the subscription options in the same stanza. In this case, the subscribe-options element MUST be a sibling of the subscribe element on the subscribe request. (If the service does not support subscription options, is MUST return a &lt;feature-not-implemented/&gt; error.)</p>

            <p class="" style="">When requesting subscription options, the subscriber MUST specify both the NodeID of the node and the JID which is subscribed to the node. Services MUST validate that the entity making the request is authorized to set the subscription options for the subscribed entity. If the subscriber's JID is of the form &lt;user@host/resource&gt;, a services SHOULD perform this check by comparing the user@host part of the two JIDs to ensure that they match. If a subscription identifier is associated with the subscription, the 'subid' attribute MUST be present on the request in order for the service to differentiate subscriptions for the same entity.</p>

            <p class="" style="">If a node supports subscription options, it MUST return a &lt;subscribe-options&gt; element inside the entity element in the result of the subscription request. The subscribe-options element MAY contain a &lt;required/&gt; child element if the subscriber MUST configure the subscription before receiving any notifications from that event. Services MAY timeout subscription requests if configuration is required and a configuration request is not submitted within a reasonable amount of time (which shall be determined by the service or node configuration). If the jabber:x:data &lt;required/&gt; element is not present, the subscription takes effect immediately and enables the entity to configure the subscription at any time.</p>

            <p class="" style="">The following example shows some (but by no means all) of the possible configuration options which MAY be implemented in implementations. If an implementation implements these options using the <span style="font-weight: bold">Data Forms</span> protocol, that implementation MUST use the field variables that are registered with the Jabber Registrar in association with the 'http://jabber.org/protocol/pubsub' namespace (a preliminary representation of those field variables is shown below, but MUST NOT be construed as canonical, since the Jabber Registrar may standardize additional fields at a later date without changes to this JEP). An implementation MAY choose to specify different labels, values, and even field types, but must conform to the defined variable naming scheme.</p>

            <p class="" style="">If nodes or services do not support subscriber options, then the response for an options request MUST be a &lt;feature-not-implemented/&gt; error. If a subscriber attempts to set an invalid group of options, the service MUST respond with a &lt;bad-request/&gt; error.
            </p>

                <p class="caption">Example 47. Entity subscribes to a node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="sub1@foo.com/home"
    to="pubsub.jabber.org"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe
        node="generic/pgm-mp3-player"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 48. Server replies with success and indicates that subscription configuration is required</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entity node="generic/pgm-mp3-player"
            jid="sub1@foo.com"
            affiliation="none"
            subid="123-abc"
            subscription="unconfigured"&gt;
      &lt;subscribe-options&gt;
        &lt;required/&gt;
      &lt;/subscribe-options&gt;
    &lt;/entity&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 49. Subscriber requests subscription options form</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="sub1@foo.com/home"
    to="pubsub.jabber.org"
    id="options1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;options
        node="generic/pgm-mp3-player"
        subid="123-abc"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 50. Server responds with Not Implemented (subscription options not supported)</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="options1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;options
        node="generic/pgm-mp3-player"
        subid="123-abc"
        jid="sub1@foo.com"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="501" type="cancel"&gt;
    &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;subscription-options-unavailable 
        xmlns="http://jabber.org/protocol/pubsub#errors"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 51. Server responds with the options form</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="options1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;options node="generic/pgm-mp3-player"
             jid="sub1@foo.com"
             subid="123-abc"&gt;
        &lt;x xmlns="jabber:x:data"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#digest" type="boolean"
                 label="Receive digest notifications (approx. one per day)"&gt;
            &lt;value&gt;0&lt;/value&gt;
          &lt;/field&gt;
          &lt;field
              var="pubsub#show-values"
              type="list-multi"
              label="Select the presence types which are 
                     allowed to receive notifications"&gt;
            &lt;option label="Want to Chat"&gt;&lt;value&gt;chat&lt;/value&gt;&lt;/option&gt;
            &lt;option label="Available"&gt;&lt;value&gt;online&lt;/value&gt;&lt;/option&gt;
            &lt;option label="Away"&gt;&lt;value&gt;away&lt;/value&gt;&lt;/option&gt;
            &lt;option label="Extended Away"&gt;&lt;value&gt;xa&lt;/value&gt;&lt;/option&gt;
            &lt;option label="Do Not Disturb"&gt;&lt;value&gt;dnd&lt;/value&gt;&lt;/option&gt;
            &lt;value&gt;chat&lt;/value&gt;
            &lt;value&gt;online&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 52. Subscriber returns completed options form</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="sub1@foo.com/home"
    to="pubsub.jabber.org"
    id="options2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;options node="generic/pgm-mp3-player"
             jid="sub1@foo.com"
             subid="123-abc"&gt;
        &lt;x xmlns="jabber:x:data"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#digest" type="boolean"&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
          &lt;field var="pubsub#show-values" type="list-multi"&gt;
            &lt;value&gt;chat&lt;/value&gt;
            &lt;value&gt;online&lt;/value&gt;
            &lt;value&gt;away&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 53. Server responds with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="options2"/&gt;</pre></div>

                <p class="caption">Example 54. Server responds with Bad Request for invalid options</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="sub1@foo.com/home"
    id="options2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;options node="generic/pgm-mp3-player"
             subid="123-abc"
             jid="sub1@foo.com"&gt;
        &lt;x xmlns="jabber:x:data"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#digest" type="boolean"&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
          &lt;field var="pubsub#show-values" type="list-multi"&gt;
            &lt;value&gt;chat&lt;/value&gt;
            &lt;value&gt;online&lt;/value&gt;
            &lt;value&gt;away&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
  &lt;error code="400" type="modify"&gt;
    &lt;bad-request xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;invalid-options xmlns="http://jabber.org/protocol/pubsub#errors"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

            </div>

            
            <div class="indent">
<h3>8.1.10 <a name="entity-getitems">Get Items for a Node</a>
</h3>
            <p class="" style="">Implementations of pubsub that choose to persist items MAY allow entities to request existing items from a node. Entities may wish to do this after successfully subscribing to a node in order to receive all the items that are in the publishing "history" for that node. When an entity requests items, the pubsub service SHOULD verify that the requesting entity has a subscription to the pubsub node. If a subscription identifier is associated with a specific subscription, the entity MUST append the 'subid' attribute to the items element when making the request (if it does not, the service SHOULD return a &lt;not-acceptable/&gt; error). This attribute allows the pubsub service to generate different sets of items based on the subscription options associated with a specific subscription.</p>
            <p class="" style="">
            Subscribers may also receive event notification without any payload information. In this case, the client may request the item that was published (using the ItemID) in order to retrieve the payload. When an entity requests items by ItemID, implementations MUST allow multiple items to be specified in the request. Implementations MAY also allow entities to request the most recent N items by using the 'max_items' attribute. When max_items is used, implementations SHOULD return the N most recent (as opposed to the N oldest) items.
            </p>

                <p class="caption">Example 55. Subscriber requests all active items</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="items1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" subid="123-abc"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 56. Server sends items back</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="items1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" subid="123-abc"&gt;
      &lt;item id="item1"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
      &lt;item id="item2"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Edward Gregson&lt;/artist&gt;
          &lt;title&gt;Tuba Concerto&lt;/title&gt;
          &lt;source&gt;Tuba Tones&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
      &lt;item id="item3"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Walter Ross&lt;/artist&gt;
          &lt;title&gt;Tuba Concerto&lt;/title&gt;
          &lt;source&gt;The Tuba's Greatest Hits&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 57. Service does not support persistent items</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="items1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" subid="123-abc"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="501" type="cancel"&gt;
    &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;persistence-unavailable xmlns="http://jabber.org/protocol/pubsub#errors"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 58. Subscriber requests two most recent items</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="items2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" max_items="2" subid="123-abc"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 59. Server returns two most recent items</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="items2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" subid="123-abc"&gt;
      &lt;item id="item2"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Edward Gregson&lt;/artist&gt;
          &lt;title&gt;Tuba Concerto&lt;/title&gt;
          &lt;source&gt;Tuba Tones&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
      &lt;item id="item3"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Walter Ross&lt;/artist&gt;
          &lt;title&gt;Tuba Concerto&lt;/title&gt;
          &lt;source&gt;The Tuba's Greatest Hits&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 60. Subscriber requests specific items by ItemID</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="items3"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" subid="123-abc"&gt;
      &lt;item id="item1"/&gt;
      &lt;item id="item3"/&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 61. Server sends requested item(s)</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="items3"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player" subid="123-abc"&gt;
      &lt;item id="item1"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Ralph Vaughan Williams&lt;/artist&gt;
          &lt;title&gt;Concerto in F for Bass Tuba&lt;/title&gt;
          &lt;source&gt;Golden Brass: The Collector's Edition&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
      &lt;item id="item3"&gt;
        &lt;tune xmlns="http://jabber.org/protocol/tune"&gt;
          &lt;artist&gt;Walter Ross&lt;/artist&gt;
          &lt;title&gt;Tuba Concerto&lt;/title&gt;
          &lt;source&gt;The Tuba's Greatest Hits&lt;/source&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 62. Subscriber sends request without subid</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="items5"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 63. Subid required</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="items5"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;items node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="406" type="modify"&gt;
    &lt;not-acceptable xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>



            </div>

            
            <div class="indent">
<h3>8.1.11 <a name="entity-discovernodes">Discover Nodes</a>
</h3>
            <p class="" style="">A service MAY implement some kind of pubsub browsing mechanism which enables the user to discover various nodes. The user may then select nodes to which he or she is interested in subscribing. Entities SHOULD use the <span style="font-weight: bold">Service Discovery</span> protocol for node discovery, subject to the recommendations in JEP-0030 regarding large result sets (for which <span class="ref" style="">Jabber Search</span>  [<a href="#nt-id2253954">9</a>] or some other protocol SHOULD be used). The examples show the protocol for possible results when using Service Discovery on a hierarchical pubsub service.</p>

            <p class="caption">Example 64. A client discovers all first level nodes</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="nodes1"&gt;
    &lt;query xmlns="http://jabber.org/protocol/disco#items"/&gt;
&lt;/iq&gt;

&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="nodes1"&gt;
    &lt;query xmlns="http://jabber.org/protocol/disco#items"&gt;
        &lt;item jid="pubsub.jabber.org"
              node="generic"
              name="A place for generic nodes"/&gt;
        &lt;item jid="pubsub.jabber.org"
              node="bar"
              name="A place for drinks"/&gt;
        &lt;item jid="pubsub.jabber.org"
              node="fez"
              name="A place for hats"/&gt;
    &lt;/query&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 65. A client drills down to second level nodes</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="nodes2"&gt;
    &lt;query xmlns="http://jabber.org/protocol/disco#items" node="generic"/&gt;
&lt;/iq&gt;

&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="nodes2"&gt;
    &lt;query xmlns="http://jabber.org/protocol/disco#items"
           node="generic"&gt;
        &lt;item jid="pubsub.jabber.org"
              node="generic/pgm-mp3-player"/&gt;
        &lt;item jid="pubsub.jabber.org"
              node="generic/psa-mp3-player"/&gt;
        &lt;item jid="pubsub.jabber.org"
              node="generic/slashdot-news"/&gt;
        &lt;item jid="pubsub.jabber.org"
              node="generic/meerkat-news"/&gt;
    &lt;/query&gt;
&lt;/iq&gt;</pre></div>
            </div>

            
            <div class="indent">
<h3>8.1.12 <a name="entity-info-metadata">Discover Node Information and Meta-Data</a>
</h3>
                <p class="" style="">A pubsub service MUST allow entities to query individual nodes for the information associated with that node. The Service Discovery protocol MUST be used to discover this information. The disco#info results MUST include an identity with a category of pubsub and a type of either leaf or collection. If a specific node has an identity type of leaf, then it MUST contain individual items. If a specific node has an identity type of collection, then it MUST contain other nodes and/or collections but MUST NOT contain items.</p>
                <p class="" style="">The disco#info result MAY include detailed metadata about the node, encapsulated in the <span style="font-weight: bold">Data Forms</span> (JEP-0004) format as described in <span class="ref" style="">Service Discovery Extensions</span>  [<a href="#nt-id2254052">10</a>], where the data form context is specified by including a FORM_TYPE of "http://jabber.org/protocol/pubsub#meta-data" in accordance with JEP-0068. If meta-data is provided, it SHOULD include values for all configured options as well as "automatic" information such as the node creation date, a list of publishers, and the like.</p>

                <p class="caption">Example 66. Entity Queries a node for information and meta-data</p>
<div class="indent"><pre>
&lt;iq type="get" to="pubsub.jabber.org" from="entity1" id="meta-1"&gt;
  &lt;query xmlns="http://jabber.org/protocol/disco#info"
         node="generic/pgm-mp3-player"/&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 67. Service responds with information and meta-data</p>
<div class="indent"><pre>
&lt;iq type="result" from="pubsub.jabber.org" to="entity1"&gt;
  &lt;query xmlns="http://jabber.org/protocol/disco#info"
         node="generic/pgm-mp3-player"&gt;
    &lt;identity category="pubsub" type="leaf"/&gt;
    &lt;feature var="http://jabber.org/protocol/pubsub"/&gt;
    &lt;x xmlns="jabber:x:data" type="result"&gt;
      &lt;field var="FORM_TYPE" type="hidden"&gt;
        &lt;value&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#type" label="Payload type"&gt;
        &lt;value&gt;http://jabber.org/protocol/tune&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#payload_xslt" label="Payload XSLT"&gt;
        &lt;value&gt;http://jabber.org/protocol/tune/payload.xslt&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#creator" label="Node creator"&gt;
        &lt;value&gt;creator@jabber.org&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#creation_date" label="Creation date"&gt;
        &lt;value&gt;2003-07-29T22:56Z&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#description" label="A description of the node"&gt;
        &lt;value&gt;This node rocks!&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#language" label="Default language"&gt;
        &lt;value&gt;en&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#publisher" label="Publishers to this node"&gt;
        &lt;value&gt;pgm@jabber.org&lt;/value&gt;
        &lt;value&gt;MaineBoy@jabber.org&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#title" label="A name for the node"&gt;
        &lt;value&gt;This node has no name.&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;</pre></div>

                  <p class="" style="">Much of the meta-data provided about a node maps directly to selected <span class="ref" style="">Dublin Core Metadata Initiative (DCMI)</span>  [<a href="#nt-id2254108">11</a>] meta-data attributes; specifically:</p>
                  <p class="caption">Table 6: Dublin Core Metadata Mapping</p>
<table border="1" cellpadding="3" cellspacing="0">
                    <tr class="body">
<th colspan="" rowspan="">Pubsub Field</th>
<th colspan="" rowspan="">Dublin Core Metadata Attribute</th>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#creation_date</td>
<td align="" colspan="" rowspan="">Date  [<a href="#nt-id2254169">12</a>]</td>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#creator</td>
<td align="" colspan="" rowspan="">Creator</td>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#description</td>
<td align="" colspan="" rowspan="">Description</td>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#language</td>
<td align="" colspan="" rowspan="">Language</td>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#publisher</td>
<td align="" colspan="" rowspan="">Publisher</td>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#title</td>
<td align="" colspan="" rowspan="">Title</td>
</tr>
                    <tr class="body">
<td align="" colspan="" rowspan="">pubsub#type</td>
<td align="" colspan="" rowspan="">Type  [<a href="#nt-id2254270">13</a>]</td>
</tr>
                  </table>
            </div>

            
            <div class="indent">
<h3>8.1.13 <a name="entity-discoveritems">Discover Items for a Node</a>
</h3>
            <p class="" style="">To discover the published items which exist on the service for a specific node, an entity MAY send a disco#items request to the node itself, and each item will be returned as a Service Discovery &lt;item/&gt; element. The 'name' attribute of each Service Discovery item MUST contain its ItemID and the item MUST NOT possess a 'node' attribute. This ItemID MAY then be used to retrieve the actual node using the protocol defined in the <a href="#entity-getitems">Get Items for a Node</a> section of this document.
            </p>

            <p class="caption">Example 68. A client requests all of the items for a node</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="items1"&gt;
    &lt;query xmlns="http://jabber.org/protocol/disco#items"
           node="generic/slashdot-news" /&gt;
&lt;/iq&gt;

&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="items1"&gt;
    &lt;query xmlns="http://jabber.org/protocol/disco#items"
           node="generic/slashdot-news"&gt;
        &lt;item jid="pubsub.jabber.org" name="2003/03/06/1641229"/&gt;
        &lt;item jid="pubsub.jabber.org" name="2003/03/06/1629206"/&gt;
        &lt;item jid="pubsub.jabber.org" name="2003/03/06/1625222"/&gt;
        &lt;item jid="pubsub.jabber.org" name="2003/03/06/1341209"/&gt;
    &lt;/query&gt;
&lt;/iq&gt;</pre></div>
            </div>

        </div>

        
        <div class="indent">
<h3>8.2 <a name="owner">Owner Use Cases</a>
</h3>
            <p class="" style="">Implementations MAY allow node owners to configure the various options for a specific node. Implementations SHOULD use the <span style="font-weight: bold">Data Forms</span> protocol to allow the node owner to accomplish the configuration.</p>
            <p class="" style="">The following example shows SOME of the possible configuration options which MAY be implemented in some implementations. If an implementation implements these features using the <span style="font-weight: bold">Data Forms</span> protocol, that implementation MUST use the fields that are registered with the Jabber Registrar in association with the 'http://jabber.org/protocol/pubsub' namespace (a preliminary representation of those field variables is shown below, but MUST NOT be construed as canonical, since the Jabber Registrar may standardize additional fields at a later date without changes to this JEP). An implementation MAY choose to specify different labels, values, and even field types, but must conform to the defined variable naming scheme.</p>

            
            <div class="indent">
<h3>8.2.1 <a name="owner-configure">Configure a Node</a>
</h3>

                <p class="" style="">After creating a new node, the node owner may want to modify the node configuration. The process for doing so is shown below.</p>

                <p class="caption">Example 69. Owner requests configuration form</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="config1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>
                <p class="caption">Example 70. Server responds with configuration form</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="config1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure node="generic/pgm-mp3-player"&gt;
      &lt;x xmlns="jabber:x:data" type="form"&gt;
        &lt;field var="FORM_TYPE" type="hidden"&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#deliver_payloads" type="boolean"
               label="Deliver payloads with event notifications"&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#notify_config" type="boolean"
               label="Notify subscribers when the node configuration changes"&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#notify_delete" type="boolean"
               label="Notify subscribers when the node is deleted"&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#notify_retract" type="boolean"
               label="Notify subscribers when items are removed from the node"&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#persist_items" type="boolean"
               label="Persist items to storage"&gt;
        &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#max_items" type="text-single"
               label="Max # of items to persist"&gt;
          &lt;value&gt;10&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subscribe" type="boolean"
               label="Whether to allow subscriptions"&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#subscription_model" type="list-single"
               label="Specify the subscriber model"&gt;
          &lt;option&gt;&lt;value&gt;whitelist&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;authorize&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;open&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#publish_model" type="list-single"
               label="Specify the publisher model"&gt;
          &lt;option&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;subscribers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;publishers&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#max_payload_size" type="text-single"
               label="Max Payload size in bytes"&gt;
          &lt;value&gt;9216&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#send_item_subscribe" type="boolean"
               label="Send items to new subscribers"&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#presence_based_delivery" type="boolean"
               label="Only deliver notifications to available users"&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#current_approver" type="list-single"
               label="Specify the current subscription approver"&gt;
          &lt;option&gt;&lt;value&gt;owner1@foo.com&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;owner2@foo.com&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;owner3@foo.com&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;owner2@foo.com&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#type" type="text-single"
               label="Specify the type of payload data to be provided at this node"/&gt;
        &lt;field var="pubsub#payload_xslt" type="text-single"
	       label="Payload XSLT"/&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="" style="">If no configuration options are available (e.g., because node configuration is "locked down"), the service MUST return a &lt;feature-not-implemented/&gt; error to the owner.</p>

                <p class="caption">Example 71. Node has no configuration options</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="config1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="501" type="cancel"&gt;
    &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;node-not-configurable xmlns="http://jabber.org/protocol/pubsub#errors"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="" style="">After receiving the configuration form, the owner SHOULD either submit a completed configuration form or cancel the configuration process, in which case the existing configuration MUST be applied.</p>

                <p class="caption">Example 72. Owner submits node configuration form</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="config2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure node="generic/pgm-mp3-player"&gt;
      &lt;x xmlns="jabber:x:data" type="submit"&gt;
        &lt;field var="FORM_TYPE" type="hidden"&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var="pubsub#deliver_payloads"&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#persist_items"&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#max_items"&gt;&lt;value&gt;10&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#subscription_allow"&gt;&lt;value&gt;authorize&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#publish_model"&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#send_item_subscribe"&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#presence_based_delivery"&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#notify_config"&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#notify_delete"&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#notify_retract"&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#max_payload_size"&gt;&lt;value&gt;1028&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#current_approver"&gt;&lt;value&gt;owner2@foo.com&lt;/value&gt;&lt;/field&gt;
        &lt;field var="pubsub#type"&gt;http://jabber.org/protocol/tune&lt;/field&gt;
        &lt;field var="pubsub#payload_xslt"&gt;
	  &lt;value&gt;http://jabber.org/protocol/tune/payload.xslt&lt;/value&gt;
	&lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 73. Owner cancels configuration process</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="config2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure node="generic/pgm-mp3-player"&gt;
      &lt;x xmlns="jabber:x:data" type="cancel"/&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            <p class="" style="">If the "pubsub#notify_config" option is set to "1" (yes), then the service MUST send a notification of configuration change to all subscribers. (A service SHOULD support this option for leaf nodes and MUST support it for <a href="#collection">Collection Nodes</a>.) If the node configuration is set to event notifications only, the notification MUST consist of an empty &lt;item/&gt; element whose 'id' attribute is set to a value of "configuration"; if the node configuration is set to full payloads, the &lt;item/&gt; element MUST in addition contain the node configuration as represented via the <span style="font-weight: bold">Data Forms</span> protocol.</p>

            <p class="caption">Example 74. Service sends configuration change notification (event notification only)</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="configuration"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

            <p class="caption">Example 75. Service sends configuration change notification (full payload)</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic/pgm-mp3-player"&gt;
      &lt;item id="configuration"&gt;
        &lt;x xmlns="jabber:x:data" type="result"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#deliver_payloads"
                 label="Deliver payloads with event notifications"&gt;
            &lt;value&gt;1&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#notify_config"
                 label="Notify subscribers when the node configuration changes"&gt;
            &lt;value&gt;0&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#notify_delete"
                 label="Notify subscribers when the node is deleted"&gt;
            &lt;value&gt;0&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#notify_retract"
                 label="Notify subscribers when items are removed from the node"&gt;
            &lt;value&gt;0&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#persist_items"
                 label="Persist items to storage"&gt;
            &lt;value&gt;1&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#max_items"
                 label="Max # of items to persist"&gt;
            &lt;value&gt;10&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#subscribe"
                 label="Whether to allow subscriptions"&gt;
            &lt;value&gt;1&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#subscription_model"
                 label="Specify the subscriber model"&gt;
            &lt;value&gt;open&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#publish_model"
                 label="Specify the publisher model"&gt;
            &lt;value&gt;publishers&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#max_payload_size"
                 label="Max Payload size in bytes"&gt;
            &lt;value&gt;9216&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#send_item_subscribe"
                 label="Send items to new subscribers"&gt;
            &lt;value&gt;0&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#presence_based_delivery"
                 label="Only deliver notifications to available users"&gt;
            &lt;value&gt;0&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#current_approver"
                 label="Specify the current subscription approver"&gt;
            &lt;value&gt;owner2@foo.com&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#type"
                 label="Specify the type of payload data to be provided at this node"&gt;
            &lt;value&gt;http://jabber.org/protocol/tune&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#payload_xslt" label="Payload XSLT"&gt;
            &lt;value&gt;http://jabber.org/protocol/tune/payload.xslt&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

         </div>

         <div class="indent">
<h3>8.2.2 <a name="owner-default">Request Default Configuration Options</a>
</h3>

            <p class="" style="">Services MAY allow entities to create nodes and include configuration options in the same stanza as the node creation request. In these cases, the entity SHOULD first get the node options which can be used. To get the options, the entity MUST send a configure request to the service with no NodeID; in response, the service MUST return the default node options if it supports batching a node creation and configuration request.   [<a href="#nt-id2254628">14</a>] If the service does not support this feature, it MUST return a &lt;feature-not-implemented/&gt; error in response to the configure request with no NodeID. If the feature is not implemented but the requesting entity does not first check to determine if it is implemented but instead simply sends a create-node request that includes configuration options, the service SHOULD ignore the configuration part of the request and proceed as if it had not been included.</p>
            <p class="" style="">Before deciding whether or not accept the default configuration during node creation, an entity may want to determine what the default node configuration settings are for the service.</p>

            <p class="caption">Example 76. Entity requests default configuration options for leaf nodes</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    id="config3"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure type="leaf"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 77. Service responds with default configuration options for leaf nodes</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pgm@jabber.org"
    id="config3"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure type="leaf"&gt;
     &lt;x xmlns="jabber:x:data" type="form"&gt;
      &lt;field var="FORM_TYPE" type="hidden"&gt;
         &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#deliver_payloads" type="boolean"
             label="Deliver payloads with event notifications"&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#notify_config" type="boolean"
             label="Notify subscribers when the node configuration changes"&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#notify_delete" type="boolean"
             label="Notify subscribers when the node is deleted"&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#notify_retract" type="boolean"
             label="Notify subscribers when items are removed from the node"&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#persist_items" type="boolean"
             label="Persist items to storage"&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#max_items" type="text-single"
             label="Max # of items to persist"&gt;
        &lt;value&gt;10&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#subscribe" type="boolean"
             label="Whether to allow subscriptions"&gt;
        &lt;value&gt;1&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#subscription_model" type="list-single"
             label="Specify the subscriber model"&gt;
        &lt;option&gt;&lt;value&gt;whitelist&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;authorize&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
        &lt;value&gt;open&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#publish_model" type="list-single"
             label="Specify the publisher model"&gt;
        &lt;option&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;subscribers&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
        &lt;value&gt;publishers&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#max_payload_size" type="text-single"
             label="Max Payload size in bytes"&gt;
        &lt;value&gt;9216&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#send_item_subscribe" type="boolean"
             label="Send items to new subscribers"&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#presence_based_delivery" type="boolean"
             label="Only deliver notifications to available users"&gt;
        &lt;value&gt;0&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var="pubsub#current_approver" type="list-single"
             label="Specify the current subscription approver"&gt;
        &lt;option&gt;&lt;value&gt;owner1@foo.com&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;owner2@foo.com&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;owner3@foo.com&lt;/value&gt;&lt;/option&gt;
        &lt;value&gt;owner2@foo.com&lt;/value&gt;
     &lt;/field&gt;
     &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 78. Service does not support default options</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="config3"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure/&gt;
  &lt;/pubsub&gt;
  &lt;error code="501" type="cancel"&gt;
    &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
    &lt;node-not-configurable xmlns="http://jabber.org/protocol/pubsub#errors"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

	      <p class="" style="">The default configuration options may be different for a collection node vs. a leaf node. In order to specifically request the default configuration options for a collection nodes, an entity MUST specify a type of "collection" in the request (since the default value for the 'type' attribute is "leaf"):</p>

              <p class="caption">Example 79. Entity requests default configuration options for leaf nodes</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    id="config4"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub#owner"&gt;
    &lt;configure type="collection"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            </div>

            
            <div class="indent">
<h3>8.2.3 <a name="owner-delete">Delete a Node</a>
</h3>
            <p class="" style="">Deleting a node removes the node from the implementation (and data store if applicable). If an implementation persists items, deleting a node MUST first have the same effect as purging all the items for the node (see the <a href="#owner-purge">Purge all node items</a> section below) before the node itself is deleted.</p>

                <p class="caption">Example 80. Owner deletes a node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="delete1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;delete node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 81. Node does not exist</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="delete1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;delete node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="404" type="cancel"&gt;
    &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 82. Entity is not an owner</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="delete1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;delete node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 83. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="delete1"/&gt;</pre></div>

                <p class="caption">Example 84. Subscribers are notified of node removal</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;delete node="generic/pgm-mp3-player"/&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message to="subscriber2" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;delete node="generic/pgm-mp3-player"/&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

            </div>

            
            <div class="indent">
<h3>8.2.4 <a name="owner-purge">Purge All Node Items</a>
</h3>
            <p class="" style="">Purging a node is applicable only in an implementation which persists published items. The act of purging a node removes all items from the persistent store. If an implementation does not persist items, it MUST return a &lt;feature-not-implemented/&gt; error. If the entity requesting to purge the node is not a node owner, the implementation must return a &lt;not-authorized/&gt; error.</p>
            <p class="" style="">If a node and/or service has been configured to notify subscribers on deletion of items, a purge request MUST NOT result in sending the same notifications as are sent when deleting items (since purging a node with many persisted items could result in a huge number of notifications); instead, the node MUST send a single notification to each subscriber, containing an empty &lt;purge/&gt; child element.</p>

                <p class="caption">Example 85. Owner purges items from a node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="purge1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;purge node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 86. Server replies with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="purge1"/&gt;</pre></div>

                <p class="caption">Example 87. Subscribers are notified of node purge</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;purge node="generic/pgm-mp3-player"/&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message to="subscriber2" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;purge node="generic/pgm-mp3-player"/&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

                <p class="caption">Example 88. Node does not exist</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="purge1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;purge node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="404" type="cancel"&gt;
    &lt;item-not-found xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 89. Entity is not an owner</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="purge1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;purge node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 90. Node is not configured for persistent items</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="purge1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;purge node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
  &lt;error code="501" type="cancel"&gt;
    &lt;feature-not-implemented xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

            </div>

            
            <div class="indent">
<h3>8.2.5 <a name="owner-modify">Modifying Entity Affiliations</a>
</h3>
            <p class="" style="">Entities will be affiliated with a node. The node owner may edit these affiliations using the pubsub namespace. The owner may get a list of all affiliated entities, and set affiliations for existing or new entities. Note that if the node is configured for open subscriptions and/or open publishers, then the service itself will also be modifying this list. Affiliations with a node SHOULD be handled and stored using the "bare JID" (user@host) of an entity rather than the "full JID" (user@host/resource).</p>
            <p class="" style="">Implementations SHOULD allow owners to specify not only affiliations, but also subscriptions. If either the 'affiliation' attribute or the 'subscription' attribute is not specified in a modification request, then the value MUST NOT be changed.</p>

                <p class="caption">Example 91. Owner requests all affiliated entities</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="ent1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entities node="generic/pgm-mp3-player"/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 92. Server responds with entity items</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    to="pgm@jabber.org"
    id="ent1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entities node="generic/pgm-mp3-player"&gt;
      &lt;entity jid="pgm@jabber.org"
              affiliation="owner"
              subscription="none"/&gt;
      &lt;entity jid="bar@baz.com"
              affiliation="publisher"
              subscription="none"/&gt;
      &lt;entity jid="bar2@baz.com"
              affiliation="publisher"
              subid="sub1"
              subscription="subscribed"/&gt;
      &lt;entity jid="bar3@baz.com"
              affiliation="publisher"
              subid="sub2"
              subscription="subscribed"/&gt;
      &lt;entity jid="sub1@foo.com"
              affiliation="none"
              subid="sub3"
              subscription="subscribed"/&gt;
      &lt;entity jid="sub2@foo.com"
              affiliation="none"
              subid="sub4"
              subscription="subscribed"/&gt;
      &lt;entity jid="sub3@foo.com"
              affiliation="none"
              subid="sub5"
              subscription="subscribed"/&gt;
      &lt;entity jid="p1@bar.com"
              affiliation="none"
              subid="sub6"
              subscription="pending"/&gt;
      &lt;entity jid="p2@bar.com"
              affiliation="none"
              subid="sub7"
              subscription="pending"/&gt;
      &lt;entity jid="out1@foo.com"
              affiliation="outcast"
              subscription="none"/&gt;
      &lt;entity jid="out2@foo.com"
              affiliation="outcast"
              subscription="none"/&gt;
    &lt;/entities&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 93. Owner sets affiliations for publishers</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="ent2"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entities node="generic/pgm-mp3-player"&gt;
      &lt;entity jid="abc@bar.com"
              affiliation="publisher"
              subscription="subscribed"/&gt;
    &lt;/entities&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 94. Server responds with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    from="pubsub.jabber.org"
    id="ent2"/&gt;</pre></div>

                <p class="" style="">The owner MAY change multiple affiliations in a single request. If one of the entity elements specified is invalid, the service SHOULD return an IQ error with the invalid entries. The following example shows an entity attempting to make another owner an outcast (pgm@jabber.org). This implementation of pubsub does not allow that operation, so it returns that item, and the error for that item. Note that the affiliation sent back is the original un-altered affiliation.
                </p>
                <p class="" style="">The state chart at the beginning of this document is a MUST-IMPLEMENT set of rules for checking possible state transitions. Implementations MAY enforce other (more strict) rules. When errors occur during a modification request for multiple entities, the pubsub service MUST return any entity element(s) which caused the error. Returned entities which failed to be modified MUST include the existing 'affiliation' and 'subscription' attributes. An error element containing the error code and a brief description of the error MUST also be included as a child element of the entity which failed. Any entity elements which are not returned in an IQ error case MUST be treated as successful modifications.
                </p>

                <p class="caption">Example 95. Owner sets affiliation for multiple entities</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="ent3"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entities node="generic/pgm-mp3-player"&gt;
      &lt;entity jid="bar@baz.com"
              affiliation="publisher"
              subscription="none"/&gt;
      &lt;entity jid="bar2@baz.com"
              affiliation="publisher"
              subscription="none"/&gt;
      &lt;entity jid="bar3@baz.com"
              affiliation="publisher"
              subid="sub2"
              subscription="subscribed"/&gt;
      &lt;entity jid="pgm@jabber.org"
              affiliation="outcast"
              subscription="none"/&gt;
    &lt;/entities&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

                <p class="caption">Example 96. Server responds with an error</p>
<div class="indent"><pre>
&lt;iq type="error"
    from="pubsub.jabber.org"
    id="ent3"/&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;entities node="generic/pgm-mp3-player"&gt;
      &lt;entity jid="pgm@jabber.org"
              affiliation="owner"
              subscription="none"/&gt;
    &lt;/entities&gt;
  &lt;/pubsub&gt;
  &lt;error code="401" type="auth"&gt;
    &lt;not-authorized xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>


            </div>
        </div>
    <h2>9.
       <a name="collections">Collection Nodes</a>
</h2>
        <p class="" style="">A pubsub service MAY support collection nodes as well as leaf nodes. Collections enable nodes to be grouped together in any way including a hierarchy. Collections MUST contain only "leaf" nodes and/or other collections. Collections MUST NOT contain published items, since only "leaf" nodes contain items. If collections are supported, then the service MUST advertise that fact in its disco#info responses by including a feature of "pubsub#collections".</p>

        <p class="" style="">Pubsub services that implement collections SHOULD allow entities to subscribe to collection nodes. Subscriptions to collection nodes MUST be configured via the protocol specified in the <a href="#usecases">Use Cases</a> section of this document. Subscription options for collection nodes MUST include a subscription type field which enables the subscriber to configure the subscription either as a subscription for items or as a subscription for nodes. This subscription option MUST use the registered field name of "pubsub#subscription_type" as defined in the <a href="#registrar">Jabber Registrar Considerations</a> section of this document. If the subscription type specified on a subscription to a collection node is "items", the subscriber MUST be notified whenever an item is published to any node contained in the collection, where such a node may be a direct "child" of the collection node, or a child (to any depth) of a sub-collection of the collection node to which the subscriber has subscribed.</p>

        <div class="indent">
<h3>9.1 <a name="collections-subscribe">Subscribing to a Collection Node</a>
</h3>
        
        <p class="" style="">When subscribing to a collection node, a service MUST allow the subscriber to specify whether it wants to receive notifications only from first-level children of the collection or from all descendents. For subscriptions of type "nodes", this enables the subscriber to be informed only when a new node is added in the specific collection to which it has subscribed, or to be informed whenever a node is added anywhere in the node "tree" that begins at the level of the collection to which it has subscribed. A similar distinction applies to subscriptions of type "items". The name for this configuration option is "pubsub#subscription_depth".</p>

        <p class="caption">Example 97. Entity subscribes to a collection node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="sub1@foo.com/home"
    to="pubsub.jabber.org"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe jid="sub1@foo.com"/&gt;
    &lt;options jid="sub1@foo.com"&gt;
        &lt;x xmlns="jabber:x:data"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#subscription_type"&gt;
            &lt;value&gt;items&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#subscription_depth"&gt;
            &lt;value&gt;all&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
     &lt;/options&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

        <p class="" style="">The subscriber will now receive item notifications from nodes at any depth within this collection.</p>

        </div>

        <div class="indent">
<h3>9.2 <a name="collections-root">Root Collection Node</a>
</h3>

        <p class="" style="">Pubsub services that implement collections SHOULD support a root collection. This collection MUST include all nodes in the entire pubsub service and shall be identified by the lack of a node identifier (i.e., the address of the pubsub service itself, such as "pubsub.shakespeare.lit"). Subscribing to this node with a subscription of type "nodes" enables an entity to be notified whenever a new node is created in the entire pubsub system.</p>

        <p class="caption">Example 98. Entity subscribes to the root collection node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="sub1@foo.com/home"
    to="pubsub.jabber.org"
    id="sub1"&gt;
  &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
    &lt;subscribe jid="sub1@foo.com"/&gt;
    &lt;options jid="sub1@foo.com"&gt;
        &lt;x xmlns="jabber:x:data"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#subscription_type"&gt;
            &lt;value&gt;nodes&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#subscription_depth"&gt;
            &lt;value&gt;1&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
     &lt;/options&gt;
   &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

        <p class="" style="">If an entity subscribes to a collection node with a subscription type of "nodes", then the service MUST inform the subscriber whenever a new node is added to the collection. This is simply done by sending a notification where the 'id' attribute of the &lt;item/&gt; element specifies the NodeID of the new node. The notification event MUST also include the node meta-data specified in the section above, which is formatted using the <span style="font-weight: bold">Data Forms</span> protocol.</p>

            <p class="caption">Example 99. Payload format for node subscriptions</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items&gt;
      &lt;item id="new-node-id"&gt;
        &lt;x xmlns="jabber:x:data" type="result"&gt;
          &lt;field var="FORM_TYPE" type="hidden"&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#creation_date" label="Creation date"&gt;
            &lt;var&gt;2003-07-29T22:56Z&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#creator" label="Node creator"&gt;
            &lt;var&gt;creator@jabber.org&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#description" label="A description of the node"&gt;
            &lt;var&gt;This node rocks!&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#language" label="Default language"&gt;
            &lt;var&gt;en&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#publisher" label="Publishers to this node"&gt;
            &lt;var&gt;pgm@jabber.org&lt;/var&gt;
            &lt;var&gt;MaineBoy@jabber.org&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#title" label="A name for the node"&gt;
            &lt;var&gt;This node has no name.&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#type" label="The type of data provided at the node"&gt;
            &lt;var&gt;http://jabber.org/protocol/moods&lt;/var&gt;
          &lt;/field&gt;
          &lt;field var="pubsub#payload_xslt" label="Payload XSLT"&gt;
            &lt;value&gt;http://jabber.org/protocol/tune/payload.xslt&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

        </div>

        <div class="indent">
<h3>9.3 <a name="collections-createnodes">Creating New Collection Nodes</a>
</h3>
            <p class="" style="">To create a new node which is a collection node, the requesting entity MUST specify a type of "collection" when asking the service to create the node.  [<a href="#nt-id2255362">15</a>] If a service does not allow new collection nodes to be created, it MUST respond with a &lt;not-allowed/&gt; error. If the requesting entity has insufficient privileges to create new collections, the service MUST respond with a &lt;not-authorized/&gt; error.</p>

            <p class="caption">Example 100. Entity requests a new collection node</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="create3"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="test"
	        type="collection"/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 101. Server responds with success</p>
<div class="indent"><pre>
&lt;iq type="result"
    to="pgm@jabber.org"
    from="pubsub.jabber.org"
    id="create3"/&gt;</pre></div>

        </div>

        <div class="indent">
<h3>9.4 <a name="collections-createaffil">Creating Nodes Affiliated with a Collection</a>
</h3>
            <p class="" style="">To create a new node which is part of an existing collection, the node configuration protocol MUST be used in the node creation request. When a pubsub system supports collections, it MUST support node configuration via the Data Forms protocol as specified in the foregoing sections. A field for collections MUST be included in the node configuration form, and it MUST have a 'var' attribute of "pubsub#collections". This field MUST have a Data Forms type of "text-multi". </p>

            <p class="caption">Example 102. Entity creates a new node related to a collection</p>
<div class="indent"><pre>
&lt;iq type="set"
    from="pgm@jabber.org"
    to="pubsub.jabber.org"
    id="create4"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="foo"/&gt;
        &lt;configure&gt;
            &lt;x xmlns="jabber:x:data" type="submit"&gt;
                &lt;field var="pubsub#collections"&gt;&lt;value&gt;test&lt;/value&gt;&lt;/field&gt;
            &lt;/x&gt;
        &lt;/configure&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

            <p class="caption">Example 103. Server responds with actual new node identifier</p>
<div class="indent"><pre>
&lt;iq type="result"
    to="pgm@jabber.org"
    from="pubsub.jabber.org"
    id="create4"&gt;
    &lt;pubsub xmlns="http://jabber.org/protocol/pubsub"&gt;
        &lt;create node="test/foo"/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

        </div>

        <div class="indent">
<h3>9.5 <a name="collections-notify">Generating Publish Notifications for Collections</a>
</h3>

            <p class="" style="">If an item is published to a node which is also contained by a collection, and an entity is subscribed to that collection with a subscription type of items, then the notifications generated by the service MUST contain additional information. The items element contained in the notification message MUST have the node identifier of the collection that the entity originally subscribed to. The item element MUST ALSO contain a node identifier for the node which generated the notification.</p>

                <p class="caption">Example 104. Subscribers receive notifications from a collection</p>
<div class="indent"><pre>
&lt;message to="subscriber1" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic"&gt;
      &lt;item node="generic/pgm-mp3-player" id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message to="subscriber2" from="pubsub.jabber.org"&gt;
  &lt;event xmlns="http://jabber.org/protocol/pubsub#event"&gt;
    &lt;items node="generic"&gt;
      &lt;item node="generic/pgm-mp3-player" id="current"/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;</pre></div>

        </div>

    <h2>10.
       <a name="errors">Error Conditions</a>
</h2>
        <p class="" style=""></p>
        <p class="caption">Table 7: Error conditions and typical causes</p>
<table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
                <th colspan="" rowspan="">Condition</th>
                <th colspan="" rowspan="">Description</th>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;conflict/&gt;</td>
                <td align="" colspan="" rowspan="">The node already exists. Some implementations may also use this error when publishing items with an ItemID that already exists. See implementation notes for ItemIDs below.</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;feature-not-implemented/&gt;</td>
                <td align="" colspan="" rowspan="">The operation being attempted on a node (or the system) is disabled because the service itself does not support the operation.</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;forbidden/&gt;</td>
                <td align="" colspan="" rowspan="">An entity is requesting an operation for a Jabber ID which it is not allowed to change (e.g., a@jabber.org attempts to subscribe b@jabber.org to a specific node) or the requesting entity has an affiliation of "outcast".</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;item-not-found/&gt;</td>
                <td align="" colspan="" rowspan="">The node specified for some operation does not exist.</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;not-allowed/&gt;</td>
                <td align="" colspan="" rowspan="">An entity has attempted to perform an action which the service implements; however the sysadmin or the node owner has disabled the action for that specific service or node.</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;not-authorized/&gt;</td>
                <td align="" colspan="" rowspan="">This error is produced when an entity tries to perform some action on a node, and that entity has insufficient privileges to perform the action.</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;payment-required/&gt;</td>
                <td align="" colspan="" rowspan="">This error would typically be used to indicate that a subscription for a pubsub node is based on some kind payment service. Payments would be done out-of-band using some agreed-upon method (not defined herein).</td>
            </tr>
            <tr class="body">
                <td align="" colspan="" rowspan="">&lt;registration-required/&gt;</td>
                <td align="" colspan="" rowspan="">Some implementations may require entities to register before node creation is allowed.</td>
            </tr>
        </table>
        <p class="" style="">Note: Refer to <span class="ref" style="">Error Condition Mappings</span>  [<a href="#nt-id2255752">16</a>] for information regarding error syntax.</p>
    <h2>11.
       <a name="impl">Implementation Notes</a>
</h2>

        <div class="indent">
<h3>11.1 <a name="impl-presence">Presence-Based Delivery of Events</a>
</h3>
        <p class="" style="">Implementations of pubsub MAY deliver event notifications only when the subscriber is online. In these cases, the option may be a node configuration option as shown in the examples above. In addition, to facilitate this, the pubsub service needs to subscribe to the subscriber's presence and check the current presence information before sending any event notifications (as described in <span class="ref" style="">XMPP IM</span>  [<a href="#nt-id2255808">17</a>]).
        </p>
        </div>

        <div class="indent">
<h3>11.2 <a name="impl-offline">Not Sending Events to Offline Storage</a>
</h3>
        <p class="" style="">Sending events to users of existing Jabber servers may force event notifications to be sent to offline storage for later delivery. This may not always be desirable. The possible ways of preventing this behavior include:</p>
            <ul>
            <li>Use presence-based subscription options as described above.</li>
            <li>Use delivery semantics as defined by <span class="ref" style="">Advanced Message Processing</span>  [<a href="#nt-id2255898">18</a>].</li>
            <li>Specify a message type of "headline", which in some existing server implementations will prevent offline storage.</li>
            </ul>
        </div>

        <div class="indent">
<h3>11.3 <a name="impl-uniqueness">Node and Item ID Uniqueness</a>
</h3>
        <p class="" style="">NodeIDs MUST be treated as unique identifiers within the context of a particular pubsub service.</p>
        <p class="" style="">If item identifiers are used, they MUST be treated as unique within the scope of the node. NodeID + ItemID MUST be unique within a given service, and MUST specify a single published item to a single node. Multiple publishes to the same ItemID MAY result in behavior similar to that stated above for nodes (except that multiple items in a list MUST NOT have the same ItemID, since ItemIDs MUST be unique within the scope of a node).</p>
        <p class="" style="">If a publisher publishes an item and the ItemID matches that of an existing item, the pubsub service MUST overwrite the existing item and generate a new event notification.</p>
        </div>

        <div class="indent">
<h3>11.4 <a name="impl-authorize">Authorizing Subscription Requests (Pending Subscribers)</a>
</h3>
        <p class="" style="">Implementations may handle sending subscription requests to node owners differently. Possibilities include:
        </p>
            <ul>
                <li>Send requests to multiple owners all the time (these may be stored to offline).</li>
                <li>The service could subscribe to owner presence, and send only to the owners that are online.</li>
                <li>The node configuration stores the current owner which is designated to approve subscription requests (this is shown in the configuration examples).</li>
                <li>All owners vote on the new subscriber.</li>
                <li>Any owner is allowed to veto the subscriber.</li>
            </ul>
          <p class="" style="">An implementation MAY use any of these methods, or some other method not defined herein.</p>
        </div>

        <div class="indent">
<h3>11.5 <a name="impl-hierarchies">Handling Node Hierarchies</a>
</h3>
        <p class="" style="">NodeIDs MAY have semantic value in implementations of pubsub. If an implementation wishes node IDs to have hierarchical meaning (as is shown in the examples), that implementation MAY choose any naming scheme which is suitable to the hierarchy in question. Identifiers could use slashes, periods, or other special characters as the hierarchy separator.
        </p>
        </div>

        <div class="indent">
<h3>11.6 <a name="impl-message">Message Bodies</a>
</h3>
          <p class="" style="">The &lt;message/&gt; stanzas sent from a service to a subscriber for purposes of event notification SHOULD include a &lt;body/&gt; child whose textual CDATA informs the subscriber that the message contains an event notification (e.g., text such as "This message contains an event notification" would be appropriate). This enables "graceful degradation" in case the user's current client does not support pubsub.</p>
        </div>

        <div class="indent">
<h3>11.7 <a name="impl-multiple">Multiple Node Discovery</a>
</h3>
          <p class="" style="">A user may publish information that adheres to a certain profile at multiple pubsub nodes, and a potential subscriber may want to discover all of these pubsub nodes. The user may make a list of pubsub nodes publicly available for querying even when the user is offline by using the Service Discovery mechanism for "publishing" items (see Section 4 of JEP-0030). The potential subscriber may then send a disco#items request to the user's bare JID (&lt;user@host&gt;), including the 'node' attribute set to the value of the namespace to which the desired information adheres. The user's server then returns a list of pubsub nodes that meet that criterion (with each pubsub node being a separate Service Discovery item). Here is an example:</p>
          <p class="caption">Example 105. Discovering multiple nodes</p>
<div class="indent"><pre>
&lt;iq type="get"
    from="stpeter@jabber.org/home"
    to="pgm@jabber.org"
    id="multi-1"/&gt;
  &lt;query xmlns="http://jabber.org/protocol/disco#items"
         node="http://jabber.org/protocol/tune"/&gt;
&lt;/iq&gt;

&lt;iq type="result"
    from="pgm@jabber.org"
    to="stpeter@jabber.org/home"
    id="multi-1"/&gt;
  &lt;query xmlns="http://jabber.org/protocol/disco#items"
         node="http://jabber.org/protocol/tune"&gt;
    &lt;item jid="pubsub.jabber.org"
          node="generic/pgm-mp3-player"
          name="Laptop MP3 Player"/&gt;
    &lt;item jid="thepub.pgmillard.com"
          node="cdplayer"
          name="CD Player @ Home"/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
        </div>

        <div class="indent">
<h3>11.8 <a name="impl-association">Associating Events and Payloads with the Generating Entity</a>
</h3>
          <p class="" style="">In some contexts, it is valuable to provide an association between the event notification or payload and the entity to which the published information pertains. For example, in the context of a protocol such as <span class="ref" style="">User Geolocation</span>  [<a href="#nt-id2256106">19</a>], the user may generate the geolocation information or the information may be generated by an automated service (e.g., a service offered by a mobile telephony provider), but in either case the information is <span style="font-style: italic">about</span> the user (specifically, his or her spatial location). In order to associate the information with the user in a manner more explicit than enforcing semantic meaning on the NodeID, the service MAY include 'replyto' or 'replyroom' data (as specified by the <span class="ref" style="">Extended Stanza Addressing</span>  [<a href="#nt-id2256137">20</a>] protocol) with the &lt;message/&gt; or &lt;presence/&gt; stanzas that contain event notifications and payloads. An example is shown below:</p>
          <p class="caption">Example 106. Event notification with extended stanza addressing</p>
<div class="indent"><pre>
&lt;message from='pubsub.shakespeare.lit'
         to='bassanio@merchantofvenice.lit'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='n48ad4fj78zn38st734'&gt;
      &lt;item id='i1s2d3f4g5h6bjeh936'&gt;
        &lt;geoloc xmlns='http://jabber.org/protocol/geoloc'&gt;
          &lt;description&gt;Venice&lt;/description&gt;
          &lt;lat&gt;45.44&lt;/lat&gt;
          &lt;lon&gt;12.33&lt;/lon&gt;
        &lt;/geoloc&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='portia@merchantofvenice.lit'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;
          </pre></div>
        </div>

        <div class="indent">
<h3>11.9 <a name="impl-leases">Implementing Time-Based Subscriptions (Leases)</a>
</h3>
            <p class="" style="">In some systems it may be desirable to provide a leasing system on subscriptions to a node in order to expire old or stale subscriptions. This can be accomplished using this protocol by using the configurable subscription options, and implementations SHOULD use this method when providing this type of functionality. When an entity subscribes, a field could be sent back in the subscription options which has a 'var' attribute of pubsub#expire. This field MUST contain a date-time specified in <span class="ref" style="">Jabber Date and Time Profiles</span>  [<a href="#nt-id2256204">21</a>]. When an entity wants to renew the lease, it simply gets the current subscription options, changes the value of the pubsub#expire field, and resubmits the new subscription options back to the service. If the new expire value exceeds the maximum value allowed for subscription leases then service MUST change the value of the field to be the current date/time plus the maximum allowed lease period.</p>
        </div>

        <div class="indent">
<h3>11.10 <a name="impl-content">Implementing Content-Based Pubsub Systems</a>
</h3>
            <p class="" style="">Content-based pubsub services SHOULD make use of a variety of optional features.</p>
            <ul>
            <li>Content-based services SHOULD use subscription options to specify the filter to apply to a specific node to determine the content that should be pushed for each node.</li>
            <li>Content-based services SHOULD allow entities to subscribe more than once to a single node. If this is allowed, the service MUST use the subscription identifier syntax as specified in this document.</li>
            </ul>
        </div>

    <h2>12.
       <a name="security">Security Considerations</a>
</h2>
        <p class="" style="">Because the data published to a pubsub node may contain sensitive information (e.g., a user's geolocation), node owners SHOULD exercise care in approving subscription requests. Security considerations regarding particular kinds of information are the responsbility of the using protocol.</p>
        <p class="" style="">A service MUST NOT send event notifications or payloads to an entity, nor allow an entity to retrieve items published to a node, unless that entity is an authorized subscriber to the node.</p>
        <p class="" style="">A service MUST NOT allow non-owners or other unauthorized entities to complete any actions defined under the <a href="#owner">Owner Use Cases</a> section above.</p>
    <h2>13.
       <a name="iana">IANA Considerations</a>
</h2>
        <p class="" style="">This JEP does not require interaction with the <span class="ref" style="">Internet Assigned Numbers Authority (IANA)</span>  [<a href="#nt-id2256338">22</a>].</p>
    <h2>14.
       <a name="registrar">Jabber Registrar Considerations</a>
</h2>
      <div class="indent">
<h3>14.1 <a name="registrar-ns">Protocol Namespaces</a>
</h3>
        <p class="" style="">The <span class="ref" style="">Jabber Registrar</span>  [<a href="#nt-id2256392">23</a>] shall include the following namespaces in its registry of protocol namespaces:</p>
        <ul>
          <li>http://jabber.org/protocol/pubsub</li>
          <li>http://jabber.org/protocol/pubsub#event</li>
          <li>http://jabber.org/protocol/pubsub#owner</li>
        </ul>
      </div>

      <div class="indent">
<h3>14.2 <a name="registrar-disco">Service Discovery Category/Type</a>
</h3>
        <p class="" style="">As a result of this JEP, the Jabber Registrar shall register a Service Discovery category of "pubsub", as well as three specific Service Discovery types within that category:</p>
        <p class="caption">Table 8: Service Discovery Types in Pubsub Category</p>
<table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <td align="" colspan="" rowspan="">collection</td>
            <td align="" colspan="" rowspan="">A pubsub node of the "collection" type.</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">leaf</td>
            <td align="" colspan="" rowspan="">A pubsub node of the "leaf" type.</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">service</td>
            <td align="" colspan="" rowspan="">A pubsub service that supports the functionality defined in JEP-0060. (Prior to version 1.15 of JEP-0060, this type was called "generic".)</td>
          </tr>
        </table>
        <p class="" style="">The registry submission is as follows:</p>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;category&gt;
  &lt;name&gt;pubsub&lt;/name&gt;
  &lt;desc&gt;Services and nodes that adhere to JEP-0060.&lt;/desc&gt;
  &lt;type&gt;
    &lt;name&gt;collection&lt;/name&gt;
    &lt;desc&gt;A pubsub node of the "collection" type.&lt;/desc&gt;
    &lt;doc&gt;JEP-0060&lt;/doc&gt;
  &lt;/type&gt;
  &lt;type&gt;
    &lt;name&gt;leaf&lt;/name&gt;
    &lt;desc&gt;A pubsub node of the "leaf" type.&lt;/desc&gt;
    &lt;doc&gt;JEP-0060&lt;/doc&gt;
  &lt;/type&gt;
  &lt;type&gt;
    &lt;name&gt;service&lt;/name&gt;
    &lt;desc&gt;A pubsub service that supports the functionality defined in JEP-0060.&lt;/desc&gt;
    &lt;doc&gt;JEP-0060&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
        </pre></div>
        <p class="" style="">Future submissions to the Jabber Registrar may register additional types.</p>
      </div>

      <div class="indent">
<h3>14.3 <a name="registrar-features">Service Discovery Features</a>
</h3>

        <p class="" style="">As a result of this JEP, the Jabber Registrar shall register Service Discovery features that may be returned by pubsub services. The following table defines the initial set of such features. (Future submissions to the Jabber Registrar may register additional features.)</p>

        <p class="caption">Table 9: Service Discovery Features</p>
<table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#collections</td>
                <td align="" colspan="" rowspan="">Collection nodes are supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#config-node</td>
                <td align="" colspan="" rowspan="">Configuration of node options is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#create-nodes</td>
                <td align="" colspan="" rowspan="">Creation of nodes is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#delete-any</td>
                <td align="" colspan="" rowspan="">Any publisher may delete an item (not only the originating publisher).</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#delete-nodes</td>
                <td align="" colspan="" rowspan="">Deletion of nodes is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#instant-nodes</td>
                <td align="" colspan="" rowspan="">Creation of instant nodes is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#item-ids</td>
                <td align="" colspan="" rowspan="">Publishers may specify item identifiers.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#leased-subscription</td>
                <td align="" colspan="" rowspan="">Time-based subscriptions are supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#meta-data</td>
                <td align="" colspan="" rowspan="">Node meta-data is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#multi-subscribe</td>
                <td align="" colspan="" rowspan="">A single entity may subscribe to a node multiple times.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#outcast-affiliation</td>
                <td align="" colspan="" rowspan="">The outcast affiliation is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#persistent-items</td>
                <td align="" colspan="" rowspan="">Persistent items are supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#presence-notifications</td>
                <td align="" colspan="" rowspan="">Presence-based delivery of event notifications is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#publisher-affiliation</td>
                <td align="" colspan="" rowspan="">The publisher affiliation is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#purge-nodes</td>
                <td align="" colspan="" rowspan="">Purging of nodes is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#retract-items</td>
                <td align="" colspan="" rowspan="">Item retraction is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#retrieve-affiliations</td>
                <td align="" colspan="" rowspan="">Retrieval of current affiliations is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#retrieve-items</td>
                <td align="" colspan="" rowspan="">Item retrieval is supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#subscribe</td>
                <td align="" colspan="" rowspan="">Subscribing and unsubscribing are supported.</td>
</tr>
            <tr class="body">
<td align="" colspan="" rowspan="">http://jabber.org/protocol/pubsub#subscription-options</td>
                <td align="" colspan="" rowspan="">Configuration of subscription options is supported.</td>
</tr>
        </table>
        <p class="" style="">The registry submission is as follows:</p>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#collections&lt;/name&gt;
  &lt;desc&gt;Collection nodes are supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#config-node&lt;/name&gt;
  &lt;desc&gt;Configuration of node options is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#create-nodes&lt;/name&gt;
  &lt;desc&gt;Creation of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#delete-any&lt;/name&gt;
  &lt;desc&gt;Any publisher may delete an item (not only the originating publisher).&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#delete-nodes&lt;/name&gt;
  &lt;desc&gt;Deletion of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#instant-nodes&lt;/name&gt;
  &lt;desc&gt;Creation of instant nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#item-ids&lt;/name&gt;
  &lt;desc&gt;Publishers may specify item identifiers.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#leased-subscription&lt;/name&gt;
  &lt;desc&gt;Time-based subscriptions are supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/name&gt;
  &lt;desc&gt;Node meta-data is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#multi-subscribe&lt;/name&gt;
  &lt;desc&gt;A single entity may subscribe to a node multiple times.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#outcast-affiliation&lt;/name&gt;
  &lt;desc&gt;The outcast affiliation is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#persistent-items&lt;/name&gt;
  &lt;desc&gt;Persistent items are supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#presence-notifications&lt;/name&gt;
  &lt;desc&gt;Presence-based delivery of event notifications is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#publisher-affiliation&lt;/name&gt;
  &lt;desc&gt;The publisher affiliation is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#purge-nodes&lt;/name&gt;
  &lt;desc&gt;Purging of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retract-items&lt;/name&gt;
  &lt;desc&gt;Item retraction is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-affiliations&lt;/name&gt;
  &lt;desc&gt;Retrieval of current affiliations is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-items&lt;/name&gt;
  &lt;desc&gt;Item retrieval is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscribe&lt;/name&gt;
  &lt;desc&gt;Subscribing and unsubscribing are supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscription-options&lt;/name&gt;
  &lt;desc&gt;Configuration of subscription options is supported.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/var&gt;
        </pre></div>
      </div>

      <div class="indent">
<h3>14.4 <a name="registrar-formtypes">Field Standardization</a>
</h3>
        <p class="" style="">JEP-0068 defines a process for standardizing the fields used within Data Forms scoped by a particular namespace. Within pubsub, there are four uses of such forms:</p>
        <ol start="" type="">
          <li>Authorization of subscriptions using the 'http://jabber.org/protocol/pubsub#subscribe_authorization' namespace</li>
          <li>Configuration of subscription options using the 'http://jabber.org/protocol/pubsub#subscribe_options' namespace</li>
          <li>Configuration of a node using the 'http://jabber.org/protocol/pubsub#node_config' namespace</li>
          <li>Setting of meta-data information using the 'http://jabber.org/protocol/pubsub#meta-data' namespace</li>
        </ol>
        <p class="" style="">The registry submissions associated with these namespaces are defined below.</p>

        <div class="indent">
<h3>14.4.1 <a name="registrar-formtypes-auth">pubsub#subscribe_authorization FORM_TYPE</a>
</h3>
          <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/name&gt;
  &lt;jep&gt;JEP-0060&lt;/jep&gt;
  &lt;desc&gt;Forms enabling authorization of subscriptions to pubsub nodes&lt;/desc&gt;
  &lt;field
      var='pubsub#allow'
      type='boolean'
      label='Whether to allow the subscription'/&gt;
  &lt;field
      var='pubsub#node'
      type='text-single'
      label='The NodeID of the node'/&gt;
  &lt;field
      var='pubsub#subid'
      type='text-single'
      label='The SubID of the subscription'/&gt;
  &lt;field
      var='pubsub#subscriber_jid'
      type='jid-single'
      label='The address (JID) of the subscriber'/&gt;
&lt;/form_type&gt;
          </pre></div>
        </div>
        <div class="indent">
<h3>14.4.2 <a name="registrar-formtypes-options">pubsub#subscribe_options FORM_TYPE</a>
</h3>
          <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/name&gt;
  &lt;jep&gt;JEP-0060&lt;/jep&gt;
  &lt;desc&gt;Forms enabling configuration of subscription options for pubsub nodes&lt;/desc&gt;
  &lt;field
      var='pubsub#digest'
      type='boolean'
      label='Whether a user wants to receive digests
             (aggregations) of notifications or all
             notifications individually'/&gt;
  &lt;field
      var='pubsub#digest'
      type='boolean'
      label='Whether a user wants to receive digests
             (aggregations) of notifications or all
             notifications individually'/&gt;
  &lt;field
      var='pubsub#show-values'
      type='list-multi'
      label='The presence states for which a user
             wants to receive notifications'&gt;
    &lt;option label='XMPP Show Value of Away'&gt;
      &lt;value&gt;away&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='XMPP Show Value of Chat'&gt;
      &lt;value&gt;chat&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='XMPP Show Value of DND (Do Not Disturb)'&gt;
      &lt;value&gt;dnd&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Mere Availability in XMPP (No Show Value)'&gt;
      &lt;value&gt;online&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='XMPP Show Value of XA (Extended Away)'&gt;
      &lt;value&gt;xa&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var="pubsub#subscription_type"
         type="list-single"&gt;
    &lt;option label='Receive notification of new items only'&gt;
      &lt;value&gt;items&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Receive notification of new nodes only'&gt;
      &lt;value&gt;nodes&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var="pubsub#subscription_depth"
         type="list-single"&gt;
    &lt;option label='Receive notification from direct child nodes only'&gt;
      &lt;value&gt;1&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Receive notification from all descendent nodes'&gt;
      &lt;value&gt;all&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;/field&gt;
&lt;/form_type&gt;
          </pre></div>
        </div>
        <div class="indent">
<h3>14.4.3 <a name="registrar-formtypes-config">pubsub#node_config FORM_TYPE</a>
</h3>
          <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#node_config&lt;/name&gt;
  &lt;jep&gt;JEP-0060&lt;/jep&gt;
  &lt;desc&gt;Forms enabling configuration of pubsub nodes&lt;/desc&gt;
  &lt;field var="pubsub#collection"
         type="boolean"
         label="Whether or not the node is a collection"/&gt;
  &lt;field var="pubsub#current_approver"
         type="list-single"
         label="The current subscription approver"/&gt;
  &lt;field var="pubsub#deliver_payloads"
         type="boolean"
         label="Whether to deliver payloads with event notifications"/&gt;
  &lt;field var="pubsub#max_items"
         type="text-single"
         label="The maximum number of items to persist"/&gt;
  &lt;field var="pubsub#max_payload_size"
         type="text-single"
         label="The maximum payload size in bytes"/&gt;
  &lt;field var="pubsub#node_type"
         type="list-single"
         label="The type of node (collection or leaf)"&gt;
    &lt;option label='Collection node (contains nodes and/or collections)'&gt;
      &lt;value&gt;collection&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Leaf node (contains published items only)'&gt;
      &lt;value&gt;leaf&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var="pubsub#notify_config"
         type="boolean"
         label="Whether to notify subscribers when the node configuration changes"/&gt;
  &lt;field var="pubsub#notify_delete"
         type="boolean"
         label="Whether to notify subscribers when the node is deleted"/&gt;
  &lt;field var="pubsub#notify_retract"
         type="boolean"
         label="Whether to notify subscribers when items are removed from the node"/&gt;
  &lt;field var="pubsub#persist_items"
         type="boolean"
         label="Whether to persist items to storage"/&gt;
  &lt;field var="pubsub#presence_based_delivery"
         type="boolean"
         label="Whether to deliver notifications to available users only"/&gt;
  &lt;field var="pubsub#publish_model"
         type="list-single"
         label="The publisher model"&gt;
    &lt;option label='Only publishers may publish'&gt;
      &lt;value&gt;publishers&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Subscribers may publish'&gt;
      &lt;value&gt;subscribers&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Anyone may publish'&gt;
      &lt;value&gt;open&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var="pubsub#subscribe" type="boolean"
         label="Whether to allow subscriptions"&gt;
    &lt;value&gt;1&lt;/value&gt;
  &lt;/field&gt;
  &lt;field var="pubsub#subscription_model"
         type="list-single"
         label="The subscriber model"&gt;
    &lt;option label='Only those on a whitelist may subscribe'&gt;
      &lt;value&gt;whitelist&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Subscription requests must be authorized'&gt;
      &lt;value&gt;authorize&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Anyone may subscribe'&gt;
      &lt;value&gt;open&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var="pubsub#send_item_subscribe"
         type="boolean"
         label="Whether to send items to new subscribers"/&gt;
  &lt;field var="pubsub#type"
         type='text-single'
         label="The type of node data, usually specified by
                the namespace of the payload (if any); MAY
                be list-single rather than text-single"/&gt;
  &lt;field var="pubsub#payload_xslt" 
	 type="text-single"
         label="The URL of an XSL transformation which can be 
	        applied to payload packets in order to generate 
		a valid Data Forms result that the client could 
		then display using a generic Data Forms rendering 
		engine"/&gt;
&lt;/form_type&gt;
          </pre></div>
        </div>
        <div class="indent">
<h3>14.4.4 <a name="registrar-formtypes-metadata">pubsub#meta-data FORM_TYPE</a>
</h3>
          <p class="caption"></p>
<div class="indent"><pre>
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/name&gt;
  &lt;jep&gt;JEP-0060&lt;/jep&gt;
  &lt;desc&gt;Forms enabling setting of meta-data information about pubsub nodes&lt;/desc&gt;
  &lt;field var="pubsub#creation_date"
         type='text-single'
         label="The datetime when the node was created"/&gt;
  &lt;field var="pubsub#creator"
         type='jid-single'
         label="The JID of the node creator"/&gt;
  &lt;field var="pubsub#description"
         type='text-single'
         label="A description of the node"/&gt;
  &lt;field var="pubsub#language"
         type='text-single'
         label="The default language of the node"/&gt;
  &lt;field var="pubsub#publisher"
         type='jid-multi'
         label="The JIDs of those who may publish to this node"/&gt;
  &lt;field var="pubsub#title"
         type='text-single'
         label="The name of the node"/&gt;
&lt;/form_type&gt;
          </pre></div>
        </div>
      </div>
      <div class="indent">
<h3>14.5 <a name="registrar-shim">SHIM Headers</a>
</h3>
        <p class="" style="">The Jabber Registrar shall add "pubsub#subid" to its registry of SHIM headers (per JEP-0131). The registry submission is as follows:</p>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;header&gt;
  &lt;name&gt;pubsub#subid&lt;/name&gt;
  &lt;desc&gt;A subscription identifer within the pubsub protocol.&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
&lt;/header&gt;
        </pre></div>
        <p class="" style="">Future submissions to the Jabber Registrar may register additional SHIM headers that can be used in relation to the pubsub protocol.</p>
      </div>
  <div class="indent">
<h3>14.6 <a name="registrar-querytypes">URI Query Types</a>
</h3>
    <p class="" style="">As authorized by <span class="ref" style="">XMPP URI Query Components</span>  [<a href="#nt-id2257254">24</a>], the Jabber Registrar maintains a registry of queries and key-value pairs for use in XMPP URIs (see &lt;<a href="http://www.jabber.org/registrar/querytypes.html">http://www.jabber.org/registrar/querytypes.html</a>&gt;).</p>
    <p class="" style="">The "pubsub" querytype is defined herein for interaction with pubsub services, with two keys: (1) "node" (to specify pubsub nodes) and (2) "action", whose defined values are "subscribe" and "unsubscribe".</p>
    <p class="caption">Example 107. Pubsub Subscribe Action: IRI/URI</p>
<div class="indent"><pre>
xmpp:pubsub.shakespeare.lit?pubsub;action=subscribe;node=globe/performances
    </pre></div>
    <p class="caption">Example 108. Pubsub Subscribe Action: Resulting Stanza</p>
<div class="indent"><pre>
&lt;iq to='pubsub.shakespeare.lit' type='set'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe node='globe/performances'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption">Example 109. Pubsub Unsubscribe Action: IRI/URI</p>
<div class="indent"><pre>
xmpp:pubsub.shakespeare.lit?pubsub;action=unsubscribe;node=globe/performances
    </pre></div>
    <p class="caption">Example 110. Pubsub Unsubscribe Action: Resulting Stanza</p>
<div class="indent"><pre>
&lt;iq to='pubsub.shakespeare.lit' type='set'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;unsubscribe node='globe/performances'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The following submission registers the "pubsub" querytype.</p>
    <p class="caption"></p>
<div class="indent"><pre>
&lt;querytype&gt;
  &lt;name&gt;pubsub&lt;/name&gt;
  &lt;proto&gt;http://jabber.org/protocol/pubsub&lt;/proto&gt;
  &lt;desc&gt;enables interaction with a publish-subscribe service&lt;/desc&gt;
  &lt;doc&gt;JEP-0060&lt;/doc&gt;
  &lt;keys&gt;
    &lt;key&gt;
      &lt;name&gt;action&lt;/name&gt;
      &lt;desc&gt;the pubsub action&lt;/desc&gt;
      &lt;values&gt;
        &lt;value&gt;
	  &lt;name&gt;subscribe&lt;/name&gt;
          &lt;desc&gt;enables subscribing to a pubsub node&lt;/desc&gt;
        &lt;/value&gt;
        &lt;value&gt;
	  &lt;name&gt;unsubscribe&lt;/name&gt;
          &lt;desc&gt;enables unsubscribing from a pubsub node&lt;/desc&gt;
        &lt;/value&gt;
      &lt;/values&gt;
    &lt;/key&gt;
    &lt;key&gt;
      &lt;name&gt;node&lt;/name&gt;
      &lt;desc&gt;the pubsub node&lt;/desc&gt;
    &lt;/key&gt;
  &lt;/keys&gt;
&lt;/querytype&gt;
    </pre></div>
  </div>
    <h2>15.
       <a name="schemas">XML Schemas</a>
</h2>
      <div class="indent">
<h3>15.1 <a name="schemas-pubsub">http://jabber.org/protocol/pubsub</a>
</h3>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub'
    xmlns='http://jabber.org/protocol/pubsub'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0060: http://www.jabber.org/jeps/jep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import 
      namespace='jabber:x:data'
      schemaLocation='http://jabber.org/protocol/x-data/x-data.xsd'/&gt;

  &lt;xs:element name='pubsub'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='create' minOccurs='0'/&gt;
          &lt;xs:element ref='configure' minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='subscribe' minOccurs='0'/&gt;
          &lt;xs:element ref='options' minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:choice minOccurs='0'&gt;
          &lt;xs:element ref='affiliations'/&gt;
          &lt;xs:element ref='delete'/&gt;
          &lt;xs:element ref='entities'/&gt;
          &lt;xs:element ref='entity'/&gt;
          &lt;xs:element ref='items'/&gt;
          &lt;xs:element ref='publish'/&gt;
          &lt;xs:element ref='purge'/&gt;
          &lt;xs:element ref='retract'/&gt;
          &lt;xs:element ref='unsubscribe'/&gt;
        &lt;/xs:choice&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='affiliations'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:element ref='entity' minOccurs='0' maxOccurs='unbounded'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='configure'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'
                   xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='create'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='type' use='optional' default='leaf'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='collection'/&gt;
                &lt;xs:enumeration value='leaf'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='delete'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='entities'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='entity' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='entity'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='subscribe-options' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='affiliation' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='outcast'/&gt;
            &lt;xs:enumeration value='owner'/&gt;
            &lt;xs:enumeration value='publisher'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='subscription' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='pending'/&gt;
            &lt;xs:enumeration value='subscribed'/&gt;
            &lt;xs:enumeration value='unconfigured'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='items'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='max_items' type='xs:positiveInteger' use='optional'/&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'&gt;
        &lt;xs:any namespace='##other'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='id' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='options'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'&gt;
        &lt;xs:any namespace='jabber:x:data'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='publish'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='purge'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='retract'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscribe-options'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='required' type='empty' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscribe'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='unsubscribe'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
        </pre></div>
      </div>

      <div class="indent">
<h3>15.2 <a name="schemas-event">http://jabber.org/protocol/pubsub#event</a>
</h3>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub#event'
    xmlns='http://jabber.org/protocol/pubsub#event'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0060: http://www.jabber.org/jeps/jep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='event'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:element ref='delete'/&gt;
        &lt;xs:element ref='items'/&gt;
        &lt;xs:element ref='purge'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='delete'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='items'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'&gt;
        &lt;xs:any namespace='##other'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='id' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='purge'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
        </pre></div>
      </div>

      <div class="indent">
<h3>15.3 <a name="schemas-owner">http://jabber.org/protocol/pubsub#owner</a>
</h3>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub#owner'
    xmlns='http://jabber.org/protocol/pubsub#owner'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      JEP-0060: http://www.jabber.org/jeps/jep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import 
      namespace='jabber:x:data'
      schemaLocation='http://jabber.org/protocol/x-data/x-data.xsd'/&gt;

  &lt;xs:element name='pubsub'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='configure'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='action' use='optional'/&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='get-pending'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='configure'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'
                   xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' use='optional'/&gt;
      &lt;xs:attribute name='type' use='optional' default='leaf'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='collection'/&gt;
            &lt;xs:enumeration value='leaf'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
        </pre></div>
      </div>

      <div class="indent">
<h3>15.4 <a name="schemas-error">http://jabber.org/protocol/pubsub#errors</a>
</h3>
        <p class="caption"></p>
<div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub#errors'
    xmlns='http://jabber.org/protocol/pubsub#errors'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      This namespace is used for error reporting only, as
      defined in JEP-0060: 
      
      http://www.jabber.org/jeps/jep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='invalid-options' type='empty'/&gt;
  &lt;xs:element name='node-not-configurable' type='empty'/&gt;
  &lt;xs:element name='persistence-unavailable' type='empty'/&gt;
  &lt;xs:element name='not-subscribed' type='empty'/&gt;
  &lt;xs:element name='subscription-options-unavailable' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
        </pre></div>
      </div>

    <p><hr></p>
<a name="notes"></a><h2>Notes</h2>
<div class="indent">
<p><a name="nt-id2250282">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://www.ietf.org/rfc/rfc3920.txt">http://www.ietf.org/rfc/rfc3920.txt</a>&gt;.</p>
<p><a name="nt-id2250306">2</a>. JEP-0030: Service Discovery &lt;<a href="http://www.jabber.org/jeps/jep-0030.html">http://www.jabber.org/jeps/jep-0030.html</a>&gt;.</p>
<p><a name="nt-id2250969">3</a>. JEP-0045: Multi-User Chat &lt;<a href="http://www.jabber.org/jeps/jep-0045.html">http://www.jabber.org/jeps/jep-0045.html</a>&gt;.</p>
<p><a name="nt-id2252087">4</a>. JEP-0118: User Tune &lt;<a href="http://www.jabber.org/jeps/jep-0118.html">http://www.jabber.org/jeps/jep-0118.html</a>&gt;.</p>
<p><a name="nt-id2252264">5</a>. JEP-0131: Stanza Headers and Internet Metadata (SHIM) &lt;<a href="http://www.jabber.org/jeps/jep-0131.html">http://www.jabber.org/jeps/jep-0131.html</a>&gt;.</p>
<p><a name="nt-id2252741">6</a>. JEP-0004: Data Forms &lt;<a href="http://www.jabber.org/jeps/jep-0004.html">http://www.jabber.org/jeps/jep-0004.html</a>&gt;.</p>
<p><a name="nt-id2252941">7</a>. JEP-0050: Ad-Hoc Commands &lt;<a href="http://www.jabber.org/jeps/jep-0050.html">http://www.jabber.org/jeps/jep-0050.html</a>&gt;.</p>
<p><a name="nt-id2252996">8</a>. JEP-0068: Field Data Standardization for Data Forms &lt;<a href="http://www.jabber.org/jeps/jep-0068.html">http://www.jabber.org/jeps/jep-0068.html</a>&gt;.</p>
<p><a name="nt-id2253954">9</a>. JEP-0055: Jabber Search &lt;<a href="http://www.jabber.org/jeps/jep-0055.html">http://www.jabber.org/jeps/jep-0055.html</a>&gt;.</p>
<p><a name="nt-id2254052">10</a>. JEP-0128: Service Discovery Extensions &lt;<a href="http://www.jabber.org/jeps/jep-0128.html">http://www.jabber.org/jeps/jep-0128.html</a>&gt;.</p>
<p><a name="nt-id2254108">11</a>. The Dublin Core Metadata Initiative (DCMI) is an organization dedicated to promoting the widespread adoption of interoperable metadata standards. For further information, see &lt;<a href="http://www.dublincore.org/">http://www.dublincore.org/</a>&gt;.</p>
<p><a name="nt-id2254169">12</a>. The value SHOULD be a DateTime as defined in JEP-0082, and MUST conform to one of the profiles defined therein.</p>
<p><a name="nt-id2254270">13</a>. The pubsub type SHOULD be the namespace that defines the payload (such as 'http://jabber.org/protocol/tune') if appropriate.</p>
<p><a name="nt-id2254628">14</a>. A configure request with no NodeID must not be confused with a creation request with no NodeID; in response to the former, the service returns the default node options, whereas in response to the latter it creates an instant node.</p>
<p><a name="nt-id2255362">15</a>. Earlier versions of this JEP specified the use of the configuration protocol in the node creation request, containing a field for node type in the node configuration form whose 'var' attribute was "pubsub#node_type" and whose &lt;value/&gt; was "collection"; that protocol is now deprecated.</p>
<p><a name="nt-id2255752">16</a>. JEP-0086: Error Condition Mappings &lt;<a href="http://www.jabber.org/jeps/jep-0086.html">http://www.jabber.org/jeps/jep-0086.html</a>&gt;.</p>
<p><a name="nt-id2255808">17</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://www.ietf.org/rfc/rfc3921.txt">http://www.ietf.org/rfc/rfc3921.txt</a>&gt;.</p>
<p><a name="nt-id2255898">18</a>. JEP-0079: Advanced Message Processing &lt;<a href="http://www.jabber.org/jeps/jep-0079.html">http://www.jabber.org/jeps/jep-0079.html</a>&gt;.</p>
<p><a name="nt-id2256106">19</a>. JEP-0080: User Geolocation &lt;<a href="http://www.jabber.org/jeps/jep-0080.html">http://www.jabber.org/jeps/jep-0080.html</a>&gt;.</p>
<p><a name="nt-id2256137">20</a>. JEP-0033: Extended Stanza Addressing &lt;<a href="http://www.jabber.org/jeps/jep-0033.html">http://www.jabber.org/jeps/jep-0033.html</a>&gt;.</p>
<p><a name="nt-id2256204">21</a>. JEP-0082: Jabber Date and Time Profiles &lt;<a href="http://www.jabber.org/jeps/jep-0082.html">http://www.jabber.org/jeps/jep-0082.html</a>&gt;.</p>
<p><a name="nt-id2256338">22</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
<p><a name="nt-id2256392">23</a>. The Jabber Registrar maintains a list of reserved Jabber protocol namespaces as well as registries of parameters used in the context of protocols approved by the Jabber Software Foundation. For further information, see &lt;<a href="http://www.jabber.org/registrar/">http://www.jabber.org/registrar/</a>&gt;.</p>
<p><a name="nt-id2257254">24</a>. JEP-0147: XMPP URI Query Components &lt;<a href="http://www.jabber.org/jeps/jep-0147.html">http://www.jabber.org/jeps/jep-0147.html</a>&gt;.</p>
</div>
<p><hr></p>
<a name="revs"></a><h2>Revision History</h2>
<div class="indent">
<h4>Version 1.7 (2005-03-03)</h4>
<div class="indent">Reinstated pubsub#subscribe feature (deleted in error); added type attribute for the &lt;create/&gt; and &lt;configure/&gt; elements to differentiate between leaf nodes and collection nodes; in Section 8.1.7, changed affiliations retrieval support to SHOULD and added pubsub#retrieve-affiliations feature; in Section 8.1.10, removed two duplicate examples; in Section 8.1.12, clarified relationship between normal disco#info data and node meta-data (which uses a service discovery extension); in Section 8.2.4, specified that node purgation MUST result in one event notification, not a notification per item; in Section 8.1.8, further specified handling of SubIDs; clarified nature of the pubsub#type field; mentioned that the forbidden error should be returned in response to certain operations requested by an outcast; corrected datatype of max_items attribute from xs:string to xs:positiveInteger; corrected &lt;requestor-not-subscribed/&gt; error to &lt;not-subscribed/&gt; since the subsribed JID need not be that of the requestor; added service discovery features for more optional use cases: retracting items, purging nodes, deleting nodes; updated relevant registries. (psa/rm)
    </div>
<h4>Version 1.6 (2004-07-13)</h4>
<div class="indent">Added service discovery features for pubsub#meta-data, and pubsub#retrieve-items. Added pubsub#subscription_depth configuration option. Specified pubsub-specific error condition elements qualified by pubsub#errors namespace. (pgm/psa)
    </div>
<h4>Version 1.5 (2004-07-07)</h4>
<div class="indent">Fixed typos. Added more details to the section on collections. Added paragraph to create node use case to allow the service to change the requested node-id to something which it creates. Added text about bouncing publish requests when the request does not match the event-type for that node. Added disco features for the jabber registrar. Changed affiliation verbiage to allow publishers to remove any item. Tweaked verbiage for create node, eliminated extra example. Fully defined Jabber Registrar submissions. Corrected schemas. (pgm/psa)
    </div>
<h4>Version 1.4 (2004-06-22)</h4>
<div class="indent">Added subid syntax in a variety of places. Added more information about disco#info and disco#items support. Added more info about subscription options. Added collection information. Added implementation notes about subscription leases, and content-based pubsub services. (pgm)
    </div>
<h4>Version 1.3 (2004-04-25)</h4>
<div class="indent">Editorial review; added one implementation note. (psa)
    </div>
<h4>Version 1.2 (2004-03-09)</h4>
<div class="indent">Added XMPP error handling. (psa)
    </div>
<h4>Version 1.1 (2004-01-14)</h4>
<div class="indent">Added Jabber Registrar Considerations subsection for Service Discovery category/type registration. (psa)
    </div>
<h4>Version 1.0 (2003-10-28)</h4>
<div class="indent">Per a vote of the Jabber Council, advanced status to Draft. (psa)
    </div>
<h4>Version 0.16 (2003-10-23)</h4>
<div class="indent">Clarified JID addressing usage for nodes. Added specific MAY requirement for disco usage. Added sentence about implementations verifying that an entity has a subscription before getting the current items.
             (pgm)
    </div>
<h4>Version 0.15 (2003-10-21)</h4>
<div class="indent">Fixed invalid XML in examples for subscription deny/allow.
             (pgm)
    </div>
<h4>Version 0.14 (2003-10-21)</h4>
<div class="indent">Clarified restrictions on addressing nodes by JID. Added "Approving and denying subscription requests" section. Changed get-pending to use Ad-Hoc Commands. Changed semantics when sending in a form type='cancel' for pending subscriptions.
             (pgm)
    </div>
<h4>Version 0.13 (2003-09-30)</h4>
<div class="indent">Removed item as a possible child of subscribe and unsubscribe and pubsub in the schemas. Removed retract as a possible child of item in the pubsub#event schema. Added verbiage to requirements for addressing nodes either via JIDs or disco nodes.
             (pgm)
    </div>
<h4>Version 0.12 (2003-08-13)</h4>
<div class="indent">Defined public vs. private nodes; described how changes to existing nodes might trigger meta-node events (e.g., configuration changes); changed &lt;x/&gt; to &lt;event/&gt; for #events namespace; added meta-data about meta-nodes; fully defined Jabber Registrar considerations. (pgm, psa)
    </div>
<h4>Version 0.11 (2003-06-25)</h4>
<div class="indent">Removed subscription notifications since they have inherent issues. Removed empty implementation note sub-section.
             (pgm)
    </div>
<h4>Version 0.10 (2003-06-11)</h4>
<div class="indent">Fixed error example when returning 501 from an items-get request. Added note about receiving subscription requests when an entity is already subscribed. Fixed some entity elements in various subscription examples. Many were missing the node attribute. Added subscription change notification verbiage and example. Added verbiage and example of subscription state notification being sent to the requesting entity. Added disco#items information for getting a list of item identifiers for a single node. Added verbiage for returning the current entity element when a curent subscriber attempts to subscribe again.
             (pgm)
    </div>
<h4>Version 0.9 (2003-04-30)</h4>
<div class="indent">Include JID attributes in the entity elements when receiving your affiliations. Changed error code 406 (which was wrong) to 404, which is correct. Changed many 405 errors to 401, and modified the error table to make it more implementable (rules are more concrete). Added subscribe-options element for indicating subscriptions may be configured. (pgm)
    </div>
<h4>Version 0.8 (2003-04-03)</h4>
<div class="indent">Clarified the affiliations table and the semantics around subscribing and unsubscribing. Added protocol to get all of "your" affiliations in the service. Added protocol for services informing subscribers that configurable subscription options are available. Added protocol for obtaining existing node configuration settings and for batching configuration and node creation requests into a single stanza. Added meta-node implementation notes and specified the interaction with the Jabber Registrar and the "meta" NodeIDs. Added authorization notes to subscription options.
             (pgm)
    </div>
<h4>Version 0.7 (2003-02-14)</h4>
<div class="indent">Clarified requirements around what affiliations must be supported. Moved requirements about specifying entities which can subscribe and publish out of the MUSTs to MAYs. Changed SHOULD to MAY when talking about allowing entities to create nodes. Added ability to send configuration requests in the same stanza as a creation request.
             (pgm)
    </div>
<h4>Version 0.6 (2003-02-06)</h4>
<div class="indent">Added more details and an example about publishing without NodeID. Added more implementation notes about NodeIDs and persistent storage. (pgm)
    </div>
<h4>Version 0.5 (2003-01-22)</h4>
<div class="indent">
            Fixed header for delete item example. Added examples showing subscribers being notified of deleted items. Added examples for notification of node deletion, and configuration for node deletion. Added Subscriber option semantics and examples. Added examples for 402 and 407 errors on subscribe and create respectively. Added clarification about ItemID handling to impl notes.
             (pgm)
    </div>
<h4>Version 0.4 (2003-01-21)</h4>
<div class="indent">Clarified in-band and out-of-band configuration requirement. Added Delete Item privilege for all affiliations to the table. Added Delete item protocol for publishers and owners. Added 401 error case for subscribing to an illegal jid. Changed subscription request form. Added defaults to configuration form, and clarified role of the Jabber Registrar for the features show. Added text explaining the max_items attribute. Changed "last items" to "most recent items". Removed default configuration acceptance -- owners should just cancel. Added the notify_retract configuration option. Clarified error handling for affiliation modifications.  (pgm)
    </div>
<h4>Version 0.3 (2003-01-20)</h4>
<div class="indent">Added subscription attribute for entities. Removed subscriber from the affiliations table. Clarified configuration details. Clarified JabberID usages. Added Jabber Registrar Considerations. Added link to JEP-0068 about the FORM_TYPE element in subscription request notifications. Fixed some typos in examples. Added unsupported configuration namespace to example.  Added a default configuration example.  (pgm)
    </div>
<h4>Version 0.2 (2003-01-02)</h4>
<div class="indent">Added numerous implementation notes; added get-pending action with regard to subscriptions; added error table; changed purge and delete to use IQ type='set'. (pgm)
    </div>
<h4>Version 0.1 (2002-11-19)</h4>
<div class="indent">Initial version. (pgm)
    </div>
</div>
<p><hr></p>
<p>END</p>
</body>
</html>
