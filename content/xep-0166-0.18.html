<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0166: Jingle</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Jingle" /><meta name="DC.Creator" content="Scott Ludwig" /><meta name="DC.Creator" content="Joe Beda" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Creator" content="Robert McQueen" /><meta name="DC.Creator" content="Sean Egan" /><meta name="DC.Creator" content="Joe Hildebrand" /><meta name="DC.Description" content="This document defines a framework for initiating and managing peer-to-peer multimedia sessions (e.g., voice and video chat) between two Jabber/XMPP endpoints in a way that is interoperable with existing Internet standards." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2007-11-08" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0166" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2007 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0166: Jingle</h1><p>This document defines a framework for initiating and managing peer-to-peer multimedia sessions (e.g., voice and video chat) between two Jabber/XMPP endpoints in a way that is interoperable with existing Internet standards.</p><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0166<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.18<br />
            Last Updated: 2007-11-08<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: TO BE ASSIGNED<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Jingle (XEP-0166)">http://wiki.jabber.org/index.php/Jingle (XEP-0166)</a>&gt;
            </p><h2>Author Information</h2><div class="indent"><h3>Scott Ludwig</h3><p class="indent">
        Email:
        <a href="mailto:scottlu@google.com">scottlu@google.com</a><br />
        JabberID: 
        <a href="xmpp:scottlu@google.com">scottlu@google.com</a><br /></p><h3>Joe Beda</h3><p class="indent">
        Email:
        <a href="mailto:jbeda@google.com">jbeda@google.com</a><br />
        JabberID: 
        <a href="xmpp:jbeda@google.com">jbeda@google.com</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p><h3>Robert McQueen</h3><p class="indent">
        Email:
        <a href="mailto:robert.mcqueen@collabora.co.uk">robert.mcqueen@collabora.co.uk</a><br />
        JabberID: 
        <a href="xmpp:robert.mcqueen@collabora.co.uk">robert.mcqueen@collabora.co.uk</a><br /></p><h3>Sean Egan</h3><p class="indent">
        Email:
        <a href="mailto:seanegan@google.com">seanegan@google.com</a><br />
        JabberID: 
        <a href="xmpp:seanegan@google.com">seanegan@google.com</a><br /></p><h3>Joe Hildebrand</h3><p class="indent">
        Email:
        <a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a><br />
        JabberID: 
        <a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a><br /></p></div><h2>Legal Notices</h2><div class="indent"><h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).<h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2007 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>This material may be distributed only subject to the terms and conditions set forth in the Creative Commons Attribution License (&lt;<a href="http://creativecommons.org/licenses/by/2.5/">http://creativecommons.org/licenses/by/2.5/</a>&gt;).</div><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#howitworks">How It Works</a><br />3.  <a href="#reqs">Requirements</a><br />4.  <a href="#glossary">Glossary</a><br />5.  <a href="#concepts">Concepts and Approach</a><br />   
      5.1.  <a href="#concepts-session">Overall Session Management</a><br />6.  <a href="#session">Session Flow</a><br />   
      6.1.  <a href="#session-resource">Resource Determination</a><br />   
      6.2.  <a href="#protocol-initiate">Initiation</a><br />   
      6.3.  <a href="#protocol-response">Receiver Response</a><br />   
      6.4.  <a href="#protocol-decline">Decline</a><br />   
      6.5.  <a href="#session-negotiation">Negotiation</a><br />   
      6.6.  <a href="#session-acceptance">Acceptance</a><br />   
      6.7.  <a href="#session-modify">Modifying an Active Session</a><br />   
      6.8.  <a href="#session-terminate">Termination</a><br />   
      6.9.  <a href="#session-info">Informational Messages</a><br />7.  <a href="#scenarios">Scenarios</a><br />   
      7.1.  <a href="#scenarios-voicechat">Jingle Audio via RTP/AVP, Negotiated with ICE-UDP</a><br />   
      7.2.  <a href="#scenarios-voicechat">Jingle Audio and Video via RTP/AVP, Negotiated with ICE-UDP</a><br />   
      7.3.  <a href="#scenarios-secure">Secure Jingle Audio via UDP/TLS/RTP/AVP, Negotiated with ICE-UDP</a><br />8.  <a href="#def">Formal Definition</a><br />   
      8.1.  <a href="#def-jingle">Jingle Element</a><br />   
      8.2.  <a href="#def-content">Content Element</a><br />9.  <a href="#errors">Error Handling</a><br />10.  <a href="#support">Determining Support</a><br />11.  <a href="#conformance">Conformance by Using Protocols</a><br />   
      11.1.  <a href="#conformance-apps">Application Types</a><br />   
      11.2.  <a href="#conformance-transports">Transport Methods</a><br />12.  <a href="#security">Security Considerations</a><br />   
      12.1.  <a href="#security-dos">Denial of Service</a><br />   
      12.2.  <a href="#security-gateways">Communication Through Gateways</a><br />13.  <a href="#iana">IANA Considerations</a><br />14.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      14.1.  <a href="#registrar-ns">Protocol Namespaces</a><br />   
      14.2.  <a href="#registrar-content">Jingle Content Description Formats Registry</a><br />   
      14.3.  <a href="#registrar-transports">Jingle Content Transport Methods Registry</a><br />   
      14.4.  <a href="#registrar-reasoncodes">Jingle Reason Codes Registry</a><br />      
      14.4.1.  <a href="#registrar-reasoncodes-process">Process</a><br />      
      14.4.2.  <a href="#registrar-reasoncodes-reg">Initial Registration</a><br />15.  <a href="#schema">XML Schemas</a><br />   
      15.1.  <a href="#schema-jingle">Jingle</a><br />   
      15.2.  <a href="#schema-errors">Jingle Errors</a><br />16.  <a href="#history">History</a><br />17.  <a href="#ack">Acknowledgements</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style="">The purpose of Jingle is to enable one-to-one, peer-to-peer media sessions between XMPP entities, with the negotiation occurring over XMPP and the media being exchanged outside the XMPP band using technologies such as the Real-time Transport Protocol (RTP; <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3550">RFC 3550</a></span>  [<a href="#nt-id2251607">1</a>]), the User Datagram Protocol (UDP; <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc0768">RFC 768</a></span>  [<a href="#nt-id2251592">2</a>]), and <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-ietf-mmusic-ice">Interactive Connectivity Establishment (ICE)</a></span>  [<a href="#nt-id2251650">3</a>].</p>
  <p class="" style="">One target application for Jingle is simple voice chat (see <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0167.html">Jingle Audio via RTP</a></span>  [<a href="#nt-id2261082">4</a>]). We stress the word "simple". The purpose of Jingle is not to build a full-fledged telephony application that supports call waiting, call forwarding, call transfer, hold music, IVR systems, find-me-follow-me functionality, conference calls, and the like. These features are of interest to some user populations, but building in support for these features would introduce unnecessary complexity into a technology that is designed for basic multimedia interaction.</p>
  <p class="" style="">The purpose of Jingle is not to supplant or replace technologies based on Session Initiation Protocol (SIP; <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3261">RFC 3261</a></span>  [<a href="#nt-id2261117">5</a>]). Because dual-stack XMPP+SIP clients are difficult to build, Jingle was designed as a pure XMPP signalling protocol. However, Jingle is at the same time designed to interwork with SIP so that the millions of deployed XMPP clients can be added onto existing Voice over Internet Protocol (VoIP) networks, rather than limiting XMPP users to a separate and distinct network.</p>
  <p class="" style="">Jingle is designed in a modular way so that developers can easily add support for multimedia session types other than voice chat, such as video chat (see <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0180.html">Jingle Video via RTP </a></span>  [<a href="#nt-id2261155">6</a>]), application sharing, file sharing, collaborative editing, whiteboarding, and torrent broadcasting. The transport methods are also modular, so that Jingle implementations can use any appropriate media transport (including proprietary methods not standardized through the XMPP Standards Foundation).</p>
<h2>2.
       <a name="howitworks" id="howitworks">How It Works</a></h2>
  <p class="" style="">This section provides a friendly introduction to Jingle.</p>
  <p class="" style="">In essence, Jingle enables two XMPP entities (e.g., romeo@montague.lit and juliet@capulet.lit) to set up, manage, and tear down a multimedia session. The negotiation takes place over XMPP, and the media transfer takes place outside of XMPP. The simplest session flow is as follows:</p>
  <p class="caption"></p><div class="indent"><pre>
Romeo                         Juliet
  |                             |
  |   session-initiate          |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   session-accept            |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   MEDIA SESSION (RTP)       |
  |&lt;===========================&gt;|
  |   session-terminate         |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |                             |
  </pre></div>
  <p class="" style="">Naturally, more complex scenarios are possible (indeed, likely).</p>
  <p class="" style="">The simplest flow might happens as follows. The example is that of a voice chat (see <span class="ref">XEP-0167</span>) initiated by Romeo, where the transport is <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0177.html">Jingle Raw UDP Transport Method </a></span>  [<a href="#nt-id2261244">7</a>].</p>
  <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Initiator sends session-initiate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='jingle1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0177.html#ns'&gt;
        &lt;candidate ip='10.1.1.104' port='13540' generation='0'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Receiver sends provisional acceptance</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
  </pre></div>
  <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Receiver sends session-accept</p><div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='accept1'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='102' name='iLBC'/&gt;
        &lt;payload-type id='4' name='G723'/&gt;
        &lt;payload-type id='8' name='PCMA'/&gt;
        &lt;payload-type id='13' name='CN'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0177.html#ns'&gt;
        &lt;candidate ip='208.245.212.67' port='9876' generation='0'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If the foregoing payload types and transport candidates can be successfully used, then the parties would begin to exchange media. In this case they would exchange audio using the Speex codec at a clockrate of 8000 since that is the highest-priority codec for the responder (as determined by the XML order of the &lt;payload-type/&gt; children).</p>
  <p class="" style="">The parties may continue the session as long as desired.</p>
  <p class="" style="">Eventually, one of the parties terminates the session.</p>
  <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Receiver terminates the session</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='term1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-terminate'
          initiator='romeo@montague.lit/orchard'
          reason='Sorry, gotta go!'
          sid='a73sjjvkla37jfea'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">The other party MUST then acknowledge termination of the session:</p>
  <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Initiator Acknowledges Termination</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' 
    id='term1'
    to='juliet@capulet.lit/balcony' 
    type='result'/&gt;
  </pre></div>
<h2>3.
       <a name="reqs" id="reqs">Requirements</a></h2>
  <p class="" style="">The protocol defined herein is designed to meet the following requirements:</p>
  <ol start="" class="" style="">
    <li class="" style="">Make it possible to manage a wide variety of peer-to-peer sessions (not limited to voice and video) within XMPP.</li>
    <li class="" style="">Clearly separate the signalling channel (XMPP) from the data channel.</li>
    <li class="" style="">Clearly separate the content description formats (e.g., for voice chat) from the content transport methods.</li>
    <li class="" style="">Make it possible to add, modify, and remove content types from an existing session.</li>
    <li class="" style="">Make it relatively easy to implement support for the protocol in standard Jabber/XMPP clients.</li>
    <li class="" style="">Where communication with non-XMPP entities is needed, push as much complexity as possible onto server-side gateways between the XMPP network and the non-XMPP network.</li>
  </ol>
  <p class="" style="">This document defines the signalling protocol only. Additional documents specify the following:</p>
  <ul class="" style="">
    <li class="" style=""><p class="" style="">Various content description formats (audio, video, etc.) and, where possible, mapping those types to the Session Description Protocol (SDP; see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4566">RFC 4566</a></span>  [<a href="#nt-id2261633">8</a>]); examples include <span class="ref">Jingle Audio via RTP</span> and <span class="ref">Jingle Video via RTP</span>.</p></li>
    <li class="" style=""><p class="" style="">Various content transport methods; examples include <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0176.html">Jingle ICE Transport Method</a></span>  [<a href="#nt-id2261675">9</a>] and <span class="ref">Raw UDP Transport</span>.</p></li>
    <li class="" style=""><p class="" style="">Procedures for mapping the Jingle signalling protocol to existing signalling standards such as the IETF's Session Initiation Protocol (SIP) and the ITU's H.323 protocol (see <span class="ref" style="">H.323</span>  [<a href="#nt-id2261717">10</a>]); these documents are forthcoming.</p></li>
  </ul>
<h2>4.
       <a name="glossary" id="glossary">Glossary</a></h2>
  <p class="caption"><a name="table-1" id="table-1"></a>Table 1: Glossary</p><table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th colspan="" rowspan="">Term</th>
      <th colspan="" rowspan="">Definition</th>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">Session</td>
      <td colspan="" rowspan="">A number of pairs of negotiated content transport methods and content description formats connecting two entities. It is delimited in time by an initiate request and session ending events. During the lifetime of a session, pairs of content descriptions and content transport methods can be added or removed. A session consists of at least one active negotiated content type at a time.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">Content Type</td>
      <td colspan="" rowspan="">The combination of one content description and one content transport method.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">Content Description</td>
      <td colspan="" rowspan="">The format of the content type being established, which formally declares one purpose of the session (e.g., "voice" or "video"). This is the 'what' of the session (i.e., the bits to be transferred), such as the acceptable codecs when establishing a voice conversation. In Jingle XML syntax the content type is the namespace of the &lt;description/&gt; element.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">Transport Method</td>
      <td colspan="" rowspan="">The method for establishing data stream(s) between entities. Possible transports might include ICE-TCP, Raw UDP, inband data, etc. This is the 'how' of the session. In Jingle XML syntax this is the namespace of the &lt;transport/&gt; element. The content transport method defines how to transfer bits from one host to another. Each transport method must specify whether it is lossy (thus suitable for applications where some packet loss is tolerable) or reliable (thus suitable for applications where packet loss is not tolerable).</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">Component</td>
      <td colspan="" rowspan="">A component is a numbered stream of data which needs to be transmitted between the endpoints for a given content type in the context of a given session. It is up to the transport to negotiate the details of each component. Depending on the content type and the content description, one content description may require multiple components to be communicated (e.g., the audio content type might use two components: one to transmit an RTP stream and another to transmit RTCP timing information).</td>
    </tr>
  </table>
<h2>5.
       <a name="concepts" id="concepts">Concepts and Approach</a></h2>
  <p class="" style="">Jingle consists of three parts, each with its own syntax, semantics, and state machine:</p>
  <ol start="" class="" style="">
    <li class="" style="">Overall session management</li>
    <li class="" style="">Content description formats (the "what")</li>
    <li class="" style="">Content transport methods (the "how")</li>
  </ol>
  <p class="" style="">This document defines the semantics and syntax for overall session management. It also provides pluggable "slots" for content description formats and content transport methods, which are specified in separate documents; however, for the sake of completeness, this document also includes examples for all of the actions related to description formats and transport methods.</p>
  <p class="" style="">At the most basic level, the process for negotiating a Jingle session is as follows:</p>
  <ol start="" class="" style="">
    <li class="" style="">One user (the "initator") sends to another user (the "receiver") a session request with one content type, which includes at least one content type.</li>
    <li class="" style="">If the receiver wants to proceed, it provisionally accepts the request by sending an IQ result.</li>
    <li class="" style="">Both the initiator and receive start exchanging possible transport candidates as quickly as possible (these are sent in quick succession before further negotiation in order to minimize the time required before media data can flow).</li>
    <li class="" style="">These candidates are checked for connectivity.</li>
    <li class="" style="">As soon as the receiver finds a candidate over which media can flow, the receiver sends to the initiator a "session-accept" action.</li>
    <li class="" style="">The parties start sending media over the negotiated candidate.</li>
  </ol>
  <p class="" style="">If the parties later discover a better candidate, they perform a "content-modify" negotiation and then switch to the better candidate. Naturally they can also modify various other parameters related to the session (e.g., adding video to a voice chat).</p>
  <div class="indent"><h3>5.1 <a name="concepts-session" id="concepts-session">Overall Session Management</a></h3>
    <p class="" style="">The state machine for overall session management (i.e., the state per Session ID) is as follows:</p>
    <p class="caption"></p><div class="indent"><pre>
         o
         |
         | session-initiate
         |
         | +-----------------------+
         |/                        |
PENDING  o---------------------+   |
         |  | content-accept,  |   |
         |  | content-modify,  |   |
         |  | content-remove,  |   |
         |  | session-info,    |   |
         |  | transport-info   |   |
         |  +------------------+   |
         |                         |
         | session-accept          |
         |                         |
 ACTIVE  o---------------------+   |
         |  | content-accept,  |   |
         |  | content-add,     |   |
         |  | content-modify,  |   |
         |  | content-remove,  |   |
         |  | session-info,    |   |
         |  | transport-info   |   |
         |  +------------------+   |
         |                         |
         +-------------------------+
                                   |
                                   | session-terminate
                                   |
                                   o ENDED
    </pre></div>
    <p class="" style="">There are three overall session states:</p>
    <ol start="" class="" style="">
      <li class="" style="">PENDING</li>
      <li class="" style="">ACTIVE</li>
      <li class="" style="">ENDED</li>
    </ol>
    <p class="" style="">The actions related to management of the overall Jingle session are as follows:</p>
    <p class="caption"><a name="table-2" id="table-2"></a>Table 2: Jingle Actions</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Action</th>
        <th colspan="" rowspan="">Description</th>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">content-accept</td>
        <td colspan="" rowspan="">Accept a content-add or content-remove action received from another party.</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">content-add</td>
        <td colspan="" rowspan="">Add one or more new content types to the session. The sender MUST specify only the added content-type(s), not the added content-type(s) plus the existing content-type(s). Therefore it is the responsibility of the recipient to maintain a local copy of the content definition. This action MUST NOT be sent while the session is in the PENDING state. When a party sends a content-add, it MUST ignore any actions received from the other party until it receives acknowledgement of the content-add.  [<a href="#nt-id2262179">11</a>]</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">content-modify</td>
        <td colspan="" rowspan="">Change an existing content type. The sender SHOULD specify only the aspects for which a modification is desired (e.g., if the sender wishes to change only the profile then it would send an empty &lt;content/&gt; element with a modified value for the 'profile' attribute; if the wishes to change only the transport, then it would send a &lt;content/&gt; element that contains only a &lt;transport/&gt; child; etc.). Therefore it is the responsibility of the recipient to maintain a local copy of the content definition. The recipient MUST NOT reply to a content-modify action with another content-modify action.  [<a href="#nt-id2262226">12</a>]</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">content-remove</td>
        <td colspan="" rowspan="">Remove one or more content types from the session. The sender MUST specify only the removed content-type(s), not the removed content-type(s) plus the remaining content-type(s). Therefore it is the responsibility of the recipient to maintain a local copy of the content definition.  [<a href="#nt-id2262257">13</a>]  [<a href="#nt-id2262264">14</a>]</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">session-accept</td>
        <td colspan="" rowspan="">Definitively accept a session negotiation (implicitly this action also serves as a content-accept).</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">session-info</td>
        <td colspan="" rowspan="">Send session-level information / messages, such as (for Jingle audio) a ringing message.</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">session-initiate</td>
        <td colspan="" rowspan="">Request negotiation of a new Jingle session.</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">session-terminate</td>
        <td colspan="" rowspan="">End an existing session.</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">transport-info</td>
        <td colspan="" rowspan="">Exchange transport candidates; it is mainly used in <span class="ref">XEP-0176</span> but may be used in other transport specifications.</td>
      </tr>
    </table>
  </div>
<h2>6.
       <a name="session" id="session">Session Flow</a></h2>
  <p class="" style="">This section defines the high-level flow of a Jingle session. More detailed descriptions are provided in the <a href="#scenarios">Scenarios</a> section of this document.</p>
  <div class="indent"><h3>6.1 <a name="session-resource" id="session-resource">Resource Determination</a></h3>
    <p class="" style="">In order to initiate a Jingle session, the initiator must determine which of the receiver's XMPP resources is best for the desired content description format. There are several possible scenarios:</p>
    <ol start="" class="" style="">
      <li class="" style=""><p class="" style="">If the intended responder shares presence with the initiator (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">XMPP IM</a></span>  [<a href="#nt-id2262470">15</a>]) and has only one available resource, this task SHOULD be completed using <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2262499">16</a>] or the presence-based profile of service discovery specified in <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0115.html">Entity Capabilities</a></span>  [<a href="#nt-id2262524">17</a>].  [<a href="#nt-id2262484">18</a>]</p></li>
      <li class="" style=""><p class="" style="">If the intended responder shares presence with the initiator and has more than one available resource but only one of the resources supports Jingle and the desired content description format, the initiator SHOULD initiate the Jingle signalling with that resource.</p></li>
      <li class="" style=""><p class="" style="">If the intended responder shares presence with the initiator and has more than one available resource but more than one of the resources supports Jingle and the desired content description format, the initiator SHOULD use <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0168.html">Resource Application Priority</a></span>  [<a href="#nt-id2262587">19</a>] in order to determine which is the best resource with which to initiate the desired Jingle session.</p></li>
      <li class="" style=""><p class="" style="">If the intended responder does not share presence with the initiator, the initiator SHOULD first send a <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0155.html">Stanza Session Negotiation</a></span>  [<a href="#nt-id2262645">20</a>] request to the responder in order to initiate the exchange of XMPP stanzas. The request SHOULD include a RAP routing hint as specified in <span class="ref">XEP-0168</span> and the &lt;message/&gt; stanza containing the request SHOULD be of type "headline" so that (typically) it is not stored offline for later delivery.</p></li>
    </ol>
  </div>
  <div class="indent"><h3>6.2 <a name="protocol-initiate" id="protocol-initiate">Initiation</a></h3>
    <p class="" style="">Once the initiator has discovered which of the receiver's XMPP resources is ideal for the desired content description format, it sends a session initiation request to the receiver. This request is an IQ-set containing a &lt;jingle/&gt; element qualified by the 'http://www.xmpp.org/extensions/xep-0166.html#ns' namespace (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces), where the value of the 'action' attribute is "session-initiate" and where the &lt;jingle/&gt; element contains one or more &lt;content/&gt; elements. Each &lt;content/&gt; element defines a content type to be transferred during the session, and each &lt;content/&gt; element in turn contains one &lt;description/&gt; child element that specifies a desired content description format and one &lt;transport/&gt; child element that specifies a potential content transport method. If either party wishes to propose the use of multiple transport methods for the same content description, it must send multiple &lt;content/&gt; elements.</p>
    <p class="" style="">Note: The syntax and semantics of the &lt;description/&gt; and &lt;transport/&gt; elements are out of scope for this specification, since they are defined in related specifications. The syntax and semantics of the &lt;jingle/&gt; and &lt;content/&gt; elements are specified in this document under <a href="#def">Formal Definition</a>.</p>

    <p class="" style="">Note: In order to expedite session establishment, the initiator MAY send transport candidates (e.g., for negotiation of the ICE transport) immediately after sending the "session-initiate" message and before receiving acknowledgement from the receiver (i.e., the initiator MUST consider the session to be live even before receiving acknowledgement). Given in-order delivery, the receiver should receive such "transport-info" messages after receiving the "session-initiate" message (if not, it is appropriate for the receiver to return &lt;unknown-session/&gt; errors since it according to its state machine the session does not exist).</p>
  </div>
  <div class="indent"><h3>6.3 <a name="protocol-response" id="protocol-response">Receiver Response</a></h3>
    <p class="" style="">Unless an error occurs, the receiver MUST acknowledge receipt of the initiation request.</p>
    <p class="" style="">If the receiver acknowledges receipt of the initation request, both parties must consider the session to be in the PENDING state.</p>
    <p class="" style="">There are several reasons why the receiver might return an error instead of acknowledging receipt of the initiation request:</p>
    <ul class="" style="">
      <li class="" style="">The initiator is unknown to the receiver (e.g., via presence subscription) and the receiver does not communicate with unknown entities.</li>
      <li class="" style="">The receiver wishes to redirect to another address.</li>
      <li class="" style="">The receiver does not support Jingle.</li>
      <li class="" style="">The receiver does not support any of the specified content description formats.</li>
      <li class="" style="">The receiver does not support any of the specified content transport methods.</li>
      <li class="" style="">The initiation request was malformed.</li>
    </ul>
    <p class="" style="">If the initiator is unknown to the receiver (e.g., via presence subscription) and the receiver has a policy of not communicating via Jingle with unknown entities, it SHOULD return a &lt;service-unavailable/&gt; error.</p>
    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Initiator Unknown to Receiver</p><div class="indent"><pre>
&lt;iq type='error' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the receiver wishes to redirect to another address, it SHOULD return a &lt;redirect/&gt; error.</p>
    <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Receiver Redirection</p><div class="indent"><pre>
&lt;iq type='error' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'&gt;
  &lt;error type='cancel'&gt;
    &lt;redirect xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;xmpp:voicemail@capulet.lit&lt;/redirect&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the receiver does not support Jingle, it MUST return a &lt;service-unavailable/&gt; error.</p>
    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Receiver Does Not Support Jingle</p><div class="indent"><pre>
&lt;iq type='error' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the receiver does not support any of the specified content description formats, it MUST return a &lt;feature-not-implemented/&gt; error with a Jingle-specific error condition of &lt;unsupported-content/&gt;.</p>
    <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Receiver Does Not Support Any Content Description Formats</p><div class="indent"><pre>
&lt;iq type='error' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported-content xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns-errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the receiver does not support any of the specified content transport methods, it MUST return a &lt;feature-not-implemented/&gt; error with a Jingle-specific error condition of &lt;unsupported-transports/&gt;.</p>
    <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Receiver Does Not Support Any Transport Methods</p><div class="indent"><pre>
&lt;iq type='error' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported-transports xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns-errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the initiation request was malformed, the receiver MUST return a &lt;bad-request/&gt; error.</p>
    <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Initiation Request Malformed</p><div class="indent"><pre>
&lt;iq type='error' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'&gt;
  &lt;error type='cancel'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>6.4 <a name="protocol-decline" id="protocol-decline">Decline</a></h3>
    <p class="" style="">In order to decline the session initiation request, the receiver MUST acknowledge receipt of the session initiation request, then terminate the session as described under <a href="#session-terminate">Termination</a>.</p>
  </div>
  <div class="indent"><h3>6.5 <a name="session-negotiation" id="session-negotiation">Negotiation</a></h3>
    <p class="" style="">In general, negotiation will be necessary before the parties can agree on an acceptable set of content types, content description formats, and content transport methods. The potential combinations of parameters to be negotiated are many, and not all are shown herein. Some are defined in the relevant specifications for various content description formats and content transport methods, and illustrated in the <a href="#scenarios">Scenarios</a> section of this document.</p>
    <p class="" style="">The allowable negotiations (including content-level and transport-level negotiations) are as follows:</p>
    <ul class="" style="">
      <li class="" style="">Adding a content type via the content-add action (not allowed in the PENDING state).</li>
      <li class="" style="">Modifying a content type via the content-modify action.</li>
      <li class="" style="">Removing a content type via the content-remove action.</li>
      <li class="" style="">Exchanging transport methods via the transport-info action.</li>
    </ul>
  </div>
  <div class="indent"><h3>6.6 <a name="session-acceptance" id="session-acceptance">Acceptance</a></h3>
    <p class="" style="">If (after negotiation of content transport methods and content description formats) the receiver determines that it will be able to establish a connection, it sends a definitive acceptance to the initiator.</p>
    <p class="" style="">Note: In the accept stanza, the &lt;jingle/&gt; element MUST contain one or more &lt;content/&gt; elements, each of which MUST contain one &lt;description/&gt; element and one &lt;transport/&gt; element. The &lt;jingle/&gt; element SHOULD possess a 'responder' attribute that explicitly specifies the full JID of the responding entity, and the initiator SHOULD send all future commmunications about this Jingle session to the JID provided in the 'responder' attribute.</p>
    <p class="" style="">The initiator then acknowledges the receiver's definitive acceptance, after which the parties can exchange content over the negotiated connection.</p>
    <p class="" style="">If one of the parties cannot find a suitable content transport method, it SHOULD terminate the session as described below.</p>
  </div>
  <div class="indent"><h3>6.7 <a name="session-modify" id="session-modify">Modifying an Active Session</a></h3>
    <p class="" style="">Once a session is in the ACTIVE state, it may be modified. Potential modifications are shown in the <a href="#scenarios">Scenarios</a> section of this document.</p>
  </div>
  <div class="indent"><h3>6.8 <a name="session-terminate" id="session-terminate">Termination</a></h3>
    <p class="" style="">In order to gracefully end the session (which MAY be done at any point after acknowledging receipt of the initiation request, including immediately thereafter in order to decline the request), either the receiver or the initiator MUST a send a "terminate" action to the other party.</p>
    <p class="" style="">The other party (in this case the initiator) MUST then acknowledge termination of the session:</p>
    <p class="" style="">Note: As soon as an entity sends a "session-terminate" action, it MUST consider the session to be ended (even before receiving acknowledgement from the other party). If the terminating entity receives additional IQ-sets from the other party after sending the "session-terminate" action, it MUST reply with an &lt;unknown-session/&gt; error.</p>
    <p class="" style="">Unfortunately, not all sessions end gracefully. In applications of Jingle that also involve the exchange of presence information, receipt of &lt;presence type='unavailable'/&gt; from the other party MAY be a considered session-ending event. However, in this case there is nothing for the party to acknowledge.</p>
  </div>
  <div class="indent"><h3>6.9 <a name="session-info" id="session-info">Informational Messages</a></h3>
    <p class="" style="">At any point after initiation of a Jingle session, either entity MAY send an informational message to the other party, for example to change a content transport method or content description format parameter, inform the other party that a session initiation request is queued, that a device is ringing, or that a scheduled event has occurred or will occur.</p>
    <p class="" style="">An informational message MUST be an IQ-set containing a &lt;jingle/&gt; element whose 'action' attribute is set to a value of "session-info" or "transport-info"; the &lt;jingle/&gt; element MUST further contain a payload child element (specific to the session or to a transport method) that specifies the information being communicated. If the party that receives an informational message does not understand the payload, it MUST return a &lt;feature-not-implemented/&gt; error with a Jingle-specific error condition of &lt;unsupported-info/&gt;.</p>
    <p class="" style="">If either party receives an empty "session-info" message for an active session, it MUST send an empty IQ result; this way, an empty "session-info" message may be used as a "ping" to determine session vitality.</p>
    <p class="" style="">Most informational messages are specific to a particular description format or transport method and therefore are described in specifications other than this one.</p>
  </div>
<h2>7.
       <a name="scenarios" id="scenarios">Scenarios</a></h2>
  <p class="" style="">The very simple scenario described in the <a href="#howitworks">How It Works</a> section of this document is just that: very simple. Typically, the session flow is more complex. The following sections show some more complex scenarios, in order of complexity.</p>
  <div class="indent"><h3>7.1 <a name="scenarios-voicechat" id="scenarios-voicechat">Jingle Audio via RTP/AVP, Negotiated with ICE-UDP</a></h3>
    <p class="" style="">In this scenario, Romeo initiates a voice chat with Juliet using a transport method of ICE-UDP.</p>
    <p class="" style="">The session flow is as follows:</p>
    <p class="caption"></p><div class="indent"><pre>
Romeo                         Juliet
  |                             |
  |   session-initiate          |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   transport-info (X times)  |
  |   (with acks)               |
  |&lt;---------------------------&gt;|
  |   session-accept            |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   AUDIO (RTP)               |
  |&lt;===========================&gt;|
  |   session-terminate         |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |                             |
    </pre></div>
    <p class="" style="">The protocol flow is as follows.</p>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Initiator sends session-initiate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='jingle1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns-udp'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Receiver sends provisional acceptance</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Initiator Sends a Candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' 
    id='info1' 
    to='juliet@capulet.lit/balcony' 
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns' 
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns-udp'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0' 
                   ip='10.0.1.1' 
                   network='0'
                   port='8998'
                   priority='2114978302'
                   protocol='udp'
                   pwd='asd88fgpdd777uzjYhagZg'
                   type='host'
                   ufrag='8hhy'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Initiator Sends a Second Candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' 
    id='info2' 
    to='juliet@capulet.lit/balcony' 
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns' 
          action='transport-info' 
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns-udp'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0' 
                   ip='192.0.2.3' 
                   network='1'
                   port='45664'
                   priority='1678246398'
                   protocol='udp'
                   pwd='asd88fgpdd777uzjYhagZg'
                   type='srflx'
                   ufrag='8hhy'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Initiator Sends a Third Candidate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' 
    id='info3' 
    to='juliet@capulet.lit/balcony' 
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns' 
          action='transport-info' 
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns-udp'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0' 
                   ip='208.245.212.67' 
                   network='2'
                   port='53267'
                   priority='1677984254'
                   protocol='udp'
                   pwd='asd88fgpdd777uzjYhagZg'
                   type='srflx'
                   ufrag='8hhy'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">For each candidate received, the other party MUST acknowledge receipt or return an error:</p>
    <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Responder Acknowledges Receipt</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='info1' type='result'/&gt;

&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='info2' type='result'/&gt;

&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='info3' type='result'/&gt;
    </pre></div>
    <p class="" style="">At the same time (i.e., immediately after provisionally accepting the session, not waiting for the initiator to begin or finish sending candidates), the responder also begins sending candidates that may work for it. As above, the initiator acknowledges receipt of the candidates.</p>
    <p class="" style="">As the initiator and responder receive candidates, they probe the various candidate transports for connectivity. In performing these connectivity checks, the parties follow the procedure specified in Section 7 of draft-ietf-mmusic-ice.</p>
    <p class="" style="">If one of the candidate transports is found to work, the receiver accepts the session.</p>
    <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Receiver sends session-accept</p><div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='accept1'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='102' name='iLBC'/&gt;
        &lt;payload-type id='4' name='G723'/&gt;
        &lt;payload-type id='8' name='PCMA'/&gt;
        &lt;payload-type id='13' name='CN'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'&gt;
        &lt;candidate ip='208.245.212.67' port='9876' generation='0'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the payload types and transport candidate can be successfully used by both parties, then the initiator acknowledges the session-accept.</p>
    <p class="caption"><a name="example-19" id="example-19"></a>Example 19. Initiator acknowledges session-accept</p><div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.lit/balcony' from='romeo@montague.lit/orchard' id='accept1'/&gt;
    </pre></div>
    <p class="" style="">The parties now begin to exchange media. In this case they would exchange audio using the Speex codec at a clockrate of 8000 since that is the highest-priority codec for the responder (as determined by the XML order of the &lt;payload-type/&gt; children).</p>
    <p class="" style="">The parties may continue the session as long as desired.</p>
    <p class="" style="">Eventually, one of the parties terminates the session.</p>
    <p class="caption"><a name="example-20" id="example-20"></a>Example 20. Receiver terminates the session</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='term1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-terminate'
          initiator='romeo@montague.lit/orchard'
          reason='Sorry, gotta go!'
          sid='a73sjjvkla37jfea'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The other party MUST then acknowledge termination of the session:</p>
    <p class="caption"><a name="example-21" id="example-21"></a>Example 21. Initiator Acknowledges Termination</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' 
    id='term1'
    to='juliet@capulet.lit/balcony' 
    type='result'/&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>7.2 <a name="scenarios-voicechat" id="scenarios-voicechat">Jingle Audio and Video via RTP/AVP, Negotiated with ICE-UDP</a></h3>
    <p class="" style="">In this scenario, Romeo initiates a combined audio and video chat with Juliet using a transport method of ICE. Juliet at first refuses the video portion, then later offers to add video, which Romeo accepts.</p>
    <p class="" style="">The session flow is as follows:</p>
    <p class="caption"></p><div class="indent"><pre>
Romeo                         Juliet
  |                             |
  |   session-initiate          |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   content-remove            |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   content-accept            |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   transport-info (X times)  |
  |   (with acks)               |
  |&lt;---------------------------&gt;|
  |   session-accept            |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   AUDIO (RTP)               |
  |&lt;===========================&gt;|
  |   content-add               |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   content-accept            |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   AUDIO + VIDEO (RTP)       |
  |&lt;===========================&gt;|
  |   session-terminate         |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |                             |
    </pre></div>
    <p class="" style="">The protocol flow is as follows.</p>
    <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Initiation</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='jingle1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'/&gt;
    &lt;/content&gt;
    &lt;content creator='initiator' name='this-is-the-video-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0180.html#ns'&gt;
        &lt;payload-type id='96' name='theora' clockrate='90000' height='720' width='1280'&gt;
          &lt;parameter name='delivery-method' value='inline'/&gt;
          &lt;parameter name='configuration' value='somebase16string'/&gt;
          &lt;parameter name='sampling' value='YCbCr-4:2:2'/&gt;
        &lt;/payload-type&gt;
        &lt;payload-type id='28' name='nv' clockrate='90000'/&gt;
        &lt;payload-type id='25' name='CelB' clockrate='90000'/&gt;
        &lt;payload-type id='32' name='MPV' clockrate='90000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-23" id="example-23"></a>Example 23. Receiver Acknowledges Receipt of Initiation Request</p><div class="indent"><pre>
&lt;iq type='result' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='jingle1'/&gt;
    </pre></div>
    <p class="" style="">However, Juliet doesn't want to do video because she is having a bad hair day, so she sends a "content-remove" request to Romeo.</p>
    <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Receiver requests content-remove</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='remove1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='content-remove'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-video-content' profile='RTP/AVP'/&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Romeo then acknowledges the content-remove request and, if it is acceptable, returns a content-accept:</p>
    <p class="caption"><a name="example-25" id="example-25"></a>Example 25. Initiator acknowledges content-remove</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='remove1' type='result'/&gt;
    </pre></div>
    <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Initiator accepts content definition</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='remove2' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='content-accept'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='this-is-the-video-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0180.html#ns'/&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The other party then acknowledges the acceptance.</p>
    <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Receiver acknowledges content-accept</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='remove2' type='result'/&gt;
    </pre></div>
    <p class="" style="">As in Scenario #1, the parties exchange ICE candidates (see above for examples).</p>
    <p class="" style="">Once the parties find candidate transports that work, the receiver accepts the session.</p>
    <p class="caption"><a name="example-28" id="example-28"></a>Example 28. Receiver sends session-accept</p><div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='accept1'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='102' name='iLBC'/&gt;
        &lt;payload-type id='4' name='G723'/&gt;
        &lt;payload-type id='8' name='PCMA'/&gt;
        &lt;payload-type id='13' name='CN'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'&gt;
        &lt;candidate ip='208.245.212.67' port='9876' generation='0'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">As above, if the payload types and transport candidate can be successfully used by both parties, then the initiator acknowledges the session-accept.</p>
    <p class="caption"><a name="example-29" id="example-29"></a>Example 29. Initiator acknowledges session-accept</p><div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.lit/balcony' from='romeo@montague.lit/orchard' id='accept1'/&gt;
    </pre></div>
    <p class="" style="">The parties now begin to exchange media. In this case they would exchange audio using the Speex codec at a clockrate of 8000 since that is the highest-priority codec for the responder (as determined by the XML order of the &lt;payload-type/&gt; children).</p>
    <p class="" style="">Once Juliet gets her hair in order, she decides that she is presentable for a video chat so she sends a content-add request to Romeo.</p>
    <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Receiver sends a content-add</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='add1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='content-add'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='video-is-back' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0180.html#ns'&gt;
        &lt;payload-type id='96' name='theora' height='720' width='1280'&gt;
          &lt;parameter name='delivery-method' value='inline'/&gt;
          &lt;parameter name='configuration' value='somebase16string'/&gt;
          &lt;parameter name='sampling' value='YCbCr-4:2:2'/&gt;
        &lt;/payload-type&gt;
        &lt;payload-type id='32' name='MPV' clockrate='90000'/&gt;
        &lt;payload-type id='33' name='MP2T' clockrate='90000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The entity receiving the content-add request then acknowledges the request and, if it is acceptable, returns a content-accept:</p>
    <p class="caption"><a name="example-31" id="example-31"></a>Example 31. Initiator acknowledges content-add</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='add1' type='result'/&gt;
    </pre></div>
    <p class="caption"><a name="example-32" id="example-32"></a>Example 32. Initiator accepts content definition</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='add2' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='content-accept'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='video-is-back' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0180.html#ns'&gt;
        &lt;payload-type id='96' name='theora' height='720' width='1280'&gt;
          &lt;parameter name='delivery-method' value='inline'/&gt;
          &lt;parameter name='configuration' value='somebase16string'/&gt;
          &lt;parameter name='sampling' value='YCbCr-4:2:2'/&gt;
        &lt;/payload-type&gt;
        &lt;payload-type id='32' name='MPV' clockrate='90000'/&gt;
        &lt;payload-type id='33' name='MP2T' clockrate='90000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The other party then acknowledges the acceptance.</p>
    <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Receiver acknowledges content-accept</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='add2' type='result'/&gt;
    </pre></div>
    <p class="" style="">The media session proceeds. Now they would exchange both audio and video, where the audio is exchanged the Speex codec at a clockrate of 8000 and the video is exchanged using the Theora codec with a height of 720 pixels, a width of 1280 pixels, and so on.</p>
    <p class="" style="">The parties may continue the session as long as desired.</p>
    <p class="" style="">Eventually, one of the parties terminates the session.</p>
    <p class="caption"><a name="example-34" id="example-34"></a>Example 34. Initiator sends session-terminate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='term1'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-terminate'
          initiator='romeo@montague.lit/orchard'
          reason='I&amp;apos;m outta here!'
          sid='a73sjjvkla37jfea'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-35" id="example-35"></a>Example 35. Receiver acknowledges session-terminate</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' 
    id='term1'
    to='romeo@montague.lit/orchard' 
    type='result'/&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>7.3 <a name="scenarios-secure" id="scenarios-secure">Secure Jingle Audio via UDP/TLS/RTP/AVP, Negotiated with ICE-UDP</a></h3>
    <p class="" style="">In this scenario, Romeo initiates a voice chat with Juliet using a transport method of ICE-UDP and an unencrypted profile of "RTP/AVP", but Juliet wants to chat securely so she requests the use of a secure transport as specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-fischl-mmusic-sdp-dtls">RTP Over DTLS</a></span>  [<a href="#nt-id2264042">21</a>] (via a profile of "UDP/TLS/RTP/AVP").</p>
    <p class="" style="">The session flow is as follows:</p>
    <p class="caption"></p><div class="indent"><pre>
Romeo                         Juliet
  |                             |
  |   session-initiate          |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   content-modify            |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   content-accept            |
  |----------------------------&gt;|
  |   ack                       |
  |&lt;----------------------------|
  |   transport-info (X times)  |
  |   (with acks)               |
  |&lt;---------------------------&gt;|
  |   session-accept            |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |   AUDIO (RTP)               |
  |&lt;===========================&gt;|
  |   session-terminate         |
  |&lt;----------------------------|
  |   ack                       |
  |----------------------------&gt;|
  |                             |
    </pre></div>
    <p class="" style="">The protocol flow is as follows.</p>
    <p class="caption"><a name="example-36" id="example-36"></a>Example 36. Initiator sends session-initiate</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='jingle1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns-udp'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-37" id="example-37"></a>Example 37. Receiver sends provisional acceptance</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='accept1'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </pre></div>
    <p class="" style="">However, Juliet wants to make sure that the communications are encrypted, so she sends a "content-modify" request to Romeo.</p>
    <p class="caption"><a name="example-38" id="example-38"></a>Example 38. Receiver requests content-modify</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='mod1' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='content-modify'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='UDP/TLS/RTP/AVP'/&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Romeo then acknowledges the content-modify request and, if it is acceptable, returns a content-accept:</p>
    <p class="caption"><a name="example-39" id="example-39"></a>Example 39. Initiator acknowledges content-modify</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='mod1' type='result'/&gt;
    </pre></div>
    <p class="caption"><a name="example-40" id="example-40"></a>Example 40. Initiator accepts content definition</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' to='juliet@capulet.lit/balcony' id='mod2' type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='content-accept'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='this-is-the-audio-content' profile='UDP/TLS/RTP/AVP'/&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The other party then acknowledges the acceptance.</p>
    <p class="caption"><a name="example-41" id="example-41"></a>Example 41. Receiver acknowledges content-accept</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='mod2' type='result'/&gt;
    </pre></div>
    <p class="" style="">As in Scenario #1, the parties exchange ICE candidates (see above for examples).</p>
    <p class="" style="">If one of the candidate transports is found to work, the receiver accepts the session.</p>
    <p class="caption"><a name="example-42" id="example-42"></a>Example 42. Receiver sends session-accept</p><div class="indent"><pre>
&lt;iq type='set' from='juliet@capulet.lit/balcony' to='romeo@montague.lit/orchard' id='accept1'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content' profile='UDP/TLS/RTP/AVP'&gt;
      &lt;description xmlns='http://www.xmpp.org/extensions/xep-0167.html#ns'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='102' name='iLBC'/&gt;
        &lt;payload-type id='4' name='G723'/&gt;
        &lt;payload-type id='8' name='PCMA'/&gt;
        &lt;payload-type id='13' name='CN'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='http://www.xmpp.org/extensions/xep-0176.html#ns'&gt;
        &lt;candidate ip='208.245.212.67' port='9876' generation='0'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the payload types and transport candidate can be successfully used by both parties, then the initiator acknowledges the session-accept.</p>
    <p class="caption"><a name="example-43" id="example-43"></a>Example 43. Initiator acknowledges session-accept</p><div class="indent"><pre>
&lt;iq type='result' to='juliet@capulet.lit/balcony' from='romeo@montague.lit/orchard' id='accept1'/&gt;
    </pre></div>
    <p class="" style="">The parties now begin to exchange media. In this case they would exchange audio using the Speex codec at a clockrate of 8000 since that is the highest-priority codec for the responder (as determined by the XML order of the &lt;payload-type/&gt; children).</p>
    <p class="" style="">The parties may continue the session as long as desired.</p>
    <p class="" style="">Eventually, one of the parties terminates the session.</p>
  <p class="caption"><a name="example-44" id="example-44"></a>Example 44. Receiver terminates the session</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='term1'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
          action='session-terminate'
          initiator='romeo@montague.lit/orchard'
          reason='Sorry, gotta go!'
          sid='a73sjjvkla37jfea'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The other party MUST then acknowledge termination of the session:</p>
    <p class="caption"><a name="example-45" id="example-45"></a>Example 45. Initiator Acknowledges Termination</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard' 
    id='term1'
    to='juliet@capulet.lit/balcony' 
    type='result'/&gt;
    </pre></div>
  </div>
<h2>8.
       <a name="def" id="def">Formal Definition</a></h2>
  <div class="indent"><h3>8.1 <a name="def-jingle" id="def-jingle">Jingle Element</a></h3>
    <p class="" style="">The &lt;jingle/&gt; element MAY be empty or contain one or more &lt;content/&gt; elements (for which see <a href="#def-content">Content Element</a>).</p>
    <p class="" style="">The attributes of the &lt;jingle/&gt; element are as follows.</p>
    <p class="caption"><a name="table-3" id="table-3"></a>Table 3: Attributes of Jingle Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">action</td>
        <td colspan="" rowspan="">A Jingle action as listed in this document (e.g., "session-terminate").</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">initiator</td>
        <td colspan="" rowspan="">The full JID of the entity that has initiated the session flow (which may be different from the 'from' address on the IQ-set).</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">reasoncode</td>
        <td colspan="" rowspan="">A machine-readable purpose for the action being sent (e.g., "connectivity-error" for a session-terminate action).</td>
        <td colspan="" rowspan="">OPTIONAL</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">reasontext</td>
        <td colspan="" rowspan="">A human-readable purpose for the action being sent (e.g., "Sorry, gotta go!" for a session-terminate action).</td>
        <td colspan="" rowspan="">OPTIONAL</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">responder</td>
        <td colspan="" rowspan="">The full JID of the entity that has replied to the initiation, which may be different from the 'to' address on the IQ-set.</td>
        <td colspan="" rowspan="">RECOMMENDED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">sid</td>
        <td colspan="" rowspan="">A random session identifier generated by the initiator, which effectively maps to the SIP "Call-ID" parameter; this SHOULD match the XML Nmtoken production  [<a href="#nt-id2264536">22</a>] so that XML character escaping is not needed for characters such as &amp;.</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table>
  </div>
  <div class="indent"><h3>8.2 <a name="def-content" id="def-content">Content Element</a></h3>
    <p class="" style="">The attributes of the &lt;content/&gt; element are as follows:</p>
    <p class="caption"><a name="table-4" id="table-4"></a>Table 4: Attributes of Content Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">creator</td>
        <td colspan="" rowspan="">Which party originally generated the content description (used to prevent race conditions regarding modifications).</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">name</td>
        <td colspan="" rowspan="">A unique name or identifier for the content type (this identifier is opaque and does not have semantic meaning).</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">profile</td>
        <td colspan="" rowspan="">The profile in use (e.g., "RTP/AVP" in the context of the Real-time Transport Protocol).</td>
        <td colspan="" rowspan="">RECOMMENDED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">senders</td>
        <td colspan="" rowspan="">which entities in the session will be generating content; the allowable values are "initiator", "recipient", or "both" (where "both" is the default).</td>
        <td colspan="" rowspan="">RECOMMENDED</td>
      </tr>
    </table>
  </div>
<h2>9.
       <a name="errors" id="errors">Error Handling</a></h2>
  <p class="" style="">The Jingle-specific error conditions are as follows.</p>
  <p class="caption"><a name="table-5" id="table-5"></a>Table 5: Other Error Conditions</p><table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th colspan="" rowspan="">Jingle Condition</th>
      <th colspan="" rowspan="">XMPP Condition</th>
      <th colspan="" rowspan="">Description</th>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">&lt;out-of-order/&gt;</td>
      <td colspan="" rowspan="">&lt;unexpected-request/&gt;</td>
      <td colspan="" rowspan="">The request cannot occur at this point in the state machine (e.g., initiate after accept).</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">&lt;unknown-session/&gt;</td>
      <td colspan="" rowspan="">&lt;bad-request/&gt;</td>
      <td colspan="" rowspan="">The 'sid' attribute specifies a session that is unknown to the recipient (e.g., no longer live according to the recipient's state machine because the recipient previously terminated the session).</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">&lt;unsupported-content/&gt;</td>
      <td colspan="" rowspan="">&lt;not-acceptable/&gt;</td>
      <td colspan="" rowspan="">The recipient does not support any of the desired content description formats.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">&lt;unsupported-info/&gt;</td>
      <td colspan="" rowspan="">&lt;feature-not-implemented/&gt;</td>
      <td colspan="" rowspan="">The recipient does not support the informational payload of a session-info message.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">&lt;unsupported-transports/&gt;</td>
      <td colspan="" rowspan="">&lt;not-acceptable/&gt;</td>
      <td colspan="" rowspan="">The recipient does not support any of the desired content transport methods.</td>
    </tr>
  </table>
<h2>10.
       <a name="support" id="support">Determining Support</a></h2>
  <p class="" style="">If an entity supports Jingle, it MUST advertise that fact by returning a feature of "http://www.xmpp.org/extensions/xep-0166.html#ns" (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces) in response to <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2264968">23</a>] information requests.</p>
  <p class="caption"><a name="example-46" id="example-46"></a>Example 46. Service Discovery Information Request</p><div class="indent"><pre>
&lt;iq from='romeo@montague.lit/orchard'
    id='disco1'
    to='juliet@capulet.lit/balcony'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-47" id="example-47"></a>Example 47. Service Discovery Information Response</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='disco1'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='http://www.xmpp.org/extensions/xep-0166.html#ns'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>11.
       <a name="conformance" id="conformance">Conformance by Using Protocols</a></h2>
  <div class="indent"><h3>11.1 <a name="conformance-apps" id="conformance-apps">Application Types</a></h3>
    <p class="" style="">A document that specifies a Jingle application type (e.g., audio via RTP) MUST define:</p>
    <ol start="" class="" style="">
      <li class="" style="">How successful content negotiation occurs for encapsulation into Jingle.</li>
      <li class="" style="">A &lt;description/&gt; element and associated semantics for representing the content.</li>
      <li class="" style="">If and how the content description can be mapped to the Session Description Protocol.</li>
      <li class="" style="">Whether the content should be sent over a reliable or lossy transport type (or both).</li>
      <li class="" style="">Exactly how the content is to be sent and received over a reliable or lossy transport.</li>
    </ol>
  </div>
  <div class="indent"><h3>11.2 <a name="conformance-transports" id="conformance-transports">Transport Methods</a></h3>
    <p class="" style="">A document that specifies a Jingle transport method (e.g., Raw UDP) MUST define:</p>
    <ol start="" class="" style="">
      <li class="" style="">How successful transport negotiation occurs for encapsulation into Jingle.</li>
      <li class="" style="">A &lt;transport/&gt; element and associated semantics for representing the transport type.</li>
      <li class="" style="">Whether the transport is reliable or lossy.</li>
      <li class="" style="">If and how the transport handles components as defined herein (e.g., for the Real Time Control Protocol).</li>
    </ol>
  </div>
<h2>12.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>12.1 <a name="security-dos" id="security-dos">Denial of Service</a></h3>
    <p class="" style="">Jingle sessions may be resource-intensive. Therefore, it is possible to launch a denial-of-service attack against an entity by burdening it with too many Jingle sessions. Care must be taken to accept content sessions only from known entities and only if the entity's device is able to process such sessions.</p>
  </div>
  <div class="indent"><h3>12.2 <a name="security-gateways" id="security-gateways">Communication Through Gateways</a></h3>
    <p class="" style="">Jingle communications may be enabled through gateways to non-XMPP networks, whose security characteristics may be quite different from those of XMPP networks. (For example, on some SIP networks authentication is optional and "from" addresses can be easily forged.) Care must be taken in communicating through such gateways.</p>
  </div>
<h2>13.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2265235">24</a>].</p>
<h2>14.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <div class="indent"><h3>14.1 <a name="registrar-ns" id="registrar-ns">Protocol Namespaces</a></h3>
    <p class="" style="">Until this specification advances to a status of Draft, its associated namespaces shall be "http://www.xmpp.org/extensions/xep-0166.html#ns" and "http://www.xmpp.org/extensions/xep-0166.html#ns-errors"; upon advancement of this specification, the <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2265293">25</a>] shall issue permanent namespaces in accordance with the process defined in Section 4 of <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0053.html">XMPP Registrar Function</a></span>  [<a href="#nt-id2265332">26</a>].</p>
  </div>
  <div class="indent"><h3>14.2 <a name="registrar-content" id="registrar-content">Jingle Content Description Formats Registry</a></h3>
    <p class="" style="">The XMPP Registrar shall maintain a registry of Jingle content description formats. All content description format registrations shall be defined in separate specifications (not in this document). Content description formats defined within the XEP series MUST be registered with the XMPP Registrar, resulting in protocol URNs of the form "urn:xmpp:jingle:description:name" (where "name" is the registered name of the content description format).</p>
    <p class="" style="">In order to submit new values to this registry, the registrant must define an XML fragment of the following form and either include it in the relevant XMPP Extension Protocol or send it to the email address &lt;registrar@xmpp.org&gt;:</p>
    <p class="caption"></p><div class="indent"><pre>
&lt;content&gt;
  &lt;name&gt;the name of the content description format&lt;/name&gt;
  &lt;desc&gt;a natural-language summary of the content description format&lt;/desc&gt;
  &lt;transport&gt;whether the content should be sent over a "reliable" or "lossy" transport&lt;/transport&gt;
  &lt;doc&gt;the document in which this content description format is specified&lt;/doc&gt;
&lt;/content&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>14.3 <a name="registrar-transports" id="registrar-transports">Jingle Content Transport Methods Registry</a></h3>
    <p class="" style="">The XMPP Registrar shall maintain a registry of Jingle content transport methods. All content transport method registrations shall be defined in separate specifications (not in this document). Content transport methods defined within the XEP series MUST be registered with the XMPP Registrar, resulting in protocol URNs of the form "urn:xmpp:jingle:transport:name" (where "name" is the registered name of the content transport method).</p>
    <p class="" style="">In order to submit new values to this registry, the registrant must define an XML fragment of the following form and either include it in the relevant XMPP Extension Protocol or send it to the email address &lt;registrar@xmpp.org&gt;:</p>
    <p class="caption"></p><div class="indent"><pre>
&lt;transport&gt;
  &lt;name&gt;the name of the content transport method&lt;/name&gt;
  &lt;desc&gt;a natural-language summary of the content transport method&lt;/desc&gt;
  &lt;type&gt;whether the transport method is "reliable" or "lossy"&lt;/type&gt;
  &lt;doc&gt;the document in which this content transport method is specified&lt;/doc&gt;
&lt;/transport&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>14.4 <a name="registrar-reasoncodes" id="registrar-reasoncodes">Jingle Reason Codes Registry</a></h3>
    <div class="indent"><h3>14.4.1 <a name="registrar-reasoncodes-process" id="registrar-reasoncodes-process">Process</a></h3>
      <p class="" style="">The XMPP Registrar shall maintain a registry of reasons for Jingle actions.</p>
      <p class="" style="">In order to submit new values to this registry, the registrant must define an XML fragment of the following form and either include it in the relevant XMPP Extension Protocol or send it to the email address &lt;registrar@xmpp.org&gt;:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;reason&gt;
  &lt;code&gt;the value of the 'reasoncode' attribute&lt;/name&gt;
  &lt;desc&gt;a natural-language summary of the reason code&lt;/desc&gt;
  &lt;doc&gt;the document in which this reason code is specified&lt;/doc&gt;
&lt;/reason&gt;
      </pre></div>
    </div>
    <div class="indent"><h3>14.4.2 <a name="registrar-reasoncodes-reg" id="registrar-reasoncodes-reg">Initial Registration</a></h3>
      <p class="" style="">The following submission registers reasoncodes in use as of April 2007. Refer to the registry itself for a complete and current list of reasoncodes.</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;reason&gt;
  &lt;code&gt;connectivity-error&lt;/code&gt;
  &lt;desc&gt;the action (e.g., session-terminate) is related to connectivity problems&lt;/desc&gt;
  &lt;doc&gt;XEP-0166&lt;/doc&gt;
&lt;/reason&gt;

&lt;reason&gt;
  &lt;code&gt;general-error&lt;/code&gt;
  &lt;desc&gt;the action (e.g., session-terminate) is related to a non-specific application error&lt;/desc&gt;
  &lt;doc&gt;XEP-0166&lt;/doc&gt;
&lt;/reason&gt;

&lt;reason&gt;
  &lt;code&gt;media-error&lt;/code&gt;
  &lt;desc&gt;the action (e.g., session-terminate) is related to media processing problems&lt;/desc&gt;
  &lt;doc&gt;XEP-0166&lt;/doc&gt;
&lt;/reason&gt;

&lt;reason&gt;
  &lt;code&gt;no-error&lt;/code&gt;
  &lt;desc&gt;the action is generated during the normal course of state management&lt;/desc&gt;
  &lt;doc&gt;XEP-0166&lt;/doc&gt;
&lt;/reason&gt;
      </pre></div>
    </div>
  </div>
<h2>15.
       <a name="schema" id="schema">XML Schemas</a></h2>
  <div class="indent"><h3>15.1 <a name="schema-jingle" id="schema-jingle">Jingle</a></h3>
    <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.xmpp.org/extensions/xep-0166.html#ns'
    xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='jingle'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='1' maxOccurs='unlimited'&gt;
        &lt;xs:element ref='content'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='action' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='content-accept'/&gt;
            &lt;xs:enumeration value='content-add'/&gt;
            &lt;xs:enumeration value='content-modify'/&gt;
            &lt;xs:enumeration value='content-remove'/&gt;
            &lt;xs:enumeration value='session-accept'/&gt;
            &lt;xs:enumeration value='session-info'/&gt;
            &lt;xs:enumeration value='session-initiate'/&gt;
            &lt;xs:enumeration value='session-terminate'/&gt;
            &lt;xs:enumeration value='transport-info'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='initiator' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='reasoncode' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='reasontext' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='responder' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='sid' type='xs:NMTOKEN' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='content'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace='##other' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='creator' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='initiator'&gt;
            &lt;xs:enumeration value='responder'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='name' use='required' type='xs:string'/&gt;
      &lt;xs:attribute name='profile' use='optional' type='xs:string'/&gt;
      &lt;xs:attribute name='senders' use='optional' default='both'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='both'&gt;
            &lt;xs:enumeration value='initiator'&gt;
            &lt;xs:enumeration value='responder'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>15.2 <a name="schema-errors" id="schema-errors">Jingle Errors</a></h3>
    <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.xmpp.org/extensions/xep-0166.html#ns-errors'
    xmlns='http://www.xmpp.org/extensions/xep-0166.html#ns-errors'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='out-of-order' type='empty'/&gt;
  &lt;xs:element name='unknown-session' type='empty'/&gt;
  &lt;xs:element name='unsupported-content' type='empty'/&gt;
  &lt;xs:element name='unsupported-transports' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
    </pre></div>
  </div>
<h2>16.
       <a name="history" id="history">History</a></h2>
  <p class="" style="">Until Jingle was developed, there existed no widely-adopted standard for initiating and managing peer-to-peer interactions between XMPP entities. Although several large service providers and Jabber client teams had written and implemented their own proprietary XMPP extensions for peer-to-peer signalling (usually only for voice), those technologies were not open and did not always take into account requirements to interoperate with SIP-based technologies. The only existing open protocol was <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0111.html">A Transport for Initiating and Negotiating Sessions</a></span>  [<a href="#nt-id2265654">27</a>], which made it possible to initiate and manage peer-to-peer sessions, but which did not provide enough of the key signalling semantics to be easily implemented in Jabber/XMPP clients.  [<a href="#nt-id2265630">28</a>]</p> 
  <p class="" style="">The result was an unfortunate fragmentation within the XMPP community regarding signalling protocols. Essentially, there were two possible approaches to solving the problem:</p>
  <ol start="" class="" style="">
    <li class="" style="">Recommend that all client developers implement a dual-stack (XMPP + SIP) solution.</li>
    <li class="" style="">Define a full-featured protocol for XMPP signalling.</li>
  </ol>
  <p class="" style="">Implementation experience indicates that a dual-stack approach may not be feasible on all the computing platforms for which Jabber clients have been written, or even desirable on platforms where it is feasible.  [<a href="#nt-id2265710">29</a>] Therefore, it seemed reasonable to define an XMPP signalling protocol that could provide the necessary session management semantics while also making it relatively straightforward to interoperate with existing Internet standards.</p>
  <p class="" style="">As a result of feedback received on <span class="ref">XEP-0111</span>, the original authors of this document (Joe Hildebrand and Peter Saint-Andre) began to define such a signalling protocol, code-named Jingle. Upon communication with members of the Google Talk team,  [<a href="#nt-id2265734">30</a>] it was discovered that the emerging Jingle approach was conceptually (and even syntactically) quite similar to the signalling protocol used in the Google Talk application. Therefore, in the interest of interoperability and adoption, we decided to harmonize the two approaches. The signalling protocol specified herein is, therefore, substantially equivalent to the original Google Talk protocol, with several adjustments based on feedback received from implementors as well as for publication within the XMPP Standards Foundation's standards process.</p>
<h2>17.
       <a name="ack" id="ack">Acknowledgements</a></h2>
  <p class="" style="">The authors would like to thank Rohan Mahy for his valuable input on early versions of this document. Thiago Camargo, Dafydd Harries, Antti Ijäs, Lauri Kaila, Justin Karneges, Jussi Laako, Anthony Minessale, Matt O'Gorman, Rob Taylor, Matt Tucker, Saku Vainio, Brian West, and others have also provided helpful input. Thanks also to those who have commented on the <span class="ref" style=""><a href="http://mail.jabber.org/mailman/listinfo/standards/">Standards SIG</a></span>  [<a href="#nt-id2265813">31</a>] and (earlier) Jingle  [<a href="#nt-id2265796">32</a>] mailing lists.</p>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2251607" id="nt-id2251607">1</a>. RFC 3550: RTP: A Transport Protocol for Real-Time Applications &lt;<a href="http://tools.ietf.org/html/rfc3550">http://tools.ietf.org/html/rfc3550</a>&gt;.</p><p><a name="nt-id2251592" id="nt-id2251592">2</a>. RFC 768: User Datagram Protocol &lt;<a href="http://tools.ietf.org/html/rfc0768">http://tools.ietf.org/html/rfc0768</a>&gt;.</p><p><a name="nt-id2251650" id="nt-id2251650">3</a>. Interactive Connectivity Establishment (ICE): A Methodology for Network Address Translator (NAT) Traversal for Offer/Answer Protocols &lt;<a href="http://tools.ietf.org/html/draft-ietf-mmusic-ice">http://tools.ietf.org/html/draft-ietf-mmusic-ice</a>&gt;. Work in progress.</p><p><a name="nt-id2261082" id="nt-id2261082">4</a>. XEP-0167: Jingle Audio via RTP &lt;<a href="http://www.xmpp.org/extensions/xep-0167.html">http://www.xmpp.org/extensions/xep-0167.html</a>&gt;.</p><p><a name="nt-id2261117" id="nt-id2261117">5</a>. RFC 3261: Session Initiation Protocol (SIP) &lt;<a href="http://tools.ietf.org/html/rfc3261">http://tools.ietf.org/html/rfc3261</a>&gt;.</p><p><a name="nt-id2261155" id="nt-id2261155">6</a>. XEP-0180: Jingle Video via RTP &lt;<a href="http://www.xmpp.org/extensions/xep-0180.html">http://www.xmpp.org/extensions/xep-0180.html</a>&gt;.</p><p><a name="nt-id2261244" id="nt-id2261244">7</a>. XEP-0177: Jingle Raw UDP Transport Method &lt;<a href="http://www.xmpp.org/extensions/xep-0177.html">http://www.xmpp.org/extensions/xep-0177.html</a>&gt;.</p><p><a name="nt-id2261633" id="nt-id2261633">8</a>. RFC 4566: SDP: Session Description Protocol &lt;<a href="http://tools.ietf.org/html/rfc4566">http://tools.ietf.org/html/rfc4566</a>&gt;.</p><p><a name="nt-id2261675" id="nt-id2261675">9</a>. XEP-0176: Jingle ICE Transport Method &lt;<a href="http://www.xmpp.org/extensions/xep-0176.html">http://www.xmpp.org/extensions/xep-0176.html</a>&gt;.</p><p><a name="nt-id2261717" id="nt-id2261717">10</a>. ITU Recommendation H.323: Packet-based Multimedia Communications Systems (September 1999).</p><p><a name="nt-id2262179" id="nt-id2262179">11</a>. In the event that a session contains two unidirectional streams of the same type because a content-add was issued simultaneously by both parties, it is RECOMMENDED that participants close the duplicate stream in favour of that created by the session initiator, which should be made bidirectional with a 'content-modify' action by the responder.</p><p><a name="nt-id2262226" id="nt-id2262226">12</a>. If both parties send modify messages at the same time, the modify message from the session initiator MUST trump the modify message from the recipient and the initiator SHOULD return an &lt;unexpected-request/&gt; error to the other party.</p><p><a name="nt-id2262257" id="nt-id2262257">13</a>. A client MUST NOT return an error upon receipt of a 'content-remove' action for a content description that is received after a 'content-remove' action has been sent but before the action has been acknowledged by the peer.</p><p><a name="nt-id2262264" id="nt-id2262264">14</a>. If the content-remove results in no more content types for the session, the entity that receives the content-remove SHOULD send a session-terminate action to the other party (since a session with no content types is void).</p><p><a name="nt-id2262470" id="nt-id2262470">15</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-id2262499" id="nt-id2262499">16</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2262524" id="nt-id2262524">17</a>. XEP-0115: Entity Capabilities &lt;<a href="http://www.xmpp.org/extensions/xep-0115.html">http://www.xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-id2262484" id="nt-id2262484">18</a>. Naturally, instead of sending service discovery requests to every contact in a user's roster, it is more efficient to use <span class="ref">Entity Capabilities</span>, whereby support for Jingle and various Jingle content description formats and content transport methods is determined for a client version in general (rather than on a per-JID basis) and then cached. Refer to <span class="ref">XEP-0115</span> for details.</p><p><a name="nt-id2262587" id="nt-id2262587">19</a>. XEP-0168: Resource Application Priority &lt;<a href="http://www.xmpp.org/extensions/xep-0168.html">http://www.xmpp.org/extensions/xep-0168.html</a>&gt;.</p><p><a name="nt-id2262645" id="nt-id2262645">20</a>. XEP-0155: Stanza Session Negotiation &lt;<a href="http://www.xmpp.org/extensions/xep-0155.html">http://www.xmpp.org/extensions/xep-0155.html</a>&gt;.</p><p><a name="nt-id2264042" id="nt-id2264042">21</a>. Real-Time Transport Protocol (RTP) over Datagram Transport Layer Security (DTLS) &lt;<a href="http://tools.ietf.org/html/draft-fischl-mmusic-sdp-dtls">http://tools.ietf.org/html/draft-fischl-mmusic-sdp-dtls</a>&gt;. Work in progress.</p><p><a name="nt-id2264536" id="nt-id2264536">22</a>. See &lt;<a href="http://www.w3.org/TR/2000/WD-xml-2e-20000814#NT-Nmtoken">http://www.w3.org/TR/2000/WD-xml-2e-20000814#NT-Nmtoken</a>&gt;</p><p><a name="nt-id2264968" id="nt-id2264968">23</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2265235" id="nt-id2265235">24</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2265293" id="nt-id2265293">25</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-id2265332" id="nt-id2265332">26</a>. XEP-0053: XMPP Registrar Function &lt;<a href="http://www.xmpp.org/extensions/xep-0053.html">http://www.xmpp.org/extensions/xep-0053.html</a>&gt;.</p><p><a name="nt-id2265654" id="nt-id2265654">27</a>. XEP-0111: A Transport for Initiating and Negotiating Sessions &lt;<a href="http://www.xmpp.org/extensions/xep-0111.html">http://www.xmpp.org/extensions/xep-0111.html</a>&gt;.</p><p><a name="nt-id2265630" id="nt-id2265630">28</a>. It is true that TINS made it relatively easy to implement an XMPP-to-SIP gateway; however, in line with the long-time Jabber philosophy of "simple clients, complex servers", it would be better to force complexity onto the server-side gateway and to keep the client as simple as possible.</p><p><a name="nt-id2265710" id="nt-id2265710">29</a>. For example, one large ISP decided to switch to a pure XMPP approach after having implemented and deployed a dual-stack client for several years.</p><p><a name="nt-id2265734" id="nt-id2265734">30</a>. Google Talk is a messaging and voice chat service and client provided by Google; see &lt;<a href="http://www.google.com/talk/">http://www.google.com/talk/</a>&gt;.</p><p><a name="nt-id2265813" id="nt-id2265813">31</a>. The Standards SIG is a standing Special Interest Group devoted to development of XMPP Extension Protocols. The discussion list of the Standards SIG is the primary venue for discussion of XMPP protocol extensions, as well as for announcements by the XMPP Extensions Editor and XMPP Registrar. To subscribe to the list or view the list archives, visit &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards/">http://mail.jabber.org/mailman/listinfo/standards/</a>&gt;.</p><p><a name="nt-id2265796" id="nt-id2265796">32</a>. Before this specification was accepted as a XMPP Extension Protocol specification, it was discussed on the semi-private &lt;jingle@jabber.org&gt; mailing list; although that list is no longer used (the Standards list is the preferred discussion venue), for historical purposes it is publicly archived at &lt;<a href="http://mail.jabber.org/pipermail/jingle/">http://mail.jabber.org/pipermail/jingle/</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 0.18 (2007-11-08)</h4><div class="indent"><p class="" style="">Added scenarios for various session flows; clarified handling of content-add, content-modify, and content-remove actions; clarified rules for codec priority.</p> (psa)
    </div><h4>Version 0.17 (2007-06-20)</h4><div class="indent"><p class="" style="">Added &lt;unsupported-info/&gt; error.</p> (psa)
    </div><h4>Version 0.16 (2007-06-06)</h4><div class="indent"><p class="" style="">Clarified resource determination process and updated text to reflect modifications to XEP-0168.</p> (psa)
    </div><h4>Version 0.15 (2007-05-25)</h4><div class="indent"><p class="" style="">Rewrote introduction and moved historical text to separate section.</p> (psa)
    </div><h4>Version 0.14 (2007-04-17)</h4><div class="indent"><p class="" style="">Clarified session lifetime; defined reason attribute and associated registry; further specified conformance requirements.</p> (psa)
    </div><h4>Version 0.13 (2007-03-23)</h4><div class="indent"><p class="" style="">Simplified signalling process and state chart; Removed session-redirect action (use redirect error instead); removed content-decline action; removed transport-* actions (except transport-info for ICE negotiation); removed description-* actions; simplified syntax to allow only one transport per content type; corrected syntax of creator attribute to be either initiator or responder (not JIDs); added profile attribute to content element in order to specify RTP profile in use.</p> (psa/ram)
    </div><h4>Version 0.12 (2006-12-21)</h4><div class="indent"><p class="" style="">Added creator attribute to content element for prevention of race condition; modified spec to use provisional namespace before advancement to Draft (per XEP-0053).</p> (psa/ram)
    </div><h4>Version 0.11 (2006-10-31)</h4><div class="indent"><p class="" style="">Completed clarifications and corrections throughout; added section on Jingle Actions.</p> (psa)
    </div><h4>Version 0.10 (2006-09-29)</h4><div class="indent"><p class="" style="">Made several corrections to the state machines and examples.</p> (ram/psa)
    </div><h4>Version 0.9 (2006-09-08)</h4><div class="indent"><p class="" style="">Further cleaned up state machines and state-related actions.</p> (ram/psa)
    </div><h4>Version 0.8 (2006-08-23)</h4><div class="indent"><p class="" style="">Changed channels to components in line with ICE; changed various action names for consistency; added session-extend and session-reduce actions to add and remove description/transport pairs; added description-modify action; added sender attribute to specify directionality.</p> (ram/psa)
    </div><h4>Version 0.7 (2006-07-17)</h4><div class="indent"><p class="" style="">Added implementation note about handling multiple content types.</p> (psa)
    </div><h4>Version 0.6 (2006-07-12)</h4><div class="indent"><p class="" style="">Changed media type to content type.</p> (se/psa)
    </div><h4>Version 0.5 (2006-03-20)</h4><div class="indent"><p class="" style="">Further clarified state machine diagrams; specified that session accept must include agreed-upon media format and transport description; moved deployment notes to appropriate transport spec.</p> (psa/jb)
    </div><h4>Version 0.4 (2006-03-01)</h4><div class="indent"><p class="" style="">Added glossary; clarified state machines; updated to reflect publication of XEP-0176 and XEP-0177.</p> (psa/jb)
    </div><h4>Version 0.3 (2006-02-24)</h4><div class="indent"><p class="" style="">Provided more detail about modify scenarios; defined media-specific and transport-specific actions and adjusted state machine accordingly.</p> (psa/jb)
    </div><h4>Version 0.2 (2006-02-13)</h4><div class="indent"><p class="" style="">Per agreement among the co-authors, moved transport definition to separate specification, simplified state machine, and made other associated changes to the text, examples, and schemas; also harmonized redirect, decline, and terminate processes.</p> (psa/jb)
    </div><h4>Version 0.1 (2005-12-15)</h4><div class="indent"><p class="" style="">Initial version.</p> (psa)
    </div><h4>Version 0.0.10 (2005-12-11)</h4><div class="indent"><p class="" style="">More fully documented burst mode, connectivity checks, error cases, etc.</p> (psa)
    </div><h4>Version 0.0.9 (2005-12-08)</h4><div class="indent"><p class="" style="">Restructured document flow; provided example of burst mode.</p> (psa)
    </div><h4>Version 0.0.8 (2005-12-05)</h4><div class="indent"><p class="" style="">Distinguished between dribble mode and burst mode, including mode attribute, service discovery features, and implementation notes; provided detailed resource discovery examples; corrected state chart; specified session termination; specified error conditions; specified semantics of informational messages; began to define security considerations; added Joe Beda as co-author.</p> (psa/sl/jb)
    </div><h4>Version 0.0.7 (2005-11-08)</h4><div class="indent"><p class="" style="">Added more detail to basic session flow; harmonized candidate negotiation process with ICE.</p> (psa)
    </div><h4>Version 0.0.6 (2005-10-27)</h4><div class="indent"><p class="" style="">Added XMPP Registrar considerations; defined schema; completed slight syntax cleanup.</p> (psa)
    </div><h4>Version 0.0.5 (2005-10-21)</h4><div class="indent"><p class="" style="">Separated  methoddescription formats from signalling protocol.</p> (psa/sl)
    </div><h4>Version 0.0.4 (2005-10-19)</h4><div class="indent"><p class="" style="">Harmonized basic session flow with Google Talk protocol; added Scott Ludwig as co-author.</p> (psa/sl)
    </div><h4>Version 0.0.3 (2005-10-10)</h4><div class="indent"><p class="" style="">Added more detail to basic session flow.</p> (psa)
    </div><h4>Version 0.0.2 (2005-10-07)</h4><div class="indent"><p class="" style="">Protocol cleanup.</p> (psa/jjh)
    </div><h4>Version 0.0.1 (2005-10-06)</h4><div class="indent"><p class="" style="">First draft.</p> (psa/jjh)
    </div></div><hr /><p>END</p></body></html>
